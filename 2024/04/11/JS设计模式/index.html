<!DOCTYPE html>
<html lang="en,zh-CN,zh-HK,zh-TW,default">
    <head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/#5.8.0'>
  <meta name="generator" content="Hexo 7.3.0">
  <meta name="Volantis" content="5.8.0">
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
  <link rel="canonical" href="http://enderxiao.github.io/2024/04/11/js设计模式/"/>
  <!-- 渲染优化 -->
    <meta http-equiv='x-dns-prefetch-control' content='on' />
      <link rel='dns-prefetch' href='https://unpkg.com'>
      <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Content-Security-Policy" content=" default-src 'self' https:; block-all-mixed-content; base-uri 'self' https:; form-action 'self' https:; worker-src 'self' https:; connect-src 'self' https: *; img-src 'self' data: https: *; media-src 'self' https: *; font-src 'self' data: https: *; frame-src 'self' https: *; manifest-src 'self' https: *; child-src https:; script-src 'self' https: 'unsafe-inline' *; style-src 'self' https: 'unsafe-inline' *; ">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <!-- import head_begin begin -->
  <!-- import head_begin end -->
  <!-- Custom Files headBegin begin-->
  <!-- 引入自定义黑暗模式动画 -->
<script defer src="../custom/drakmode/darkmode.js"></script>
<link rel="stylesheet" href="../custom/drakmode/darkmode.css">

<!-- 引入KaTex公式渲染 -->
<link rel="stylesheet" href="https://unpkg.com/katex@0.16.4/dist/katex.min.css">
<script defer src="https://unpkg.com/katex@0.16.4/dist/katex.min.js"></script>
<script defer src="https://unpkg.com/katex@0.16.4/dist/contrib/copy-tex.min.js"></script>
<!-- 引入公式滚动样式 -->
<link rel="stylesheet" href="../custom/MathScroll/style.css"
  <!-- Custom Files headBegin end-->
  <!-- front-matter head_begin begin -->
  <!-- front-matter head_begin end -->
    <link rel="shortcut icon" type='image/x-icon' href="/images/end_purple_favicon128.ico">
  <link rel="preload" href="/css/style.css" as="style">
  <link rel="preload" href="https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/VarelaRound/VarelaRound-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
<link rel="preload" href="https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/UbuntuMono/UbuntuMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <!-- feed -->
      <link rel="alternate" href="/atom.xml" title="Ender" type="application/atom+xml">
  <!-- 页面元数据 -->
  <title>JS设计模式 - Ender</title>
  <meta name="keywords" content="life,设计模式,前端,JS,Blog EnderXiao">
  <meta desc name="description" content="设计模式收集使用JS实现，参考JS设计模式Github仓库以及书《JavaScript设计模式与开发实践》曾探著 - John Doe - Ender">
  
<meta property="og:type" content="article">
<meta property="og:title" content="JS设计模式">
<meta property="og:url" content="http://enderxiao.github.io/2024/04/11/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html">
<meta property="og:site_name" content="Ender">
<meta property="og:description" content="设计模式收集使用JS实现，参考JS设计模式Github仓库以及书《JavaScript设计模式与开发实践》曾探著">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png">
<meta property="article:published_time" content="2024-04-11T06:11:11.000Z">
<meta property="article:modified_time" content="2024-07-30T11:26:33.909Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="life">
<meta property="article:tag" content="设计模式">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="JS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png">
  <style>
    /* 首屏样式 */
    #safearea {
  display: none;
}
:root {
  --color-site-body: #f4f4f4;
  --color-site-bg: #f4f4f4;
  --color-site-inner: #fff;
  --color-site-footer: #666;
  --color-card: #fff;
  --color-text: #444;
  --color-block: #f6f6f6;
  --color-inlinecode: #c74f00;
  --color-codeblock: #fff7ea;
  --color-h1: #3a3a3a;
  --color-h2: #3a3a3a;
  --color-h3: #333;
  --color-h4: #444;
  --color-h5: #555;
  --color-h6: #666;
  --color-p: #444;
  --color-list: #666;
  --color-list-hl: #c4b23d;
  --color-meta: #888;
  --color-read-bkg: #e0d8c8;
  --color-read-post: #f8f1e2;
  --color-copyright-bkg: #f5f5f5;
}
* {
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  outline: none;
  margin: 0;
  padding: 0;
}
*::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
*::-webkit-scrollbar-track-piece {
  background: transparent;
}
*::-webkit-scrollbar-thumb {
  background: #f5df4d;
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
*::-webkit-scrollbar-thumb:hover {
  background: #ff5722;
}
html {
  color: var(--color-text);
  width: 100%;
  height: 100%;
  font-family: UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  font-size: 16px;
}
html >::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
html >::-webkit-scrollbar-track-piece {
  background: transparent;
}
html >::-webkit-scrollbar-thumb {
  background: #54b5a0 linear-gradient(45deg, rgba(255,255,255,0.4) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.4) 75%, transparent 75%, transparent);
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
html >::-webkit-scrollbar-thumb:hover {
  background: #54b5a0 linear-gradient(45deg, rgba(255,255,255,0.4) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.4) 75%, transparent 75%, transparent);
}
body {
  background-color: var(--color-site-body);
  text-rendering: optimizelegibility;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  line-height: 1.6;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
}
body.modal-active {
  overflow: hidden;
}
@media screen and (max-width: 680px) {
  body.modal-active {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
a {
  color: #f5df4d;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
a:hover {
  color: #ff5722;
}
a:active,
a:hover {
  outline: 0;
}
ul,
ol {
  padding-left: 0;
}
ul li,
ol li {
  list-style: none;
}
header {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
img {
  border: 0;
  background: none;
  max-width: 100%;
}
svg:not(:root) {
  overflow: hidden;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  -webkit-box-sizing: content-box;
  -moz-box-sizing: content-box;
  height: 0;
  border: 0;
  border-radius: 1px;
  -webkit-border-radius: 1px;
  border-bottom: 1px solid rgba(68,68,68,0.1);
}
button,
input {
  color: inherit;
  font: inherit;
  margin: 0;
}
button {
  overflow: visible;
  text-transform: none;
  -webkit-appearance: button;
  cursor: pointer;
}
@supports (backdrop-filter: blur(20px)) {
  .blur {
    background: rgba(255,255,255,0.9) !important;
    backdrop-filter: saturate(200%) blur(20px);
  }
}
.shadow {
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.shadow.floatable {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.shadow.floatable:hover {
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
}
#l_cover {
  min-height: 64px;
}
.cover-wrapper {
  top: 0;
  left: 0;
  max-width: 100%;
  height: 100vh;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  align-self: center;
  align-content: center;
  color: var(--color-site-inner);
  padding: 0 16px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  position: relative;
  overflow: hidden;
  margin-bottom: -100px;
}
.cover-wrapper .cover-body {
  z-index: 1;
  position: relative;
  width: 100%;
  height: 100%;
}
.cover-wrapper#full {
  height: calc(100vh + 100px);
  padding-bottom: 100px;
}
.cover-wrapper#half {
  max-height: 640px;
  min-height: 400px;
  height: calc(36vh - 64px + 200px);
}
.cover-wrapper #scroll-down {
  width: 100%;
  height: 64px;
  position: absolute;
  bottom: 100px;
  text-align: center;
  cursor: pointer;
}
.cover-wrapper #scroll-down .scroll-down-effects {
  color: #fff;
  font-size: 24px;
  line-height: 64px;
  position: absolute;
  width: 24px;
  left: calc(50% - 12px);
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  animation: scroll-down-effect 1.5s infinite;
  -webkit-animation: scroll-down-effect 1.5s infinite;
  -khtml-animation: scroll-down-effect 1.5s infinite;
  -moz-animation: scroll-down-effect 1.5s infinite;
  -o-animation: scroll-down-effect 1.5s infinite;
  -ms-animation: scroll-down-effect 1.5s infinite;
}
@-moz-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.cover-wrapper .cover-body {
  margin-top: 64px;
  margin-bottom: 100px;
}
.cover-wrapper .cover-body,
.cover-wrapper .cover-body .top,
.cover-wrapper .cover-body .bottom {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  max-width: 100%;
}
.cover-wrapper .cover-body .bottom {
  margin-top: 32px;
}
.cover-wrapper .cover-body .title {
  font-family: "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
  font-size: 3.125rem;
  line-height: 1.2;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.cover-wrapper .cover-body .subtitle {
  font-size: 20px;
}
.cover-wrapper .cover-body .logo {
  max-height: 120px;
  max-width: calc(100% - 4 * 16px);
}
@media screen and (min-height: 1024px) {
  .cover-wrapper .cover-body .title {
    font-size: 3rem;
  }
  .cover-wrapper .cover-body .subtitle {
    font-size: 1.05rem;
  }
  .cover-wrapper .cover-body .logo {
    max-height: 150px;
  }
}
.cover-wrapper .cover-body .m_search {
  position: relative;
  max-width: calc(100% - 16px);
  width: 320px;
  vertical-align: middle;
}
.cover-wrapper .cover-body .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  width: 100%;
}
.cover-wrapper .cover-body .m_search .icon,
.cover-wrapper .cover-body .m_search .input {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.cover-wrapper .cover-body .m_search .icon {
  position: absolute;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  line-height: 2.5rem;
  width: 32px;
  top: 0;
  left: 5px;
  color: rgba(68,68,68,0.75);
}
.cover-wrapper .cover-body .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  height: 2.5rem;
  width: 100%;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  font-size: 0.875rem;
  -webkit-appearance: none;
  padding-left: 36px;
  border-radius: 1.4rem;
  -webkit-border-radius: 1.4rem;
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(10px);
  border: none;
  color: var(--color-text);
}
@media screen and (max-width: 500px) {
  .cover-wrapper .cover-body .m_search .input {
    padding-left: 36px;
  }
}
.cover-wrapper .cover-body .m_search .input:hover {
  background: rgba(255,255,255,0.8);
}
.cover-wrapper .cover-body .m_search .input:focus {
  background: #fff;
}
.cover-wrapper .list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  flex-wrap: wrap;
  -webkit-flex-wrap: wrap;
  -khtml-flex-wrap: wrap;
  -moz-flex-wrap: wrap;
  -o-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  align-items: stretch;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.cover-wrapper .list-h a {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 0;
  -ms-flex: 1 0;
  flex: 1 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  font-weight: 600;
}
.cover-wrapper .list-h a img {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  border-radius: 2px;
  -webkit-border-radius: 2px;
  margin: 4px;
  min-width: 40px;
  max-width: 44px;
}
@media screen and (max-width: 768px) {
  .cover-wrapper .list-h a img {
    min-width: 36px;
    max-width: 40px;
  }
}
@media screen and (max-width: 500px) {
  .cover-wrapper .list-h a img {
    margin: 2px 4px;
    min-width: 32px;
    max-width: 36px;
  }
}
@media screen and (max-width: 375px) {
  .cover-wrapper .list-h a img {
    min-width: 28px;
    max-width: 32px;
  }
}
.cover-wrapper {
  max-width: 100%;
}
.cover-wrapper.search .bottom .menu {
  margin-top: 16px;
}
.cover-wrapper.search .bottom .menu .list-h a {
  white-space: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  align-items: baseline;
  padding: 2px;
  margin: 4px;
  color: var(--color-site-inner);
  opacity: 0.75;
  -webkit-opacity: 0.75;
  -moz-opacity: 0.75;
  text-shadow: 0 1px 2px rgba(0,0,0,0.05);
  border-bottom: 2px solid transparent;
}
.cover-wrapper.search .bottom .menu .list-h a i {
  margin-right: 4px;
}
.cover-wrapper.search .bottom .menu .list-h a p {
  font-size: 0.9375rem;
}
.cover-wrapper.search .bottom .menu .list-h a:hover,
.cover-wrapper.search .bottom .menu .list-h a.active,
.cover-wrapper.search .bottom .menu .list-h a:active {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
  border-bottom: 2px solid var(--color-site-inner);
}
.cover-wrapper.dock .menu,
.cover-wrapper.featured .menu,
.cover-wrapper.focus .menu {
  border-radius: 6px;
  -webkit-border-radius: 6px;
}
.cover-wrapper.dock .menu .list-h a,
.cover-wrapper.featured .menu .list-h a,
.cover-wrapper.focus .menu .list-h a {
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  padding: 12px;
  line-height: 24px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  border-bottom: none;
  text-align: center;
  align-content: flex-end;
  color: rgba(68,68,68,0.7);
  font-size: 1.5rem;
}
@media screen and (max-width: 500px) {
  .cover-wrapper.dock .menu .list-h a,
  .cover-wrapper.featured .menu .list-h a,
  .cover-wrapper.focus .menu .list-h a {
    padding: 12px 8px;
  }
}
.cover-wrapper.dock .menu .list-h a i,
.cover-wrapper.featured .menu .list-h a i,
.cover-wrapper.focus .menu .list-h a i {
  margin: 8px;
}
.cover-wrapper.dock .menu .list-h a p,
.cover-wrapper.featured .menu .list-h a p,
.cover-wrapper.focus .menu .list-h a p {
  font-size: 0.875rem;
}
.cover-wrapper.dock .menu .list-h a.active,
.cover-wrapper.featured .menu .list-h a.active,
.cover-wrapper.focus .menu .list-h a.active {
  background: var(--color-card);
  backdrop-filter: none;
}
.cover-wrapper.dock .menu .list-h a.active i,
.cover-wrapper.featured .menu .list-h a.active i,
.cover-wrapper.focus .menu .list-h a.active i,
.cover-wrapper.dock .menu .list-h a.active i+p,
.cover-wrapper.featured .menu .list-h a.active i+p,
.cover-wrapper.focus .menu .list-h a.active i+p {
  color: #f5df4d;
}
.cover-wrapper.dock .menu .list-h a.active img+p,
.cover-wrapper.featured .menu .list-h a.active img+p,
.cover-wrapper.focus .menu .list-h a.active img+p {
  color: var(--color-text);
}
.cover-wrapper.dock .menu .list-h a:hover,
.cover-wrapper.featured .menu .list-h a:hover,
.cover-wrapper.focus .menu .list-h a:hover {
  background: var(--color-card);
}
.cover-wrapper.dock .top {
  margin-bottom: 48px;
}
.cover-wrapper.dock .menu {
  background: rgba(255,255,255,0.5);
  position: absolute;
  bottom: 0;
  max-width: 100%;
}
.cover-wrapper.dock .menu .list-h {
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  margin: 4px;
}
.cover-wrapper.dock .menu .list-h a+a {
  margin-left: 4px;
}
@media screen and (max-width: 500px) {
  .cover-wrapper.dock .menu .list-h {
    overflow-x: scroll;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar {
    height: 0;
    width: 0;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-track-piece {
    background: transparent;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-thumb {
    background: #f5df4d;
    cursor: pointer;
    border-radius: 0;
    -webkit-border-radius: 0;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-thumb:hover {
    background: #ff5722;
  }
}
@supports (backdrop-filter: blur(20px)) {
  .cover-wrapper.dock .menu {
    background: rgba(255,255,255,0.5);
    backdrop-filter: saturate(200%) blur(20px);
  }
}
.cover-wrapper #parallax-window {
  position: absolute;
  width: 100%;
  height: 100%;
  background: transparent;
}
.parallax-mirror {
  animation-delay: 0s;
  animation-duration: 0.5s;
  animation-fill-mode: forwards;
  animation-timing-function: ease-out;
  animation-name: fadeIn;
}
@-moz-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --color-mode: 'dark';
  }
  :root:not([color-scheme]) {
    --color-site-body: #121212;
    --color-read-bkg: #1f1f1f;
    --color-read-post: #262626;
    --color-site-bg: #1f1f1f;
    --color-site-inner: rgba(238,238,238,0.871);
    --color-site-footer: rgba(170,170,170,0.871);
    --color-card: #262626;
    --color-text: rgba(238,238,238,0.871);
    --color-block: #434343;
    --color-codeblock: #1f1f1f;
    --color-inlinecode: #d56d28;
    --color-h1: rgba(255,255,255,0.871);
    --color-h2: rgba(255,255,255,0.871);
    --color-h3: rgba(255,255,255,0.6);
    --color-h4: rgba(255,255,255,0.6);
    --color-h5: rgba(255,255,255,0.6);
    --color-h6: rgba(255,255,255,0.6);
    --color-p: rgba(217,217,217,0.871);
    --color-list: rgba(217,217,217,0.871);
    --color-list-hl: #f7e570;
    --color-meta: rgba(191,191,191,0.871);
    --color-link: rgba(191,191,191,0.871);
    --color-copyright-bkg: #21252b;
  }
  :root:not([color-scheme]) img {
    filter: brightness(70%) !important;
  }
  :root:not([color-scheme]) .blur {
    background: rgba(31,31,31,0.9) !important;
  }
  :root:not([color-scheme]) .white-box.blur {
    background: rgba(38,38,38,0.9) !important;
  }
  :root:not([color-scheme]) .nav-main .u-search-input {
    background: var(--color-card) !important;
  }
  :root:not([color-scheme]) #l_main .article .prev-next>a {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) #l_main .article .prev-next>a:hover {
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) .article blockquote {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .article-title a {
    color: var(--color-h1) !important;
  }
  :root:not([color-scheme]) details>summary {
    color: var(--color-p) !important;
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) details {
    border: 1px solid var(--color-site-bg) !important;
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) #u-search .modal,
  :root:not([color-scheme]) #u-search .modal-header,
  :root:not([color-scheme]) #u-search .modal-body {
    background: var(--color-card) !important;
  }
  :root:not([color-scheme]) #u-search .modal-body .modal-results .result:hover {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .u-search-input:hover {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .u-search-input:focus {
    background: var(--color-site-body) !important;
  }
}
[color-scheme='dark'] {
  --color-site-body: #121212;
  --color-read-bkg: #1f1f1f;
  --color-read-post: #262626;
  --color-site-bg: #1f1f1f;
  --color-site-inner: rgba(238,238,238,0.871);
  --color-site-footer: rgba(170,170,170,0.871);
  --color-card: #262626;
  --color-text: rgba(238,238,238,0.871);
  --color-block: #434343;
  --color-codeblock: #1f1f1f;
  --color-inlinecode: #d56d28;
  --color-h1: rgba(255,255,255,0.871);
  --color-h2: rgba(255,255,255,0.871);
  --color-h3: rgba(255,255,255,0.6);
  --color-h4: rgba(255,255,255,0.6);
  --color-h5: rgba(255,255,255,0.6);
  --color-h6: rgba(255,255,255,0.6);
  --color-p: rgba(217,217,217,0.871);
  --color-list: rgba(217,217,217,0.871);
  --color-list-hl: #f7e570;
  --color-meta: rgba(191,191,191,0.871);
  --color-link: rgba(191,191,191,0.871);
  --color-copyright-bkg: #21252b;
}
[color-scheme='dark'] img {
  filter: brightness(70%) !important;
}
[color-scheme='dark'] .blur {
  background: rgba(31,31,31,0.9) !important;
}
[color-scheme='dark'] .white-box.blur {
  background: rgba(38,38,38,0.9) !important;
}
[color-scheme='dark'] .nav-main .u-search-input {
  background: var(--color-card) !important;
}
[color-scheme='dark'] #l_main .article .prev-next>a {
  background: var(--color-block) !important;
}
[color-scheme='dark'] #l_main .article .prev-next>a:hover {
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] .article blockquote {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .article-title a {
  color: var(--color-h1) !important;
}
[color-scheme='dark'] details>summary {
  color: var(--color-p) !important;
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] details {
  border: 1px solid var(--color-site-bg) !important;
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] #u-search .modal,
[color-scheme='dark'] #u-search .modal-header,
[color-scheme='dark'] #u-search .modal-body {
  background: var(--color-card) !important;
}
[color-scheme='dark'] #u-search .modal-body .modal-results .result:hover {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .u-search-input:hover {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .u-search-input:focus {
  background: var(--color-site-body) !important;
}
@media screen and (max-width: 500px) {
  [color-scheme='dark'] .l_header .m_search {
    background: var(--color-site-bg) !important;
  }
}
@font-face {
  font-family: 'UbuntuMono';
  src: url("https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/UbuntuMono/UbuntuMono-Regular.ttf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
@font-face {
  font-family: 'Varela Round';
  src: url("https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/VarelaRound/VarelaRound-Regular.ttf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
.l_header {
  position: fixed;
  z-index: 1000;
  top: 0;
  width: 100%;
  height: 64px;
  background: var(--color-card);
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.l_header.auto {
  transition: opacity 0.4s ease;
  -webkit-transition: opacity 0.4s ease;
  -khtml-transition: opacity 0.4s ease;
  -moz-transition: opacity 0.4s ease;
  -o-transition: opacity 0.4s ease;
  -ms-transition: opacity 0.4s ease;
  visibility: hidden;
}
.l_header.auto.show {
  opacity: 1 !important;
  -webkit-opacity: 1 !important;
  -moz-opacity: 1 !important;
  visibility: visible;
}
.l_header .container {
  margin-left: 16px;
  margin-right: 16px;
}
.l_header #wrapper {
  height: 100%;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.l_header #wrapper .nav-main,
.l_header #wrapper .nav-sub {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  justify-content: space-between;
  -webkit-justify-content: space-between;
  -khtml-justify-content: space-between;
  -moz-justify-content: space-between;
  -o-justify-content: space-between;
  -ms-justify-content: space-between;
  align-items: center;
}
.l_header #wrapper .nav-main {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.l_header #wrapper.sub .nav-main {
  transform: translateY(-64px);
  -webkit-transform: translateY(-64px);
  -khtml-transform: translateY(-64px);
  -moz-transform: translateY(-64px);
  -o-transform: translateY(-64px);
  -ms-transform: translateY(-64px);
}
.l_header #wrapper .nav-sub {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  opacity: 0;
  -webkit-opacity: 0;
  -moz-opacity: 0;
  height: 64px;
  width: calc(100% - 2 * 16px);
  position: absolute;
}
.l_header #wrapper .nav-sub ::-webkit-scrollbar {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (min-width: 2048px) {
  .l_header #wrapper .nav-sub {
    max-width: 55vw;
    margin: auto;
  }
}
.l_header #wrapper.sub .nav-sub {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
}
.l_header #wrapper .title {
  position: relative;
  color: var(--color-text);
  padding-left: 24px;
  max-height: 64px;
}
.l_header #wrapper .nav-main .title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex-shrink: 0;
  line-height: 64px;
  padding: 0 24px;
  font-size: 1.25rem;
  font-family: "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
}
.l_header #wrapper .nav-main .title img {
  height: 64px;
}
.l_header .nav-sub {
  max-width: 1080px;
  margin: auto;
}
.l_header .nav-sub .title {
  font-weight: bold;
  font-family: UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  line-height: 1.2;
  max-height: 64px;
  white-space: normal;
  flex-shrink: 1;
}
.l_header .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  line-height: 64px;
  align-items: center;
}
.l_header .switcher .s-toc {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (max-width: 768px) {
  .l_header .switcher .s-toc {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
  }
}
.l_header .switcher >li {
  height: 48px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  margin: 2px;
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li {
    margin: 0 1px;
    height: 48px;
  }
}
.l_header .switcher >li >a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  align-items: center;
  width: 48px;
  height: 48px;
  padding: 0.85em 1.1em;
  border-radius: 100px;
  -webkit-border-radius: 100px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  color: #f5df4d;
}
.l_header .switcher >li >a:hover {
  border: none;
}
.l_header .switcher >li >a.active,
.l_header .switcher >li >a:active {
  border: none;
  background: var(--color-site-bg);
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li >a {
    width: 36px;
    height: 48px;
  }
}
.l_header .nav-sub .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
}
.l_header .m_search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  height: 64px;
  width: 240px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (max-width: 1024px) {
  .l_header .m_search {
    width: 44px;
    min-width: 44px;
  }
  .l_header .m_search input::placeholder {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
  }
  .l_header .m_search:hover {
    width: 240px;
  }
  .l_header .m_search:hover input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (min-width: 500px) {
  .l_header .m_search:hover .input {
    width: 100%;
  }
  .l_header .m_search:hover .input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search {
    min-width: 0;
  }
  .l_header .m_search input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.l_header .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  width: 100%;
  align-items: center;
}
.l_header .m_search .icon {
  position: absolute;
  width: 36px;
  left: 5px;
  color: var(--color-meta);
}
@media screen and (max-width: 500px) {
  .l_header .m_search .icon {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
.l_header .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding-top: 8px;
  padding-bottom: 8px;
  line-height: 1.3;
  width: 100%;
  color: var(--color-text);
  background: #fafafa;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  padding-left: 40px;
  font-size: 0.875rem;
  border-radius: 8px;
  -webkit-border-radius: 8px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (min-width: 500px) {
  .l_header .m_search .input:focus {
    box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
    -webkit-box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search .input {
    background: var(--color-block);
    padding-left: 8px;
    border: none;
  }
  .l_header .m_search .input:hover,
  .l_header .m_search .input:focus {
    border: none;
  }
}
@media (max-width: 500px) {
  .l_header .m_search {
    left: 0;
    width: 0;
    overflow: hidden;
    position: absolute;
    background: #fff;
    transition: all 0.28s ease;
    -webkit-transition: all 0.28s ease;
    -khtml-transition: all 0.28s ease;
    -moz-transition: all 0.28s ease;
    -o-transition: all 0.28s ease;
    -ms-transition: all 0.28s ease;
  }
  .l_header .m_search .input {
    border-radius: 32px;
    -webkit-border-radius: 32px;
    margin-left: 16px;
    padding-left: 16px;
  }
  .l_header.z_search-open .m_search {
    width: 100%;
  }
  .l_header.z_search-open .m_search .input {
    width: calc(100% - 120px);
  }
}
ul.m-pc >li>a {
  color: inherit;
  border-bottom: 2px solid transparent;
}
ul.m-pc >li>a:active,
ul.m-pc >li>a.active {
  border-bottom: 2px solid #f5df4d;
}
ul.m-pc li:hover >ul.list-v,
ul.list-v li:hover >ul.list-v {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.nav-list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  align-items: stretch;
}
ul.nav-list-h>li {
  position: relative;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  height: 100%;
  line-height: 2.4;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
ul.nav-list-h>li >a {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 600;
}
ul.list-v {
  z-index: 1;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: absolute;
  background: var(--color-card);
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  margin-top: -6px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  padding: 8px 0;
}
ul.list-v.show {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.list-v hr {
  margin-top: 8px;
  margin-bottom: 8px;
}
ul.list-v >li {
  white-space: nowrap;
  word-break: keep-all;
}
ul.list-v >li.header {
  font-size: 0.78125rem;
  font-weight: bold;
  line-height: 2em;
  color: var(--color-meta);
  margin: 8px 16px 4px;
}
ul.list-v >li.header i {
  margin-right: 8px;
}
ul.list-v >li ul {
  margin-left: 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: -40px;
}
ul.list-v .aplayer-container {
  min-height: 64px;
  padding: 6px 16px;
}
ul.list-v >li>a {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  color: var(--color-list);
  font-size: 0.875rem;
  font-weight: bold;
  line-height: 36px;
  padding: 0 20px 0 16px;
  text-overflow: ellipsis;
  margin: 0 4px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
@media screen and (max-width: 1024px) {
  ul.list-v >li>a {
    line-height: 40px;
  }
}
ul.list-v >li>a >i {
  margin-right: 8px;
}
ul.list-v >li>a:active,
ul.list-v >li>a.active {
  color: var(--color-list-hl);
}
ul.list-v >li>a:hover {
  color: var(--color-list-hl);
  background: var(--color-site-bg);
}
.l_header .menu >ul>li>a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding: 0 8px;
}
.l_header .menu >ul>li>a >i {
  margin-right: 4px;
}
.l_header ul.nav-list-h>li {
  color: var(--color-list);
  line-height: 64px;
}
.l_header ul.nav-list-h>li >a {
  max-height: 64px;
  overflow: hidden;
  color: inherit;
}
.l_header ul.nav-list-h>li >a:active,
.l_header ul.nav-list-h>li >a.active {
  color: #f5df4d;
}
.l_header ul.nav-list-h>li:hover>a {
  color: var(--color-list-hl);
}
.l_header ul.nav-list-h>li i.music {
  animation: rotate-effect 1.5s linear infinite;
  -webkit-animation: rotate-effect 1.5s linear infinite;
  -khtml-animation: rotate-effect 1.5s linear infinite;
  -moz-animation: rotate-effect 1.5s linear infinite;
  -o-animation: rotate-effect 1.5s linear infinite;
  -ms-animation: rotate-effect 1.5s linear infinite;
}
@-moz-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-webkit-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-o-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
.menu-phone li ul.list-v {
  right: calc(100% - 0.5 * 16px);
}
.menu-phone li ul.list-v ul {
  right: calc(100% - 0.5 * 16px);
}
#wrapper {
  max-width: 1080px;
  margin: auto;
}
@media screen and (min-width: 2048px) {
  #wrapper {
    max-width: 55vw;
  }
}
#wrapper .menu {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 1;
  -ms-flex: 1 1;
  flex: 1 1;
  margin: 0 16px 0 0;
}
#wrapper .menu .list-v ul {
  left: calc(100% - 0.5 * 16px);
}
.menu-phone {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: 16px;
  right: 8px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.menu-phone ul {
  right: calc(100% - 0.5 * 16px);
}
@media screen and (max-width: 500px) {
  .menu-phone {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: block;
  }
}
.l_header {
  max-width: 65vw;
  left: calc((100% - 65vw) * 0.5);
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
}
@media screen and (max-width: 2048px) {
  .l_header {
    max-width: 1112px;
    left: calc((100% - 1112px) * 0.5);
  }
}
@media screen and (max-width: 1112px) {
  .l_header {
    left: 0;
    border-radius: 0;
    -webkit-border-radius: 0;
    max-width: 100%;
  }
}
@media screen and (max-width: 500px) {
  .l_header .container {
    margin-left: 0;
    margin-right: 0;
  }
  .l_header #wrapper .nav-main .title {
    padding-left: 16px;
    padding-right: 16px;
  }
  .l_header #wrapper .nav-sub {
    width: 100%;
  }
  .l_header #wrapper .nav-sub .title {
    overflow-y: scroll;
    margin-top: 2px;
    padding: 8px 16px;
  }
  .l_header #wrapper .switcher {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
    margin-right: 8px;
  }
  .l_header .menu {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
@media screen and (max-width: 500px) {
  .list-v li {
    max-width: 270px;
  }
}
#u-search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  padding: 60px 20px;
  z-index: 1001;
}
@media screen and (max-width: 680px) {
  #u-search {
    padding: 0px;
  }
}
@media screen and (prefers-color-scheme: dark) and (max-width: 500px) {
  .l_header .m_search {
    background: var(--color-site-bg) !important;
  }
}

  </style>
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
    <script>
      let userColorScheme=localStorage.getItem("color-scheme")
      if(userColorScheme){
        document.documentElement.setAttribute("color-scheme", userColorScheme);
      }
    </script>
  
<script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
    '.kill-t{'+
      'font-size: 2rem;'+
    '}'+
    '.kill-c{'+
      'font-size: 1.2rem;'+
    '}'+
		'#l_header,#l_body{'+
			'display: none;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        `<span class="kill-t"><b>Sorry, your browser cannot access this site</b></span><br/>`+
        `<span class="kill-c">Microsoft has terminated support for Internet Explorer (IE) 10 and earlier versions in 2016. <br/>There are great security risks to continue using it. Please use contemporary mainstream browsers to access.</span><br/>`+
        `<a target="_blank" rel="noopener" href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/"><strong>Learn more ></strong></a>`+
    '</div>');
</script>


<noscript>
	<style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
    .kill-t{
      font-size: 2rem;
    }
    .kill-c{
      font-size: 1.2rem;
    }
		#l_header,#l_body{
			display: none;
		}
	</style>
    <div class="kill-noscript">
        <span class="kill-t"><b>Sorry, your browser cannot access this site</b></span><br/>
        <span class="kill-c">This page requires browser support (enable) JavaScript</span><br/>
        <a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=启用JavaScript"><strong>Learn more ></strong></a>
    </div>
</noscript>


  <script>
  /************这个文件存放不需要重载的全局变量和全局函数*********/
  window.volantis = {}; // volantis 全局变量
  volantis.debug = "env"; // 调试模式
  volantis.dom = {}; // 页面Dom see: /source/js/app.js etc.

  volantis.GLOBAL_CONFIG ={
    debug: "env",
    cdn: {"js":{"app":"/js/app.js","parallax":"/js/plugins/parallax.js","rightMenu":"/js/plugins/rightMenu.js","rightMenus":"/js/plugins/rightMenus.js","sites":"/js/plugins/tags/sites.js","friends":"/js/plugins/tags/friends.js","contributors":"/js/plugins/tags/contributors.js","search":"/js/search/hexo.js"},"css":{"style":"/css/style.css"}},
    default: {"avatar":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/avatar/round/3442075.svg","link":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/link/8f277b4ee0ecd.svg","cover":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/cover/76b86c0226ffd.svg","image":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/image/2659360.svg"},
    lastupdate: new Date(1722341071998),
    sidebar: {
      for_page: ["blogger","category","tagcloud","donate"],
      for_post: ["toc"],
      webinfo: {
        lastupd: {
          enable: true,
          friendlyShow: true
        },
        runtime: {
          data: "2020/01/01",
          unit: "天"
        }
      }
    },
    plugins: {
      message: {"enable":true,"css":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/izitoast/dist/css/iziToast.min.css","js":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/izitoast/dist/js/iziToast.min.js","icon":{"default":"fa-solid fa-info-circle light-blue","quection":"fa-solid fa-question-circle light-blue"},"time":{"default":5000,"quection":20000},"position":"topRight","transitionIn":"bounceInLeft","transitionOut":"fadeOutRight","titleColor":"var(--color-text)","messageColor":"var(--color-text)","backgroundColor":"var(--color-card)","zindex":2147483647,"copyright":{"enable":true,"title":"知识共享许可协议","message":"请遵守 CC BY-NC-SA 4.0 协议。","icon":"far fa-copyright light-blue"},"aplayer":{"enable":true,"play":"fa-solid fa-play","pause":"fa-solid fa-pause"},"rightmenu":{"enable":true,"notice":true}},
      fancybox: {"css":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fancyapps/ui/dist/fancybox.css","js":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fancyapps/ui/dist/fancybox.umd.js"},
      
      aplayer: {
        id: 2674113840,
        enable:true
      },
      
      
      
      rightmenus: {"enable":true,"order":["plugins.navigation","hr","plugins.inputBox","plugins.seletctText","plugins.elementCheck","plugins.elementImage","menus.link","hr","menus.darkMode","plugins.articlePage","music"],"options":{"iconPrefix":"fa-solid","articleShowLink":true,"musicAlwaysShow":true},"plugins":{"navigation":[{"id":"left","name":"转到上一页","icon":"fa-solid fa-arrow-left","event":"history.back()","group":"navigation"},{"id":"right","name":"转到下一页","icon":"fa-solid fa-arrow-right","event":"history.forward()","group":"navigation"},{"id":"redo","name":"刷新当前页面","icon":"fa-solid fa-redo","event":"window.location.reload()","group":"navigation"},{"id":"up","name":"回到顶部","icon":"fa-solid fa-arrow-up","event":"VolantisApp.scrolltoElement(volantis.dom.bodyAnchor)","group":"navigation"}],"inputBox":[{"id":"copyPaste","name":"粘贴文本","icon":"fa-solid fa-paste","event":"copyPaste","group":"inputBox"},{"id":"copyAll","name":"全选文本","icon":"fa-solid fa-object-ungroup","event":"copyAll","group":"inputBox"},{"id":"copyCut","name":"剪切文本","icon":"fa-solid fa-cut","event":"copyCut","group":"inputBox"}],"seletctText":[{"id":"copyText","name":"复制文本","icon":"fa-solid fa-copy","event":"copyText","group":"seletctText"},{"id":"searchWord","name":"站内搜索","icon":"fa-solid fa-search","event":"OpenSearch(__text__)","group":"seletctText"},{"id":"bingSearch","name":"必应搜索","icon":"fa-solid fa-search","event":"window.open(`https://cn.bing.com/search?q=${__text__}`)","group":"seletctText"}],"elementCheck":[{"id":"openTab","name":"新标签页打开","icon":"fa-solid fa-external-link-square-alt","event":"window.open(__link__)","group":"elementCheck"},{"id":"copyLink","name":"复制链接地址","icon":"fa-solid fa-link","event":"copyLink","group":"elementCheck"}],"elementImage":[{"id":"copyImg","name":"复制图片","icon":"fa-solid fa-image","event":"copyImg","group":"elementImage"},{"id":"googleImg","name":"谷歌识图","icon":"fa-solid fa-images","event":"window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)","group":"elementImage"}],"articlePage":[{"id":"printMode","name":"打印页面","icon":"fa-solid fa-print","event":"printMode","group":"articlePage"},{"id":"readMode","name":"阅读模式","icon":"fa-solid fa-book-open","event":"readMode","group":"articlePage"}]},"menus":{"link":[{"id":"help","name":"常见问题","icon":"fa-solid fa-question","link":"https://volantis.js.org/faqs/","group":"link"},"hr",{"id":"source_docs","name":"本站源码","icon":"fa-solid fa-code-branch","link":"https://github.com/enderxiao/enderxiao.github.io/","group":"link"},{"id":"source_theme","name":"主题源码","icon":"fa-solid fa-code-branch","link":"https://github.com/volantis-x/hexo-theme-volantis/","group":"link"}],"darkMode":[{"id":"darkMode","name":"暗黑模式","icon":"fa-solid fa-moon","event":"volantis.dark.toggle()","group":"darkMode"}]}}
      
    }
  }

  /******************** volantis.EventListener ********************************/
  // 事件监听器 see: /source/js/app.js
  volantis.EventListener = {}
  // 这里存放pjax切换页面时将被移除的事件监听器
  volantis.EventListener.list = []
  //构造方法
  function volantisEventListener(type, f, ele) {
    this.type = type
    this.f = f
    this.ele = ele
  }
  // 移除事件监听器
  volantis.EventListener.remove = () => {
    volantis.EventListener.list.forEach(function (i) {
      i.ele.removeEventListener(i.type, i.f, false)
    })
    volantis.EventListener.list = []
  }
  /******************** volantis.dom.$ ********************************/
  // 注：这里没有选择器，也没有forEach一次只处理一个dom，这里重新封装主题常用的dom方法，返回的是dom对象，对象包含了以下方法，同时保留dom的原生API
  function volantisDom(ele) {
    if (!ele) ele = document.createElement("div")
    this.ele = ele;
    // ==============================================================
    this.ele.find = (c) => {
      let q = this.ele.querySelector(c)
      if (q)
        return new volantisDom(q)
    }
    // ==============================================================
    this.ele.hasClass = (c) => {
      return this.ele.className.match(new RegExp('(\\s|^)' + c + '(\\s|$)'));
    }
    this.ele.addClass = (c) => {
      this.ele.classList.add(c);
      return this.ele
    }
    this.ele.removeClass = (c) => {
      this.ele.classList.remove(c);
      return this.ele
    }
    this.ele.toggleClass = (c) => {
      if (this.ele.hasClass(c)) {
        this.ele.removeClass(c)
      } else {
        this.ele.addClass(c)
      }
      return this.ele
    }
    // ==============================================================
    // 参数 r 为 true 表示pjax切换页面时事件监听器将被移除，false不移除
    this.ele.on = (c, f, r = 1) => {
      this.ele.addEventListener(c, f, false)
      if (r) {
        volantis.EventListener.list.push(new volantisEventListener(c, f, this.ele))
      }
      return this.ele
    }
    this.ele.click = (f, r) => {
      this.ele.on("click", f, r)
      return this.ele
    }
    this.ele.scroll = (f, r) => {
      this.ele.on("scroll", f, r)
      return this.ele
    }
    // ==============================================================
    this.ele.html = (c) => {
      // if(c=== undefined){
      //   return this.ele.innerHTML
      // }else{
      this.ele.innerHTML = c
      return this.ele
      // }
    }
    // ==============================================================
    this.ele.hide = (c) => {
      this.ele.style.display = "none"
      return this.ele
    }
    this.ele.show = (c) => {
      this.ele.style.display = "block"
      return this.ele
    }
    // ==============================================================
    return this.ele
  }
  volantis.dom.$ = (ele) => {
    return !!ele ? new volantisDom(ele) : null;
  }
  /******************** RunItem ********************************/
  function RunItem() {
    this.list = []; // 存放回调函数
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = ()=>{
          volantis.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) =>{
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index,1);
        }
      }
    }
    // 构造一个可以run的对象
    function Item(fn, name) {
      // 函数名称
      this.name = name || fn.name;
      // run方法
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }
  /******************** Pjax ********************************/
  // /layout/_plugins/pjax/index.ejs
  // volantis.pjax.send(callBack[,"callBackName"]) 传入pjax:send回调函数
  // volantis.pjax.push(callBack[,"callBackName"]) 传入pjax:complete回调函数
  // volantis.pjax.error(callBack[,"callBackName"]) 传入pjax:error回调函数
  volantis.pjax = {};
  volantis.pjax.method = {
    complete: new RunItem(),
    error: new RunItem(),
    send: new RunItem(),
  };
  volantis.pjax = Object.assign(volantis.pjax, {
    push: volantis.pjax.method.complete.push,
    error: volantis.pjax.method.error.push,
    send: volantis.pjax.method.send.push,
  });
  /******************** RightMenu ********************************/
  // volantis.rightmenu.handle(callBack[,"callBackName"]) 外部菜单项控制
  // 可在 volantis.mouseEvent 处获取右键事件
  volantis.rightmenu = {};
  volantis.rightmenu.method = {
    handle: new RunItem(),
  }
  volantis.rightmenu = Object.assign(volantis.rightmenu, {
    handle: volantis.rightmenu.method.handle.push,
  });
  /********************  Dark Mode  ********************************/
  // /layout/_partial/scripts/darkmode.ejs
  // volantis.dark.mode 当前模式 dark or light
  // volantis.dark.toggle() 暗黑模式触发器
  // volantis.dark.push(callBack[,"callBackName"]) 传入触发器回调函数
  volantis.dark = {};
  volantis.dark.method = {
    toggle: new RunItem(),
  };
  volantis.dark = Object.assign(volantis.dark, {
    push: volantis.dark.method.toggle.push,
  });
  /********************  Message  ********************************/
  // VolantisApp.message
  /********************  isMobile  ********************************/
  // /source/js/app.js
  // volantis.isMobile
  // volantis.isMobileOld
  /********************脚本动态加载函数********************************/
  // volantis.js(src, cb)  cb 可以传入onload回调函数 或者 JSON对象 例如: volantis.js("src", ()=>{}) 或 volantis.js("src", {defer:true,onload:()=>{}})
  // volantis.css(src)

  // 返回Promise对象，如下方法同步加载资源，这利于处理文件资源之间的依赖关系，例如：APlayer 需要在 MetingJS 之前加载
  // (async () => {
  //     await volantis.js("...theme.plugins.aplayer.js.aplayer...")
  //     await volantis.js("...theme.plugins.aplayer.js.meting...")
  // })();

  // 已经加入了setTimeout
  volantis.js = (src, cb) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }
  volantis.css = (src) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  }
  /********************按需加载的插件********************************/
  // volantis.import.jQuery().then(()=>{})
  volantis.import = {
    jQuery: () => {
      if (typeof jQuery == "undefined") {
        return volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/jquery/dist/jquery.min.js")
      } else {
        return new Promise(resolve => {
          resolve()
        });
      }
    }
  }
  /********************** requestAnimationFrame ********************************/
  // 1、requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率，一般来说，这个频率为每秒60帧。
  // 2、在隐藏或不可见的元素中，requestAnimationFrame 将不会进行重绘或回流，这当然就意味着更少的的 cpu，gpu 和内存使用量。
  volantis.requestAnimationFrame = (fn)=>{
    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
    }
    window.requestAnimationFrame(fn)
  }
  /************************ layoutHelper *****************************************/
  volantis.layoutHelper = (helper, html, opt)=>{
    opt = Object.assign({clean:false, pjax:true}, opt)
    function myhelper(helper, html, clean) {
      volantis.tempDiv = document.createElement("div");
      volantis.tempDiv.innerHTML = html;
      let layoutHelper = document.querySelector("#layoutHelper-"+helper)
      if (layoutHelper) {
        if (clean) {
          layoutHelper.innerHTML = ""
        }
        layoutHelper.append(volantis.tempDiv);
      }
    }
    myhelper(helper, html, opt.clean)
    if (opt.pjax) {
      volantis.pjax.push(()=>{
        myhelper(helper, html, opt.clean)
      },"layoutHelper-"+helper)
    }
  }
  /****************************** 滚动事件处理 ****************************************/
  volantis.scroll = {
    engine: new RunItem(),
    unengine: new RunItem(),
  };
  volantis.scroll = Object.assign(volantis.scroll, {
    push: volantis.scroll.engine.push,
  });
  // 滚动条距离顶部的距离
  volantis.scroll.getScrollTop = () =>{
    let scrollPos;
    if (window.pageYOffset) {
      scrollPos = window.pageYOffset;
    } else if (document.compatMode && document.compatMode != 'BackCompat') {
      scrollPos = document.documentElement.scrollTop;
    } else if (document.body) {
      scrollPos = document.body.scrollTop;
    }
    return scrollPos;
  }
  // 使用 requestAnimationFrame 处理滚动事件
  // `volantis.scroll.del` 中存储了一个数值, 该数值检测一定时间间隔内滚动条滚动的位移, 数值的检测频率是浏览器的刷新频率. 数值为正数时, 表示向下滚动. 数值为负数时, 表示向上滚动.
  volantis.scroll.handleScrollEvents = () => {
    volantis.scroll.lastScrollTop = volantis.scroll.getScrollTop()
    function loop() {
      const scrollTop = volantis.scroll.getScrollTop();
      if (volantis.scroll.lastScrollTop !== scrollTop) {
        volantis.scroll.del = scrollTop - volantis.scroll.lastScrollTop;
        volantis.scroll.lastScrollTop = scrollTop;
        // if (volantis.scroll.del > 0) {
        //   console.log("向下滚动");
        // } else {
        //   console.log("向上滚动");
        // }
        // 注销过期的unengine未滚动事件
        volantis.scroll.unengine.list=[]
        volantis.scroll.engine.start();
      }else{
        volantis.scroll.unengine.start();
      }
      volantis.requestAnimationFrame(loop)
    }
    volantis.requestAnimationFrame(loop)
  }
  volantis.scroll.handleScrollEvents()
  volantis.scroll.ele = null;
  // 触发页面滚动至目标元素位置
  volantis.scroll.to = (ele, option = {}) => {
    if (!ele) return;
    volantis.scroll.ele = ele;
    // 默认配置
    opt = {
      top: ele.getBoundingClientRect().top + document.documentElement.scrollTop,
      behavior: "smooth"
    }
    // 定义配置
    if ("top" in option) {
      opt.top = option.top
    }
    if ("behavior" in option) {
      opt.behavior = option.behavior
    }
    if ("addTop" in option) {
      opt.top += option.addTop
    }
    if (!("observerDic" in option)) {
      option.observerDic = 100
    }
    // 滚动
    window.scrollTo(opt);
    // 监视器
    // 监视并矫正元素滚动到指定位置
    // 用于处理 lazyload 引起的 cls 导致的定位失败问题
    // option.observer = false
    if (option.observer) {
      setTimeout(() => {
        if (volantis.scroll.ele != ele) {
          return
        }
        volantis.scroll.unengine.push(() => {
          let me = ele.getBoundingClientRect().top
          if(!(me >= -option.observerDic && me <= option.observerDic)){
            volantis.scroll.to(ele, option)
          }
          volantis.scroll.unengine.remove("unengineObserver")
        },"unengineObserver")
      },1000)
    }
  }
  /********************** Content Visibility ********************************/
  // 见 source/css/first.styl 如果遇到任何问题 删除 .post-story 即可
  // 一个元素被声明 content-visibility 属性后 如果元素不在 viewport 中 浏览器不会计算其后代元素样式和属性 从而节省 Style & Layout 耗时
  // content-visibility 的副作用: 锚点失效 等等(实验初期 暂不明确), 使用此方法清除样式
  volantis.cleanContentVisibility = ()=>{
    if (document.querySelector(".post-story")) {
      console.log("cleanContentVisibility");
      document.querySelectorAll(".post-story").forEach(e=>{
        e.classList.remove("post-story")
      })
    }
  }
  /******************************************************************************/
  /******************************************************************************/
  /******************************************************************************/
  //图像加载出错时的处理
  function errorImgAvatar(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/avatar/round/3442075.svg";
    img.onerror = null;
  }
  function errorImgCover(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/cover/76b86c0226ffd.svg";
    img.onerror = null;
  }
  /******************************************************************************/
</script>

  <!-- import head_end begin -->
  <!-- import head_end end -->
  <!-- Custom Files headEnd begin-->
  
  <!-- Custom Files headEnd end-->
  <!-- front-matter head_end begin -->
  <!-- front-matter head_end end -->
</head>
  <body itemscope itemtype="http://schema.org/WebPage">
    <!-- import body_begin begin-->
    <!-- import body_begin end-->
    <!-- Custom Files bodyBegin begin-->
    
    <!-- Custom Files bodyBegin end-->
    <!-- front-matter body_begin begin -->
    <!-- front-matter body_begin end -->
    <header itemscope itemtype="http://schema.org/WPHeader" id="l_header" class="l_header auto shadow floatable blur show" style='opacity: 0' >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a id="s-comment" class="fa-solid fa-comments fa-fw" target="_self"  href="/" onclick="return false;" title="comment"></a></li>
        
          <li><a id="s-toc" class="s-toc fa-solid fa-list fa-fw" target="_self"  href="/" onclick="return false;" title="toc"></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='https://z3.ax1x.com/2021/08/06/fmMNRO.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/" title="首页"
                  
                  
                  
                    active-action="action-home"
                  >
                  <i class='fas fa-home fa-fw'></i>首页
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/categories/" title="分类"
                  
                  
                  
                    active-action="action-categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/tags/" title="标签"
                  
                  
                  
                    active-action="action-tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/archives/" title="归档"
                  
                  
                  
                    active-action="action-archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/friends/" title="友链"
                  
                  
                  
                    active-action="action-friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/about/" title="关于"
                  
                  
                  
                    active-action="action-about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                 href="/" onclick="return false;" title="摸!"
                  
                  
                  >
                  <i class='fas fa-gamepad fa-fw'></i>摸!
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/EnderGame.github.2048.io/" title="2048!"
                  
                  
                  
                    active-action="action-EnderGamegithub2048io"
                  >
                  2048!
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/EnderGame.github.MoonSweeper.io/" title="MoonSweeper!"
                  
                  
                  
                    active-action="action-EnderGamegithubMoonSweeperio"
                  >
                  <i class='fas fa-moon fa-fw'></i>MoonSweeper!
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                 href="/" onclick="return false;" title="更多"
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>黑暗模式
                </a>
              <li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>
      
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fa-solid fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>
      

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fa-solid fa-search fa-fw" target="_self" href="/" onclick="return false;" title="search"></a></li>
				
				<li>
          <a class="s-menu fa-solid fa-bars fa-fw" target="_self" href="/" onclick="return false;" title="menu"></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/" title="首页"
                  
                  
                  
                    active-action="action-home"
                  >
                  <i class='fas fa-home fa-fw'></i>首页
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/categories/" title="分类"
                  
                  
                  
                    active-action="action-categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/tags/" title="标签"
                  
                  
                  
                    active-action="action-tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/archives/" title="归档"
                  
                  
                  
                    active-action="action-archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/friends/" title="友链"
                  
                  
                  
                    active-action="action-friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/about/" title="关于"
                  
                  
                  
                    active-action="action-about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                 href="/" onclick="return false;" title="摸!"
                  
                  
                  >
                  <i class='fas fa-gamepad fa-fw'></i>摸!
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/EnderGame.github.2048.io/" title="2048!"
                  
                  
                  
                    active-action="action-EnderGamegithub2048io"
                  >
                  2048!
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/EnderGame.github.MoonSweeper.io/" title="MoonSweeper!"
                  
                  
                  
                    active-action="action-EnderGamegithubMoonSweeperio"
                  >
                  <i class='fas fa-moon fa-fw'></i>MoonSweeper!
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                 href="/" onclick="return false;" title="更多"
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>黑暗模式
                </a>
              <li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>

      <!-- Custom Files header begin -->
      
      <!-- Custom Files header end -->
		</div>
	</div>
  </div>
</header>

    <div id="l_body">
      <div id="l_cover">
  
    
      <!-- see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs -->
      <div id="none" class='cover-wrapper post dock' style="display: none;">
        
  <div id="parallax-window"></div>

<div class='cover-body'>
  <div class='top'>
    
      <img no-lazy class='logo' src='https://z3.ax1x.com/2021/08/06/fmncJU.png'/>
    
    
      <p class="title">Ender</p>
    
    
  </div>
  <div class='bottom'>
    <div class='menu navigation'>
      <div class='list-h'>
        
          
            <a href="/"
              
              
              active-action="action-home">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg'><p>Blogs</p>
            </a>
          
            <a href="/categories/"
              
              
              active-action="action-categories">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f516.svg'><p>Categories</p>
            </a>
          
            <a href="/tags/"
              
              
              active-action="action-tags">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f396.svg'><p>Tags</p>
            </a>
          
            <a href="/images/"
              
              
              active-action="action-images">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f389.svg'><p>Images</p>
            </a>
          
            <a href="/archives/"
              
              
              active-action="action-archives">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f5c3.svg'><p>Archives</p>
            </a>
          
            <a target="_blank" rel="noopener" href="https://github.com/enderxiao/enderxiao.github.io/"
              
              
              active-action="action-https:githubcomenderxiaoenderxiaogithubio">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f9ec.svg'><p>Code</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

        <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
      </div>
    
  
</div>

      <div id="safearea">
        <div class="body-wrapper">
          
<div id="l_main" class=''>
  <article itemscope itemtype="http://schema.org/Article" class="article post white-box reveal md shadow floatable blur article-type-post" id="post" itemscope itemprop="blogPost">
  <link itemprop="mainEntityOfPage" href="http://enderxiao.github.io/2024/04/11/JS设计模式/">
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Ender">
  </span>
  <span hidden itemprop="post" itemscope itemtype="http://schema.org/Post">
    <meta itemprop="name" content="Ender">
    <meta itemprop="description" content="a blog of EnderXiao">
  </span>
  


  
    <div class='headimg-div'>
      <a class='headimg-a'>
        <img itemprop="image" class='headimg' src='https://s11.ax1x.com/2022/03/13/bqYfFH.jpg'/>
      </a>
    </div>
  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title" itemprop="name headline">
        JS设计模式
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author' itemprop="author" itemscope itemtype="http://schema.org/Person">
  <a itemprop="url" class='author' href="/" rel="nofollow">
    <img itemprop="image" src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/apple-touch-icon.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/apple-touch-icon.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
    <p itemprop="name">Ender</p>
  </a>
</div>

          
        
          
            
  <div class='new-meta-item category'>
    <i class="fa-solid fa-folder-open fa-fw" aria-hidden="true"></i>
    <a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="sep"></span><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
    
      <span hidden itemprop="about" itemscope itemtype="http://schema.org/Thing">
        <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url"><span itemprop="name">前端</span></a>
      </span>
    
      <span hidden itemprop="about" itemscope itemtype="http://schema.org/Thing">
        <a href="/categories/%E5%89%8D%E7%AB%AF/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url"><span itemprop="name">设计模式</span></a>
      </span>
    
  </div>


          
        
          
            <div class="new-meta-item date" itemprop="dateCreated datePublished" datetime="2024-04-11T14:11:11+08:00">
  <a class='notlink'>
    <i class="fa-solid fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Apr 11, 2024</p>
  </a>
</div>

          
        
          
            


<div class="new-meta-item browse">
  <a class='notlink'>
    <p>
      <i class="fa-solid fa-eye fa-fw" aria-hidden="true"></i>
      
      <span id="lc-pv" data-title="JS设计模式" data-path="/2024/04/11/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
        <span id='number'><i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i></span>
      </span>
      
      <span>次浏览</span>
    </p>
  </a>
</div>


          
        
        <!-- Custom Files topMeta begin-->
        
        <!-- Custom Files topMeta end-->
      </div>
    
  </div>


  <div id="layoutHelper-page-plugins"></div>
  <div id="post-body" itemprop="articleBody">
    <p>设计模式收集使用JS实现，参考<a target="_blank" rel="noopener" href="https://github.com/zy445566/design-pattern-in-javascript">JS设计模式Github仓库</a>以及书《JavaScript设计模式与开发实践》曾探著</p>
<span id="more"></span>
<h2 id="设计模式"><a class="markdownIt-Anchor" href="#设计模式"></a> 设计模式</h2>
<p>设计模式通常是前任在开发中总结而来的经验，通常我们在看别人代码的时候，会产生：“为什么这么写”的疑问。而学习设计模式的目的在于帮助我们更好地理解代码。</p>
<p>本文沿用GoF四人组(Erich Gamma、Richard Helm、Ralph Johnson、John Vlissides)的分类方式将设计模式分为：</p>
<ul>
<li>创建型模式
<ul>
<li>创建对象</li>
</ul>
</li>
<li>结构型模式
<ul>
<li>处理类或对象的组合</li>
</ul>
</li>
<li>行为型模式
<ul>
<li>描述类或对象怎样交互和怎样分配职责</li>
</ul>
</li>
</ul>
<p>三类并使用JS进行实现</p>
<h2 id="设计模式六大原则"><a class="markdownIt-Anchor" href="#设计模式六大原则"></a> 设计模式六大原则</h2>
<p>在描述设计模式之前，先来聊聊设计原则吧，因为稍后介绍的设计模式都或多或少的应用了这些设计原则，而且这些原则能够帮助我们提高自己代码的健壮性。</p>
<p>本章参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/110130347">知乎——六大设计模式</a></p>
<p>六大设计原则包括：</p>
<ul>
<li>单一责任原则(Single Responsibility Principle)
<ul>
<li>定义：应该有，且仅有一个原因引起类的变更</li>
<li>理解：即一个接口或类或方法，应该具有单一职责，例如一个接口要么进行协议管理要么进行数据传输，不应同时具备上述两种职责。</li>
<li>优点：
<ul>
<li>类复杂性低</li>
<li>可读性，可维护性高</li>
<li>变更分析低</li>
</ul>
</li>
<li>总结：<strong>一个类或接口只承担一个职责。</strong></li>
</ul>
</li>
<li>开闭原则(Open Closed Principle)
<ul>
<li>定义：一个软件实体（类，模块，函数）对扩展开放，对修改封闭</li>
<li>理解：开闭原则是其他五大原则的精神领袖，其他五大原则都是实现开闭原则的具体型态</li>
<li>优点：
<ul>
<li>提高可复用性与可维护性</li>
</ul>
</li>
<li>总结：<strong>对软件实体的改动，最好用扩展而非修改的方式。</strong></li>
</ul>
</li>
<li>里氏替换原则(Liskov Substitution Principle)（LSP❌）
<ul>
<li>定义：如果对每一个类型为S的对象o1，都有类型为T的对象o2，使得以T定义的所有程序P中，使用对象o2替换所有的对象o1时，程序P的行为没有发生变化，那么类型S是类型T的子类型。</li>
<li>理解：<strong>就是只要父类能出现的地方，子类就可以出现，而且替换为子类也不会产生任何错误或异常</strong>。符合该原则的继承可以被定义为良好的继承
<ul>
<li>子类必须完全实现父类的方法</li>
<li>子类可以有自己的个性</li>
<li>覆盖或实现父类的方法时，输入参数可以被放大，即子类重载父类方法时，参数范围要<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo></mrow><annotation encoding="application/x-tex">\geq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mrel">≥</span></span></span></span>父类方法参数</li>
<li>覆盖或实现父类的方法时，输出结果可以被缩小，即子类重载父类方法时，返回值范围要<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo></mrow><annotation encoding="application/x-tex">\leq</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mrel">≤</span></span></span></span>父类方法返回值</li>
</ul>
</li>
<li>总结：<strong>在继承类时，务必重写（override）父类中所有的方法，尤其需要注意父类的protected方法（它们往往是让你重写的），子类尽量不要暴露自己的public方法供外界调用。</strong></li>
</ul>
</li>
<li>迪米特法则(Law of Demeter)(也叫最少知道原则)
<ul>
<li>定义：一个对象应该对其他对象有最少的了解</li>
<li>理解：
<ul>
<li>只和直接的朋友交流：出现在成员变量、方法的输入输出参数中的类称为成员<strong>朋友类</strong>，一个类的方法中只能和朋友类进行数据交流，不能涉及其他类</li>
<li>朋友间也是有距离的：开发中尽量不要对外公布太多public方法和非静态的public变量，尽量内敛，可以整合为一个方法的需要进行整合。</li>
<li>是自己的就是自己的：如果一个方法放在本类中，既不增加类间关系，也对本类不产生负面影响，那就放置在本类中。</li>
</ul>
</li>
<li>总结：<strong>尽量减少对象之间的交互，从而减小类之间的耦合。</strong></li>
</ul>
</li>
<li>接口隔离原则(Interface Segregation Principle)
<ul>
<li>定义：户端不应该依赖它不需要的接口，或者说类间的依赖关系应该建立在最小的接口上。</li>
<li>理解：把一个臃肿的接口拆分为多个独立的接口</li>
<li>总结：<strong>不要对外暴露没有实际意义的接口。</strong></li>
</ul>
</li>
<li>依赖倒置原则(Dependence Inversion Principle)
<ul>
<li>定义：即面向接口编程
<ul>
<li>模块间的依赖通过抽象发生，实现类之间不直接发生依赖关系，其依赖关系是通过接口或抽象类产生的</li>
<li>接口或抽象类不依赖于实现类</li>
<li>实现类依赖接口或抽象类</li>
</ul>
</li>
<li>理解：
<ul>
<li>每个类尽量都有接口或抽象类，或者接口和抽象类两者都具备。</li>
<li>变量的字面类型尽量是接口或抽象类。</li>
<li>任何类都不应该从具体类派生。</li>
<li>尽量不要重写基类的方法。如果基类是一个抽象类，而且这个方法已经实现了，子类尽量不要重写。</li>
</ul>
</li>
<li>优点：
<ul>
<li>减少类间的耦合性，提高系统的稳定性</li>
<li>降低并行开发引起的风险</li>
<li>提高代码的可读性和可维护性。</li>
</ul>
</li>
<li>总结：<strong>高层模块不应该依赖于低层模块，而应该依赖于抽象。抽象不应依赖于细节，细节应依赖于抽象。</strong></li>
</ul>
</li>
</ul>
<p>我们把这六大原则的首字母放进一个Set中，并保持原有顺序，就能得到字符串<code>SOLID</code>，预示着六大原则结合后的好处：健壮、稳定</p>
<h2 id="创建型模式"><a class="markdownIt-Anchor" href="#创建型模式"></a> 创建型模式</h2>
<div class="note quote"><p>创建型模式 (Creational Pattern) 对类的实例化过程进 行了抽象，能够 将软件模块中对象的创建和对象的使用 分离 。为了使软件的结构更加清晰，外界对于这些对象 只需要知道它们共同的接口，而不清楚其具体的实现细 节，使整个系统的设计更加符合单一职责原则。 创建型模式在 创建什么 (What) ， 由谁创建 (Who) ， 何 时创建 (When) 等方面都为软件设计者提供了尽可能大 的灵活性。创建型模式 隐藏了类的实例的创建细节，通 过隐藏对象如何被创建和组合在一起达到使整个系统独 立的目的 。</p></div>
<h3 id="单例模式singleton-pattern"><a class="markdownIt-Anchor" href="#单例模式singleton-pattern"></a> 单例模式（Singleton Pattern）</h3>
<p>在面向对象设计的语言中，单例模式通常为我们提供了一种避免多次进行实例化的方法，从而降低构造带来的性能消耗，在基于ES6的语法中，我们也可以实现这一功能。</p>
<p>另外单例模式分为：</p>
<ul>
<li>懒汉式
<ul>
<li>使用时才进行实例化</li>
</ul>
</li>
<li>饿汉式
<ul>
<li>先初始化，用的时候直接返回</li>
</ul>
</li>
</ul>
<p>由于js不需要考虑线程安全，所以推荐使用懒汉式写法，饿汉在JS中反而容易产生没必要的垃圾。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SingleObject</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 防止使用new创建对象</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">new</span>.<span class="property">target</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> errorMsg = <span class="string">&quot;This is single object,Can&#x27;t use keyword new!&quot;</span>;</span><br><span class="line">      <span class="keyword">const</span> tipMsg = <span class="string">&quot;You should use method getInstance to get instance。&quot;</span>;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`\n<span class="subst">$&#123;errorMsg&#125;</span>\n<span class="subst">$&#123;tipMsg&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> getInstance获取单例</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getInstance</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 如果存在单例直接返回</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">SingleObject</span>.<span class="property">instance</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">SingleObject</span>.<span class="property">instance</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 否则创建</span></span><br><span class="line">    <span class="title class_">SingleObject</span>.<span class="property">instance</span> = &#123;&#125;</span><br><span class="line">    <span class="title class_">SingleObject</span>.<span class="property">instance</span>.<span class="property">__proto__</span> = <span class="title class_">SingleObject</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">SingleObject</span>.<span class="property">instance</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> 实际功能</span></span><br><span class="line">  <span class="title function_">doSomething</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;..doing&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance1 = <span class="title class_">SingleObject</span>.<span class="title function_">getInstance</span>();</span><br><span class="line"><span class="keyword">const</span> instance2 = <span class="title class_">SingleObject</span>.<span class="title function_">getInstance</span>();</span><br><span class="line"></span><br><span class="line">instance1.<span class="title function_">doSomething</span>()  <span class="comment">// ...doing</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1 === instance2)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>但上述方法仍然存在一些不足，比如不满足<span style="color:red">1.单一责任原则</span>，上述代码中进行单例是否存在判断的代码与实例化的代码是融合在一起的。另外上述代码也没能很好的满足<span style="color: red">2.开闭原则</span>，因为如果在后续的场景中，我们需要创建多个对象时，就需要修改关于new方式的控制。</p>
<p>因此我们可以通过代理的方式将实现单例的代码抽离出来，他需要实现一下几个功能：</p>
<ol>
<li>单例判断</li>
<li>支持接收任何对象，并返回对象单例</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getSingle</span>(<span class="params">classFun</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> result || (result = <span class="keyword">new</span> <span class="title function_">classFun</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Object</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">doSomething</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;...doing&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 支持函数式调用</span></span><br><span class="line">  <span class="title function_">__call__</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> singleObjectProxy = <span class="title function_">getSingle</span>(<span class="title class_">Object</span>)</span><br><span class="line"><span class="keyword">const</span> instance1 = <span class="title function_">singleObjectProxy</span>()</span><br><span class="line"><span class="keyword">const</span> instance2 = <span class="title function_">singleObjectProxy</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance3 = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1 === instance2)  <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(instance1 === instance3)  <span class="comment">// false</span></span><br><span class="line">instance1.<span class="title function_">doSomething</span>()  <span class="comment">// ...doing</span></span><br><span class="line">instance3.<span class="title function_">doSomething</span>()  <span class="comment">// ...doing</span></span><br></pre></td></tr></table></figure>
<p>单例设计模式远不止能够在面向对象中使用，利用单例模式，创建某些唯一的<code>div</code>浮窗来实现登陆框，iframe，script标签解决跨域问题时候，我们希望整个项目，或者某个页面中仅使用一个实例来减少创建实例的开销以优化性能。</p>
<p>并且懒汉式的单例模式能够避免页面在第一次加载的时候就将该元素加载。等到真正要用到这个元素时才创建该元素并加载DOM</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> getSingle = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> result || (result = fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">createLoginLayer</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> dir = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">  div.<span class="property">innerHtml</span> = <span class="string">&#x27;Login Window&#x27;</span></span><br><span class="line">  div.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div)</span><br><span class="line">  <span class="keyword">return</span> div</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> createSingleLoginLayer = <span class="title function_">getSingle</span>(createLoginLayer)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;LoginBtn&#x27;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> loginLayer = <span class="title function_">createSingleLoginLayer</span>()</span><br><span class="line">  loginLayer.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="工厂设计模式"><a class="markdownIt-Anchor" href="#工厂设计模式"></a> 工厂设计模式</h3>
<p>工厂设计模式常用来实例化对象，某些对象的实例化逻辑非常复杂，我们希望将其封装到一个函数中，当我们想要实例化时，调用函数即可，那么这个用来封装的函数就可以被视为一个工厂，工厂设计模式按照抽象程度不同可以分为：</p>
<ul>
<li>简单工厂模式</li>
<li>工厂模式</li>
<li>抽象工厂模式</li>
</ul>
<h4 id="简单工厂模式"><a class="markdownIt-Anchor" href="#简单工厂模式"></a> 简单工厂模式</h4>
<p>简单工厂又叫<code>静态工厂</code>，核心思想是将某一种产品类的实例化交给工厂对象处理，主要用来创建同一类对象，这些类通常具体相同的父类，例如在进行用户鉴权时，可以根据用户类型渲染不同的页面：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="comment">// 构造函数</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">opt</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = opt.<span class="property">name</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">viewPages</span> = opt.<span class="property">viewPages</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 静态方法实现工厂</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">userFactory</span>(<span class="params">role</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (role) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;superAdmin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;超管&quot;</span>, <span class="attr">viewPages</span>: [<span class="string">&#x27;首页&#x27;</span>,<span class="string">&#x27;作业编辑&#x27;</span>,<span class="string">&#x27;账号管理&#x27;</span>, <span class="string">&#x27;阅卷&#x27;</span>]&#125;)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;teacher&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;教师&quot;</span>, <span class="attr">viewPages</span>: [<span class="string">&#x27;首页&#x27;</span>,<span class="string">&#x27;作业编辑&#x27;</span>, <span class="string">&#x27;阅卷&#x27;</span>]&#125;)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;student&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;学生&quot;</span>, <span class="attr">viewPages</span>: [<span class="string">&#x27;首页&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;参数错误&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> superAdmin = <span class="title class_">User</span>.<span class="title function_">userFactory</span>(<span class="string">&#x27;superAdmin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> teacher = <span class="title class_">User</span>.<span class="title function_">userFactory</span>(<span class="string">&#x27;teacher&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> student = <span class="title class_">User</span>.<span class="title function_">userFactory</span>(<span class="string">&#x27;student&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>简单工厂的优势在于我们只需要传递正确的参数即可得到想要的实例化对象，无需关注实例化的过程。当函数包含了所有对象创建的逻辑，随着项目的增大，构造函数的增多，我们不仅需要修改方法工厂中的逻辑代码，该函数还会变成一个体量庞大的超级函数，因此只适用于实例化对象较少的场景。</p>
<h4 id="工厂模式"><a class="markdownIt-Anchor" href="#工厂模式"></a> 工厂模式</h4>
<p>工厂方法实际上是对静态工厂的进一步抽象，在简单工厂模式中，如果我们希望工厂生产型的同类产品，比如<code>admin</code>类别的用户，那么我们需要修改工厂中的代码，这违反了开闭原则，因此工厂模式使用抽象工厂类或接口来定义工厂需要具备的方法，然后为每个产品类构造对应的工厂，实现一个工厂对应一个产品的形式。</p>
<p>事实上这一设计利用了单一责任原则，将类的实例化充工厂中抽离，交由子类实现</p>
<p>这我们只需要添加一个新的<code>createAdmin</code>工厂函数即可，而不需要修改代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span>, viewPages = []</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> === <span class="title class_">User</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&quot;抽象类无法实例化&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">viewPages</span> = viewPages</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserFactory</span> <span class="keyword">extends</span> <span class="title class_ inherited__">User</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, viewPages</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name, viewPages)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">createSuperAdmin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserFactory</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;超管&quot;</span>, <span class="attr">viewPages</span>: [<span class="string">&#x27;首页&#x27;</span>,<span class="string">&#x27;作业编辑&#x27;</span>,<span class="string">&#x27;账号管理&#x27;</span>, <span class="string">&#x27;阅卷&#x27;</span>]&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">createTeacher</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserFactory</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;教师&quot;</span>, <span class="attr">viewPages</span>: [<span class="string">&#x27;首页&#x27;</span>,<span class="string">&#x27;作业编辑&#x27;</span>, <span class="string">&#x27;阅卷&#x27;</span>]&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createStudent</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserFactory</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;学生&quot;</span>, <span class="attr">viewPages</span>: [<span class="string">&#x27;首页&#x27;</span>]&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userFactory = <span class="keyword">new</span> <span class="title class_">UserFactory</span>();</span><br><span class="line"><span class="keyword">const</span> superAdmin = userFactory.<span class="title function_">createSuperAdmin</span>()</span><br><span class="line"><span class="keyword">const</span> teacher = userFactory.<span class="title function_">createTeacher</span>()</span><br><span class="line"><span class="keyword">const</span> student = userFactory.<span class="title function_">createStudent</span>()</span><br></pre></td></tr></table></figure>
<h4 id="抽象工厂模式"><a class="markdownIt-Anchor" href="#抽象工厂模式"></a> 抽象工厂模式</h4>
<p>抽象工厂模式这是对工厂模式的进一步抽象，考虑如果我们想要生产除了User类以外的其他类，我们仍然需要修改工厂中的create方法，仍然会破坏开闭原则，因此我们需要更高级的抽象，需要一个抽象工厂，来管理其余的所有工厂：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span>, viewPages = []</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span>.<span class="property">target</span> === <span class="title class_">User</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&quot;抽象类无法实例化&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">viewPages</span> = viewPages</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Problem</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">title = <span class="string">&#x27;&#x27;</span>, desc = <span class="string">&#x27;&#x27;</span>, score = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">new</span>.<span class="property">target</span> === <span class="title class_">Problem</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&quot;抽象类无法实例化&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">title</span> = title</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">desc</span> = desc</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">score</span> = score</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProblemFactory</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Problem</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">title, desc, score</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(title, desc, score)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createEasyProblem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProblemFactory</span>(<span class="string">&quot;简单题&quot;</span>, <span class="string">&quot;简单&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">createHardProblem</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProblemFactory</span>(<span class="string">&quot;困难题&quot;</span>, <span class="string">&quot;困难&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserFactory</span> <span class="keyword">extends</span> <span class="title class_ inherited__">User</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, viewPages</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name, viewPages)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">createSuperAdmin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserFactory</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;超管&quot;</span>, <span class="attr">viewPages</span>: [<span class="string">&#x27;首页&#x27;</span>,<span class="string">&#x27;作业编辑&#x27;</span>,<span class="string">&#x27;账号管理&#x27;</span>, <span class="string">&#x27;阅卷&#x27;</span>]&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">createTeacher</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserFactory</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;教师&quot;</span>, <span class="attr">viewPages</span>: [<span class="string">&#x27;首页&#x27;</span>,<span class="string">&#x27;作业编辑&#x27;</span>, <span class="string">&#x27;阅卷&#x27;</span>]&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">createStudent</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserFactory</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;学生&quot;</span>, <span class="attr">viewPages</span>: [<span class="string">&#x27;首页&#x27;</span>]&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EduFactory</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getUserFactory</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserFactory</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getProblemFactory</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProblemFactory</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userFactory = <span class="title class_">EduFactory</span>.<span class="title function_">getUserFactory</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> teacher = userFactory.<span class="title function_">createTeacher</span>()</span><br><span class="line"><span class="keyword">const</span> student = userFactory.<span class="title function_">createStudent</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> problemFactory = <span class="title class_">EduFactory</span>.<span class="title function_">getProblemFactory</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> easyProblem = problemFactory.<span class="title function_">createEasyProblem</span>()</span><br><span class="line"><span class="keyword">const</span> hardProblem = problemFactory.<span class="title function_">createHardProblem</span>()</span><br></pre></td></tr></table></figure>
<p>这样一来，日后如果需要生产新的商品，只需要添加型的工厂即可，不需要修改工厂中的代码</p>
<h4 id="实际引用"><a class="markdownIt-Anchor" href="#实际引用"></a> 实际引用</h4>
<p>最直接的应用就是在处理路由上了，假设现在我们有多个页面，需要让不同的用户根据路径进入不同的页面，通常我们会在<code>route/index.js</code>中直接进行配置：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Login.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SuperAdmin</span> <span class="keyword">from</span> <span class="string">&#x27;../components/SuperAdmin.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Teacher</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Teacher.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Student</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Student.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotFound404</span> <span class="keyword">from</span> <span class="string">&#x27;../components/404.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Router</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    <span class="comment">//重定向到登录页</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//登陆页</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Login</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//超管页面</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/super-admin&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;SuperAdmin&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">SuperAdmin</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//教师页面</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/teacher&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Teacher&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Teacher</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//学生页面</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/student&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Student&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Student</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//404页面</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;NotFound404&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">NotFound404</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>此时，如果学生用户知道了教师用户的path，可以直接通过url进入教师页面，这样显然是不科学的，因此我们需要在登录的时候根据权限使用<code>vue-router</code>的<code>addRoutes</code>方法动态赋予权限，此处就可以利用工厂设计模式进行设计。</p>
<p>首先我们只需要在<code>index.js</code>中添加Login的路由：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Login.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Router</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    <span class="comment">//重定向到登录页</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//登陆页</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Login&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Login</span></span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>随后我们在<code>router</code>目录下创建一个路由工厂<code>routerFactory.js</code>来根据登录状态动态地添加路由，我们可以利用数组的slice方法，将不属于该类用户的路由剔除，仅保留运行访问的路由：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routerFactory.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">SuperAdmin</span> <span class="keyword">from</span> <span class="string">&#x27;../components/SuperAdmin.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Teacher</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Teacher.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Student</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Student.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NotFound404</span> <span class="keyword">from</span> <span class="string">&#x27;../components/404.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">AllRouter</span> = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//超管页面</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/super-admin&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;SuperAdmin&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">SuperAdmin</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//教师页面</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/teacher&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Teacher&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Teacher</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//学生页面</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/student&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Student&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Student</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//404页面</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;NotFound404&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">NotFound404</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">routerFactory</span> = (<span class="params">role</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span>(role) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;superAdmin&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;SuperAdmin&quot;</span>,</span><br><span class="line">        <span class="attr">route</span>: <span class="title class_">AllRouter</span></span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;Teacher&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;Teacher&quot;</span>,</span><br><span class="line">        <span class="comment">// 将不属于该类型用户的导航去掉</span></span><br><span class="line">        <span class="attr">route</span>: <span class="title class_">AllRouter</span>.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;Student&quot;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;Student&quot;</span>,</span><br><span class="line">        <span class="attr">route</span>: <span class="title class_">AllRouter</span>.<span class="title function_">slice</span>(<span class="number">2</span>)</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;参数错误! 可选参数: superAdmin, Teacher, Student&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; routerFactory &#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>在登录组件的事件中调用路由工厂得到路由：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// Login.vue</span><br><span class="line"></span><br><span class="line">&lt;script lang=&#x27;js&#x27; setup&gt;</span><br><span class="line">import &#123; routerFactory &#125; from &quot;../router/routerFactory.js&quot;</span><br><span class="line"></span><br><span class="line">const router = useRouter()</span><br><span class="line"></span><br><span class="line">const getRouter = (role) =&gt; &#123;</span><br><span class="line">  let routerObj = routerFactory(role)</span><br><span class="line">  // 动态添加路由</span><br><span class="line">  router.addRoute(routerObj)</span><br><span class="line">  // 进行页面跳转</span><br><span class="line">  router.push(&#123;name: routerObj.name&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>但在实际项目中，因为使用<code>addRoute</code>方法添加的路由刷新后不能保存，所以会导致路由无法访问。通常的做法是本地加密保存用户信息，在刷新后获取本地权限并解密，根据权限重新添加路由。</p>
<p>实际上JQuery中的<code>$(selector)</code>，React中的<code>createElement()</code>都是工厂方法。</p>
<p><code>$()</code>利用我们提供的信息创建<code>JQuery</code>对象并返回</p>
<p><code>createElement()</code>利用我们提供的信息创建<code>Vnode</code>对象并返回</p>
<h3 id="原型设计模式"><a class="markdownIt-Anchor" href="#原型设计模式"></a> 原型设计模式</h3>
<p>对于前端程序员而言，原型设计模式可谓非常熟悉了，JS的原型链就是以原型设计模式设计的。</p>
<p>因此对一这部分的理解可以直接借用JS原型链的知识，原型编程泛型的基本规则是：</p>
<blockquote>
<ol>
<li>所有数据都是对象</li>
<li>要得到一个对象，不是通过实例化类，而是找到一个对象作为原型，并克隆他它</li>
<li>对象会记住它的原型</li>
<li>如果对象无法响应某个请求，则会把这个请求委托给自己的原型</li>
</ol>
</blockquote>
<p>是不是很熟悉，new方法实际上是一个很好的例子，我们可以借助new方法源码的方法实现一个这个克隆的过程：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">shape</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getType</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">type</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getId</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">id</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">setId</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">id</span> = id;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">clone</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 创建空对象</span></span><br><span class="line">    <span class="keyword">let</span> res = &#123;&#125;</span><br><span class="line">    <span class="comment">// 绑定原型</span></span><br><span class="line">    res.<span class="property">__proto__</span> = <span class="variable language_">this</span>.<span class="property">__proto__</span></span><br><span class="line">    <span class="comment">// 改变this指向</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">__proto__</span>.<span class="property">constructor</span>.<span class="title function_">call</span>(res)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>接下来我们就可以使用原型继承的方式创建一些类对象：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Rectangle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">type</span> = <span class="string">&quot;Rectangle&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定原型</span></span><br><span class="line"><span class="title class_">Rectangle</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> = <span class="keyword">new</span> <span class="title class_">Shape</span>()</span><br><span class="line"><span class="comment">// 绑定静态方法</span></span><br><span class="line"><span class="title class_">Rectangle</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">draw</span> = <span class="function">() =&gt;</span> &#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Rectangle!&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Square</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">type</span> = <span class="string">&quot;Square&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定原型</span></span><br><span class="line"><span class="title class_">Square</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> = <span class="keyword">new</span> <span class="title class_">Shape</span>()</span><br><span class="line"><span class="comment">// 绑定静态方法</span></span><br><span class="line"><span class="title class_">Square</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">draw</span> = <span class="function">() =&gt;</span> &#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Square!&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Circle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">type</span> = <span class="string">&quot;Circle&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定原型</span></span><br><span class="line"><span class="title class_">Circle</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> = <span class="keyword">new</span> <span class="title class_">Shape</span>()</span><br><span class="line"><span class="comment">// 绑定静态方法</span></span><br><span class="line"><span class="title class_">Circle</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">draw</span> = <span class="function">() =&gt;</span> &#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Circle!&quot;</span>)&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>创建好了类以后我们就可以尝试对类进行实例化，由上面的描述我们知道实例化的过程是通过找到一个对象，然后克隆得到的，为了实现’找到一个对象’的过程，我们需要模拟一个cache：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ShapeCache</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getShape</span>(<span class="params">shapeId</span>) &#123;</span><br><span class="line">       <span class="keyword">const</span> cachedShape = <span class="title class_">ShapeCache</span>.<span class="property">shapeMap</span>.<span class="title function_">get</span>(shapeId);</span><br><span class="line">       <span class="keyword">return</span> cachedShape.<span class="title function_">clone</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">loadCache</span>(<span class="params"></span>) &#123;</span><br><span class="line">       <span class="keyword">const</span> circle = <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">       circle.<span class="title function_">setId</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">       <span class="title class_">ShapeCache</span>.<span class="property">shapeMap</span>.<span class="title function_">set</span>(circle.<span class="title function_">getId</span>(),circle);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">const</span> square = <span class="keyword">new</span> <span class="title class_">Square</span>();</span><br><span class="line">       square.<span class="title function_">setId</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">       <span class="title class_">ShapeCache</span>.<span class="property">shapeMap</span>.<span class="title function_">set</span>(square.<span class="title function_">getId</span>(),square);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">const</span> rectangle = <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">       rectangle.<span class="title function_">setId</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">       <span class="title class_">ShapeCache</span>.<span class="property">shapeMap</span>.<span class="title function_">set</span>(rectangle.<span class="title function_">getId</span>(),rectangle);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="title class_">ShapeCache</span>.<span class="property">shapeMap</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="title class_">ShapeCache</span>.<span class="title function_">loadCache</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clonedShape = <span class="title class_">ShapeCache</span>.<span class="title function_">getShape</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Shape : &quot;</span> + clonedShape.<span class="title function_">getType</span>());          </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clonedShape2 = <span class="title class_">ShapeCache</span>.<span class="title function_">getShape</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Shape : &quot;</span> + clonedShape2.<span class="title function_">getType</span>());         </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clonedShape3 = <span class="title class_">ShapeCache</span>.<span class="title function_">getShape</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Shape : &quot;</span> + clonedShape3.<span class="title function_">getType</span>());</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * output:</span></span><br><span class="line"><span class="comment"> * Shape : Circle</span></span><br><span class="line"><span class="comment"> * Shape : Square</span></span><br><span class="line"><span class="comment"> * Shape : Rectangle</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>在其它编程中使用原型模式的优势是使用更小的代价来创建对象，通过原型引用的方式而不是开辟新的空间。</p>
<p>JS在设计之初就是采用的原型链继承的方式，直接new就进行了克隆的操作，所以对比其它语言创建大对象的性能，能高出不少。</p>
<h3 id="生成器设计模式"><a class="markdownIt-Anchor" href="#生成器设计模式"></a> 生成器设计模式</h3>
<blockquote>
<p>使用简单的对象组合成复杂的对象</p>
</blockquote>
<p>这里我们用快餐举例，如果我们希望但开一家快餐店，那么各种套餐都是由不同种类的冷饮和汉堡组合而成。同时冷饮需要瓶子装，汉堡需要纸盒包住，那么我们可以先定义冷饮和汉堡类和它们所需要的瓶子和纸盒。</p>
<p>下面是生成器模式的类图：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/builder/structure.png' data-fancybox='default' data-caption='生成器模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/builder/structure.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/builder/structure.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="生成器模式类图" /></a><span class='image-caption'>生成器模式类图</span></div></div>
<ol>
<li>主管（Director）类定义调用构造步骤的顺序，这样就可以创建和复用特定的产品配置。</li>
<li>生成器（Builder）接口声明在所有类型生成器中通用的产品构造步骤。</li>
<li>具体生成器（Concrete Builders）提供构造过程的不同实现。 具体生成器也可以构造不遵循通用接口的产品。</li>
</ol>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 纸盒</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wrapper</span> &#123;</span><br><span class="line">  <span class="title function_">pack</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Wrapper&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 水杯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bottle</span>&#123;</span><br><span class="line">  <span class="title function_">pack</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bottle&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 汉堡需要纸盒包住</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Burger</span> &#123;</span><br><span class="line">  <span class="title function_">packing</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Wrapper</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 饮料需要水杯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Drink</span> &#123;</span><br><span class="line">  <span class="title function_">packing</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bottle</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>如果在这个基础上，我们想要提供不同类别的汉堡与饮料我们可以根据基类进行派生：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 各种生成器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VegBurger</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Burger</span> &#123;</span><br><span class="line">  <span class="title function_">price</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">25.0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">name</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Veg Burger&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChickenBurger</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Burger</span> &#123;</span><br><span class="line">  <span class="title function_">price</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">50.0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">name</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Chicken Burger&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Coke</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Drink</span> &#123;</span><br><span class="line">  <span class="title function_">price</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3.0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">name</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Coke&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>之后我们可以在这个的基础上构建一些套餐，以便用户进行选择：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Meal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> items = []</span><br><span class="line">    <span class="comment">// 使用defineProperty代理定义属性操作</span></span><br><span class="line">    <span class="title class_">Reflect</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, <span class="string">&#x27;items&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">get</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">__proto__</span> !== <span class="title class_">Meal</span>.<span class="property"><span class="keyword">prototype</span></span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;items is private!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> items</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">addItem</span>(<span class="params">item</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">push</span>(item)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getCost</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> cost = <span class="number">0.0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      cost += item.<span class="title function_">price</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">showItems</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Item: <span class="subst">$&#123;item.name()&#125;</span>;Packing: <span class="subst">$&#123;item.packing.pack&#125;</span>;Price: <span class="subst">$&#123;item.price()&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>接下来我们可以利用工厂设计模式，为套餐创建工厂，避免繁杂的对象构建：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主管类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MealBuilder</span> &#123;</span><br><span class="line">  <span class="title function_">prepareVegMeal</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> meal = <span class="keyword">new</span> <span class="title class_">Meal</span>()</span><br><span class="line">    meal.<span class="title function_">addItem</span>(<span class="keyword">new</span> <span class="title class_">VegBurger</span>());</span><br><span class="line">    meal.<span class="title function_">addItem</span>(<span class="keyword">new</span> <span class="title class_">Coke</span>());</span><br><span class="line">    <span class="keyword">return</span> meal</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">prepareChickenMeal</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> meal = <span class="keyword">new</span> <span class="title class_">Meal</span>()</span><br><span class="line">    meal.<span class="title function_">addItem</span>(<span class="keyword">new</span> <span class="title class_">ChickenBurger</span>());</span><br><span class="line">    meal.<span class="title function_">addItem</span>(<span class="keyword">new</span> <span class="title class_">Coke</span>());</span><br><span class="line">    <span class="keyword">return</span> meal</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="keyword">const</span> mealBuilder = <span class="keyword">new</span> <span class="title class_">MealBuilder</span>()</span><br><span class="line"><span class="keyword">const</span> vegMeal = mealBuilder.<span class="title function_">prepareVegMeal</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Veg Meal:&quot;</span>)</span><br><span class="line">vegMeal.<span class="title function_">showItems</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Total Cost: &quot;</span> +vegMeal.<span class="title function_">getCost</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> chickenMeal = mealBuilder.<span class="title function_">prepareChickenMeal</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Chicken Meal:&quot;</span>)</span><br><span class="line">chickenMeal.<span class="title function_">showItems</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Total Cost: &quot;</span> +chickenMeal.<span class="title function_">getCost</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * output:</span></span><br><span class="line"><span class="comment"> * Veg Meal</span></span><br><span class="line"><span class="comment"> * Item : Veg Burger,Packing : Wrapper,Price : 25</span></span><br><span class="line"><span class="comment"> * Item : Coke,Packing : Bottle,Price : 3</span></span><br><span class="line"><span class="comment"> * Total Cost: 28</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Chicken Meal</span></span><br><span class="line"><span class="comment"> * Item : Chicken Burger,Packing : Wrapper,Price : 50</span></span><br><span class="line"><span class="comment"> * Item : Coke,Packing : Bottle,Price : 3</span></span><br><span class="line"><span class="comment"> * Total Cost: 53</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>这是一种创建复杂对象的最佳实践。尤其是复杂对象多变的情况下，通过基础组件来组合，在基础组件变更时，多种依赖于基础组件的复杂组件也能方便变更，而不需要更改多种不同的复杂组件。</p>
<h2 id="结构型模式"><a class="markdownIt-Anchor" href="#结构型模式"></a> 结构型模式</h2>
<div class="note quote"><p>其描述 如何将类或者对 象结合在一起形成更大的结构 ，就像搭积木，可以通过 简单积木的组合形成复杂的、功能更为强大的结构。 结构型模式可以分为 类结构型模式 和 对象结构型模式 ： • 类结构型模式关心类的组合 ，由多个类可以组合成一个更大的系统，在类结构型模式中一般只存在继承关系和实现关系。 • 对象结构型模式关心类与对象的组合，通过关联关系使得在一个类中定义另一个类的实例对象，然后通过该对象调用其方法。 根据“合成复用原则”，在系统中尽量使用关联关系来替代继承关系，因此大部分结构型模式都是 对象结构型模式 。</p></div>
<h3 id="适配器模式"><a class="markdownIt-Anchor" href="#适配器模式"></a> 适配器模式</h3>
<blockquote>
<p>适配器模式是一种结构型设计模式， 它能使接口不兼容的对象能够相互合作。</p>
</blockquote>
<p>我们从实际问题出发理解适配器设计模式：</p>
<p>现在我们有一个数据展示平台，有一个需求是将股票数据展示的业务整合到原有平台中，我们决定使用第三方库对股票信息进行分析后进行展示。</p>
<p>那么问题来了，我们使用的第三方库要求以<code>Json</code>格式输入，但从数据提供方取得的数据是<code>XML</code>格式的，我们该怎么办</p>
<p>我们当然可以修改第三方库中的代码让他支持，但有时第三方库的原码并没有那么好取得，也没有那么好修改。</p>
<p>于是，我们想到可以创建一个<strong>适配器</strong>，对格式进行转换后，输入给第三方库。</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/adapter/solution-zh.png' data-fancybox='default' data-caption='适配器流程'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/adapter/solution-zh.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/adapter/solution-zh.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="适配器流程" /></a><span class='image-caption'>适配器流程</span></div></div>
<p>适配器不仅可以转换不同格式的数据， 其还有助于采用不同接口的对象之间的合作。 它的运作方式如下：</p>
<ol>
<li>适配器实现与其中一个现有对象兼容的接口。</li>
<li>现有对象可以使用该接口安全地调用适配器方法。</li>
<li>适配器方法被调用后将以另一个对象兼容的格式和顺序将请求传递给该对象。</li>
</ol>
<p>有时你甚至可以创建一个双向适配器来实现双向转换调用。</p>
<h4 id="对象适配器"><a class="markdownIt-Anchor" href="#对象适配器"></a> 对象适配器</h4>
<p>实现时使用了构成原则： 适配器实现了其中一个对象的接口， 并对另一个对象进行封装。 所有流行的编程语言都可以实现适配器。</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/adapter/structure-object-adapter.png?id=33dffbe3aece294162440c7ddd3d5d4f' data-fancybox='default' data-caption='对象适配器类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/adapter/structure-object-adapter.png?id=33dffbe3aece294162440c7ddd3d5d4f" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/adapter/structure-object-adapter.png?id=33dffbe3aece294162440c7ddd3d5d4f" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="对象适配器类图" /></a><span class='image-caption'>对象适配器类图</span></div></div>
<h4 id="类适配器"><a class="markdownIt-Anchor" href="#类适配器"></a> 类适配器</h4>
<p>下列适配器模式演示基于经典的 “方钉和圆孔” 问题。</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/adapter/example.png?id=9d2b6857ce256f2c669383ce4df3d0aa' data-fancybox='default' data-caption='类适配器类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/adapter/example.png?id=9d2b6857ce256f2c669383ce4df3d0aa" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/adapter/example.png?id=9d2b6857ce256f2c669383ce4df3d0aa" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="类适配器类图" /></a><span class='image-caption'>类适配器类图</span></div></div>
<p>适配器假扮成一个圆钉 （Round­Peg）， 其半径等于方钉 （Square­Peg） 横截面对角线的一半 （即能够容纳方钉的最小外接圆的半径）。</p>
<h4 id="使用场景"><a class="markdownIt-Anchor" href="#使用场景"></a> 使用场景</h4>
<ol>
<li>当你希望使用某个类， 但是其接口与其他代码不兼容时， 可以使用适配器类
<ul>
<li>适配器模式允许你创建一个中间层类， 其可作为代码与遗留类、 第三方类或提供怪异接口的类之间的转换器。</li>
</ul>
</li>
<li>如果您需要复用这样一些类， 他们处于同一个继承体系， 并且他们又有了额外的一些共同的方法， 但是这些共同的方法不是所有在这一继承体系中的子类所具有的共性。
<ul>
<li>你可以扩展每个子类， 将缺少的功能添加到新的子类中。 但是， 你必须在所有新子类中重复添加这些代码， 这样会使得代码有坏味道。将缺失功能添加到一个适配器类中是一种优雅得多的解决方案。 然后你可以将缺少功能的对象封装在适配器中， 从而动态地获取所需功能。 如要这一点正常运作， 目标类必须要有通用接口， 适配器的成员变量应当遵循该通用接口。 这种方式同装饰模式非常相似。</li>
</ul>
</li>
</ol>
<p>下面大件一个场景来写一个简单的demo吧。</p>
<p>我们知道音频文件有<code>vlc</code>,<code>mp3</code>,<code>mp4</code>等多种不同的文件，不同的文件需要使用不同的播放器大概并播放，但随着文件编码方式的进步，未来将会有更多编码类型的音频文件流行，那么我们希望设计一个播放器可以同时播放不同格式的文件。</p>
<p>通过上面的分析我们知道，此处是使用适配器模式的好时候，我们为播放器设计一个适配器来处理不同格式的文件：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VlcPlayer</span> &#123;</span><br><span class="line">  <span class="title function_">playVlc</span>(<span class="params">fileName</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Vlc file:<span class="subst">$&#123;fileName&#125;</span> is playing`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mp3Player</span> &#123;</span><br><span class="line">  <span class="title function_">playMp3</span>(<span class="params">fileName</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Mp3 file:<span class="subst">$&#123;fileName&#125;</span> is playing`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mp4Player</span> &#123;</span><br><span class="line">  <span class="title function_">playMp4</span>(<span class="params">fileName</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Mp4 file:<span class="subst">$&#123;fileName&#125;</span> is playing`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MediaAdapter</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">audioType</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(audioType) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;vlc&#x27;</span>:</span><br><span class="line">        <span class="title class_">MediaAdapter</span>.<span class="property">MusicPlayer</span> = <span class="keyword">new</span> <span class="title class_">VlcPlayer</span>()</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;mp3&#x27;</span>:</span><br><span class="line">        <span class="title class_">MediaAdapter</span>.<span class="property">MusicPlayer</span> = <span class="keyword">new</span> <span class="title class_">Mp3Player</span>()</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;mp4&#x27;</span>:</span><br><span class="line">        <span class="title class_">MediaAdapter</span>.<span class="property">MusicPlayer</span> = <span class="keyword">new</span> <span class="title class_">Mp4Player</span>()</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">play</span>(<span class="params">audioType, fileName</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(audioType) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;vlc&#x27;</span>:</span><br><span class="line">        <span class="title class_">MediaAdapter</span>.<span class="property">MusicPlayer</span>.<span class="title function_">playVlc</span>(fileName)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;mp3&#x27;</span>:</span><br><span class="line">        <span class="title class_">MediaAdapter</span>.<span class="property">MusicPlayer</span>.<span class="title function_">playMp3</span>(fileName)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;mp4&#x27;</span>:</span><br><span class="line">        <span class="title class_">MediaAdapter</span>.<span class="property">MusicPlayer</span>.<span class="title function_">playMp4</span>(fileName)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AudioPlayer</span> &#123;</span><br><span class="line">  <span class="title function_">play</span>(<span class="params">audioType, fileName</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(audioType) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;vlc&#x27;</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;mp3&#x27;</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;mp4&#x27;</span>:</span><br><span class="line">        <span class="title class_">AudioPlayer</span>.<span class="property">mediaAdapter</span> = <span class="keyword">new</span> <span class="title class_">MediaAdapter</span>(audioType)</span><br><span class="line">        <span class="title class_">AudioPlayer</span>.<span class="property">mediaAdapter</span>.<span class="title function_">play</span>(audioType, fileName)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`sorry this type is not supported yet`</span>)</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> audioPlayer = <span class="keyword">new</span> <span class="title class_">AudioPlayer</span>();</span><br><span class="line"></span><br><span class="line">audioPlayer.<span class="title function_">play</span>(<span class="string">&#x27;mp3&#x27;</span>, <span class="string">&#x27;fly me to the moon.mp3&#x27;</span>)  <span class="comment">// Mp3 file: fly me to the moon.mp3 is playing</span></span><br><span class="line">audioPlayer.<span class="title function_">play</span>(<span class="string">&#x27;vlc&#x27;</span>, <span class="string">&#x27;high way to hell.vlc&#x27;</span>)  <span class="comment">// Vlc file: high way to hell.vlc is playing</span></span><br><span class="line">audioPlayer.<span class="title function_">play</span>(<span class="string">&#x27;mp4&#x27;</span>, <span class="string">&#x27;help.mp4&#x27;</span>)  <span class="comment">// Mp4 file: help.mp4 is playing</span></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h3 id="桥接模式"><a class="markdownIt-Anchor" href="#桥接模式"></a> 桥接模式</h3>
<blockquote>
<p>桥接模式也叫桥梁模式，将实现与抽象放在两个不同的层次中，使得两者可以独立地变化。(最主要的将实现和抽象两个层次划分开来)</p>
</blockquote>
<p>桥接模式将类分为了抽象与实现两个层次，其中抽象类作为桥梁定义角色的行为并保存一个实现类的引用。然后为了规范实现类具备的功能，实现类需要实现一个统一的interface</p>
<p>就好比GUI和API，用户操作的是GUI，GUI充当用户和系统之间的桥梁，调用各种API来处理具体的事物。</p>
<p>下面我们用一个小例子来体会一下，现在我们有两套播放设备，一套是tv，另一套是radio，客户希望可以对他们进行控制。此时我们通过创建一个抽象类RemoteControl来向用户提供一些操作接口，然后在这些接口中调用实现类的方法完成这些操作，这样就可以将用户和设配联系在一起了。</p>
<p>该场景下类图如下：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/bridge/example-zh.png' data-fancybox='default' data-caption='桥接设计模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/bridge/example-zh.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/bridge/example-zh.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="桥接设计模式类图" /></a><span class='image-caption'>桥接设计模式类图</span></div></div>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现类 的接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="title function_">isEnabled</span>(): <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="title function_">enable</span>(): <span class="built_in">void</span>;</span><br><span class="line">    <span class="title function_">disable</span>(): <span class="built_in">void</span>;</span><br><span class="line">    <span class="title function_">getVolume</span>(): <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">setVolume</span>(<span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">    <span class="title function_">getChannel</span>(): <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">setChannel</span>(<span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">    <span class="title function_">getName</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类1</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tv</span> <span class="keyword">implements</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">name</span>: <span class="string">&quot;Tv&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">state</span>: <span class="string">&quot;close&quot;</span> | <span class="string">&quot;open&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">volume</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">channel</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;Tv&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&quot;close&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">volume</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">channel</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">isEnabled</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&quot;open&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">enable</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&quot;open&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">disable</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&quot;close&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getVolume</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">volume</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setVolume</span>(<span class="attr">number</span>: <span class="built_in">any</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">volume</span> += <span class="built_in">number</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">volume</span> = <span class="variable language_">this</span>.<span class="property">volume</span> &gt; <span class="number">100</span> ? <span class="number">100</span> : <span class="variable language_">this</span>.<span class="property">volume</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">volume</span> = <span class="variable language_">this</span>.<span class="property">volume</span> &lt; <span class="number">0</span> ? <span class="number">0</span> : <span class="variable language_">this</span>.<span class="property">volume</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getChannel</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">channel</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setChannel</span>(<span class="attr">number</span>: <span class="built_in">any</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">channel</span> += <span class="built_in">number</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">channel</span> = <span class="variable language_">this</span>.<span class="property">channel</span> &lt; <span class="number">0</span> ? <span class="number">0</span> : <span class="variable language_">this</span>.<span class="property">channel</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getName</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现类2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Radio</span> <span class="keyword">implements</span> <span class="title class_">Device</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">name</span>: <span class="string">&quot;Radio&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">state</span>: <span class="string">&quot;close&quot;</span> | <span class="string">&quot;open&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">volume</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">channel</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;Radio&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&quot;close&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">volume</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">channel</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">isEnabled</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">state</span> === <span class="string">&quot;open&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">enable</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&quot;open&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">disable</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="string">&quot;close&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getVolume</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">volume</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setVolume</span>(<span class="attr">number</span>: <span class="built_in">any</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">volume</span> += <span class="built_in">number</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">volume</span> = <span class="variable language_">this</span>.<span class="property">volume</span> &gt; <span class="number">100</span> ? <span class="number">100</span> : <span class="variable language_">this</span>.<span class="property">volume</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">volume</span> = <span class="variable language_">this</span>.<span class="property">volume</span> &lt; <span class="number">0</span> ? <span class="number">0</span> : <span class="variable language_">this</span>.<span class="property">volume</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getChannel</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">channel</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">setChannel</span>(<span class="attr">number</span>: <span class="built_in">any</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">channel</span> += <span class="built_in">number</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">channel</span> = <span class="variable language_">this</span>.<span class="property">channel</span> &lt; <span class="number">0</span> ? <span class="number">0</span> : <span class="variable language_">this</span>.<span class="property">channel</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getName</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象类</span></span><br><span class="line"><span class="comment">// 它定义了两个类层次结构中“控制”部分的接口。</span></span><br><span class="line"><span class="comment">// 它管理着一个指向实现类对象的引用，并会将所有真实工作委派给该对象。</span></span><br><span class="line"><span class="comment">// 它扮演了一个桥梁的作用，将用户和device连接起来</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">device</span>: <span class="title class_">Device</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">device</span>: <span class="title class_">Device</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">device</span> = device;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">togglePower</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`toggle <span class="subst">$&#123;<span class="variable language_">this</span>.device.getName()&#125;</span> power`</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">isEnabled</span>()) <span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">disable</span>();</span><br><span class="line">        <span class="keyword">else</span> <span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">enable</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">volumeDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">setVolume</span>(<span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">getVolume</span>() - <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">volumeUp</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">setVolume</span>(<span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">getVolume</span>() + <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">channelDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">setChannel</span>(<span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">getChannel</span>() - <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">channelUp</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">setChannel</span>(<span class="variable language_">this</span>.<span class="property">device</span>.<span class="title function_">getChannel</span>() + <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tv = <span class="keyword">new</span> <span class="title class_">Tv</span>();</span><br><span class="line"><span class="keyword">const</span> tvRemote = <span class="keyword">new</span> <span class="title class_">RemoteControl</span>(tv);</span><br><span class="line"></span><br><span class="line">tvRemote.<span class="title function_">togglePower</span>(); <span class="comment">// toggle Tv power</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> radio = <span class="keyword">new</span> <span class="title class_">Radio</span>();</span><br><span class="line"><span class="keyword">const</span> radioRemote = <span class="keyword">new</span> <span class="title class_">RemoteControl</span>(radio);</span><br><span class="line"></span><br><span class="line">radioRemote.<span class="title function_">togglePower</span>(); <span class="comment">// toggle Radio power</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="适用场景"><a class="markdownIt-Anchor" href="#适用场景"></a> 适用场景</h4>
<ol>
<li>如果你想要拆分或重组一个具有多重功能的庞杂类 （例如能与多个数据库服务器进行交互的类）， 可以使用桥接模式。
<ul>
<li>这样一来能够减少类的代码行数，提升代码可读性，此后，可以修改任意一个类层次结构而不会影响到其他类层次结构。</li>
</ul>
</li>
<li>如果你希望在几个独立维度上扩展一个类，可使用该模式。
<ul>
<li>桥接建议将每个维度抽取为独立的类层次。初始类将相关工作委派给属于对应类层次的对象， 无需自己完成所有工作。</li>
</ul>
</li>
<li>如果你需要在运行时切换不同实现方法，可使用桥接模式。
<ul>
<li>桥接模式可替换抽象类中的实现类对象。</li>
</ul>
</li>
</ol>
<h4 id="缺点"><a class="markdownIt-Anchor" href="#缺点"></a> 缺点</h4>
<ol>
<li>对高内聚的类使用该模式可能会让代码更加复杂。</li>
</ol>
<h4 id="combo"><a class="markdownIt-Anchor" href="#combo"></a> Combo</h4>
<ol>
<li>当抽象类只与特定的实现类组合时，可以将桥接模式与<code>抽象工厂模式</code>进行结合，抽象工厂负责对某些关系进行封装，对客户段隐藏其复杂性</li>
<li><code>生成器模式</code>也能与桥接模式很好的组合，例如我们可以让主管类负责抽象类的工作，让各种不用的生成器类负责实现类的工作。</li>
</ol>
<h3 id="过滤器模式"><a class="markdownIt-Anchor" href="#过滤器模式"></a> 过滤器模式</h3>
<blockquote>
<p>过滤器模式用来操作一组对象，允许开发者使用不同标准对这组对象进行过滤从而得到不同的集合，该模式通过逻辑运算以解耦的方式把它们连接起来</p>
</blockquote>
<p>参与过滤器设计模式中的角色包括：</p>
<ol>
<li>抽象过滤器角色(AbstractFilter): 负责定义过滤器的实现接口</li>
<li>具体过滤器角色(ConcreteFilter): 负责具体的过滤器实现，最后返回一个过滤后的数据集合，标准过滤器只对数据进行过滤，当然也能对集合中的数据进行预处理，在将处理好的数据行程集合返回</li>
<li>被过滤对象(Subject): 具体的被过滤对象</li>
</ol>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://www.runoob.com/wp-content/uploads/2014/08/20230510-filter.svg' data-fancybox='default' data-caption='过滤器模式类图'><img fancybox itemprop="contentUrl" src="https://www.runoob.com/wp-content/uploads/2014/08/20230510-filter.svg" class="lazyload placeholder" data-srcset="https://www.runoob.com/wp-content/uploads/2014/08/20230510-filter.svg" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="过滤器模式类图" /></a><span class='image-caption'>过滤器模式类图</span></div></div>
<p>类图中<code>Criteria</code>扮演抽象过滤器的角色<code>Person</code>扮演被过滤对象，其余均为实现对象。</p>
<p>我们根据上述类图来实现一个过滤器模式，首先我们来实现一个被过滤对象：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 被过滤对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, gender, maritalStatus</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gender</span> = gender;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">maritalStatus</span> = maritalStatus;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getGender</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">gender</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getMaritalStatus</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">maritalStatus</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>接下来我们对过滤器对象进行实现，这个过程我们需要实现一个接口，随后根据结构实现一系列具体过滤器，我们还可以利用处理结合的方式，例如与、或操作，构造更为复杂的筛选条件：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Criteria</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * meetCriteria</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">meetCriteria</span>(<span class="attr">persons</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt;): <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CriteriaMale</span> <span class="keyword">implements</span> <span class="title class_">Criteria</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">meetCriteria</span>(<span class="params"><span class="attr">persons</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> persons.<span class="title function_">filter</span>(<span class="function">(<span class="params"><span class="attr">person</span>: <span class="title class_">Person</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (person.<span class="title function_">getGender</span>().<span class="title function_">toUpperCase</span>() === <span class="string">&quot;MALE&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CriteriaFemale</span> <span class="keyword">implements</span> <span class="title class_">Criteria</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">meetCriteria</span>(<span class="params"><span class="attr">persons</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> persons.<span class="title function_">filter</span>(<span class="function">(<span class="params"><span class="attr">person</span>: <span class="title class_">Person</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (person.<span class="title function_">getGender</span>().<span class="title function_">toUpperCase</span>() === <span class="string">&quot;FEMALE&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CriteriaSingle</span> <span class="keyword">implements</span> <span class="title class_">Criteria</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">meetCriteria</span>(<span class="attr">persons</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt;): <span class="title class_">Person</span>[] &#123;</span><br><span class="line">        <span class="keyword">return</span> persons.<span class="title function_">filter</span>(<span class="function">(<span class="params"><span class="attr">person</span>: <span class="title class_">Person</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (person.<span class="title function_">getMaritalStatus</span>().<span class="title function_">toUpperCase</span>() === <span class="string">&quot;SINGLE&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与筛选</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndCriteria</span> <span class="keyword">implements</span> <span class="title class_">Criteria</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">criteria</span>: <span class="title class_">Criteria</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">otherCriteria</span>: <span class="title class_">Criteria</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">criteria</span>: <span class="title class_">Criteria</span>, <span class="attr">otherCriteria</span>: <span class="title class_">Criteria</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">criteria</span> = criteria;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">otherCriteria</span> = otherCriteria;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">meetCriteria</span>(<span class="attr">persons</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt;): <span class="title class_">Person</span>[] &#123;</span><br><span class="line">        <span class="keyword">const</span> middleArray = <span class="variable language_">this</span>.<span class="property">criteria</span>.<span class="title function_">meetCriteria</span>(persons);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">otherCriteria</span>.<span class="title function_">meetCriteria</span>(middleArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或筛选</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrCriteria</span> <span class="keyword">implements</span> <span class="title class_">Criteria</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">criteria</span>: <span class="title class_">Criteria</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">otherCriteria</span>: <span class="title class_">Criteria</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">criteria</span>: <span class="title class_">Criteria</span>, <span class="attr">otherCriteria</span>: <span class="title class_">Criteria</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">criteria</span> = criteria;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">otherCriteria</span> = otherCriteria;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">meetCriteria</span>(<span class="attr">persons</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt;): <span class="title class_">Person</span>[] &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt; = [];</span><br><span class="line">        <span class="keyword">const</span> firstArray = <span class="variable language_">this</span>.<span class="property">criteria</span>.<span class="title function_">meetCriteria</span>(persons);</span><br><span class="line">        <span class="keyword">const</span> secondArray = <span class="variable language_">this</span>.<span class="property">otherCriteria</span>.<span class="title function_">meetCriteria</span>(persons);</span><br><span class="line"></span><br><span class="line">        firstArray.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="attr">person</span>: <span class="title class_">Person</span></span>) =&gt;</span> &#123;</span><br><span class="line">            result.<span class="title function_">push</span>(person);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        secondArray.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="attr">person</span>: <span class="title class_">Person</span></span>) =&gt;</span> &#123;</span><br><span class="line">            result.<span class="title function_">push</span>(person);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>随后我们就可以使用这些过滤器来处理一个目标集合了：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">showPersons</span> = (<span class="params"><span class="attr">persons</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt;</span>) =&gt; &#123;</span><br><span class="line">    persons.<span class="title function_">forEach</span>(<span class="function">(<span class="params">person, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(person.<span class="title function_">getName</span>());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> personList = <span class="keyword">new</span> <span class="title class_">Array</span>&lt;<span class="title class_">Person</span>&gt;();</span><br><span class="line"></span><br><span class="line">personList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Robert&quot;</span>, <span class="string">&quot;Male&quot;</span>, <span class="string">&quot;Single&quot;</span>));</span><br><span class="line">personList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John&quot;</span>, <span class="string">&quot;Male&quot;</span>, <span class="string">&quot;Married&quot;</span>));</span><br><span class="line">personList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Laura&quot;</span>, <span class="string">&quot;Female&quot;</span>, <span class="string">&quot;Married&quot;</span>));</span><br><span class="line">personList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Diana&quot;</span>, <span class="string">&quot;Female&quot;</span>, <span class="string">&quot;Single&quot;</span>));</span><br><span class="line">personList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Mike&quot;</span>, <span class="string">&quot;Male&quot;</span>, <span class="string">&quot;Single&quot;</span>));</span><br><span class="line">personList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Bobby&quot;</span>, <span class="string">&quot;Male&quot;</span>, <span class="string">&quot;Single&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> maleCriteria = <span class="keyword">new</span> <span class="title class_">CriteriaMale</span>();</span><br><span class="line"><span class="keyword">const</span> femaleCriteria = <span class="keyword">new</span> <span class="title class_">CriteriaFemale</span>();</span><br><span class="line"><span class="keyword">const</span> singleCriteria = <span class="keyword">new</span> <span class="title class_">CriteriaSingle</span>();</span><br><span class="line"><span class="keyword">const</span> singleAndMale = <span class="keyword">new</span> <span class="title class_">AndCriteria</span>(singleCriteria, maleCriteria);</span><br><span class="line"><span class="keyword">const</span> singleOrFemale = <span class="keyword">new</span> <span class="title class_">OrCriteria</span>(singleAndMale, femaleCriteria);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Males: &quot;</span>);</span><br><span class="line"><span class="title function_">showPersons</span>(maleCriteria.<span class="title function_">meetCriteria</span>(personList));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Males:</span></span><br><span class="line"><span class="comment"> * Robert</span></span><br><span class="line"><span class="comment"> * John</span></span><br><span class="line"><span class="comment"> * Mike</span></span><br><span class="line"><span class="comment"> * Bobby</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Females: &quot;</span>);</span><br><span class="line"><span class="title function_">showPersons</span>(femaleCriteria.<span class="title function_">meetCriteria</span>(personList));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Females:</span></span><br><span class="line"><span class="comment"> * Laura</span></span><br><span class="line"><span class="comment"> * Diana</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Singles: &quot;</span>);</span><br><span class="line"><span class="title function_">showPersons</span>(singleCriteria.<span class="title function_">meetCriteria</span>(personList));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Singles:</span></span><br><span class="line"><span class="comment"> * Robert</span></span><br><span class="line"><span class="comment"> * Diana</span></span><br><span class="line"><span class="comment"> * Mike</span></span><br><span class="line"><span class="comment"> * Bobby</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Single And Males: &quot;</span>);</span><br><span class="line"><span class="title function_">showPersons</span>(singleAndMale.<span class="title function_">meetCriteria</span>(personList));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Single And Males:</span></span><br><span class="line"><span class="comment"> * Robert</span></span><br><span class="line"><span class="comment"> * Mike</span></span><br><span class="line"><span class="comment"> * Bobby</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Single Or Females: &quot;</span>);</span><br><span class="line"><span class="title function_">showPersons</span>(singleOrFemale.<span class="title function_">meetCriteria</span>(personList));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Robert</span></span><br><span class="line"><span class="comment"> * Mike</span></span><br><span class="line"><span class="comment"> * Bobby</span></span><br><span class="line"><span class="comment"> * Laura</span></span><br><span class="line"><span class="comment"> * Diana</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="优势"><a class="markdownIt-Anchor" href="#优势"></a> 优势</h4>
<p>在需要做类的筛选的时候，通过每次单一功能的筛选，再做聚合能极大的降低筛选功能的复杂性。</p>
<h3 id="组合设计模式"><a class="markdownIt-Anchor" href="#组合设计模式"></a> 组合设计模式</h3>
<blockquote>
<p>组合模式是一种结构型设计模式， 你可以使用它将对象组合成树状结构， 并且能像使用独立对象一样使用它们。</p>
</blockquote>
<p>下面我们假设这样一个场景：我们有一些产品和一些盒子，一个盒子里可以装多个产品，或多个较小的盒子，以此类推。现在我们的订单系统需要支持无盒子包装的单一产品，也需要支持一个包含内部所有东西的盒子。</p>
<p>对于后者我们应该如何得到这个盒子的订单总价呢？</p>
<p>我们当然可以使用DFS等算法计算，但更好的方法是利用类似记忆化搜索的方法让每个盒子负责计算他内部的产品的价格，以此类推。</p>
<p>这样设计最大优点在于无需了解构成树状结构的对象的具体类。也无需了解对象是简单的产品还是复杂的盒子。 你只需调用通用接口以相同的方式对其进行处理即可。当你调用该方法后，对象会将请求沿着树结构传递下去。</p>
<p>组合结构类图如下：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/composite/structure-zh.png' data-fancybox='default' data-caption='组合设计模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/composite/structure-zh.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/composite/structure-zh.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="组合设计模式类图" /></a><span class='image-caption'>组合设计模式类图</span></div></div>
<ol>
<li>组件Component描述了树结构上每个节点共有的方法</li>
<li>叶节点Leaf是树的基本结构，不包含子项，树中实际完成工作的单元，无法将工作指派给其他人</li>
<li>容器Composite用来包含其他容器和叶节点，容器无需了解组成自己的子项的具体类型，收到工作请求后，将其派发给子项完成，然后处理中间结果返回给上级</li>
</ol>
<p>接下来我们用组合设计模式来实现一个文件树的小案例。</p>
<p>首先我们有文件和文件夹两周类型，文件夹里可以包含其他文件夹。另外为了方便地查看文件，每个文件夹和文件需要包含：</p>
<ol>
<li>文件名</li>
<li>文件大小</li>
<li>一个<code>getName</code>方法来输出自身的名称</li>
<li>一个<code>getSize</code>方法来计算自身的体积</li>
<li><code>display</code>方法来输出自身以及自身包含的文件或文件夹</li>
</ol>
<p>可以想到<code>display</code>和<code>getSize</code>两个方法是需要根节点派发任务到子节点才能实现的。</p>
<p>那么首先我们可以实现一个接口来定义文件、文件夹等组件的共有方法：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="title function_">getName</span>(): <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">getSize</span>(): <span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">// 缩进数量</span></span><br><span class="line">    <span class="title function_">display</span>(<span class="attr">indentation</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>随后利用组件接口我们来实现一下文件类和文件夹类，文件夹类需要一个Component数组：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 叶子节点：文件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyFile</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">size</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">size</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">size</span> = size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getName</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getSize</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">size</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">display</span>(<span class="attr">indentation</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> tabLine = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; indentation; i++) tabLine += <span class="string">&quot; &quot;</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tabLine + <span class="variable language_">this</span>.<span class="property">name</span>, <span class="string">&quot; Size: &quot;</span> + <span class="variable language_">this</span>.<span class="title function_">getSize</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合节点：文件夹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Folder</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">size</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">children</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Component</span>&gt; = [];</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">children</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Component</span>&gt; = []</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">children</span> = children;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">size</span> = <span class="variable language_">this</span>.<span class="title function_">getSize</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getName</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getSize</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">size</span> = <span class="variable language_">this</span>.<span class="property">children</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">pre, cur</span>) =&gt;</span> pre + cur.<span class="title function_">getSize</span>(), <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">size</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">add</span>(<span class="attr">child</span>: <span class="title class_">Component</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">children</span>.<span class="title function_">push</span>(child);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">remove</span>(<span class="attr">child</span>: <span class="title class_">Component</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> childIndex = <span class="variable language_">this</span>.<span class="property">children</span>.<span class="title function_">indexOf</span>(child);</span><br><span class="line">        <span class="keyword">if</span> (childIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">children</span>.<span class="title function_">splice</span>(childIndex, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">display</span>(<span class="attr">indentation</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> tabLine = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; indentation; i++) tabLine += <span class="string">&quot; &quot;</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tabLine + <span class="variable language_">this</span>.<span class="property">name</span>, <span class="string">&quot; Size: &quot;</span> + <span class="variable language_">this</span>.<span class="title function_">getSize</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="attr">component</span>: <span class="title class_">Component</span>, index</span>) =&gt;</span> &#123;</span><br><span class="line">            component.<span class="title function_">display</span>(indentation + <span class="number">4</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>最后我们就可以利用这些类来构造一个目录了，利用<code>display</code>方法可以显示出层级结构以及文件大小：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> file1 = <span class="keyword">new</span> <span class="title class_">MyFile</span>(<span class="string">&quot;file1.txt&quot;</span>, <span class="number">12</span>);</span><br><span class="line"><span class="keyword">const</span> file2 = <span class="keyword">new</span> <span class="title class_">MyFile</span>(<span class="string">&quot;file2.txt&quot;</span>, <span class="number">13</span>);</span><br><span class="line"><span class="keyword">const</span> folder1 = <span class="keyword">new</span> <span class="title class_">Folder</span>(<span class="string">&quot;Folder 1&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> folder2 = <span class="keyword">new</span> <span class="title class_">Folder</span>(<span class="string">&quot;Folder 2&quot;</span>);</span><br><span class="line"></span><br><span class="line">folder1.<span class="title function_">add</span>(file1);</span><br><span class="line">folder1.<span class="title function_">add</span>(file2);</span><br><span class="line">folder2.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="title class_">MyFile</span>(<span class="string">&quot;file3.txt&quot;</span>, <span class="number">30</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootFolder = <span class="keyword">new</span> <span class="title class_">Folder</span>(<span class="string">&quot;Root&quot;</span>);</span><br><span class="line">rootFolder.<span class="title function_">add</span>(folder1);</span><br><span class="line">rootFolder.<span class="title function_">add</span>(folder2);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;File system structure:&quot;</span>);</span><br><span class="line">rootFolder.<span class="title function_">display</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * File system structure:</span></span><br><span class="line"><span class="comment"> * Root  Size: 55</span></span><br><span class="line"><span class="comment"> *     Folder 1  Size: 25</span></span><br><span class="line"><span class="comment"> *         file1.txt  Size: 12</span></span><br><span class="line"><span class="comment"> *         file2.txt  Size: 13</span></span><br><span class="line"><span class="comment"> *     Folder 2  Size: 30</span></span><br><span class="line"><span class="comment"> *         file3.txt  Size: 30</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h4 id="优势-2"><a class="markdownIt-Anchor" href="#优势-2"></a> 优势</h4>
<p>让相互关联的对象产生了结构性，无论是在关系修改或者是关系直观性上，都只需要关心当前下级的关系，这样能更好的降低关系和关系之间的复杂度，加强单对象关系结构的可维护性。<a target="_blank" rel="noopener" href="https://github.com/zy445566/design-pattern-in-javascript/blob/master/design-pattern/composite-pattern/README.md">[引用自zy445566的design-pattern-in-javascript库]</a></p>
<p>由此可以引申出两种应用场景：</p>
<ol>
<li>实现特定的树形对象结构时</li>
<li>需要使用相同的操作处理对象时，共用同一接口，此时就无需关注对象的具体实现</li>
</ol>
<p>组合设计模式符合开闭原则。其无需更改现有代码，就可以在应用中添加新元素，使其成为对象树的一部分。<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/composite">[引用自重构大师]</a></p>
<h4 id="combo-2"><a class="markdownIt-Anchor" href="#combo-2"></a> Combo</h4>
<ol>
<li>在使用<code>组合设计模式</code>构造结构复杂的树时，可以使用<code>生成器模式</code>让树的构造以递归的形式进行</li>
<li><code>责任链模式</code>通常和<code>组合模式</code>结合使用。在这种情况下，叶组件接收到请求后， 可以将请求沿包含全体父组件的链一直传递至对象树的底部。</li>
<li>可以使用<code>迭代器模式</code>来遍历组合树。</li>
<li>你可以使用<code>访问者模式</code>对整个组合树执行操作。</li>
<li>你可以使用<code>享元模式</code>实现组合树的共享叶节点以节省内存。</li>
<li><code>组合</code>和<code>装饰模式</code>的结构图很相似， 因为两者都依赖递归组合来组织无限数量的对象。
<ol>
<li>装饰类似于组合， 但其只有一个子组件。 此外还有一个明显不同： 装饰为被封装对象添加了额外的职责， 组合仅对其子节点的结果进行了 “求和”。</li>
<li>但是， 模式也可以相互合作： 你可以使用装饰来扩展组合树中特定对象的行为。</li>
</ol>
</li>
<li>大量使用<code>组合和装饰</code>的设计通常可从对于<code>原型模式</code>的使用中获益。可以通过该模式来复制复杂结构，而非从零开始重新构造。</li>
</ol>
<h3 id="装饰设计模式"><a class="markdownIt-Anchor" href="#装饰设计模式"></a> 装饰设计模式</h3>
<blockquote>
<p>装饰模式是一种结构型设计模式， 允许你通过将对象放入包含行为的特殊封装对象中来为原对象绑定新的行为。</p>
</blockquote>
<p>我们考虑以下场景：</p>
<ol>
<li>首先公司原本有一个用于发送通知到邮箱的<code>Notifier</code>类</li>
<li>现在由于社会的发展，社交媒体开始流行，手机得到普及，公司需要丰富通知类的功能，需要新增：
<ol>
<li>发送通知到短信的类</li>
<li>发送通知到微信的类</li>
<li>发送通知到QQ的类</li>
<li>能同时发送到微信和QQ的类</li>
<li>能同时发送到短信和微信的类</li>
<li>…</li>
</ol>
</li>
</ol>
<p>我们当然可以为每种发送方式基于<code>Notifier</code>类创建子类，但每种情况都需要创建特殊的子类，这样会是的子类数量爆炸：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/decorator/problem3-zh.png' data-fancybox='default' data-caption='子类组合爆炸'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/decorator/problem3-zh.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/decorator/problem3-zh.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="子类组合爆炸" /></a><span class='image-caption'>子类组合爆炸</span></div></div>
<p>除了继承以外，面向对象中还有两个重要的概念：<strong>聚合</strong>以及<strong>组合</strong>，两者都是使一个对象包含另一个对象的引用，并将部分任务委托给引用对象完成。</p>
<p>而继承则是子类自身完全负责完成工作。</p>
<blockquote>
<p>聚合： 对象 A 包含对象 B； B 可以独立于 A 存在。</p>
<p>组合： 对象 A 由对象 B 构成； A 负责管理 B 的生命周期。 B 无法独立于A 存在。</p>
</blockquote>
<p>在装饰设计模式中真正实现上述功能的对象我们称之为<strong>装饰器</strong>，一个装饰器需要与其分装对象实现相同的接口，这样在用户的视角下，装饰器和引用成员变量是完全一样的减少心智负担。而装饰器中的对象，可以是实现了相同接口的任意对象，这样就可以将一个对象放入多个封装器中，并在对象中添加所有这些装饰器的组合行为。</p>
<p>那上文提到的通知类来举例，我们可以将邮件通知行为放在基类中，将其他通知方式放入装饰器中：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/decorator/solution2-zh.png' data-fancybox='default' data-caption='通知装饰器'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/decorator/solution2-zh.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/decorator/solution2-zh.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="通知装饰器" /></a><span class='image-caption'>通知装饰器</span></div></div>
<p>当我们需要使用不同装饰器组合的时候，我们可以用嵌套的方式用<strong>装饰器构造装饰器</strong>，结构就像一个栈：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/decorator/solution3-zh.png' data-fancybox='default' data-caption='装饰器组合'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/decorator/solution3-zh.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/decorator/solution3-zh.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="装饰器组合" /></a><span class='image-caption'>装饰器组合</span></div></div>
<p>最终用户会拿到最后一个构造的装饰器，而由于所有装饰器均实现了同一接口，用户并不需要知道这个装饰器内部有多少层嵌套，直接使用<code>send()</code>方法即可。</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/decorator/structure.png' data-fancybox='default' data-caption='装饰器模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/decorator/structure.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/decorator/structure.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="装饰器模式类图" /></a><span class='image-caption'>装饰器模式类图</span></div></div>
<p>下面我们再通过装饰设计模式实现一个文件读取写入的类，加深理解。</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 部件 （Component）: 数据源</span></span><br><span class="line"><span class="comment">// 声明封装器和被封装对象的公用接口。</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DataSource</span> &#123;</span><br><span class="line">    <span class="title function_">writeData</span>(<span class="attr">data</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">    <span class="title function_">readData</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体部件 （Concrete Component） 类：文件数据源</span></span><br><span class="line"><span class="comment">// 被封装对象所属的类。 它定义了基础行为， 但装饰类可以改变这些行为。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileDataSource</span> <span class="keyword">implements</span> <span class="title class_">DataSource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">filename</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">filename</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">filename</span> = filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">writeData</span>(<span class="attr">data</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data + <span class="string">&quot; 数据已写入&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">readData</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataSourceDecorator</span> <span class="keyword">implements</span> <span class="title class_">DataSource</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="attr">wrapper</span>: <span class="title class_">DataSource</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">wrapper</span>: <span class="title class_">DataSource</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wrapper</span> = wrapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">writeData</span>(<span class="attr">data</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wrapper</span>.<span class="title function_">writeData</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">readData</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">wrapper</span>.<span class="title function_">readData</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰器: 加密器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EncryptionDecorator</span> <span class="keyword">extends</span> <span class="title class_ inherited__">DataSourceDecorator</span> &#123;</span><br><span class="line">    <span class="title function_">writeData</span>(<span class="attr">data</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        data = data + <span class="string">&quot; 数据已加密&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wrapper</span>.<span class="title function_">writeData</span>(data);</span><br><span class="line">        <span class="comment">// this.wrapper.writeData(data)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">readData</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> readData = <span class="variable language_">this</span>.<span class="property">wrapper</span>.<span class="title function_">readData</span>();</span><br><span class="line">        readData = readData + <span class="string">&quot; 数据已解密&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> readData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰器: 压缩器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CompressionDecorator</span> <span class="keyword">extends</span> <span class="title class_ inherited__">DataSourceDecorator</span> &#123;</span><br><span class="line">    <span class="title function_">writeData</span>(<span class="attr">data</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        data = data + <span class="string">&quot; 数据已压缩&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">wrapper</span>.<span class="title function_">writeData</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">readData</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> zipData = <span class="variable language_">this</span>.<span class="property">wrapper</span>.<span class="title function_">readData</span>();</span><br><span class="line">        zipData = zipData + <span class="string">&quot; 数据已解压&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> zipData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体引用类：薪资文件管理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SalaryManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">source</span>: <span class="title class_">DataSource</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">source</span>: <span class="title class_">DataSource</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">source</span> = source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">load</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">source</span>.<span class="title function_">readData</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">save</span>(<span class="params"><span class="attr">salaryRecords</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">source</span>.<span class="title function_">writeData</span>(salaryRecords);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getDataSource</span> = (<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">enabledEncryption</span>: <span class="built_in">boolean</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">enabledCompression</span>: <span class="built_in">boolean</span></span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">source</span>: <span class="title class_">DataSource</span> = <span class="keyword">new</span> <span class="title class_">FileDataSource</span>(<span class="string">&quot;data.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (enabledEncryption) &#123;</span><br><span class="line">        source = <span class="keyword">new</span> <span class="title class_">EncryptionDecorator</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (enabledCompression) &#123;</span><br><span class="line">        source = <span class="keyword">new</span> <span class="title class_">CompressionDecorator</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造薪资管理器，要求在存储之前进行加密和压缩，在读取之前进行解密和解压缩</span></span><br><span class="line"><span class="keyword">const</span> salaryLogger = <span class="keyword">new</span> <span class="title class_">SalaryManager</span>(<span class="title function_">getDataSource</span>(<span class="literal">true</span>, <span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">salaryLogger.<span class="title function_">save</span>(<span class="string">&quot;salary&quot;</span>); <span class="comment">// salary 数据已压缩 数据已加密 数据已写入</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(salaryLogger.<span class="title function_">load</span>()); <span class="comment">// data.txt 数据已解密 数据已解压</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="适用场景-2"><a class="markdownIt-Anchor" href="#适用场景-2"></a> 适用场景</h4>
<ol>
<li>在无需修改代码的情况下为对象添加额外行为</li>
<li>使用继承对对象进行扩展非常复杂时</li>
</ol>
<blockquote>
<p>js中已经增加了对装饰器语法的支持</p>
</blockquote>
<h4 id="优点"><a class="markdownIt-Anchor" href="#优点"></a> 优点</h4>
<ol>
<li>无需创建子类即可扩展行为</li>
<li>可以在运行时为对象添加功能</li>
<li>支持多装饰器的组合</li>
<li>符合单一责任原则（可以将一个大类拆分为数个小类）</li>
</ol>
<h4 id="缺点-2"><a class="markdownIt-Anchor" href="#缺点-2"></a> 缺点</h4>
<ol>
<li>嵌套装饰器难以删除其中的某一个</li>
<li>实现一个不受嵌套顺序影响的装饰器比较困难</li>
<li>各层的初始化配置代码比较复杂</li>
</ol>
<h4 id="combo-3"><a class="markdownIt-Anchor" href="#combo-3"></a> Combo</h4>
<ol>
<li>与<code>适配器模式</code>相比，<code>装饰器</code>可以在不修改对象接口的前提下强化对象，另外装饰器支持嵌套</li>
<li>适配器、装饰器与代理
<ol>
<li><code>适配器</code>可以为被封装对象提供不同接口</li>
<li><code>代理模式</code>能为对象提供相同的接口</li>
<li><code>装饰器</code>能为对象提供强化的接口</li>
</ol>
</li>
<li><code>组合模式</code>和<code>装饰模式</code>的结构图很相似，因为两者都依赖递归组合来组织无限数量的对象。
<ol>
<li>装饰类只有一个子组件。</li>
<li>装饰为被封装对象添加了额外的职责，而组合仅对其子节点的结果进行了 “求和”。</li>
<li>可以使用装饰来扩展组合树中特定对象的行为。</li>
</ol>
</li>
<li><code>装饰</code>可让你更改对象的外表，<code>策略模式</code>则让你能够改变其本质。</li>
<li><code>装饰</code>和<code>代理</code>
<ol>
<li>二者相似的结构，但是意图不同。两者都基于组合原则</li>
<li>两者之间的不同之处在于代理通常自行管理其服务对象的生命周期，而装饰的生成则总是由客户端进行控制。</li>
</ol>
</li>
</ol>
<h3 id="外观设计模式"><a class="markdownIt-Anchor" href="#外观设计模式"></a> 外观设计模式</h3>
<blockquote>
<p>外观模式是一种结构型设计模式， 能为程序库、 框架或其他复杂类提供一个简单的接口。</p>
</blockquote>
<p>假设一下场景：我们需要在项目中使用某个第三方库的众多对象，并按顺序组织他们的初始化工作。这样我们的业务逻辑会和第三方类的实现纠缠在一起形成<span style="color:red">紧密的耦合</span>，使得维护难度增加</p>
<p>二外观设计模式就是用来处理这种情况的，我们可以为包含许多活动的复杂子系统提供一个简单的接口来降低用户的心智负担。虽然这一接口提供的功能有限，但他更关心用户需要的功能。</p>
<p>例如显示生活中的网购，我们只需要点击下单并付款，购物平台将为我们完成支付处理、调货、包装、纳税、送货等等操作。</p>
<p>外观模式类图如下所示：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/facade/structure.png' data-fancybox='default' data-caption='外观模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/facade/structure.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/facade/structure.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="外观模式类图" /></a><span class='image-caption'>外观模式类图</span></div></div>
<p>例如我们使用外观设计模式来实现一个第三方视频转换框架，我们需要向客户暴露一个上传接口，其中需要读取视频文件，获得视频文件的源码，得到视频的比特流，随后使用对应的编码器将比特流编码为视频流，最后进行混音后返回。</p>
<p>首先我们来准备实际处理这些操作的类，包含：</p>
<ol>
<li>视频文件类</li>
<li>MPEG4视频编码类</li>
<li>Ogg视频编码类</li>
<li>源码提取类</li>
<li>比特流读取类</li>
<li>混音类</li>
</ol>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VideoFile</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">read</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Compression</span> &#123;</span><br><span class="line">  <span class="title function_">compression</span>(<span class="attr">buffer</span>: <span class="built_in">string</span>): <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MPEG4Compression</span> <span class="keyword">implements</span> <span class="title class_">Compression</span> &#123;</span><br><span class="line">  <span class="title function_">compression</span>(<span class="attr">buffer</span>: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MPEG4编码文件： &quot;</span>, file.<span class="title function_">read</span>())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;MPEG4编码文件&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OggCompression</span> <span class="keyword">implements</span> <span class="title class_">Compression</span> &#123;</span><br><span class="line">  <span class="title function_">compression</span>(<span class="attr">buffer</span>: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OGG编码文件： &quot;</span>, file.<span class="title function_">read</span>())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;OGG编码文件&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取视频源码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CodeFactory</span> &#123;</span><br><span class="line">  <span class="title function_">extract</span>(<span class="attr">file</span>: <span class="title class_">VideoFile</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;读取视频源码: &quot;</span>, file.<span class="title function_">read</span>())</span><br><span class="line">    <span class="keyword">return</span> file.<span class="title function_">read</span>() + <span class="string">&quot;的源码&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取bit流</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BitrateReader</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">read</span>(<span class="attr">filename</span>: <span class="built_in">string</span>, <span class="attr">source</span>: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;将名为: &quot;</span>, filename,<span class="string">&quot;,的源码: &quot;</span>, source, <span class="string">&quot;,读取为比特流&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> filename + <span class="string">&quot;的二进制代码&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">convert</span>(<span class="attr">buffer</span>: <span class="built_in">string</span>, <span class="attr">compression</span>: <span class="title class_">Compression</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result = compression.<span class="title function_">compression</span>(buffer)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;将文件: &quot;</span>, buffer, <span class="string">&quot;, 编码为: &quot;</span>, result)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;编码后的&quot;</span> + filename</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 混音类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AudioMixer</span> &#123;</span><br><span class="line">  <span class="title function_">fix</span>(<span class="attr">codeFile</span>: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;对文件: &quot;</span>, codeFile, <span class="string">&quot; 进行混音&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;混音后的文件&quot;</span> + codeFile</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<p>随后我们定义一个类来对外暴露一个接口，在接口中实现整个业务逻辑，用户使用该接口即可：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VideoConvert</span> &#123;</span><br><span class="line">  <span class="title function_">convert</span>(<span class="attr">filename</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> file = <span class="keyword">new</span> <span class="title class_">VideoFile</span>(filename)</span><br><span class="line">    <span class="keyword">let</span> sourceCode = (<span class="keyword">new</span> <span class="title class_">CodeFactory</span>()).<span class="title function_">extract</span>(file)</span><br><span class="line">    <span class="keyword">let</span> compression = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span>(format === <span class="string">&quot;mp4&quot;</span>) &#123;</span><br><span class="line">      compression = <span class="keyword">new</span> <span class="title class_">MPEG4Compression</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      compression = <span class="keyword">new</span> <span class="title class_">OggCompression</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> buffer = <span class="title class_">BitrateReader</span>.<span class="title function_">read</span>(filename, sourceCode)</span><br><span class="line">    <span class="keyword">let</span> res = <span class="title class_">BitrateReader</span>.<span class="title function_">convert</span>(buffer, compression)</span><br><span class="line">    res = (<span class="keyword">new</span> <span class="title class_">AudioMixer</span>()).<span class="title function_">fix</span>(res)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"></span><br><span class="line">convert = <span class="keyword">new</span> <span class="title class_">VideoConvert</span>()</span><br><span class="line">mp4 = convert.<span class="title function_">convert</span>(<span class="string">&quot;funny-cats-video.ogg&quot;</span>, <span class="string">&quot;mp4&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mp4)</span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="使用场景-2"><a class="markdownIt-Anchor" href="#使用场景-2"></a> 使用场景</h4>
<ol>
<li>如果你需要一个指向复杂子系统的直接接口，且该接口的功能有限，则可以使用外观模式。</li>
<li>如果需要将子系统组织为多层结构，可以使用外观。创建外观来定义子系统中各层次的入口。可以要求子系统仅使用外观来进行交互，以减少子系统之间的耦合。
<ol>
<li>例如上述上传视频的功能，我们可以可以拆分为两个层次：音频相关和视频相关。可以为每个层次创建一个外观，然后要求各层的类必须通过这些外观进行交互。</li>
</ol>
</li>
</ol>
<h4 id="优点-2"><a class="markdownIt-Anchor" href="#优点-2"></a> 优点</h4>
<ol>
<li>可以让自己的代码独立于复杂子系统。</li>
</ol>
<h4 id="缺点-3"><a class="markdownIt-Anchor" href="#缺点-3"></a> 缺点</h4>
<ol>
<li>外观可能成为与程序中所有类都耦合的<a target="_blank" rel="noopener" href="https://blog.csdn.net/su9257/article/details/116484539">上帝对象</a>。</li>
</ol>
<h4 id="combo-4"><a class="markdownIt-Anchor" href="#combo-4"></a> Combo</h4>
<ol>
<li><code>外观模式</code>在实现时与<code>代理模式</code>较为类似，他们都缓存了一个复杂实体并自行对其进行初始化，但不同之处在于<code>代理</code>与其<code>服务对象</code>遵循同一接口，使得自己和服务对象可以互换。</li>
<li><code>外观类</code>通常可以转换为<code>单例模式</code>，大部分情况下一个外观对象就够用了</li>
<li><code>抽象工厂模式</code>与<code>外观模式</code>看起来也很相似，但他们的使用场景对他们进行了区分，如果只需要对用户隐藏子系统的对象创建，则使用<code>抽象工厂模式</code>。</li>
<li><code>适配器模式</code>只封装一个对象，并运用已有接口。<code>外观模式</code>作用于整个对象子系统上，并为现有对象定义了一个新的接口。</li>
</ol>
<h3 id="享元模式"><a class="markdownIt-Anchor" href="#享元模式"></a> 享元模式</h3>
<blockquote>
<p>享元模式是一种结构型设计模式， 它摒弃了在每个对象中保存所有数据的方式， 通过共享多个对象所共有的相同状态， 让你能在<strong>有限的内存容量</strong>中载入更多对象。</p>
</blockquote>
<p>考虑如下场景：</p>
<ol>
<li>由一个FPS游戏，需要设计特殊的粒子系统，希望弹片可以在战场上自由飞翔</li>
<li>那么粒子需要一个自己的类，应该包含方向、速度、颜色、精灵图等信息</li>
<li>希望战争场景尽量真实，因此需要让每颗子弹、导弹、炸弹爆炸时都生成数个粒子</li>
</ol>
<p>但这样做显然是非常耗费内存的，每个粒子对象都需要在内存中保存自己的信息，包括<strong>精灵图</strong>。</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/flyweight/problem-zh.png?id=af96019d13fa27a76c3bc0164ede262a' data-fancybox='default' data-caption='未使用享元时的类图及内存消耗'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/flyweight/problem-zh.png?id=af96019d13fa27a76c3bc0164ede262a" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/flyweight/problem-zh.png?id=af96019d13fa27a76c3bc0164ede262a" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="未使用享元时的类图及内存消耗" /></a><span class='image-caption'>未使用享元时的类图及内存消耗</span></div></div>
<p>而事实上大部分粒子的颜色和精灵图都是相同的，<strong>不需要为每个粒子对象都存储一遍</strong>。</p>
<p>在面向对象中，我们通常将对象中的状态分为两类：</p>
<ol>
<li>内在状态——其他对象能读但不能修改</li>
<li>外在状态——能被其他对象充外部修改</li>
</ol>
<p>而享元模式建议：<strong>不在对象中存储外在状态</strong></p>
<p>那么，根据这一建议我们可以将原本的粒子对象分为两个对象：</p>
<ol>
<li>粒子享元：Particle
<ol>
<li>color</li>
<li>sprite</li>
</ol>
</li>
<li>移动粒子：MovingParticle
<ol>
<li>particle</li>
<li>coords</li>
<li>vector</li>
<li>speed</li>
</ol>
</li>
</ol>
<p>让每个移动中的，颜色，精灵图相同的粒子共用一个粒子对象，这一对象我们称其为<strong>享元</strong>。</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/flyweight/solution3-zh.png?id=56d1d3bafd2d241952f162483ecd8ccf' data-fancybox='default' data-caption='享元下的类图与内存占用'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/flyweight/solution3-zh.png?id=56d1d3bafd2d241952f162483ecd8ccf" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/flyweight/solution3-zh.png?id=56d1d3bafd2d241952f162483ecd8ccf" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="享元下的类图与内存占用" /></a><span class='image-caption'>享元下的类图与内存占用</span></div></div>
<p>从图中我们可以看出，除了需要上述两个对象外，我们还需要添加以下几个部分：</p>
<ol>
<li>在容器<code>Game</code>中添加一个数组存储并索引不同的粒子</li>
<li>在容器<code>Game</code>中添加一个数组来存储并索引每个粒子的坐标、方向矢量和速度</li>
<li>为容器<code>Game</code>添加一个方法<code>addParticle</code>来生成不同状态的对象</li>
</ol>
<p>更优雅的，我们可以构造一个独立的情景类来管理享元对象和外在属性对象，这样容器<code>Game</code>就只需要一个数组就可以了。</p>
<p>由于享元对象需要被多个其他对象<strong>复用</strong>因此，它最好是不可被修改的，这样就不会出现牵一发而动全身的情况。</p>
<p>另外为了能够方便的访问各种享元，可以创建一个<strong>工厂</strong>来管理已有的享元对象的缓存池。</p>
<p>下面一起来看看更泛华的享元模式类图：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/flyweight/structure.png' data-fancybox='default' data-caption='享元模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/flyweight/structure.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/flyweight/structure.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="享元模式类图" /></a><span class='image-caption'>享元模式类图</span></div></div>
<ol>
<li>享元(Flyweight)类: 包含原始对象中部分能共享的状态，被称为内在状态</li>
<li>情景(Context)类: 包含原始对象中各部相同的状态，与其中的享元对象一起组成原始对象
<ol>
<li>通常原始对象的行为会被保存在享元对象中，但也可以将其保存在情景对象中</li>
</ol>
</li>
<li>享元工厂(Flyweight Factory)类: 管理享元缓存池，工厂会根据客户提供的参数从缓存池中查找特定享元，有则直接用，无则创建并加入缓存池</li>
</ol>
<h4 id="示例"><a class="markdownIt-Anchor" href="#示例"></a> 示例</h4>
<p>下面我们以绘制树形对象为例来使用享元模式设计一系列对象：</p>
<p>我们的树具有一些类型，他们包含一下状态：</p>
<ol>
<li>name</li>
<li>color</li>
<li>texture</li>
</ol>
<p>另外，每棵树需要画在不同的地方，因此需要：</p>
<ol>
<li>x</li>
<li>y</li>
</ol>
<p>两个坐标。而使用这些树的容器我们称其为森林<code>Forest</code></p>
<p>那么我们可以得到这样一幅类图：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/flyweight/example.png?id=0818d078c1a79f373e96397f37b7ee06' data-fancybox='default' data-caption='享元森林类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/flyweight/example.png?id=0818d078c1a79f373e96397f37b7ee06" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/flyweight/example.png?id=0818d078c1a79f373e96397f37b7ee06" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="享元森林类图" /></a><span class='image-caption'>享元森林类图</span></div></div>
<p>这样一来，我们在渲染这个森林时，就能尽量少的占用内存。</p>
<p>根据这张图我们可以尝试写一个简单的Demo。</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TreeType</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">color</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">texture</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">name, color, texture</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = color;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">texture</span> = texture;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">draw</span>(<span class="params"><span class="attr">canvas</span>: <span class="built_in">string</span>, <span class="attr">x</span>: <span class="built_in">number</span>, <span class="attr">y</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">            <span class="string">`Draw a <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> tree with <span class="subst">$&#123;<span class="variable language_">this</span>.color&#125;</span> color &amp; <span class="subst">$&#123;<span class="variable language_">this</span>.texture&#125;</span> texture at (<span class="subst">$&#123;x&#125;</span>,<span class="subst">$&#123;y&#125;</span>) on <span class="subst">$&#123;canvas&#125;</span>`</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getName</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getColor</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getTexture</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">texture</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tree</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">x</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">y</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">type</span>: <span class="title class_">TreeType</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="attr">x</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">        <span class="attr">y</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params">        <span class="attr">name</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">        <span class="attr">color</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">        <span class="attr">texture</span>: <span class="built_in">string</span></span></span><br><span class="line"><span class="params">    </span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span> = <span class="title class_">TreeFactory</span>.<span class="title function_">getTreeType</span>(name, color, texture);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">draw</span>(<span class="params"><span class="attr">canvas</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">type</span>.<span class="title function_">draw</span>(canvas, <span class="variable language_">this</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">y</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeFactory</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="attr">types</span>: <span class="title class_">TreeType</span>[] = [];</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">TreeFactory</span>.<span class="property">types</span> = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getTreeType</span>(<span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">color</span>: <span class="built_in">string</span>, <span class="attr">texture</span>: <span class="built_in">string</span>): <span class="title class_">TreeType</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> res = <span class="title class_">TreeFactory</span>.<span class="property">types</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params"><span class="attr">type</span>: <span class="title class_">TreeType</span>, <span class="attr">index</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">                <span class="keyword">type</span>.<span class="title function_">getColor</span>() === color &amp;&amp;</span><br><span class="line">                <span class="keyword">type</span>.<span class="title function_">getName</span>() === name &amp;&amp;</span><br><span class="line">                <span class="keyword">type</span>.<span class="title function_">getTexture</span>() === texture</span><br><span class="line">            ) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (res !== <span class="literal">null</span> &amp;&amp; res.<span class="property">length</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res[<span class="number">0</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> newType = <span class="keyword">new</span> <span class="title class_">TreeType</span>(name, color, texture);</span><br><span class="line">            <span class="title class_">TreeFactory</span>.<span class="property">types</span>.<span class="title function_">push</span>(newType);</span><br><span class="line">            <span class="keyword">return</span> newType;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Forest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">trees</span>: <span class="title class_">Tree</span>[];</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">trees</span> = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">plantTree</span>(x, y, name, color, texture): <span class="title class_">Tree</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> newTree = <span class="keyword">new</span> <span class="title class_">Tree</span>(x, y, name, color, texture);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">trees</span>.<span class="title function_">push</span>(newTree);</span><br><span class="line">        <span class="keyword">return</span> newTree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">draw</span>(<span class="params"><span class="attr">canvas</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">trees</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params"><span class="attr">tree</span>: <span class="title class_">Tree</span>, <span class="attr">index</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">            tree.<span class="title function_">draw</span>(canvas);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> forest = <span class="keyword">new</span> <span class="title class_">Forest</span>();</span><br><span class="line"></span><br><span class="line">forest.<span class="title function_">plantTree</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="string">&quot;Trio&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;shadow&quot;</span>);</span><br><span class="line">forest.<span class="title function_">plantTree</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="string">&quot;Trio&quot;</span>, <span class="string">&quot;yellow&quot;</span>, <span class="string">&quot;solid&quot;</span>);</span><br><span class="line">forest.<span class="title function_">plantTree</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="string">&quot;Trio&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;dash&quot;</span>);</span><br><span class="line">forest.<span class="title function_">plantTree</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="string">&quot;Trio&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;shadow&quot;</span>);</span><br><span class="line">forest.<span class="title function_">plantTree</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;B+&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;solid&quot;</span>);</span><br><span class="line">forest.<span class="title function_">plantTree</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="string">&quot;B+&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;solid&quot;</span>);</span><br><span class="line"></span><br><span class="line">forest.<span class="title function_">draw</span>(<span class="string">&quot;Window&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Draw a Trio tree with red color &amp; shadow texture at (0,0) on Window</span></span><br><span class="line"><span class="comment">// Draw a Trio tree with yellow color &amp; solid texture at (0,1) on Window</span></span><br><span class="line"><span class="comment">// Draw a Trio tree with blue color &amp; dash texture at (0,2) on Window</span></span><br><span class="line"><span class="comment">// Draw a Trio tree with red color &amp; shadow texture at (1,0) on Window</span></span><br><span class="line"><span class="comment">// Draw a B+ tree with green color &amp; solid texture at (1,1) on Window</span></span><br><span class="line"><span class="comment">// Draw a B+ tree with green color &amp; solid texture at (1,2) on Window</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="使用场景-3"><a class="markdownIt-Anchor" href="#使用场景-3"></a> 使用场景</h4>
<ol>
<li>程序支持大量对象且没有足够的内存容量时使用</li>
</ol>
<h4 id="优点-3"><a class="markdownIt-Anchor" href="#优点-3"></a> 优点</h4>
<ol>
<li>对于具有相似状态的大量对象，可以节约内存</li>
</ol>
<h4 id="缺点-4"><a class="markdownIt-Anchor" href="#缺点-4"></a> 缺点</h4>
<ol>
<li>时间换空间，享元工厂挑选享元的过程需要花费额外的时间</li>
<li>代码复杂，一个实体将被拆分为多个实体</li>
</ol>
<h4 id="combo-5"><a class="markdownIt-Anchor" href="#combo-5"></a> Combo</h4>
<ol>
<li>使用<strong>享元模式</strong>实现<strong>组合模式</strong>树的共享叶节点以节省内存。</li>
<li><strong>享元</strong>展示了如何生成大量的小型对象，<strong>外观模式</strong>则展示了如何用一个对象来代表整个子系统。</li>
<li>如果将对象的所有共享状态简化为一个享元对象，那么<strong>享元</strong>就和<strong>单例模式</strong>类似了。 但这两个模式有两个根本性的不同：
<ol>
<li><strong>单例</strong>只有一个实体，<strong>享元</strong>可以有多个，且内在状态不同</li>
<li><strong>单例</strong>对象可变，<strong>享元</strong>不可变</li>
</ol>
</li>
</ol>
<h3 id="代理模式"><a class="markdownIt-Anchor" href="#代理模式"></a> 代理模式</h3>
<blockquote>
<p>代理模式是一种结构型设计模式， 让你能够提供对象的替代品或其占位符。 代理控制着对于原对象的访问， 并允许在将请求提交给对象前后进行一些处理。</p>
</blockquote>
<p>考虑如下场景，当我们在使用某个第三方类时：</p>
<ol>
<li>构造该类对象将消耗大量系统资源</li>
<li>对该对象的使用并不频繁</li>
</ol>
<p>我们可能会想到对该类实现延迟初始化，即在使用时再进行实例化对象。</p>
<p>我们希望可以将延时初始化的逻辑写入类中来避免冗余代码，但如果第三方库闭源，我们就不得在每个使用该对象的文件中实现延时初始化逻辑。</p>
<p>当然，我们可以使用代理模式解决这一问题。我们可以设计一个代理类，让它与原服务对象接口相同，于是我们就能在代理类中，在实际调用接口之前或之后进行一些操作来实现特殊的功能。</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/proxy/structure.png' data-fancybox='default' data-caption='代理设计模式'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/proxy/structure.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/proxy/structure.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="代理设计模式" /></a><span class='image-caption'>代理设计模式</span></div></div>
<ol>
<li>ServiceInterface服务接口，为代理类以及服务类提供接口规范，但从服务类中抽取接口并非总是可行的，因为需要对服务的所有客户端进行修改，让它们使用接口。备选计划是将代理作为服务类的子类， 这样代理就能继承服务的所有接口了。</li>
<li>Service服务类，实际处理业务逻辑的类</li>
<li>Proxy代理类，包含一个指向服务对象的引用成员变量，完成服务对象进行业务处理前后的工作。通常情况下，代理负责创建服务并对其整个生命周期进行管理。 在一些特殊情况下，客户端会通过构造函数将服务传递给代理。</li>
<li>可以考虑新建一个构建方法来判断客户端可获取的是代理还是实际服务。可以在代理类中创建一个简单的静态方法，也可以创建一个完整的工厂方法。</li>
<li>可以考虑为服务对象实现延迟初始化。</li>
</ol>
<p>下面我们以一个使用第三方视频工具（例如腾讯视频TencentVideo，TV）库，尝试为其添加延迟初始化和缓存功能的案例，来感受一下代理设计模式。</p>
<p>首先我们需要一个腾讯视频类充当服务类，进行实际的视频业务，随后我们需要实现一个接口，其中包含腾讯视频类中的一些方法。最后实现一个代理类，以腾讯视频对象作为属性，并实现需要代理的方法。</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟下载队列</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">downLoadList</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Video</span>&gt; = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断当前视频是否已在下载队列</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">downLoadExists</span> = (<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> judgeList = downLoadList.<span class="title function_">filter</span>(<span class="function">(<span class="params"><span class="attr">value</span>: <span class="title class_">Video</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id === value.<span class="property">id</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> judgeList.<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">VideoLib</span> &#123;</span><br><span class="line">    <span class="title function_">listVideos</span>();</span><br><span class="line">    <span class="title function_">getVideoInfo</span>(<span class="attr">id</span>: <span class="built_in">number</span>);</span><br><span class="line">    <span class="title function_">downloadVideo</span>(<span class="attr">id</span>: <span class="built_in">number</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Video</span> = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TVClass</span> <span class="keyword">implements</span> <span class="title class_">VideoLib</span> &#123;</span><br><span class="line">    <span class="attr">videoList</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Video</span>&gt;;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">videoList</span> = [</span><br><span class="line">            &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;1.mp4&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;2.mp4&quot;</span> &#125;,</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">listVideos</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">videoList</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getVideoInfo</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">videoList</span>[id]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">downloadVideo</span>(<span class="attr">id</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> video = <span class="variable language_">this</span>.<span class="title function_">getVideoInfo</span>(id);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;视频正在下载...&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(video);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;下载成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CacheTVClass</span> <span class="keyword">implements</span> <span class="title class_">VideoLib</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">service</span>: <span class="title class_">TVClass</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">listCache</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">videoCache</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">private</span> needReset;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">service</span>: <span class="title class_">TVClass</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">service</span> = service;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">needReset</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">listVideos</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">listCache</span> === <span class="literal">null</span> || <span class="variable language_">this</span>.<span class="property">needReset</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">listCache</span> = <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">listVideos</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">listCache</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getVideoInfo</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">videoCache</span> === <span class="literal">null</span> || <span class="variable language_">this</span>.<span class="property">needReset</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">videoCache</span> = <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">getVideoInfo</span>(id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">videoCache</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">downloadVideo</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">downLoadExists</span>(id) || <span class="variable language_">this</span>.<span class="property">needReset</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">downloadVideo</span>(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实际使用服务的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TVManager</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="attr">service</span>: <span class="title class_">VideoLib</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">service</span>: <span class="title class_">VideoLib</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">service</span> = service;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">renderVideoPage</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> info = <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">getVideoInfo</span>(id);</span><br><span class="line">        <span class="comment">// 渲染视频页面。</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;视频详情页面被渲染！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">renderListPanel</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> list = <span class="variable language_">this</span>.<span class="property">service</span>.<span class="title function_">listVideos</span>();</span><br><span class="line">        <span class="comment">// 渲染视频缩略图列表。</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;视频缩略图列表被渲染！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">reactOnUserInput</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`响应用户点击，并渲染视频 <span class="subst">$&#123;id&#125;</span> 的详情页`</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">renderVideoPage</span>(id);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">renderListPanel</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tyService = <span class="keyword">new</span> <span class="title class_">TVClass</span>();</span><br><span class="line"><span class="keyword">const</span> tyProxy = <span class="keyword">new</span> <span class="title class_">CacheTVClass</span>(tyService);</span><br><span class="line"><span class="keyword">const</span> manager = <span class="keyword">new</span> <span class="title class_">TVManager</span>(tyProxy);</span><br><span class="line">manager.<span class="title function_">reactOnUserInput</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应用户点击，并渲染视频 1 的详情页</span></span><br><span class="line"><span class="comment">// 视频详情页面被渲染！</span></span><br><span class="line"><span class="comment">// 视频缩略图列表被渲染！</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="试用场景"><a class="markdownIt-Anchor" href="#试用场景"></a> 试用场景</h4>
<ol>
<li>延迟初始化（虚拟代理）。如果有一个偶尔使用的重量级服务对象，一直保持该对象运行会消耗系统资源时，可使用代理模式。
<ol>
<li>无需在程序启动时就创建该对象，可将对象的初始化延迟到真正有需要的时候。</li>
</ol>
</li>
<li>访问控制 （保护代理）。如果只希望特定客户端使用服务对象，这里的对象可以是操作系统中非常重要的部分，而客户端则是各种已启动的程序 包括恶意程序），此时可使用代理模式。
<ol>
<li>代理可仅在客户端凭据满足要求时将请求传递给服务对象。</li>
</ol>
</li>
<li>本地执行远程服务（远程代理）。适用于服务对象位于远程服务器上的情形。
<ol>
<li>在这种情形中，代理通过网络传递客户端请求，负责处理所有与网络相关的复杂细节。</li>
</ol>
</li>
<li>记录日志请求（日志记录代理）。适用于当需要保存对于服务对象的请求历史记录时。</li>
<li>缓存请求结果（缓存代理）。适用于需要缓存客户请求结果并对缓存生命周期进行管理时，特别是当返回结果的体积非常大时。</li>
<li>智能引用。可在没有客户端使用某个重量级对象时立即销毁该对象。
<ol>
<li>代理会可以将所有获取了指向服务对象或其结果的客户端记录在案。代理可以时不时地遍历各个客户端，检查它们是否仍在运行。如果相应的客户端列表为空，代理就会销毁该服务对象，释放底层系统资源。</li>
</ol>
</li>
<li>代理还可以记录客户端是否修改了服务对象。 其他客户端还可以复用未修改的对象。</li>
</ol>
<h4 id="优点-4"><a class="markdownIt-Anchor" href="#优点-4"></a> 优点</h4>
<ol>
<li>可以在客户端毫无察觉的情况下控制服务对象。</li>
<li>如果客户端对服务对象的生命周期没有特殊要求，你可以对生命周期进行管理。</li>
<li>即使服务对象还未准备好或不存在，代理也可以正常工作。</li>
<li>开闭原则。可以在不对服务或客户端做出修改的情况下创建新代理。</li>
</ol>
<h4 id="缺点-5"><a class="markdownIt-Anchor" href="#缺点-5"></a> 缺点</h4>
<ol>
<li>代码可能会变得复杂，因为需要新建许多类。</li>
<li>服务响应可能会延迟。</li>
</ol>
<h4 id="combo-6"><a class="markdownIt-Anchor" href="#combo-6"></a> Combo</h4>
<ol>
<li><strong>适配器模式</strong>能为被封装对象提供不同的接口，<strong>代理模式</strong>能为对象提供相同的接口，<strong>装饰模式</strong>则能为对象提供加强的接口。</li>
<li><strong>外观模式</strong>与<strong>代理</strong>的相似之处在于它们都缓存了一个复杂实体并自行对其进行初始化。<strong>代理</strong>与其服务对象遵循同一接口，使得自己和服务对象可以互换，在这一点上它与<strong>外观</strong>不同。</li>
<li><strong>装饰</strong>和<strong>代理</strong>有着相似的结构，但是其意图却非常不同。这两个模式的构建都基于组合原则，也就是说一个对象应该将部分工作委派给另一个对象。两者之间的不同之处在于<strong>代理通常自行管理其服务对象的生命周期</strong>，而<strong>装饰的生成则总是由客户端进行控制</strong>。</li>
</ol>
<h2 id="行为型模式"><a class="markdownIt-Anchor" href="#行为型模式"></a> 行为型模式</h2>
<div class="note quote"><p>行为型模式 (Behavioral Pattern) 是对 在不 同的对象之间划分责任和算法的抽象化 。 行为型模式不仅仅关注类和对象的结构，而 且 重点关注它们之间的相互作用 。 通过行为型模式，可以更加清晰地 划分类与 对象的职责 ，并 研究系统在运行时实例对象 之间的交互 。在系统运行时，对象并不是孤 立的，它们可以通过相互通信与协作完成某 些复杂功能，一个对象在运行时也将影响到 其他对象的运行。 行为型模式分为 类行为型模式 和 对象行为型模式 两种： • 类行为型模式 ：类的行为型模式 使用继承关系在几个类之间分配行为 ，类行为型模式主要通过多态等方式来分配父类与子类的职责。 • 对象行为型模式 ：对象的行为型模式则 使用对象的聚合关联关系来分配行为 ，对象行为型模式主要是通过对象关联等方式来分配两个或多个类的职责。根据“合成复用原则”，系统中要尽量使用关联关系来取代继承关系，因此大部分行为型设计模式都属于对象行为型设计模式</p></div>
<h3 id="责任链模式chain-of-responsibility-pattern"><a class="markdownIt-Anchor" href="#责任链模式chain-of-responsibility-pattern"></a> 责任链模式(Chain of Responsibility Pattern)</h3>
<blockquote>
<p>责任链模式是一种行为设计模式， 允许你将请求沿着处理者链进行发送。 收到请求后， 每个处理者均可对请求进行处理， 或将其传递给链上的下个处理者。</p>
</blockquote>
<p>我们来看以下场景：</p>
<ol>
<li>现在有一个在线订购系统</li>
<li>希望限制：有认证的用户才能创建订单</li>
<li>希望限制：有管理员权限的用户拥有所有订单的完全访问权限</li>
</ol>
<p>接下来有同事提出这个系统存在安全隐患，需要增加一些功能：</p>
<ol>
<li>需要增加额外的验证步骤来清理请求中的数据</li>
<li>需要添加一个检测步骤来过滤来自同一IP地址的重复错误请求，避免暴力密码破解</li>
<li>需要增加一个缓存查找功能，包含同样数据的重复请求返回缓存中的结果，提高响应速度</li>
</ol>
<p>但我们还把这一大堆东西加入原本的身份认证机制中后，将得到一大坨复杂、难以复用且难以维护的代码。</p>
<p>这时，责任链模式可以优雅的解决上述问题。</p>
<p>责任链模式会将上述功能，按照单一责任原则，才分为一个一个的处理者，然后将这些处理者按照输入输出一个一个链接起来，每个处理者都有一个成员变量来保存对于下一处理者的引用。这些处理者除了处理请求外，还要负责沿着责任链传递请求。<strong>处理者可以决定不再沿着链传递请求， 这可高效地取消所有后续处理步骤</strong>。</p>
<p>还有一种更为经典的责任链设计模式，我们在JS中触发事件时，最外层对象Window对象会率先处理事件，最后会一层一层向内存对象传递，最后到达能够处理该事件的对象，则响应该事件，并将结果一层一层冒泡场地到最外层window对象。</p>
<p>所有处理者类<strong>均实现同一接口</strong>是关键所在。每个具体处理者仅关心下一个包含 execute执行方法的处理者。 这样一来， 就可以在运行时使用不同的处理者来创建链，而无需将相关代码与处理者的具体类进行耦合。</p>
<p>责任链模式类图如下：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/structure.png' data-fancybox='default' data-caption='责任链模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/structure.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/chain-of-responsibility/structure.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="责任链模式类图" /></a><span class='image-caption'>责任链模式类图</span></div></div>
<ol>
<li>处理者Handler：为处理者声明接口。</li>
<li>基础处理者BaseHandler：可选类，将所有处理者共同的代码保存在这里，例如确定下一个处理者存在后再将请求传递给它。</li>
<li>具体处理者ConcreteHandler: 实际处理请求的类，接收到请求后举动直接处理或传递给下一个处理者。</li>
</ol>
<p>下面我们用责任链模式设计一个投喂系统，不同动物会根据请求给出的不同食物各取所需。那么我们需要如下几个部分：</p>
<ol>
<li>处理者接口
<ol>
<li>责任链构建方法</li>
<li>请求处理方法</li>
</ol>
</li>
<li>基础处理者抽象类
<ol>
<li>构建方法：接受一个处理者，保存，然后返回该处理者以实现链式调用</li>
<li>处理方法：处理者非空判断</li>
</ol>
</li>
<li>具体处理者
<ol>
<li>处理方法：若能处理则返回结果，否则调用父类处理方法</li>
</ol>
</li>
<li>客户端
<ol>
<li>构建责任链</li>
<li>一个接受处理者的方法</li>
</ol>
</li>
</ol>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理者接口</span></span><br><span class="line"><span class="comment"> * 包含一个责任链构建方法</span></span><br><span class="line"><span class="comment"> * 和一个请求处理方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Handler</span>&lt;<span class="title class_">Request</span> = <span class="built_in">string</span>, <span class="title class_">Result</span> = <span class="built_in">string</span>&gt; &#123;</span><br><span class="line">    <span class="title function_">setNext</span>(<span class="attr">handler</span>: <span class="title class_">Handler</span>&lt;<span class="title class_">Request</span>, <span class="title class_">Result</span>&gt;): <span class="title class_">Handler</span>&lt;<span class="title class_">Request</span>, <span class="title class_">Result</span>&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">handle</span>(<span class="attr">request</span>: <span class="title class_">Request</span>): <span class="title class_">Result</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基础处理者抽象类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractHandler</span> <span class="keyword">implements</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">nextHandler</span>: <span class="title class_">Handler</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setNext</span>(<span class="attr">handler</span>: <span class="title class_">Handler</span>): <span class="title class_">Handler</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nextHandler</span> = handler;</span><br><span class="line">        <span class="comment">// 返回处理者，以支持链式调用</span></span><br><span class="line">        <span class="comment">// monkey.setNext(squirrel).setNext(dog);</span></span><br><span class="line">        <span class="keyword">return</span> handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">handle</span>(<span class="attr">request</span>: <span class="built_in">string</span>): <span class="built_in">string</span> | <span class="literal">null</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">nextHandler</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">nextHandler</span>.<span class="title function_">handle</span>(request);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体处理者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonkeyHandler</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">handle</span>(<span class="attr">request</span>: <span class="built_in">string</span>): <span class="built_in">string</span> | <span class="literal">null</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request === <span class="string">&quot;Banana&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`Monkey: I&#x27;ll eat the <span class="subst">$&#123;request&#125;</span>.`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">handle</span>(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SquirrelHandler</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">handle</span>(<span class="attr">request</span>: <span class="built_in">string</span>): <span class="built_in">string</span> | <span class="literal">null</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request === <span class="string">&quot;Nut&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`Squirrel: I&#x27;ll eat the <span class="subst">$&#123;request&#125;</span>.`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">handle</span>(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DogHandler</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AbstractHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">handle</span>(<span class="attr">request</span>: <span class="built_in">string</span>): <span class="built_in">string</span> | <span class="literal">null</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request === <span class="string">&quot;MeatBall&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`Dog: I&#x27;ll eat the <span class="subst">$&#123;request&#125;</span>.`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">handle</span>(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端首先创建责任链.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> monkey = <span class="keyword">new</span> <span class="title class_">MonkeyHandler</span>();</span><br><span class="line"><span class="keyword">const</span> squirrel = <span class="keyword">new</span> <span class="title class_">SquirrelHandler</span>();</span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> <span class="title class_">DogHandler</span>();</span><br><span class="line"></span><br><span class="line">monkey.<span class="title function_">setNext</span>(squirrel).<span class="title function_">setNext</span>(dog);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 随后构造客户端调用方法的行为</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clientCode</span>(<span class="params"><span class="attr">handler</span>: <span class="title class_">Handler</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> foods = [<span class="string">&quot;Nut&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Cup of coffee&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> food <span class="keyword">of</span> foods) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Client: Who wants a <span class="subst">$&#123;food&#125;</span>?`</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> result = handler.<span class="title function_">handle</span>(food);</span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  <span class="subst">$&#123;food&#125;</span> was left untouched.`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 可以将任意处理者传入调用方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Chain: Monkey &gt; Squirrel &gt; Dog\n&quot;</span>);</span><br><span class="line"><span class="title function_">clientCode</span>(monkey);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Subchain: Squirrel &gt; Dog\n&quot;</span>);</span><br><span class="line"><span class="title function_">clientCode</span>(squirrel);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Chain: Monkey &gt; Squirrel &gt; Dog</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Client: Who wants a Nut?</span></span><br><span class="line"><span class="comment"> *  Squirrel: I&#x27;ll eat the Nut.</span></span><br><span class="line"><span class="comment"> * Client: Who wants a Banana?</span></span><br><span class="line"><span class="comment"> *  Monkey: I&#x27;ll eat the Banana.</span></span><br><span class="line"><span class="comment"> * Client: Who wants a Cup of coffee?</span></span><br><span class="line"><span class="comment"> *  Cup of coffee was left untouched.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Subchain: Squirrel &gt; Dog</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Client: Who wants a Nut?</span></span><br><span class="line"><span class="comment"> *  Squirrel: I&#x27;ll eat the Nut.</span></span><br><span class="line"><span class="comment"> * Client: Who wants a Banana?</span></span><br><span class="line"><span class="comment"> *  Banana was left untouched.</span></span><br><span class="line"><span class="comment"> * Client: Who wants a Cup of coffee?</span></span><br><span class="line"><span class="comment"> *  Cup of coffee was left untouched.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="试用场景-2"><a class="markdownIt-Anchor" href="#试用场景-2"></a> 试用场景</h4>
<ol>
<li>当程序需要使用不同方式处理不同种类请求，而且请求类型和顺序预先未知时，可以使用责任链模式。</li>
<li>当必须按顺序执行多个处理者时，可以使用该模式。</li>
<li>如果所需处理者及其顺序必须在运行时进行改变，可以使用责任链模式。</li>
</ol>
<h4 id="优点-5"><a class="markdownIt-Anchor" href="#优点-5"></a> 优点</h4>
<ol>
<li>允许处理请求顺序。</li>
<li>符合单一责任原则。可对发起操作和执行操作的类进行解耦。</li>
<li>符合开闭原则。可以在不更改现有代码的情况下在程序中新增处理者。</li>
</ol>
<h4 id="缺点-6"><a class="markdownIt-Anchor" href="#缺点-6"></a> 缺点</h4>
<ol>
<li>部分请求可能未被处理。</li>
</ol>
<h4 id="combo-7"><a class="markdownIt-Anchor" href="#combo-7"></a> Combo</h4>
<ol>
<li><strong>责任链模式</strong>、<strong>命令模式</strong>、<strong>中介者模式</strong>和<strong>观察者模式</strong>都是用于处理请求发送者和接收者之间的不同连接方式：
<ol>
<li><strong>责任链</strong>按照顺序将请求传递给潜在接收者。直到有一名处理</li>
<li><strong>命令</strong>在发送者和接收者之间建立单向连接🔗</li>
<li><strong>中介者</strong>消除了发送者和接收者之间的直接连接🔗，强制他们与一个中介对象进行沟通</li>
<li><strong>观察者</strong>允许接收者动态地订阅或取消接收请求</li>
</ol>
</li>
<li><strong>责任链</strong>通常和<strong>组合模式</strong>结合使用。在这种情况下，叶组件接收到请求后，可以将请求沿包含全体父组件的链一直传递至对象树的底部。</li>
<li><strong>责任链</strong>的管理者可使用<strong>命令模式</strong>实现。在这种情况下，你可以对由请求代表的同一个上下文对象执行许多不同的操作。另一种是请求自身就是一个命令对象。在这种情况下，可以对由一系列不同上下文连接而成的链执行相同的操作。</li>
<li><strong>责任链</strong>和<strong>装饰模式</strong>的类结构非常相似。两者都依赖递归组合将需要执行的操作传递给一系列对象。但是，两者有几点重要的不同之处。
<ol>
<li><strong>责任链</strong>的管理者可以相互独立地执行一切操作，还可以随时停止传递请求。</li>
<li>各种<strong>装饰</strong>可以在遵循基本接口的情况下扩展对象的行为。</li>
<li><strong>装饰</strong>无法中断请求的传递。</li>
</ol>
</li>
</ol>
<h3 id="命令模式"><a class="markdownIt-Anchor" href="#命令模式"></a> 命令模式</h3>
<blockquote>
<p>命令模式将请求的所有相关信息转化为一个独立对象，这一操作可以允许我们根据不同请求将方法参数化、延迟请求执行或者将其放入队列，且能支持撤销操作。</p>
</blockquote>
<p>现在我们有一个构建GUI的业务，他也许包含以下特征：</p>
<ol>
<li>需要创建一个多个按钮的工具栏</li>
<li>每个按钮对应不同的功能，例如打开、保存、打印</li>
<li>同一功能，例如复制，除了试用按钮完成，还需要支持右键菜单复制与<code>ctrl + C</code>完成</li>
</ol>
<p>对于第一项需求，我们也许会设计一个简洁的按钮基类Btn，随后设计一些按钮类的子类，来支持不同的功能，例如OpenBtn,SaveBtn。</p>
<p>而对于第三个需求，我们有两个方案：</p>
<ol>
<li>将复制按钮中的逻辑代码复制一份到菜单类中</li>
<li>让菜单依赖于按钮</li>
</ol>
<p>前者造成了不小的代码重复，而后者将导致我们的类继承关系混乱。</p>
<p>此时，命令模式可以很好地解决上述问题。</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/command/structure.png' data-fancybox='default' data-caption='命令模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/command/structure.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/command/structure.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="命令模式类图" /></a><span class='image-caption'>命令模式类图</span></div></div>
<p>命令模式将类的行为抽象成了命令类如图所示：</p>
<ol>
<li>发送者Sender: 负责对请求进行初始化操作，需要包含一个成员变量来存储命令对象的引用，发送者只负责触发命令，而不需要向接收者发送请求。（注意：发送者并不负责创建命令对象，而是通过构造函数获得预先生成的命令）。</li>
<li>命令Command: 命令接口，通常只需要声明一个执行函数。</li>
<li>具体命令ConcreteCommand: 实现请求，并不完成具体的业务逻辑，而是委派给一个业务逻辑对象，请求参数可保存在成员变量中。</li>
<li>接收者Receiver: 实际处理业务逻辑的类，几乎所有对象都能作为接收者。</li>
</ol>
<p>下面我们来实现一个简单的DEMO来感受一下每个类的作用：</p>
<ol>
<li>首先为了确保命令的统一性我们需要一个命令接口</li>
<li>其次我们需要一个不带接收者的简单命令，以及一个需要向接收者发送请求的复杂命令</li>
<li>最后我们需要一个实际发送请求的发送者类，他本该向接收者发送请求，但现在他可以通过命令保存参数，定义执行顺序并间接地发送请求。</li>
</ol>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 命令接口，声明执行方法</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="title function_">execute</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 接收者，处理实际业务逻辑</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span> &#123;</span><br><span class="line">    <span class="title function_">doSomething</span>(<span class="attr">a</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Receiver: Working on (<span class="subst">$&#123;a&#125;</span>.)`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">doSomethingElse</span>(<span class="attr">b</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Receiver: Working on (<span class="subst">$&#123;b&#125;</span>.)`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 简单命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">payload</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">payload</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">payload</span> = payload;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">execute</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">            <span class="string">`SimpleCommand: See, I can do simple things like printing (<span class="subst">$&#123;<span class="variable language_">this</span>.payload&#125;</span>)`</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 复杂命令，需要委派给接收者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">receiver</span>: <span class="title class_">Receiver</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 上下文信息，用于保存请求参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">a</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">b</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">receiver</span>: <span class="title class_">Receiver</span>, <span class="attr">a</span>: <span class="built_in">string</span>, <span class="attr">b</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">receiver</span> = receiver;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">a</span> = a;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">b</span> = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">execute</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">            <span class="string">&quot;ComplexCommand: Complex stuff should be done by a receiver object.&quot;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">doSomething</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">doSomethingElse</span>(<span class="variable language_">this</span>.<span class="property">b</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 与命令相关联，向命令发送请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoke</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">onStart</span>: <span class="title class_">Command</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">onFinish</span>: <span class="title class_">Command</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setOnStart</span>(<span class="params"><span class="attr">command</span>: <span class="title class_">Command</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onStart</span> = command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setOnFinish</span>(<span class="params"><span class="attr">command</span>: <span class="title class_">Command</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFinish</span> = command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">isCommand</span>(<span class="built_in">object</span>): <span class="built_in">object</span> is <span class="title class_">Command</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">object</span>.<span class="property">execute</span> !== <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Invoke类并不需要依赖具体的命令或是接收者，Invoke通过执行命令来调用接收者</span></span><br><span class="line">    <span class="title function_">doSomethingImportant</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">            <span class="string">&quot;Invoker: Does anybody want something done before I begin?&quot;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isCommand</span>(<span class="variable language_">this</span>.<span class="property">onStart</span>)) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onStart</span>.<span class="title function_">execute</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Invoker: ...doing something really important...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">            <span class="string">&quot;Invoker: Does anybody want something done after I finish?&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isCommand</span>(<span class="variable language_">this</span>.<span class="property">onFinish</span>)) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onFinish</span>.<span class="title function_">execute</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> invoker = <span class="keyword">new</span> <span class="title class_">Invoke</span>();</span><br><span class="line"></span><br><span class="line">invoker.<span class="title function_">setOnStart</span>(<span class="keyword">new</span> <span class="title class_">SimpleCommand</span>(<span class="string">&quot;Say Hi!&quot;</span>));</span><br><span class="line"><span class="keyword">const</span> receiver = <span class="keyword">new</span> <span class="title class_">Receiver</span>();</span><br><span class="line"></span><br><span class="line">invoker.<span class="title function_">setOnFinish</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ComplexCommand</span>(receiver, <span class="string">&quot;Send Message&quot;</span>, <span class="string">&quot;Save report&quot;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">invoker.<span class="title function_">doSomethingImportant</span>();</span><br><span class="line"><span class="comment">// Invoker: Does anybody want something done before I begin?</span></span><br><span class="line"><span class="comment">// SimpleCommand: See, I can do simple things like printing (Say Hi!)</span></span><br><span class="line"><span class="comment">// Invoker: ...doing something really important...</span></span><br><span class="line"><span class="comment">// Invoker: Does anybody want something done after I finish?</span></span><br><span class="line"><span class="comment">// ComplexCommand: Complex stuff should be done by a receiver object.</span></span><br><span class="line"><span class="comment">// Receiver: Working on (Send Message.)</span></span><br><span class="line"><span class="comment">// Receiver: Working on (Save report.)</span></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="试用场景-3"><a class="markdownIt-Anchor" href="#试用场景-3"></a> 试用场景</h4>
<ol>
<li>当需要通过操作来参数化对象时</li>
<li>当需要将操作放入队列中或者计划命令执行时间等等需要序列化命令时</li>
<li>当需要实现命令回滚时</li>
</ol>
<h4 id="优点-6"><a class="markdownIt-Anchor" href="#优点-6"></a> 优点</h4>
<ol>
<li>符合单一责任原则。可将触发和执行操作类解耦</li>
<li>符合开闭原则。可以在不修改已有代码的情况下构建新的命令</li>
<li>可以实现撤销和恢复功能</li>
<li>可以实现操作延迟执行</li>
<li>可以将一组简单的命令组合为复杂的命令</li>
</ol>
<h4 id="缺点-7"><a class="markdownIt-Anchor" href="#缺点-7"></a> 缺点</h4>
<ol>
<li>代码可能会因为全新的层次：命令层的引入而变得复杂</li>
</ol>
<h4 id="combo-8"><a class="markdownIt-Anchor" href="#combo-8"></a> Combo</h4>
<ol>
<li><strong>责任链</strong>的管理者可使用<strong>命令模式</strong>实现。在这种情况下，可以对由请求代表的同一个上下文对象执行许多不同的操作。另外一种实现方式，是请求自身就是一个命令对象。这样可以对由一系列不同上下文连接而成的链执行相同的操作。</li>
<li>可以同时使用<strong>命令</strong>和备<strong>忘录模式</strong>来实现 “撤销”。在这种情况下，命令用于对目标对象执行各种不同的操作，备忘录用来保存一条命令执行前该对象的状态。</li>
<li><strong>命令</strong>和<strong>策略模式</strong>看上去很像，因为两者都能通过某些行为来参数化对象。但是，它们的意图有非常大的不同：
<ol>
<li>可以使用<strong>命令</strong>来将任何操作转换为对象。可以通过转换来延迟操作的执行、将操作放入队列、保存历史命令或者向远程服务发送命令等。</li>
<li><strong>策略</strong>通常可用于描述完成某件事的不同方式，让你能够在同一个上下文类中切换算法。</li>
</ol>
</li>
<li><strong>原型模式</strong>可用于保存命令的历史记录。</li>
<li>可以将<strong>访问者模式</strong>视为<strong>命令模式</strong>的加强版本，其对象可对不同类的多种对象执行操作。</li>
</ol>
<h3 id="迭代器模式"><a class="markdownIt-Anchor" href="#迭代器模式"></a> 迭代器模式</h3>
<blockquote>
<p>迭代器模式是一种行为设计模式，能让你在不暴露集合底层表现形式（如列表、栈、队列）的情况下遍历集合中所有的元素</p>
</blockquote>
<p>我们考虑以下场景：</p>
<ol>
<li>在一个系统中我们有一个树形集合容器</li>
<li>需要为这一容器设计一些遍历算法</li>
<li>但可能今天需要用DFS遍历，明天需要用BFS遍历</li>
</ol>
<p>在这一场景中我们可能需要配合业务不断的增加新的遍历算法，这将造成一下几点问题：</p>
<ol>
<li>模糊集合“高效存储数据”的主要职责。</li>
<li>根据特定应用定制的算法加入泛型集合类造成不必要的内存开销</li>
<li>客户端不得不关心当前集合类是否能够进行某些元素访问方式，使得代码与特定集合耦合。</li>
</ol>
<p>迭代器模式就是为了解决这一问题而生。迭代器模式的主要思想是将集合的遍历行为抽取为单独的迭代器对象。</p>
<p>迭代器类主要包含以下内容：</p>
<ol>
<li>实现自身迭代算法</li>
<li>封装遍历操作的所有细节</li>
<li>获取集合元素的基本方法</li>
</ol>
<p>另外我们需要实现一个迭代器接口，来保证迭代器方法一致。迭代器模式类图如下：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/iterator/structure.png' data-fancybox='default' data-caption='迭代器模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/iterator/structure.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/iterator/structure.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="迭代器模式类图" /></a><span class='image-caption'>迭代器模式类图</span></div></div>
<ol>
<li>迭代器Iterator: 迭代器接口，声明了遍历集合所需要的操作，例如获取下一个元素、获取当前位置、重新开始迭代</li>
<li>具体迭代器ConcreteIterator: 实现遍历集合的一种算法。迭代器对象必须追踪自身遍历的进度。这使得多个迭代器可以相互独立地遍历同一集合</li>
<li>集合Collection: 集合接口，声明一个或多个方法来获取与集合兼容的迭代器。方法返回的类型必须为迭代器接口，因此具体集合可以返回各种不同的迭代器</li>
<li>具体集合ConcreteCollection: 实现集合接口中的方法，为客户端返回一个特定的具体迭代器对象。</li>
<li>客户端Client: 客户端通常不会执行创建迭代器，而是从集合中获取。但特定情况下，例如当客户端要自定义特殊迭代器，客户端可以直接创建一个迭代器。</li>
</ol>
<p>下面我们尝试为一个字符串集合构建迭代器：</p>
<ol>
<li>迭代器接口：需要支持获取当前元素、获取下一元素、获取当前元素key值、检测当前指针位置是否合法、重置指针的操作</li>
<li>集合接口：需要一个工厂方法，支持构建集合对应的迭代器</li>
<li>具体集合：试用一个数组作为底层数据结构，同时需要支持获取数组，获取长度、添加元素、获取迭代器、获取方向迭代器的功能</li>
<li>具体迭代器：需要保存可迭代对象的引用，当前位置的属性，以及遍历方向标志位。</li>
</ol>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 迭代器接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MyIterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// 获取当前元素</span></span><br><span class="line">    <span class="title function_">getCurrent</span>(): T;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当前元素并将指针移动到下一元素</span></span><br><span class="line">    <span class="title function_">getNext</span>(): T;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回当前预算的key</span></span><br><span class="line">    <span class="title function_">getCurrentKey</span>(): <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检测当前位置是否有效</span></span><br><span class="line">    <span class="title function_">checkValid</span>(): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将迭代器指针指向第一个元素</span></span><br><span class="line">    <span class="title function_">rewind</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 集合接口，定义获得迭代器的方法</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Aggregator</span> &#123;</span><br><span class="line">    <span class="title function_">getIterator</span>(): <span class="title class_">MyIterator</span>&lt;<span class="built_in">string</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 具体集合类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WordsCollection</span> <span class="keyword">implements</span> <span class="title class_">Aggregator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">items</span>: <span class="built_in">string</span>[] = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得集合</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getItems</span>(): <span class="built_in">string</span>[] &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得长度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getCount</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">addItem</span>(<span class="params"><span class="attr">item</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">push</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得迭代器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getIterator</span>(): <span class="title class_">MyIterator</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AlphabeticalOrderIterator</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得方向迭代器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getReverseIterator</span>(): <span class="title class_">MyIterator</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AlphabeticalOrderIterator</span>(<span class="variable language_">this</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 具体迭代器类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlphabeticalOrderIterator</span> <span class="keyword">implements</span> <span class="title class_">MyIterator</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">collection</span>: <span class="title class_">WordsCollection</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">position</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历方向</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">reverse</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">collection</span>: <span class="title class_">WordsCollection</span>, <span class="attr">reverse</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">collection</span> = collection;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reverse</span> = reverse;</span><br><span class="line">        <span class="keyword">if</span> (reverse) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">position</span> = collection.<span class="title function_">getCount</span>() - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">rewind</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">position</span> = <span class="variable language_">this</span>.<span class="property">reverse</span> ? <span class="variable language_">this</span>.<span class="property">collection</span>.<span class="title function_">getCount</span>() - <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getCurrent</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">collection</span>.<span class="title function_">getItems</span>()[<span class="variable language_">this</span>.<span class="property">position</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getCurrentKey</span>(): <span class="built_in">number</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">position</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getNext</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> item = <span class="variable language_">this</span>.<span class="property">collection</span>.<span class="title function_">getItems</span>()[<span class="variable language_">this</span>.<span class="property">position</span>];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">position</span> += <span class="variable language_">this</span>.<span class="property">reverse</span> ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">checkValid</span>(): <span class="built_in">boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">reverse</span></span><br><span class="line">            ? <span class="variable language_">this</span>.<span class="property">position</span> &gt;= <span class="number">0</span></span><br><span class="line">            : <span class="variable language_">this</span>.<span class="property">position</span> &lt; <span class="variable language_">this</span>.<span class="property">collection</span>.<span class="title function_">getCount</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> collection = <span class="keyword">new</span> <span class="title class_">WordsCollection</span>();</span><br><span class="line">collection.<span class="title function_">addItem</span>(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">collection.<span class="title function_">addItem</span>(<span class="string">&quot;second&quot;</span>);</span><br><span class="line">collection.<span class="title function_">addItem</span>(<span class="string">&quot;third&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> iterator = collection.<span class="title function_">getIterator</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Straight traversal:&quot;</span>);</span><br><span class="line"><span class="keyword">while</span> (iterator.<span class="title function_">checkValid</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">getNext</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Reverse traversal:&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> reverseIterator = collection.<span class="title function_">getReverseIterator</span>();</span><br><span class="line"><span class="keyword">while</span> (reverseIterator.<span class="title function_">checkValid</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(reverseIterator.<span class="title function_">getNext</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Straight traversal:</span></span><br><span class="line"><span class="comment"> * first</span></span><br><span class="line"><span class="comment"> * second</span></span><br><span class="line"><span class="comment"> * third</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Reverse traversal:</span></span><br><span class="line"><span class="comment"> * third</span></span><br><span class="line"><span class="comment"> * second</span></span><br><span class="line"><span class="comment"> * first</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="应用场景"><a class="markdownIt-Anchor" href="#应用场景"></a> 应用场景</h4>
<ol>
<li>当集合背后为复杂的数据结构，且你希望对客户端隐藏其复杂性时（出于使用便利性或安全性的考虑），可以使用迭代器模式。</li>
<li>使用该模式可以减少程序中重复的遍历代码。</li>
<li>如果希望代码能够遍历不同的甚至是无法预知的数据结构，可以使用迭代器模式。</li>
</ol>
<h4 id="优点-7"><a class="markdownIt-Anchor" href="#优点-7"></a> 优点</h4>
<ol>
<li>符合单一责任原则。将遍历算法抽离为独立的类</li>
<li>符合开闭原则。无需修改代码，就能创建新的集合与迭代器</li>
<li>可以并行遍历同一集合，因为迭代器对象都包含其自身的遍历状态。</li>
<li>可以暂停遍历，并在需要时继续</li>
</ol>
<h4 id="缺点-8"><a class="markdownIt-Anchor" href="#缺点-8"></a> 缺点</h4>
<ol>
<li>如果程序只与简单的集合进行交互，应用该模式可能会矫枉过正。</li>
<li>对于某些特殊集合，使用迭代器可能比直接遍历的效率低。</li>
</ol>
<h4 id="combo-9"><a class="markdownIt-Anchor" href="#combo-9"></a> Combo</h4>
<ol>
<li>可以使用<strong>迭代器模式</strong>来遍历<strong>组合模式树</strong>。</li>
<li>可以同时使用<strong>工厂方法模式</strong>和<strong>迭代器</strong>来让子类集合返回不同类型的迭代器， 并使得迭代器与集合相匹配。</li>
<li>可以同时使用<strong>备忘录模式</strong>和<strong>迭代器</strong>来获取当前迭代器的状态， 并且在需要的时候进行回滚。</li>
<li>可以同时使用<strong>访问者模式</strong>和<strong>迭代器</strong>来遍历复杂数据结构，并对其中的元素执行所需操作，即使这些元素所属的类完全不同。</li>
</ol>
<h3 id="解释器模式interpreter-pattern"><a class="markdownIt-Anchor" href="#解释器模式interpreter-pattern"></a> 解释器模式Interpreter Pattern</h3>
<blockquote>
<p>给分析对象定义一个语言，并定义该语言的文法表示，再设计一个解析器来解释语言中的句子。也就是说，用编译语言的方式来分析应用中的实例。这种模式实现了文法表达式处理的接口，该接口解释一个特定的上下文。</p>
</blockquote>
<h3 id="中介模式"><a class="markdownIt-Anchor" href="#中介模式"></a> 中介模式</h3>
<blockquote>
<p>中介模式是一种行为设计模式，他能减少对象之间混乱无序的依赖关系。通过限制对象之间的直接交互，强迫他们通过一个中介对象进行合作</p>
</blockquote>
<p>中介模式建议我们停止组件之间的直接交流，使其相互独立，这样就不会出现一个组件与多个其他组件相互耦合的情况，一个组件只会依赖于一个中介类。中介模式类图如下</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/mediator/structure.png' data-fancybox='default' data-caption='中介模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/mediator/structure.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/mediator/structure.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="中介模式类图" /></a><span class='image-caption'>中介模式类图</span></div></div>
<ol>
<li>组件Component: 包含业务逻辑的类，依赖于一个中介对象，保存其引用。组件无需知道中介对象的具体类，只需要知道其实现了中介接口既可以，这样便于连接不同中介类，并在程序中复用</li>
<li>中介接口Mediator: 声明了中介与组件交流的方法，通常包含一个通知方法，以上下文作为参数，将接收组件与发送组件解耦</li>
<li>具体中介ConcreteMediator: 封装组件间的关系，保存所有组件的引用并对其进行管理，甚至可以管理其生命周期</li>
<li>对于组件而言，中介者是一个黑箱，组件并不知道其发送的消息将由谁来处理，也不会知道是谁给它发送了消息。</li>
</ol>
<p>下面我们来写一个Demo感受一下中介模式，我们需要以下接口：</p>
<ol>
<li>中介接口: 声明一个消息提醒接口，它接收一个参数sender代表发送信息的组件，一个上下文信息event，这里用string简单演示</li>
<li>组件基类: 为了确保组件均通过中介对象发送请求，我们需要为每个组件实现一个基类，使这个基类保存中介对象的引用。</li>
<li>实际组件类: 依赖于组件基类，实现一些具体的业务逻辑方法。</li>
<li>实际中介类: 实际中介类需要保存所有组件对象的引用，另外还需要实现接口中的通知方法，该方法会根据不同的上下文，调用不同的组件对象的逻辑方法。</li>
</ol>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 中介接口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * notify</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>:</span></span><br><span class="line"><span class="comment">     *  sender: object</span></span><br><span class="line"><span class="comment">     *  event: string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span>:</span></span><br><span class="line"><span class="comment">     *  void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">notify</span>(<span class="attr">sender</span>: <span class="built_in">object</span>, <span class="attr">event</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实现组件基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseComponent</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 组件需要保存中介对象</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="attr">mediator</span>: <span class="title class_">Mediator</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">mediator?: <span class="title class_">Mediator</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span> = mediator!;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setMediator</span>(<span class="params"><span class="attr">mediator</span>: <span class="title class_">Mediator</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span> = mediator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实际组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseComponent</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">mediator?: <span class="title class_">Mediator</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(mediator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 一些业务逻辑</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doSomeA</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Component 1 does A.&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span>.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doSomeB</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Component 1 does B.&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span>.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实际组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component2</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseComponent</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">mediator?: <span class="title class_">Mediator</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(mediator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一些业务逻辑</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doSomeC</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Component 2 does C.&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span>.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doSomeD</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Component 2 does D.&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span>.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实际中介类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span> <span class="keyword">implements</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 保存所有组件</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">component1</span>: <span class="title class_">Component1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">component2</span>: <span class="title class_">Component2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">component1</span>: <span class="title class_">Component1</span>, <span class="attr">component2</span>: <span class="title class_">Component2</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">component1</span> = component1;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">component1</span>.<span class="title function_">setMediator</span>(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">component2</span> = component2;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">component2</span>.<span class="title function_">setMediator</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 实现通知接口，根据事件名称执行不同的业务，sender用于保存信息发送者</span></span><br><span class="line">    <span class="title function_">notify</span>(<span class="attr">sender</span>: <span class="built_in">object</span>, <span class="attr">event</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (event === <span class="string">&quot;A&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">                <span class="string">&quot;Mediator reacts on A and triggers following operations:&quot;</span></span><br><span class="line">            );</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">component2</span>.<span class="title function_">doSomeC</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (event === <span class="string">&quot;D&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">                <span class="string">&quot;Mediator reacts on D and triggers following operations:&quot;</span></span><br><span class="line">            );</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">component1</span>.<span class="title function_">doSomeB</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">component2</span>.<span class="title function_">doSomeC</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c1 = <span class="keyword">new</span> <span class="title class_">Component1</span>();</span><br><span class="line"><span class="keyword">const</span> c2 = <span class="keyword">new</span> <span class="title class_">Component2</span>();</span><br><span class="line"><span class="keyword">const</span> mediator = <span class="keyword">new</span> <span class="title class_">ConcreteMediator</span>(c1, c2);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Client triggers operation A.&quot;</span>);</span><br><span class="line">c1.<span class="title function_">doSomeA</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Client triggers operation D.&quot;</span>);</span><br><span class="line">c2.<span class="title function_">doSomeD</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Client triggers operation A.</span></span><br><span class="line"><span class="comment">// Component 1 does A.</span></span><br><span class="line"><span class="comment">// Mediator reacts on A and triggers following operations:</span></span><br><span class="line"><span class="comment">// Component 2 does C.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Client triggers operation D.</span></span><br><span class="line"><span class="comment">// Component 2 does D.</span></span><br><span class="line"><span class="comment">// Mediator reacts on D and triggers following operations:</span></span><br><span class="line"><span class="comment">// Component 1 does B.</span></span><br><span class="line"><span class="comment">// Component 2 does C.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="使用场景-4"><a class="markdownIt-Anchor" href="#使用场景-4"></a> 使用场景</h4>
<ol>
<li>当一些对象与其他对象紧密耦合以至于难以对其进行修改时，可以使用中介模式</li>
<li>当组件因过于依赖于其他组件而无法在不同应用中复用时，可以使用中介模式</li>
<li>如果为了能在不同场景下复用一些基本行为，导致不得不创建大量组件子类时，可以使用中介模式</li>
</ol>
<h4 id="优点-8"><a class="markdownIt-Anchor" href="#优点-8"></a> 优点</h4>
<ol>
<li>符合单一责任原则，将多个组件间的交流抽取到同一位置，使其便于理解与维护</li>
<li>符合开闭原则，无需修改实际组件就能增加新的中介者</li>
<li>缓解应用中的耦合情况</li>
<li>更方便地复用组件</li>
</ol>
<h4 id="缺点-9"><a class="markdownIt-Anchor" href="#缺点-9"></a> 缺点</h4>
<ol>
<li>一段时间后中介者可能变为上帝对象</li>
</ol>
<h4 id="combo-10"><a class="markdownIt-Anchor" href="#combo-10"></a> Combo</h4>
<ol>
<li><strong>责任链模式</strong>、<strong>命令模式</strong>、<strong>中介者模式</strong>和<strong>观察者模式</strong>都是用于处理请求发送者和接收者之间的不同连接方式：
<ol>
<li><strong>责任链</strong>按照顺序将请求传递给潜在接收者。直到有一名处理</li>
<li><strong>命令</strong>在发送者和接收者之间建立单向连接🔗</li>
<li><strong>中介者</strong>消除了发送者和接收者之间的直接连接🔗，强制他们与一个中介对象进行沟通</li>
<li><strong>观察者</strong>允许接收者动态地订阅或取消接收请求</li>
</ol>
</li>
<li><strong>外观模式</strong>和<strong>中介模式</strong>的职责类似: 它们都尝试在大量紧密耦合的类中组织起合作。
<ol>
<li><strong>外观</strong>为子系统中的所有对象定义了一个简单接口， 但是它不提供任何新功能。子系统本身不会意识到外观的存在。子系统中的对象可以直接进行交流。</li>
<li><strong>中介者</strong>将系统中组件的沟通行为中心化。各组件只知道中介者对象，无法直接相互交流。</li>
</ol>
</li>
<li><strong>中介者</strong>和<strong>观察者</strong>大部分情况下只能使用其中一种模式，但有时可以同时使用:
<ol>
<li><strong>中介者</strong>的主要目标是消除一系列系统组件之间的相互依赖。<strong>观察者</strong>的目标是在对象之间建立动态的单向连接，使得部分对象可作为其他对象的附属发挥作用。</li>
<li>而有一种流行的中介模式融合了二者：中介者对象担当发布者的角色，其他组件则作为订阅者</li>
</ol>
</li>
</ol>
<h3 id="备忘录模式"><a class="markdownIt-Anchor" href="#备忘录模式"></a> 备忘录模式</h3>
<blockquote>
<p>备忘录模式是一种行为设计模式，允许在不暴露对象实现细节的情况下保存和恢复对象之前的状态。</p>
</blockquote>
<p>我们先来思考以下场景：</p>
<ol>
<li>我们想要设计一个文字编辑器app，需要支持撤销操作</li>
<li>这意味着用户每次进行操作时，需要将操作之前的所有对象的状态进行保存</li>
<li>但这也意味着，负责记录的类要访问所有需要被记录的所有成员。</li>
<li>这就意味着：要么会暴露类的所有内部细节而使其过于脆弱；要么会限制对其状态的访问权限而无法生成快照。</li>
</ol>
<p>而备忘录模式为我们提供了解决办法：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/memento/solution-zh.png' data-fancybox='default' data-caption='备忘录模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/memento/solution-zh.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/memento/solution-zh.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="备忘录模式类图" /></a><span class='image-caption'>备忘录模式类图</span></div></div>
<ol>
<li>原发射器Originator: 备忘录将创建快照的工作委托给实际状态拥有者，称为原发射器对象，拥有对备忘录所有成员的访问权限，可以保存自身状态的快照，也能在需要时通过快照恢复自身状态。</li>
<li>备忘录Memento: 备忘录模式建议将对象状态存储在备忘录对象中。除了创建备忘录的对象可以访问其内容，其余对象均不可访问其中的内容。其他对象必须使用受限接口与备忘录进行交互，它们可以获取快照的元数据（创建时间和操作名称等），但不能获取快照中原始对象的状态。</li>
<li>负责人Caretakers: 备忘录将被保存在负责人对象中，负责人对象仅通过受限接口访问备忘录，因此无法对其进行修改。</li>
</ol>
<p>备忘录模式具体有三种主流结构，下面我们来一一介绍</p>
<h4 id="基于嵌套实现"><a class="markdownIt-Anchor" href="#基于嵌套实现"></a> 基于嵌套实现</h4>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/memento/structure1.png?id=4b4a42363a005b617d4df06689787385' data-fancybox='default' data-caption='基于嵌套实现的备忘录模式'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/memento/structure1.png?id=4b4a42363a005b617d4df06689787385" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/memento/structure1.png?id=4b4a42363a005b617d4df06689787385" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="基于嵌套实现的备忘录模式" /></a><span class='image-caption'>基于嵌套实现的备忘录模式</span></div></div>
<ol>
<li>在这一方法中备忘录类将被嵌套在原发射器中</li>
<li>这样原发射器可以访问备忘录的所有成员变量和方法</li>
<li>负责人对备忘录的访问权限非常有限，只能在栈中保存备忘录，而无法修改其状态</li>
<li>负责人通过备忘录栈来保存历史状态，当原发送者需要回溯时，负责人从栈顶取出备忘录，传递给原发射器来恢复状态</li>
</ol>
<h4 id="基于中间接口实现"><a class="markdownIt-Anchor" href="#基于中间接口实现"></a> 基于中间接口实现</h4>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/memento/structure2.png?id=fcff71cb648389be2e302fbe55e2f847' data-fancybox='default' data-caption='基于中间接口实现的备忘录模式'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/memento/structure2.png?id=fcff71cb648389be2e302fbe55e2f847" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/memento/structure2.png?id=fcff71cb648389be2e302fbe55e2f847" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="基于中间接口实现的备忘录模式" /></a><span class='image-caption'>基于中间接口实现的备忘录模式</span></div></div>
<ol>
<li>适用于不支持嵌套类的语言（比如PHP）</li>
<li>通过接口，规定负责人只能通过固定接口与备忘录进行交互，限制负责人对备忘录成员的直接访问</li>
<li>原发射器可以直接与备忘录对象交互，访问备忘录中的成员与方法</li>
<li>缺点是需要将备忘录中的所有成员变量声明为公有</li>
</ol>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原发射器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Originator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">state</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">state</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟业务</span></span><br><span class="line">    <span class="title function_">doSomething</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Originator: I&#x27;m doing something important.&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable language_">this</span>.<span class="title function_">generateRandomString</span>(<span class="number">30</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Originator: and my state has changed to: <span class="subst">$&#123;<span class="variable language_">this</span>.state&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 产生随机字符串</span></span><br><span class="line">    <span class="title function_">generateRandomString</span>(<span class="params"><span class="attr">length</span>: <span class="built_in">number</span> = <span class="number">10</span></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> charSet = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, &#123; length &#125;)</span><br><span class="line">            .<span class="title function_">map</span>(<span class="function">() =&gt;</span></span><br><span class="line">                charSet.<span class="title function_">charAt</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * charSet.<span class="property">length</span>))</span><br><span class="line">            )</span><br><span class="line">            .<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存快照</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">save</span>(): <span class="title class_">Memento</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteMemento</span>(<span class="variable language_">this</span>.<span class="property">state</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 恢复状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">restore</span>(<span class="params"><span class="attr">m</span>: <span class="title class_">Memento</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = m.<span class="title function_">getState</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Originator: My state has changed to: <span class="subst">$&#123;<span class="variable language_">this</span>.state&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备忘录接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line">    <span class="title function_">getState</span>(): <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">getName</span>(): <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">getDate</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实际备忘录</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMemento</span> <span class="keyword">implements</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line">    <span class="comment">// 快照</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">state</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="comment">// 保存时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">date</span>: <span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">state</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = state;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toISOString</span>().<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">19</span>).<span class="title function_">replace</span>(<span class="string">&quot;T&quot;</span>, <span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getState</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getName</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.date&#125;</span> / (<span class="subst">$&#123;<span class="variable language_">this</span>.state.slice(<span class="number">0</span>, <span class="number">9</span>)&#125;</span>...)`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">getDate</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">date</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 负责人</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Caretaker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">mementos</span>: <span class="title class_">Memento</span>[] = [];</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">originator</span>: <span class="title class_">Originator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">originator</span>: <span class="title class_">Originator</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">originator</span> = originator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 备份时创建新的备忘录</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">backup</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nCaretaker: Saving Originator&#x27;s state...&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mementos</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">originator</span>.<span class="title function_">save</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 撤销时取出栈定备忘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">undo</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">mementos</span>.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> memento = <span class="variable language_">this</span>.<span class="property">mementos</span>.<span class="title function_">pop</span>() <span class="keyword">as</span> <span class="title class_">Memento</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Caretaker: Restoring state to: <span class="subst">$&#123;memento.getName()&#125;</span>`</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">originator</span>.<span class="title function_">restore</span>(memento);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查看保存历史</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">showHistory</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Caretaker: Here&#x27;s the list of mementos:&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> memento <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">mementos</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(memento.<span class="title function_">getName</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> originator = <span class="keyword">new</span> <span class="title class_">Originator</span>(<span class="string">&quot;Super-duper-super-puper-super.&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> caretaker = <span class="keyword">new</span> <span class="title class_">Caretaker</span>(originator);</span><br><span class="line"></span><br><span class="line">caretaker.<span class="title function_">backup</span>();</span><br><span class="line">originator.<span class="title function_">doSomething</span>();</span><br><span class="line"></span><br><span class="line">caretaker.<span class="title function_">backup</span>();</span><br><span class="line">originator.<span class="title function_">doSomething</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">caretaker.<span class="title function_">showHistory</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nClient: Now, let&#x27;s rollback!\n&quot;</span>);</span><br><span class="line">caretaker.<span class="title function_">undo</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nClient: Once more!\n&quot;</span>);</span><br><span class="line">caretaker.<span class="title function_">undo</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Caretaker: Saving Originator&#x27;s state...</span></span><br><span class="line"><span class="comment">// Originator: I&#x27;m doing something important.</span></span><br><span class="line"><span class="comment">// Originator: and my state has changed to: jeSdYDdKubiayBMNwGKzkmVeloqZUz</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Caretaker: Saving Originator&#x27;s state...</span></span><br><span class="line"><span class="comment">// Originator: I&#x27;m doing something important.</span></span><br><span class="line"><span class="comment">// Originator: and my state has changed to: JrMFnUuPEBgdTGNzBaeduRDUHlrmax</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Caretaker: Here&#x27;s the list of mementos:</span></span><br><span class="line"><span class="comment">// 2024-06-28 10:59:37 / (Super-dup...)</span></span><br><span class="line"><span class="comment">// 2024-06-28 10:59:37 / (jeSdYDdKu...)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Client: Now, let&#x27;s rollback!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Caretaker: Restoring state to: 2024-06-28 10:59:37 / (jeSdYDdKu...)</span></span><br><span class="line"><span class="comment">// Originator: My state has changed to: jeSdYDdKubiayBMNwGKzkmVeloqZUz</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Client: Once more!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Caretaker: Restoring state to: 2024-06-28 10:59:37 / (Super-dup...)</span></span><br><span class="line"><span class="comment">// Originator: My state has changed to: Super-duper-super-puper-super.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="更为严格的实现"><a class="markdownIt-Anchor" href="#更为严格的实现"></a> 更为严格的实现</h4>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/memento/structure3.png?id=6c3ef6a916be8c8ec6d6659d19a6a79f' data-fancybox='default' data-caption='更为严格的实现'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/memento/structure3.png?id=6c3ef6a916be8c8ec6d6659d19a6a79f" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/memento/structure3.png?id=6c3ef6a916be8c8ec6d6659d19a6a79f" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="更为严格的实现" /></a><span class='image-caption'>更为严格的实现</span></div></div>
<ol>
<li>不会让其他类有任何机会访问原发射器状态。</li>
<li>允许存在多种不同形式的原始发射器，每种发射器与其相应的备忘录进行交互，原发射器和备忘录不会暴露任何状态。</li>
<li>负责人禁止修改存储在备忘录中的状态，负责人独立于原发射器存在，因此恢复方法被保存在了备忘录中。</li>
<li>每个备忘录与创建了自身的原发射器连接，原发射器将自身状态传递给备忘录的构造函数，这样只需要原发射器定义了合适的设置器(setter)，备忘录就能恢复原本状态。</li>
</ol>
<h4 id="试用场景-4"><a class="markdownIt-Anchor" href="#试用场景-4"></a> 试用场景</h4>
<ol>
<li>当需要创建对象状态快照来恢复其之前的状态时，可以使用备忘录模式。</li>
<li>当直接访问对象的成员变量、获取器或设置器将导致封装被突破时，可以使用该模式。
<ol>
<li>备忘录让对象自行负责创建其状态的快照。任何其他对象都不能读取快照，这有效地保障了数据的安全性。</li>
</ol>
</li>
</ol>
<h4 id="优点-9"><a class="markdownIt-Anchor" href="#优点-9"></a> 优点</h4>
<ol>
<li>可以在不破坏对象封装情况的前提下创建对象状态快照。</li>
<li>可以通过让负责人维护原发器状态历史记录来简化原发器代码。</li>
</ol>
<h4 id="缺点-10"><a class="markdownIt-Anchor" href="#缺点-10"></a> 缺点</h4>
<ol>
<li>如果客户端过于频繁地创建备忘录，程序将消耗大量内存。</li>
<li>负责人必须完整跟踪原发器的生命周期，这样才能销毁弃用的备忘录。</li>
<li>绝大部分动态编程语言（例如 PHP、Python 和 JavaScript）不能确保备忘录中的状态不被修改。</li>
</ol>
<h4 id="combo-11"><a class="markdownIt-Anchor" href="#combo-11"></a> Combo</h4>
<ol>
<li>可以同时使用命令模式和备忘录模式来实现 “撤销”。在这种情况下，命令用于对目标对象执行各种不同的操作，备忘录用来保存一条命令执行前该对象的状态。</li>
<li>你可以同时使用备忘录和迭代器模式来获取当前迭代器的状态，并且在需要的时候进行回滚。</li>
<li>有时候原型模式可以作为备忘录的一个简化版本，其条件是需要在历史记录中存储的对象的状态比较简单，不需要链接其他外部资源，或者链接可以方便地重建。</li>
</ol>
<h3 id="观察者设计模式事件订阅者"><a class="markdownIt-Anchor" href="#观察者设计模式事件订阅者"></a> 观察者设计模式（事件订阅者）</h3>
<blockquote>
<p><strong>观察者模式</strong>是一种行为设计模式，允许你定义一种订阅机制，可在对象事件发生时通知多个观察该对象的其他对象</p>
</blockquote>
<p>订阅这模式脱胎于一个很日常的问题：</p>
<ol>
<li>某个商店将要上一批产品，但目前并不知道具体的开售时间。</li>
<li>部分顾客对该产品感兴趣，但部分用户不感兴趣</li>
</ol>
<p>那么如果我们不采用任何措施，也许对产品感兴趣的顾客，可能得连续几天都到店询问是否到货。</p>
<p>商店还能采取一种措施：到货了之后，向所有注册用户发送邮件。</p>
<p>第一种方案会造成不必要的时间浪费，也很大程度上会导致顾客错过商品；第二种方案，对产品不感兴趣的用户也会受到邮件，这将造成不必要的骚扰。</p>
<p>于是观察者模式应运而生。</p>
<p>商店可以先对顾客收集意向，当产品到货之后，只向有意向的顾客发送邮件。这就避免了时间的浪费，以及不必要的骚扰。</p>
<p>观察者模式类图如下：</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/observer/structure.png?id=365b7e2b8fbecc8948f34b9f8f16f33c' data-fancybox='default' data-caption='观察者模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/observer/structure.png?id=365b7e2b8fbecc8948f34b9f8f16f33c" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/observer/structure.png?id=365b7e2b8fbecc8948f34b9f8f16f33c" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="观察者模式类图" /></a><span class='image-caption'>观察者模式类图</span></div></div>
<ol>
<li>发布者Publisher: 会向其他对象发送事件通知。包含一个加入订阅和离开订阅的框架。事件会在发布者自身状态改变或执行特定行为后发生。
<ol>
<li>当新事件发生时，发送者会遍历订阅列表，并调用每个订阅这的更新方法。</li>
</ol>
</li>
<li>订阅者Subscriber: 订阅这接口，声明了通知接口。在绝大多数情况下包含一个update更新方法。该方法可以拥有多个参数，使发布者能在更新时传递时间的详细信息</li>
<li>具体订阅者ConcreteSubscribers: 可以执行一些操作来回应发布者的通知。所有具体订阅者类都实现了同样的接口，以达到将发布者与具体的类解耦的目的。
<ol>
<li>订阅者通常需要一些上下文信息来正确处理更新。硬吃发布者会将上下文传递给更新方法，发布者甚至可以将自身作为参数传递给更新方法，使订阅者直接获取所需的数据。</li>
</ol>
</li>
</ol>
<p>我们熟知的Vue中，数据双向绑定就是使用观察者模式实现的。下面我们也来简单的实现一下观察者模式：</p>
<ol>
<li>首先我们需要一个发布者接口，它定义了一个普通对象要被当做发布者应该具有的方法：
<ol>
<li>增加订阅</li>
<li>删除订阅</li>
<li>通知订阅者</li>
</ol>
</li>
<li>随后我们实现一个带有状态的类，然后让他实现发布者接口，成为发布者，此外他需要一个可以修改自身状态的业务方法</li>
<li>其次我们需要一个订阅者接口，它定义了一个普通对象成为订阅者需要实现的方法：
<ol>
<li>更新函数（副作用函数）</li>
</ol>
</li>
<li>最后我们实现一个类，然后让他实现订阅者接口，称为订阅者</li>
</ol>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 发布者接口，定义收集，分发，通知方法</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Publisher</span> &#123;</span><br><span class="line">    <span class="title function_">attach</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">detach</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">notify</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 观察者接口，定义更新方法（副作用函数）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="title function_">update</span>(<span class="attr">publish</span>: <span class="title class_">Publisher</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcretePublisher</span> <span class="keyword">implements</span> <span class="title class_">Publisher</span> &#123;</span><br><span class="line">    <span class="comment">// 发布者具有的状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">state</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">// 收集订阅者</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">observers</span>: <span class="title class_">Observer</span>[];</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">state</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = state;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observers</span> = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增加</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">attach</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isExit = <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">indexOf</span>(observer) === -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (isExit)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">                <span class="string">&quot;Publisher: Observer has been attached already.&quot;</span></span><br><span class="line">            );</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Publisher: Attached an observer.&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">push</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">detach</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> observerIndex = <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">indexOf</span>(observer);</span><br><span class="line">        <span class="keyword">if</span> (observerIndex === -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Publisher: Nonexistent observer.&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">splice</span>(observerIndex, <span class="number">1</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Publisher: Detached an observer.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通知</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">notify</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Publisher: Notifying observers...&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> observer <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">observers</span>) &#123;</span><br><span class="line">            observer.<span class="title function_">update</span>(<span class="variable language_">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 模拟业务逻辑改变发布者的状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doSomething</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\nPublisher: I&#x27;m doing something important.&quot;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (<span class="number">10</span> + <span class="number">1</span>));</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Publisher: My state has just changed to: <span class="subst">$&#123;<span class="variable language_">this</span>.state&#125;</span>`</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">notify</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverA</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">update</span>(<span class="attr">publish</span>: <span class="title class_">Publisher</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (publish <span class="keyword">instanceof</span> <span class="title class_">ConcretePublisher</span> &amp;&amp; publish.<span class="property">state</span> &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ConcreteObserverA: Reacted to the event.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverB</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">update</span>(<span class="attr">publish</span>: <span class="title class_">Publisher</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (publish <span class="keyword">instanceof</span> <span class="title class_">ConcretePublisher</span> &amp;&amp; publish.<span class="property">state</span> &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ConcreteObserverB: Reacted to the event.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> publisher = <span class="keyword">new</span> <span class="title class_">ConcretePublisher</span>(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> observer1 = <span class="keyword">new</span> <span class="title class_">ConcreteObserverA</span>();</span><br><span class="line">publisher.<span class="title function_">attach</span>(observer1);</span><br><span class="line"><span class="keyword">const</span> observer2 = <span class="keyword">new</span> <span class="title class_">ConcreteObserverB</span>();</span><br><span class="line">publisher.<span class="title function_">attach</span>(observer2);</span><br><span class="line"></span><br><span class="line">publisher.<span class="title function_">doSomething</span>();</span><br><span class="line">publisher.<span class="title function_">doSomething</span>();</span><br><span class="line"></span><br><span class="line">publisher.<span class="title function_">detach</span>(observer2);</span><br><span class="line"></span><br><span class="line">publisher.<span class="title function_">doSomething</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Publisher: Observer has been attached already.</span></span><br><span class="line"><span class="comment">// Publisher: Observer has been attached already.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Publisher: I&#x27;m doing something important.</span></span><br><span class="line"><span class="comment">// Publisher: My state has just changed to: 8</span></span><br><span class="line"><span class="comment">// Publisher: Notifying observers...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Publisher: I&#x27;m doing something important.</span></span><br><span class="line"><span class="comment">// Publisher: My state has just changed to: 5</span></span><br><span class="line"><span class="comment">// Publisher: Notifying observers...</span></span><br><span class="line"><span class="comment">// Publisher: Nonexistent observer.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Publisher: I&#x27;m doing something important.</span></span><br><span class="line"><span class="comment">// Publisher: My state has just changed to: 3</span></span><br><span class="line"><span class="comment">// Publisher: Notifying observers...</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="适用场景-3"><a class="markdownIt-Anchor" href="#适用场景-3"></a> 适用场景</h4>
<ol>
<li>当一个对象状态的改变需要改变其他对象，或实际对象是事先未知的或动态变化的时，可使用观察者模式。
<ol>
<li>后者的一个例子是：你创建了自定义按钮类并允许客户端在按钮中注入自定义代码，这样当用户按下按钮时就会触发这些代码。</li>
</ol>
</li>
<li>当应用中的一些对象必须观察其他对象时，可使用该模式。但仅能在有限时间内或特定情况下使用。</li>
</ol>
<h4 id="优点-10"><a class="markdownIt-Anchor" href="#优点-10"></a> 优点</h4>
<ol>
<li>符合开闭原则。无需修改发布者代码就能引入新的订阅者类 （如果是发布者接口则可轻松引入发布者类）。</li>
<li>可以在运行时建立对象之间的联系。</li>
</ol>
<h4 id="缺点-11"><a class="markdownIt-Anchor" href="#缺点-11"></a> 缺点</h4>
<ol>
<li>订阅者的通知顺序是随机的。</li>
</ol>
<h4 id="combo-12"><a class="markdownIt-Anchor" href="#combo-12"></a> Combo</h4>
<ol>
<li><strong>责任链</strong>模式、<strong>命令</strong>模式、<strong>中介者</strong>模式和<strong>观察者</strong>模式用于处理请求发送者和接收者之间的不同连接方式。</li>
<li><strong>中介者</strong>和<strong>观察者</strong>之间的区别往往很难记住。在大部分情况下，可以使用其中一种模式，而有时可以同时使用。</li>
</ol>
<h3 id="状态模式"><a class="markdownIt-Anchor" href="#状态模式"></a> 状态模式</h3>
<blockquote>
<p>状态模式是一种行为设计模式，让你能在一个对象的内部状态变化时改变其行为，使其看上去就像改变了自身所属的类一样。</p>
</blockquote>
<p>状态模式实际上与**<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_34375251/article/details/87997180">有限状态机</a>**这一概念息息相关。JS种的Promise就是一个具有四种状态的有限状态机。这里不做展开。我们通过下面的例子来感受一下：</p>
<ol>
<li>我们需要实现一个文档类</li>
<li>文档类可能处于三种状态：
<ol>
<li>草稿</li>
<li>审核中</li>
<li>已发布</li>
</ol>
</li>
<li>文档类需要包含一个publish发布方法，但该方法在不同的状态时逻辑不同：
<ol>
<li>处于草稿状态时，调用publish，文档变为审核中状态</li>
<li>处于审核中状态时，调用publish，会进行身份认证，若为管理员者将文档变为发布状态</li>
<li>处于发布状态时，调用publish，不会进行任何操作</li>
</ol>
</li>
</ol>
<p>上述文档类就能看作一个三个状态的有限状态机。因此我们简单概括一下就能得到有限状态机的定义：</p>
<div class="note info"><p>程序在任意时刻处于几种有限的状态中，在任何状态下程序的行为并不相同，并且可瞬间从一个状态变换到另一个，或保持不变。这种状态切换称为转移</p></div>
<p>接下来我们在回到上面的例子，如果我们想要实现这一案例，我能该怎么做？</p>
<p>最简单的方法一定是通过<code>if...else</code>或者<code>switch</code>等条件运算符实现。但当我们逐步在文档类中添加更多状态和依赖于状态的行为后，大部分方法中将会包含复杂的条件语句。修改其转换逻辑可能会涉及到修改所有方法中的状态条件语句，导致代码维护困难。</p>
<p>状态模式建议为对象的所有可能状态新建一个类， 然后将所有状态的对应行为抽取到这些类中。</p>
<div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='default'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" target="_blank" rel="noopener" href='https://refactoringguru.cn/images/patterns/diagrams/state/structure-zh.png' data-fancybox='default' data-caption='状态模式类图'><img fancybox itemprop="contentUrl" src="https://refactoringguru.cn/images/patterns/diagrams/state/structure-zh.png" class="lazyload placeholder" data-srcset="https://refactoringguru.cn/images/patterns/diagrams/state/structure-zh.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg" alt="状态模式类图" /></a><span class='image-caption'>状态模式类图</span></div></div>
<ol>
<li>上下文Context: 有限状态机本身，包含一个对当前状态对象的引用，将与当前状态相关的工作委派给状态对象，并提供一个改变当前状态对象的接口。</li>
<li>状态State: 状态接口，声明特定于这一状态的方法。</li>
<li>具体状态ConcreteStates: 实现特定于状态的方法。为了避免多个状态中包含相似代码，可以提供一个封装有部分通用行为的中间抽象类。状态对象可存储对于上下文对象的反向引用。状态可以通过该引用从上下文处获取所需信息，并且能触发状态转移。</li>
<li>上下文和具体状态都可以设置上下文的下个状态，并可通过替换连接到上下文的状态对象来完成实际的状态转换。</li>
</ol>
<p>根据上述类图我们可以尝试实现一个状态模式Demo：</p>
<details yellow><summary> 点击查看代码 </summary>
              <div class='content'>
              <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 状态接口</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="attr">context</span>: <span class="title class_">Context</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setContext</span>(<span class="params"><span class="attr">context</span>: <span class="title class_">Context</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">context</span> = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="title function_">handle1</span>(): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="title function_">handle2</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">state</span>: <span class="title class_">State</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"><span class="attr">state</span>: <span class="title class_">State</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">transitionTo</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 状态转移</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">transitionTo</span>(<span class="params"><span class="attr">state</span>: <span class="title class_">State</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Context: Transition to <span class="subst">$&#123;(&lt;<span class="built_in">any</span>&gt;state).constructor.name&#125;</span>.`</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = state;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span>.<span class="title function_">setContext</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 业务1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">request1</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span>.<span class="title function_">handle1</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 业务2</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">request2</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span>.<span class="title function_">handle2</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 具体状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteStateA</span> <span class="keyword">extends</span> <span class="title class_ inherited__">State</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">handle1</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ConcreteStateA handles request1.&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ConcreteStateA wants to change the state of the context.&quot;</span>);</span><br><span class="line">        <span class="comment">// 转移到下一状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">transitionTo</span>(<span class="keyword">new</span> <span class="title class_">ConcreteStateB</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">handle2</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ConcreteStateA handles request2.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteStateB</span> <span class="keyword">extends</span> <span class="title class_ inherited__">State</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">handle1</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ConcreteStateB handles request1.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">handle2</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ConcreteStateB handles request2.&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ConcreteStateB wants to change the state of the context.&quot;</span>);</span><br><span class="line">        <span class="comment">// 转移到下一状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">transitionTo</span>(<span class="keyword">new</span> <span class="title class_">ConcreteStateA</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> context = <span class="keyword">new</span> <span class="title class_">Context</span>(<span class="keyword">new</span> <span class="title class_">ConcreteStateA</span>());</span><br><span class="line">context.<span class="title function_">request1</span>();</span><br><span class="line">context.<span class="title function_">request2</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Context: Transition to ConcreteStateA.</span></span><br><span class="line"><span class="comment">// ConcreteStateA handles request1.</span></span><br><span class="line"><span class="comment">// ConcreteStateA wants to change the state of the context.</span></span><br><span class="line"><span class="comment">// Context: Transition to ConcreteStateB.</span></span><br><span class="line"><span class="comment">// ConcreteStateB handles request2.</span></span><br><span class="line"><span class="comment">// ConcreteStateB wants to change the state of the context.</span></span><br><span class="line"><span class="comment">// Context: Transition to ConcreteStateA.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
              </div>
            </details>
<h4 id="试用场景-5"><a class="markdownIt-Anchor" href="#试用场景-5"></a> 试用场景</h4>
<ol>
<li>如果对象需要根据自身当前状态进行不同行为，同时状态的数量非常多且与状态相关的代码会频繁变更的话，可使用状态模式。</li>
<li>如果某个类需要根据成员变量的当前值改变自身行为，从而需要使用大量的条件语句时，可使用该模式。</li>
<li>当相似状态和基于条件的状态机转换中存在许多重复代码时，可使用状态模式。</li>
</ol>
<h4 id="优点-11"><a class="markdownIt-Anchor" href="#优点-11"></a> 优点</h4>
<ol>
<li>符合单一职责原则。将与特定状态相关的代码放在单独的类中。</li>
<li>符合开闭原则。无需修改已有状态类和上下文就能引入新状态。</li>
<li>通过消除臃肿的状态机条件语句简化上下文代码。</li>
</ol>
<h4 id="缺点-12"><a class="markdownIt-Anchor" href="#缺点-12"></a> 缺点</h4>
<ol>
<li>如果状态机只有很少的几个状态，或者很少发生改变，那么应用该模式可能会显得小题大作。</li>
</ol>
<h4 id="combo-13"><a class="markdownIt-Anchor" href="#combo-13"></a> Combo</h4>
<ol>
<li><strong>桥接</strong>模式、<strong>状态</strong>模式和<strong>策略</strong>模式（在某种程度上包括适配器模式）模式的接口非常相似。实际上，它们都基于<strong>组合模式</strong>——即将<strong>工作委派</strong>给其他对象， 不过也各自解决了不同的问题。</li>
<li><strong>状态</strong>可被视为<strong>策略</strong>的扩展。两者都基于组合机制： 它们都通过将部分工作委派给 “帮手” 对象来改变其在不同情景下的行为。
<ol>
<li>策略使得这些对象相互之间完全独立，它们不知道其他对象的存在。</li>
<li>状态模式没有限制具体状态之间的依赖，且允许它们自行改变在不同情景下的状态。</li>
</ol>
</li>
</ol>
<h3 id="策略模式"><a class="markdownIt-Anchor" href="#策略模式"></a> 策略模式</h3>

  </div>
  
  
    
    <div class='footer'>
       <!-- 参考资料、相关资料等 -->
      
       <!-- 相关文章 -->
      
      <!-- 版权声明组件 -->
      
        
          <div class='copyright'>
            <blockquote>
              
                
                  <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

                
              
                
                  <p>本文永久链接是：<a href="http://enderxiao.github.io/2024/04/11/JS设计模式/">http://enderxiao.github.io/2024/04/11/JS设计模式/</a></p>
                
              
            </blockquote>
          </div>
        
      
      <!-- 打赏组件 -->
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateModified" datetime="2024-07-30T19:26:33+08:00">
  <a class='notlink'>
    <i class="fa-solid fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：Jul 30, 2024</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/life/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>life</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>设计模式</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E5%89%8D%E7%AB%AF/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>前端</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/JS/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>JS</p></a></div>
  <span hidden itemprop="keywords">life 设计模式 前端 JS</span>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://enderxiao.github.io/2024/04/11/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/&title=JS设计模式 - Ender&summary=设计模式收集使用JS实现，参考JS设计模式Github仓库以及书《JavaScript设计模式与开发实践》曾探著"
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qq.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qq.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://enderxiao.github.io/2024/04/11/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/&title=JS设计模式 - Ender&summary=设计模式收集使用JS实现，参考JS设计模式Github仓库以及书《JavaScript设计模式与开发实践》曾探著"
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qzone.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qzone.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://service.weibo.com/share/share.php?url=http://enderxiao.github.io/2024/04/11/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/&title=JS设计模式 - Ender&summary=设计模式收集使用JS实现，参考JS设计模式Github仓库以及书《JavaScript设计模式与开发实践》曾探著"
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/weibo.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/weibo.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
          
        </a>
      
    
      
    
      
        <a class="-mob-share-telegram" title="" rel="external nofollow noopener noreferrer noopener"
          
            target="_blank" href="https://t.me/share/url?url=http://enderxiao.github.io/2024/04/11/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/&text=JS设计模式 - Ender"
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/telegram.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/telegram.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
    <!-- Custom Files bottomMeta begin -->
    
    <!-- Custom Files bottomMeta end -->
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/2024/06/21/React%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/'>
          <p class='title'><i class="fa-solid fa-chevron-left" aria-hidden="true"></i>React源码阅读</p>
          <p class='content'>React进阶学习

 源码阅读流程

下载源码
观察package.json：

主要使用的依赖
构建相关的脚本


根据核心API找寻结构：

packages/react
packages...</p>
        </a>
      
      
        <a class='next' href='/2024/04/01/docker%E5%AD%A6%E4%B9%A0/'>
          <p class='title'>docker学习<i class="fa-solid fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>docker学习

 Docker解决的问题

部署流程反锁
环境不一致（开发、测试、预发布、线上）
资源隔离问题
交付流程复杂

 Docker
 核心概念
Docker(Moby)诞生于20...</p>
        </a>
      
    </div>
  
  <!-- Custom Files postEnd begin-->
  
  <!-- Custom Files postEnd end-->
</article>


  


  <article class="post white-box shadow floatable blur" id="comments">
    <span hidden>
      <meta itemprop="discussionUrl" content="/2024/04/11/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html#comments">
    </span>
    <p ct><i class='fa-solid fa-comments'></i> 评论</p>
    

    <div id="layoutHelper-comments"></div>

  </article>






</div>
<aside id='l_side' itemscope itemtype="http://schema.org/WPSideBar">
  

  
    
    
      
    
  


<div class="widget-sticky pjax">

  
  


  <section class="widget toc-wrapper desktop mobile " id="toc-div" >
    
  <header>
    
      <i class="fa-solid fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 设计模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-text"> 设计模式六大原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 创建型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8Fsingleton-pattern"><span class="toc-text"> 单例模式（Singleton Pattern）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 工厂设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 简单工厂模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 工厂模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 抽象工厂模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BC%95%E7%94%A8"><span class="toc-text"> 实际引用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 原型设计模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 生成器设计模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 适配器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-text"> 对象适配器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-text"> 类适配器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text"> 使用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 桥接模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text"> 适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 过滤器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8A%BF"><span class="toc-text"> 优势</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 组合设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8A%BF-2"><span class="toc-text"> 优势</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-2"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 装饰设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-text"> 适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-2"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-3"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 外观设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-text"> 使用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-2"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-3"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-4"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 享元模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-text"> 示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="toc-text"> 使用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-3"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-4"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-5"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text"> 试用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-4"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-5"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-6"><span class="toc-text"> Combo</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 行为型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8Fchain-of-responsibility-pattern"><span class="toc-text"> 责任链模式(Chain of Responsibility Pattern)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-text"> 试用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-5"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-6"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-7"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="toc-text"> 试用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-6"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-7"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-8"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 迭代器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text"> 应用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-7"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-8"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-9"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8Finterpreter-pattern"><span class="toc-text"> 解释器模式Interpreter Pattern</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 中介模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="toc-text"> 使用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-8"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-9"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-10"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 备忘录模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%B5%8C%E5%A5%97%E5%AE%9E%E7%8E%B0"><span class="toc-text"> 基于嵌套实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E4%B8%AD%E9%97%B4%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-text"> 基于中间接口实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E4%B8%BA%E4%B8%A5%E6%A0%BC%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text"> 更为严格的实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="toc-text"> 试用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-9"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-10"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-11"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%BA%8B%E4%BB%B6%E8%AE%A2%E9%98%85%E8%80%85"><span class="toc-text"> 观察者设计模式（事件订阅者）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="toc-text"> 适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-10"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-11"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-12"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 状态模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%95%E7%94%A8%E5%9C%BA%E6%99%AF-5"><span class="toc-text"> 试用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-11"><span class="toc-text"> 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-12"><span class="toc-text"> 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#combo-13"><span class="toc-text"> Combo</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text"> 策略模式</span></a></li></ol></li></ol>
    </div>
  </section>

  

</div>


<!-- 没有 pjax 占位会报错 万恶的 pjax -->

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <!-- Custom Files side begin -->
  
  <!-- Custom Files side end -->
</aside>



          <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<pjax>
<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  pdata.commentConfig={};
  //  see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs
  
    // header
    var l_header=document.getElementById("l_header");
    
    l_header.classList.add("show");
    
    
      // cover
      var cover_wrapper=document.querySelector('#l_cover .cover-wrapper');
      var scroll_down=document.getElementById('scroll-down');
      cover_wrapper.id="none";
      cover_wrapper.style.display="none";
      scroll_down.style.display="none";
    
  
</script>
</pjax>
        </div>
        
  
  <footer class="footer clearfix"  itemscope itemtype="http://schema.org/WPFooter">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.3'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='320px'
      server='netease'
      type='playlist'
      id='2674113840'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper" itemprop="about" itemscope itemtype="http://schema.org/Thing">
          
            
          
            
          
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        
          <div><p><span id="lc-sv">本站总访问量为 <span id='number'><i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i></span> 次</span> <span id="lc-uv">访客数为 <span id='number'><i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i></span> 人</span></p>
</div>
        
      
    
      
        Use
        <a href="https://github.com/volantis-x/hexo-theme-volantis/#5.8.0" target="_blank" class="codename">Volantis</a>
        as theme
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright © since 2017 XXX</a></p>

        </div>
      
    
    <!-- Custom Files footer begin-->
    
    <!-- Custom Files footer end-->
  </footer>


        <a id="s-top" class="fa-solid fa-arrow-up fa-fw" href="/" onclick="return false;" title="top"></a>
      </div>
    </div>
    <div>
      <script>
  /******************** volantis.dom ********************************/
  // 页面选择器 将dom对象缓存起来 see: /source/js/app.js etc.
  volantis.dom.bodyAnchor = volantis.dom.$(document.getElementById("safearea")); // 页面主体
  volantis.dom.topBtn = volantis.dom.$(document.getElementById('s-top')); // 向上
  volantis.dom.wrapper = volantis.dom.$(document.getElementById('wrapper')); // 整个导航栏
  volantis.dom.coverAnchor = volantis.dom.$(document.querySelector('#l_cover .cover-wrapper')); // 1个
  volantis.dom.switcher = volantis.dom.$(document.querySelector('#l_header .switcher .s-search')); // 搜索按钮   移动端 1个
  volantis.dom.header = volantis.dom.$(document.getElementById('l_header')); // 移动端导航栏
  volantis.dom.search = volantis.dom.$(document.querySelector('#l_header .m_search')); // 搜索框 桌面端 移动端 1个
  volantis.dom.mPhoneList = volantis.dom.$(document.querySelectorAll('#l_header .m-phone .list-v')); //  手机端 子菜单 多个
</script>

<script>
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fortawesome/fontawesome-free/css/all.min.css");
  
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/font-awesome-animation/font-awesome-animation.min.css");
  
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/node-waves/dist/waves.min.css");
  
</script>

<!-- required -->

  
<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/jquery/dist/jquery.min.js"></script>



<!-- internal -->

<script src="/js/app.js"></script>





  













<div id="rightmenu-wrapper">
  <ul class="list-v rightmenu" id="rightmenu-content">
    
  <li class='navigation menuNavigation-Content'>


    <a class="nav icon-only fix-cursor-default" onclick="history.back()"><i class="fa-solid fa-arrow-left fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="history.forward()"><i class="fa-solid fa-arrow-right fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="window.location.reload()"><i class="fa-solid fa-redo fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="VolantisApp.scrolltoElement(volantis.dom.bodyAnchor)"><i class="fa-solid fa-arrow-up fa-fw"></i></a>


  </li>


    <hr class="menuLoad-Content" >



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyPaste" data-event="copyPaste" data-group="inputBox">
      <i class="fa-solid fa-paste fa-fw"></i>
      粘贴文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyAll" data-event="copyAll" data-group="inputBox">
      <i class="fa-solid fa-object-ungroup fa-fw"></i>
      全选文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyCut" data-event="copyCut" data-group="inputBox">
      <i class="fa-solid fa-cut fa-fw"></i>
      剪切文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyText" data-event="copyText" data-group="seletctText">
      <i class="fa-solid fa-copy fa-fw"></i>
      复制文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="searchWord" data-event="OpenSearch(__text__)" data-group="seletctText">
      <i class="fa-solid fa-search fa-fw"></i>
      站内搜索
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="bingSearch" data-event="window.open(`https://cn.bing.com/search?q=${__text__}`)" data-group="seletctText">
      <i class="fa-solid fa-search fa-fw"></i>
      必应搜索
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="openTab" data-event="window.open(__link__)" data-group="elementCheck">
      <i class="fa-solid fa-external-link-square-alt fa-fw"></i>
      新标签页打开
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyLink" data-event="copyLink" data-group="elementCheck">
      <i class="fa-solid fa-link fa-fw"></i>
      复制链接地址
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyImg" data-event="copyImg" data-group="elementImage">
      <i class="fa-solid fa-image fa-fw"></i>
      复制图片
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="googleImg" data-event="window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)" data-group="elementImage">
      <i class="fa-solid fa-images fa-fw"></i>
      谷歌识图
    </span>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="help" target="_blank" rel="noopener" href="https://volantis.js.org/faqs/" data-group="link">
      <i class="fa-solid fa-question fa-fw"></i>
      常见问题
    </a>
  </li>



    <hr class="menuLoad-Content" >



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="source_docs" target="_blank" rel="noopener" href="https://github.com/enderxiao/enderxiao.github.io/" data-group="link">
      <i class="fa-solid fa-code-branch fa-fw"></i>
      本站源码
    </a>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="source_theme" target="_blank" rel="noopener" href="https://github.com/volantis-x/hexo-theme-volantis/" data-group="link">
      <i class="fa-solid fa-code-branch fa-fw"></i>
      主题源码
    </a>
  </li>



    <hr class="menuLoad-Content" >



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="darkMode" data-event="volantis.dark.toggle()" data-group="darkMode">
      <i class="fa-solid fa-moon fa-fw"></i>
      暗黑模式
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="printMode" data-event="printMode" data-group="articlePage">
      <i class="fa-solid fa-print fa-fw"></i>
      打印页面
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="readMode" data-event="readMode" data-group="articlePage">
      <i class="fa-solid fa-book-open fa-fw"></i>
      阅读模式
    </span>
  </li>


<div id="menuMusic">
  <li class='music name menuOption-Content'>
    <p class='nav music-title fix-cursor-default'></p>
  </li>
  <li class='music ctrl'>
    <a class='nav icon-only backward fix-cursor-default' href="/" onclick="return false;" title="backward">
      <i class='fa-solid fa-step-backward fa-fw'></i>
    </a>
    <a class='nav icon-only toggle fix-cursor-default' href="/" onclick="return false;" title="toggle">
      <i class='fa-solid fa-play fa-fw'></i>
    </a>
    <a class='nav icon-only forward fix-cursor-default' href="/" onclick="return false;" title="forward">
      <i class='fa-solid fa-step-forward fa-fw'></i>
    </a>
  </li>
  <li class='music volume'>
    <div class='nav volume'>
      <div class="aplayer-volume-bar-wrap">
        <div class="aplayer-volume-bar fix-cursor-pointer">
          <div class="aplayer-volume"></div>
          <i class='left fa-solid fa-volume-off fa-fw'></i>
          <i class='right fa-solid fa-volume-up fa-fw'></i>
        </div>
      </div>
    </div>
  </li>
</div>

  </ul>
</div>
<script src="/js/plugins/rightMenus.js"></script>
<script>
  const RightMenusFunction = {};
  












  //RightMenusFunction['copyPaste'] = (fun) => {fun()}





  //RightMenusFunction['copyAll'] = (fun) => {fun()}





  //RightMenusFunction['copyCut'] = (fun) => {fun()}





  //RightMenusFunction['copyText'] = (fun) => {fun()}





  RightMenusFunction['searchWord'] = (__text__) => {OpenSearch(__text__)}





  RightMenusFunction['bingSearch'] = (__text__) => {window.open(`https://cn.bing.com/search?q=${__text__}`)}





  RightMenusFunction['openTab'] = (__link__) => {window.open(__link__)}





  //RightMenusFunction['copyLink'] = (fun) => {fun()}





  //RightMenusFunction['copyImg'] = (fun) => {fun()}





  RightMenusFunction['googleImg'] = (__link__) => {window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)}















  RightMenusFunction['darkMode'] = () => {volantis.dark.toggle()}





  //RightMenusFunction['printMode'] = (fun) => {fun()}





  //RightMenusFunction['readMode'] = (fun) => {fun()}





</script>



<!-- rightmenu要在darkmode之前（ToggleButton） darkmode要在comments之前（volantis.dark.push）-->

  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "color-scheme";
const rootElementDarkModeAttributeName = "color-scheme";
const setLS = (k, v) => {
    localStorage.setItem(k, v);
};
const removeLS = (k) => {
    localStorage.removeItem(k);
};
const getLS = (k) => {
    return localStorage.getItem(k);
};
const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};
const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};
const validColorModeKeys = {
  dark: true,
  light: true,
};
const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);
  getCustomDarkMode();
  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};
const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};
/**
 * get target mode
 */
 const getCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  if(currentSetting=="dark"){
    volantis.dark.mode="light";
  }else{
    volantis.dark.mode="dark";
  }
  // console.log(volantis.dark.mode)
};
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};
/**
 * 暗黑模式触发器
 */
volantis.dark.toggle=()=>{
  const mode = toggleCustomDarkMode();
  applyCustomDarkModeSettings(mode);
  // 使用 volantis.dark.push 方法传入volantis.dark.toggle回调函数 参见layout/_partial/scripts/global.ejs
  volantis.dark.method.toggle.start();
}
/**
 * bind event for toggle button
 */

function bindToggleButton() {
  var btn= document.querySelectorAll("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn")
  btn.forEach(function (e) {
    volantis.dom.$(e).on('click',volantis.dark.toggle);
  })
}
applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", ()=>{
  volantis.requestAnimationFrame(bindToggleButton)
});
volantis.pjax.push(bindToggleButton);

const darkModelListeners={
  dark:(mediaQueryList )=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "dark";
    }
    volantis.dark.method.toggle.start();
  },
  light:(mediaQueryList)=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "light";
    }
    volantis.dark.method.toggle.start();
  }
}
window.matchMedia('(prefers-color-scheme: dark)').addListener(darkModelListeners.dark)
window.matchMedia('(prefers-color-scheme: light)').addListener(darkModelListeners.light)
</script>




<script>
  function loadIssuesJS() {
    
      const sites_api = document.getElementById('sites-api');
      if (sites_api != undefined && typeof SitesJS === 'undefined') {
        volantis.js("/js/plugins/tags/sites.js")
      }
    
    
      const friends_api = document.getElementById('friends-api');
      if (friends_api != undefined && typeof FriendsJS === 'undefined') {
        volantis.js("/js/plugins/tags/friends.js")
      }
    
    
      const contributors_api = document.getElementById('contributors-api');
      if (contributors_api != undefined && typeof ContributorsJS === 'undefined') {
        volantis.js("/js/plugins/tags/contributors.js")
      }
    
  };
  loadIssuesJS()
  volantis.pjax.push(()=>{
    loadIssuesJS();
  })

</script>




  <script defer src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/vanilla-lazyload/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  

<script>
  window.FPConfig = {
	delay: 0,
	ignoreKeywords: ["#"],
	maxRPS: 6,
	hoverDelay: 0
  };
</script>
<script defer src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/flying-pages/flying-pages.min.js"></script>





   <script type="text/javascript">
  function pjax_scrollrebeal() {
    ScrollReveal().reveal("#l_main .reveal", {
      distance: "32px",
      duration: "800",
      interval: "20",
      scale: "0.9",
      easing: "ease-out",
    });
  }
  function init_scrollrebeal() {
    if (typeof ScrollReveal == "undefined") {
      volantis.requestAnimationFrame(init_scrollrebeal);
    } else {
      pjax_scrollrebeal();
    }
  }
  volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/scrollreveal/dist/scrollreveal.min.js");
  document.addEventListener("DOMContentLoaded", init_scrollrebeal);
  volantis.pjax.push(
    pjax_scrollrebeal,
    "pjax_scrollrebeal",
    (setRequestAnimationFrame = false)
  );
</script>




  <script>
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/aplayer/dist/APlayer.min.css");
  (async () => {
    // APlayer 需要在  MetingJS 之前加载
    await volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/aplayer/dist/APlayer.min.js")
    await volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/meting/dist/Meting.min.js")
  
    // 右键 music 需要在 APlayer  MetingJS 之后加载
    await volantis.js('/js/plugins/aplayer.js')
  
  })();

  function SetAPlayerPlugin(){
    let Metings = document.querySelectorAll('meting-js');
    if (Metings.length === 0) {return;};
    if (Metings[0].aplayer && Metings[0].aplayer.on) {
      // improve the accessibility https://web.dev/button-name/
      document.querySelectorAll(".aplayer-icon-menu").forEach(e=>{
        e.setAttribute("aria-label","Aplayer Menu")
      })
      // message see: /layout/_plugins/message/script.ejs
      
        try {
          setTimeout(() => {
            Metings.forEach((item, index) => {
              const aplayerItem = item.aplayer; if(!aplayerItem) return;
              const rightAplayerCheck = 'true' === 'true'
                && item.meta.id === '2674113840';
              if(rightAplayerCheck && typeof RightMenuAplayer !="undefined") RightMenuAplayer.checkAPlayer();
              if(aplayerItem.events.events.play.every(item => {return item.name !== 'messagePlay'})) {
                aplayerItem.on('play', function messagePlay() {
                  let index = aplayerItem.list.index;
                  let title = aplayerItem.list.audios[index].title;
                  let artist = aplayerItem.list.audios[index].artist;
                  setTimeout(() => {
                    VolantisApp.message('音乐通知', title + ' - ' + artist, {
                      icon: 'fa-solid fa-play',
                      transitionIn: 'flipInX',
                      transitionOut: 'flipOutX'
                    });
                  }, 100)
                });
              }
              if(aplayerItem.events.events.pause.every(item => {return item.name !== 'messagePause'})) {
                aplayerItem.on('pause', function messagePause() {
                  let index = aplayerItem.list.index;
                  let title = aplayerItem.list.audios[index].title;
                  let artist = aplayerItem.list.audios[index].artist;
                  setTimeout(() => {
                    // 歌曲播放结束也会触发 pause 事件，为了避免错误提示，等待一会儿
                    if(aplayerItem.paused) {
                      VolantisApp.message('音乐通知', title + ' - ' + artist, {
                        icon: 'fa-solid fa-pause',
                        transitionIn: 'flipInX',
                        transitionOut: 'flipOutX'
                      });
                    }
                  }, 100)
                });
              }
            });
          }, 500)
        } catch (error) { console.error(error); }
      
    }else{
      volantis.requestAnimationFrame(SetAPlayerPlugin)
    }
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    SetAPlayerPlugin();
  });
  volantis.pjax.push(SetAPlayerPlugin);
</script>




      <script>
  volantis.layoutHelper("comments",`<div id="giscus_container"></div>`)

  volantis.giscus = {};

  function check_giscus() {
    if (volantis.dark.mode === "dark") {
      volantis.giscus.Theme = 'dark';
    } else {
      volantis.giscus.Theme = 'light';
    }

    return document.getElementById("giscus_container");
  }

  function pjax_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;
    let cfg = Object.assign({"theme":{"light":"light","dark":"dark"},"repo":"EnderXiao/myrepo","repo-id":"R_kgDOH8NryQ","category":"General","category-id":"DIC_kwDOH8Nryc4CRPWQ","mapping":"pathname","reactions-enabled":"1","emit-metadata":"0","lang":"zh-CN"},pdata.commentConfig)
    const script = document.createElement('script');
    script.setAttribute('src', 'https://giscus.app/client.js');
    Object.keys(cfg).forEach(k=>{
      if (k != "theme") {
        script.setAttribute('data-'+k, cfg[k]);
      }
    })
    script.setAttribute('data-theme', volantis.giscus.Theme);
    script.setAttribute('crossorigin', "anonymous");
    HEAD.appendChild(script);
  }

  function dark_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;

    const message = {
      setConfig: {
        theme: volantis.giscus.Theme
      }
    };
    const giscusIframe = document.querySelector('iframe.giscus-frame');
    giscusIframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
  }
  pjax_giscus();
  volantis.pjax.push(pjax_giscus);
  volantis.dark.push(dark_giscus);
</script>

    





<!-- optional -->

  <script>
  const SearchServiceDataPathRoot = ("/" || "/").endsWith("/") ?
    "/" || "/" :
    "//" || "/";
  const SearchServiceDataPath = SearchServiceDataPathRoot + "content.json";

  function loadSearchScript() {
    // see: layout/_partial/scripts/_ctrl/cdnCtrl.ejs
    return volantis.js("/js/search/hexo.js");
  }

  function loadSearchService() {
    loadSearchScript();
    document.querySelectorAll(".input.u-search-input").forEach((e) => {
      e.removeEventListener("focus", loadSearchService, false);
    });

    document.querySelectorAll(".u-search-form").forEach((e) => {
      e.addEventListener("submit", (event) => {
        event.preventDefault();
      }, false);
    });
  }

  // 打开并搜索 字符串 s
  function OpenSearch(s) {
    if (typeof SearchService === 'undefined')
      loadSearchScript().then(() => {
        SearchService.setQueryText(s);
        SearchService.search();
      });
    else {
      SearchService.setQueryText(s);
      SearchService.search();
    }
  }

  // 访问含有 ?s=xxx  的链接时打开搜索 // 与搜索引擎 structured data 相关: /scripts/helpers/structured-data/lib/config.js
  if (window.location.search && /^\?s=/g.test(window.location.search)) {
    let queryText = decodeURI(window.location.search)
      .replace(/\ /g, "-")
      .replace(/^\?s=/g, "");
    OpenSearch(queryText);
  }

  // 搜索输入框获取焦点时加载搜索
  document.querySelectorAll(".input.u-search-input").forEach((e) => {
    e.addEventListener("focus", loadSearchService, false);
  });
</script>



  
<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/node-waves/dist/waves.min.js"></script>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function () {
  Waves.attach('.flat-btn', ['waves-button']);
  Waves.attach('.float-btn', ['waves-button', 'waves-float']);
  Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
  Waves.attach('.flat-box', ['waves-block']);
  Waves.attach('.float-box', ['waves-block', 'waves-float']);
  Waves.attach('.waves-image');
  Waves.init();
});
</script>



  
<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/comment_typing/comment_typing.js"></script>




  <script>



  function pjax_highlightjs_copyCode(){
    if (!(document.querySelector(".highlight .code pre") ||
      document.querySelector(".article pre code"))) {
      return;
    }
    VolantisApp.utilCopyCode(".highlight .code pre, .article pre code")
  }
  volantis.requestAnimationFrame(pjax_highlightjs_copyCode)
  volantis.pjax.push(pjax_highlightjs_copyCode)

</script>




  <script defer>

  const LCCounter = {
    app_id: 'u9j57bwJod4EDmXWdxrwuqQT-MdYXbMMI',
    app_key: 'jfHtEKVE24j0IVCGHbvuFClp',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'http://enderxiao.github.io' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'http://enderxiao.github.io' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'http://enderxiao.github.io' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.custom_api_server || `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script>








  <script>
  let imgs = ["https://z3.ax1x.com/2021/08/05/fegggS.jpg"];
  let index = 0;
  let IntervalParallax = null;

  function parallax(){
    let ParallaxWindow = document.querySelector("#parallax-window");
    
    Parallax.window = ParallaxWindow;
    Parallax.options.fade = 1500;
    Parallax.cache = 1;
    next_parallax();
    Parallax.init();
    if (imgs.length>1) {
      IntervalParallax = setInterval(function () {
        next_parallax();
      }, '10000');
    }
  }

  function next_parallax() {
    if (typeof Parallax == "undefined") {
      return
    }
    
      if (!document.querySelector("#full")&&!document.querySelector("#half")) {
        return
      }
    
    if (imgs.length>=1) {
      Parallax.options.src = imgs[index % imgs.length];
      Parallax.start();
      index++;
      if (Parallax.cache) {
        fetch(imgs[index % imgs.length] +"?t=" + new Date().getTime());
        if (index == imgs.length) {
          Parallax.cache = 0;
        }
      }
    }
  }
  var runningOnBrowser = typeof window !== "undefined";
  var isBot = runningOnBrowser && !("onscroll" in window) || typeof navigator !== "undefined" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);
  if (!isBot) {
    volantis.js('/js/plugins/parallax.js').then(()=>{
      parallax()
    })
    volantis.pjax.send(()=>{
      clearInterval(IntervalParallax)
    },"clearIntervalParallax");
    volantis.pjax.push(parallax);
  }
</script>




  <script>
  function load_swiper() {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/swiper/swiper-bundle.min.css");
    volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/swiper/swiper-bundle.min.js").then(() => {
      pjax_swiper();
    });
  }

  load_swiper();

  function pjax_swiper() {
    volantis.swiper = new Swiper('.swiper-container', {
      slidesPerView: 'auto',
      spaceBetween: 8,
      centeredSlides: true,
      loop: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    });
  }

  volantis.pjax.push(() => {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    if (typeof volantis.swiper === "undefined") {
      load_swiper();
    } else {
      pjax_swiper();
    }
  });
</script>


<!-- pjax 标签必须存在于所有页面 否则 pjax error -->
<pjax>

        <script>
  // https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/math/mathjax.swig
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = "https://unpkg.com/volantis-static@0.0.1654736714924/libs/mathjax/es5/tex-mml-chtml.js";
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    // 文章章节标题不能为 “MathJax” ，否则会报错。
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typesetPromise();
  }
</script>



</pjax>

<script>
  function listennSidebarTOC() {
    const navItems = document.querySelectorAll(".toc li");
    if (!navItems.length) return;
    let targets = []
    const sections = [...navItems].map((element) => {
      const link = element.querySelector(".toc-link");
      const target = document.getElementById(
        decodeURI(link.getAttribute("href")).replace("#", "")
      );
      targets.push(target)
      // 解除 a 标签 href 的 锚点定位, a 标签 href 的 锚点定位 会随机启用?? 产生错位???
      link.setAttribute("onclick","return false;")
      link.setAttribute("toc-action","toc-"+decodeURI(link.getAttribute("href")).replace("#", ""))
      link.setAttribute("href","/")
      // 配置 点击 触发新的锚点定位
      link.addEventListener("click", (event) => {
        event.preventDefault();
        // 这里的 addTop 是通过错位使得 toc 自动展开.
        volantis.scroll.to(target,{addTop: 5, observer:true})
        // Anchor id
        history.pushState(null, document.title, "#" + target.id);
      });
      return target;
    });

    function activateNavByIndex(target) {
      if (target.classList.contains("active-current")) return;

      document.querySelectorAll(".toc .active").forEach((element) => {
        element.classList.remove("active", "active-current");
      });
      target.classList.add("active", "active-current");
      let parent = target.parentNode;
      while (!parent.matches(".toc")) {
        if (parent.matches("li")) parent.classList.add("active");
        parent = parent.parentNode;
      }
    }

    // 方案一：
    volantis.activateNavIndex=0
    activateNavByIndex(navItems[volantis.activateNavIndex])
    volantis.scroll.push(()=>{
      if (targets[0].getBoundingClientRect().top >= 0) {
        volantis.activateNavIndex = 0
      }else if (targets[targets.length-1].getBoundingClientRect().top < 0) {
        volantis.activateNavIndex = targets.length-1
      } else {
        for (let index = 0; index < targets.length; index++) {
          const target0 = targets[index];
          const target1 = targets[(index+1)%targets.length];
          if (target0.getBoundingClientRect().top < 0&&target1.getBoundingClientRect().top >= 0) {
            volantis.activateNavIndex=index
            break;
          }
        }
      }
      activateNavByIndex(navItems[volantis.activateNavIndex])
    })

    // 方案二：
    // IntersectionObserver 不是完美精确到像素级别 也不是低延时性的
    // function findIndex(entries) {
    //   let index = 0;
    //   let entry = entries[index];
    //   if (entry.boundingClientRect.top > 0) {
    //     index = sections.indexOf(entry.target);
    //     return index === 0 ? 0 : index - 1;
    //   }
    //   for (; index < entries.length; index++) {
    //     if (entries[index].boundingClientRect.top <= 0) {
    //       entry = entries[index];
    //     } else {
    //       return sections.indexOf(entry.target);
    //     }
    //   }
    //   return sections.indexOf(entry.target);
    // }
    // function createIntersectionObserver(marginTop) {
    //   marginTop = Math.floor(marginTop + 10000);
    //   let intersectionObserver = new IntersectionObserver(
    //     (entries, observe) => {
    //       let scrollHeight = document.documentElement.scrollHeight;
    //       if (scrollHeight > marginTop) {
    //         observe.disconnect();
    //         createIntersectionObserver(scrollHeight);
    //         return;
    //       }
    //       let index = findIndex(entries);
    //       activateNavByIndex(navItems[index]);
    //     }, {
    //       rootMargin: marginTop + "px 0px -100% 0px",
    //       threshold: 0,
    //     }
    //   );
    //   sections.forEach((element) => {
    //     element && intersectionObserver.observe(element);
    //   });
    // }
    // createIntersectionObserver(document.documentElement.scrollHeight);
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    volantis.requestAnimationFrame(listennSidebarTOC)
  });
  document.addEventListener("pjax:success", ()=>{
    volantis.requestAnimationFrame(listennSidebarTOC)
  });
</script>



<script>
  document.onreadystatechange = function () {
    if (document.readyState == 'complete') {
      // 页面加载完毕 样式加载失败，或是当前网速慢，或是开启了省流模式
      const { saveData, effectiveType } = navigator.connection || navigator.mozConnection || navigator.webkitConnection || {}
      if (getComputedStyle(document.querySelector("#safearea"), null)["display"] == "none" || saveData || /2g/.test(effectiveType)) {
        document.querySelectorAll(".reveal").forEach(function (e) {
          e.style["opacity"] = "1";
        });
        document.querySelector("#safearea").style["display"] = "block";
      }
    }
  }
</script>


  <script type="application/ld+json">[{"@context":"http://schema.org","@type":"Organization","name":"Ender","url":"http://enderxiao.github.io/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},{"@context":"http://schema.org","@type":"Person","name":"John Doe","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://enderxiao.github.io/","sameAs":["https://github.com/volantis-x"],"description":"a blog of EnderXiao"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"http://enderxiao.github.io/","name":"Ender"}},{"@type":"ListItem","position":2,"item":{"@id":"http://enderxiao.github.io/categories/前端/","name":"前端"}},{"@type":"ListItem","position":2,"item":{"@id":"http://enderxiao.github.io/categories/前端/设计模式/","name":"设计模式"}},{"@type":"ListItem","position":3,"item":{"@id":"http://enderxiao.github.io/2024/04/11/JS设计模式/","name":"JS设计模式"}}]},{"@context":"http://schema.org","@type":"WebSite","name":"Ender","url":"http://enderxiao.github.io/","keywords":"Blog EnderXiao","description":"a blog of EnderXiao","author":{"@type":"Person","name":"John Doe","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://enderxiao.github.io/","description":"a blog of EnderXiao"},"publisher":{"@type":"Organization","name":"Ender","url":"http://enderxiao.github.io/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"potentialAction":{"@type":"SearchAction","name":"Site Search","target":{"@type":"EntryPoint","urlTemplate":"http://enderxiao.github.io?s={search_term_string}"},"query-input":"required name=search_term_string"}},{"@context":"http://schema.org","@type":"BlogPosting","headline":"JS设计模式","description":"设计模式收集使用JS实现，参考JS设计模式Github仓库以及书《JavaScript设计模式与开发实践》曾探著","inLanguage":["en","zh-CN","zh-HK","zh-TW","default"],"mainEntityOfPage":{"@type":"WebPage","@id":"http://enderxiao.github.io/2024/04/11/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},"author":{"@type":"Person","name":"John Doe","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://enderxiao.github.io/"},"publisher":{"@type":"Organization","name":"Ender","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"url":"http://enderxiao.github.io/2024/04/11/JS%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","wordCount":56,"datePublished":"2024-04-11T06:11:11.000Z","dateModified":"2024-07-30T11:26:33.909Z","articleSection":"前端","keywords":"life,设计模式,前端,JS","image":{"@type":"ImageObject","url":"https://s11.ax1x.com/2022/03/13/bqYfFH.jpg","width":1024,"height":768}}]</script>



      
        <!--
  pjax重载区域接口：
  1.  <pjax></pjax> 标签 pjax 标签必须存在于所有页面 否则 pjax error
  2.  script[data-pjax]
  3.  .pjax-reload script
  4.  .pjax
-->



<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/pjax/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox]):not([onclick="return false;"]):not([onclick="return!1"]):not([target="_blank"]):not([target="view_window"]):not([href$=".xml"])',
        selectors: [
          "head title",
          "head meta[name=keywords]",
          "head meta[name=description]",
          
          "#l_main",
          "#pjax-header-nav-list",
          ".pjax",
          "pjax", // <pjax></pjax> 标签
          "script[data-pjax], .pjax-reload script" // script标签添加data-pjax 或 script标签外层添加.pjax-reload 的script代码段重载
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000,
        
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      // 使用 volantis.pjax.send 方法传入pjax:send回调函数 参见layout/_partial/scripts/global.ejs
      volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      // 使用 volantis.pjax.push 方法传入重载函数 参见layout/_partial/scripts/global.ejs
      volantis.pjax.method.complete.start();
    });

    document.addEventListener('pjax:error', function (e) {
      if(volantis.debug) {
        console.error(e);
        console.log('pjax error: \n' + JSON.stringify(e));
      }else{
        // 使用 volantis.pjax.error 方法传入pjax:error回调函数 参见layout/_partial/scripts/global.ejs
        volantis.pjax.method.error.start();
        window.location.href = e.triggerElement.href;
      }
    });
</script>

      
    </div>
    <!-- import body_end begin-->
    <!-- import body_end end-->
    <!-- Custom Files bodyEnd begin-->
    
    <!-- Custom Files bodyEnd end-->
    <!-- front-matter body_end begin -->
    <!-- front-matter body_end end -->
  </body>
</html>
