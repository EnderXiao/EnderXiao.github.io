---
title: Games101_9TO16
date: 2022-03-17 14:24:37
categories:
  - - 计算机图形学
    - 图形学入门
  - - Games101
    - 1-8
tags:
  - 计算机图形学
  - Games101
mathjax: true
headimg:
  'https://z3.ax1x.com/2021/08/05/fegbgU.jpg'
---

继续Games101 1-8的内容，从纹理映射开始

<!-- more -->

## 纹理映射

### 三角形内插值：重心坐标

下面提出两个问题：

1. 为什么要做插值
   - 因为需要在三角形内得到平滑过渡的一组值
2. 需要插哪些值
   - 纹理，颜色，法线等等
3. 如何插值
   - 重心坐标（Barycentric Coordinates）

#### 重心坐标

对于一个已知所有顶点的三角形，与该三角形共面的任意一点，都可以表示为这三个顶点的加权和。且满足系数之和等于1。另外，如果三个系数均为非负，则该点位于三角形内部。

![image-20220317143733928](..\images\image-20220317143733928.png)

则这三个系数组成的坐标为重心坐标。

#### 重心坐标求法

对于三角形内任意一点，我们可以通过连接该点与三角形三个顶点，得到三个三角形，如下图所示：

![image-20220317164618425](..\images\image-20220317164618425.png)

其中$A_i$表示与角i相对的三角形的面积。那么该点的重心坐标可以通过如下公式结算得到：
$$
\alpha = \frac{A_A}{A_A + A_B + A_C} \\
\beta = \frac{A_B}{A_A + A_B + A_C} \\
\gamma = \frac{A_C}{A_A + A_B + A_C}
$$
因此我们可以得到一个特殊点的重心坐标。即三角形重心的重心坐标。因为三角形重心具有平分三角形面积的性质，故重心的重心坐标为：(1/3,1/3,1/3)

除了使用面积进行计算我们还可以通过如下方式得到更直观的坐标运算来得到重心坐标：

对于上图中三角形内的点(x,y)，我们令其为Ｐ，如果我们把三角形ABC看成坐标系

，A为原点，基为$\vec{AB}，\vec{AC}$，那么对于向量AP我们可以使用如下方式:

$\vec{AP} = u\vec{AB} + b\vec{AC}$

移项得到：

$u\vec{AB} + b\vec{AC} + \vec{PA} = 0$

对于二维三角形，我们可以得到如下形式的式子：
$$
u\vec{AB}_x + v\vec{AC}_x + \vec{PA}_x = 0 \\
u\vec{AB}_y + v\vec{AC}_y + \vec{PA}_y = 0
$$
此外还可以将其写为矩阵形式：
$$
\left(
\begin{matrix}
u & v & 1
\end{matrix}
\right)

\left(
\begin{matrix}
\vec{AB}_x \\
\vec{AC}_x \\
\vec{PA}_x
\end{matrix}
\right) = 0
\\
\left(
\begin{matrix}
u & v & 1
\end{matrix}
\right)

\left(
\begin{matrix}
\vec{AB}_y \\
\vec{AC}_y \\
\vec{PA}_y
\end{matrix}
\right) = 0
$$
可见我们需要计算的向量(u,v,1)垂直与上述两个向量，因此可以使用上述两个向量的叉乘得到我们要求的系数。

我们还可以得到如下公式：
$$
\alpha = \frac{-(x-x_B)(y_C - y_B) + (y - y_B)(x_C - x_B)}{-(x_A - x_B)(y_C - y_B) + (y_A - y_B)(x_C - x_B)} \\
\beta =  \frac{-(x-x_C)(y_A - y_C) + (y - y_C)(x_A - x_C)}{-(x_B - x_C)(y_A - y_C) + (y_B - y_C)(x_A - x_C)} \\
\gamma = 1 - \alpha - \beta
$$
至此，三角形内部的任意点，都能通过三个点的线性组合来得到该点的位置。

> 但需要注意的是，重心坐标并不具有投影不变性

![image-20220317170225311](..\images\image-20220317170225311.png)

对于投影进行插值，应该先进行投影，然后根据投影逆运算计算出该像素点在三维空间中的坐标，然后进行插值，再将结果放回投影后的像素点

### 应用纹理

#### 简答纹理映射：漫反射颜色

1. 对于每一个投影屏幕中的采样点，通过插值计算出他的坐标(u,v)
2. 在纹理图上查询纹理值
3. 将该纹理直（例如漫反射系数Kd）应用到模型中。

但是如果使用上述简单的方式进行纹理应用，将存在下文将要讨论的几个问题：

#### 纹理放大（Texture Magnification）

即纹理本身过小，分辨率过低。

此处为了区分模型上的像素与纹理上的像素，我们引入一个概念：Texel，指纹理上的像素，即纹理像素或纹素

当查询纹理时候，所给坐标为非整数坐标，因此通常会采取一些方法来得到它的纹理值，常见方法有：

- 最近邻Nearest
- 双线性插值Bilinear
- 双向三次插值Bicubic

#### 纹理放大（Hard Case）

即纹理过大，分辨率过高

当纹理过大时，映射到模型上会产生走样的问题，如下图所示，远处产生了摩尔纹，近处产生了锯齿：

![image-20220317201248602](..\images\image-20220317201248602.png)

产生摩尔纹的原因是像素不够多，而由于近大远小，远处会有更多的像素被同一纹素的纹理所覆盖，如下图所示：

![image-20220317203115282](..\images\image-20220317203115282.png)

此处引出一个计算几何中的经典问题：点查询与区域查询（Point Query & Range Query）

其中范围查询又分为很多种，例如平均范围查询，最大最小值范围查询（如线段树） 

#### 双线性插值

对于一个非整数点，考虑它的四领域，分别计算你该点到四领域中的Texel的水平与数值距离，并分别进行一次线性插值。

线性插值：对于已知的两个点A、B，如果某一点距离A点的距离为x，则该点的值可以表示为：

$lerp(x,A,B) = A + x(B - A)$

具体过程如图所示：

![image-20220317200455034](..\images\image-20220317200455034.png)

#### 双向三次插值

与双向线性插值的区别在于去该点的16领域，这16个领域进行水平竖直的三次插值

#### MipMap

允许进行一种快速，近似，正方形(fast,approx,square)的范围查询
