---
title: 高级计算机网络报告
date: 2021-10-27 15:51:29
categories:
tags:
---

## 802.11发展史

## 研究背景

2019年9月16日，Wi-Fi联盟宣布启动Wi-Fi 6认证计划，该计划旨在使采用下一代802.11ax Wi-Fi无线通信技术的设备达到既定标准。近年来，获得Wi-Fi 6认证的路由器产品正逐渐增多，支持Wi-Fi6的手机也越来越多，这不免让我们产生了这样的疑问：Wi-Fi 6到底为我们的日常生活带来了怎样的遍历？相较于老版本的认证标准，Wi-Fi 6从哪些方面进行了优化？这些问题促使我对Wi-Fi使用的协议802.11的发展历史进行了相关的研究，本文通过梳理802.11的发展历程，对比各个版本之间的差异，来展现该协议对我们日常生活的影响，以及对将要到来的Wi-Fi 7无线网络进行预先的了解

## 802.11

802.11协议即IEEE 802.11 - 1997 是最初通过的802.11版本，该协议中物理层机制已经不再使用，包括FHSS模式和IR的淘汰，以及DSSS模式已经在802.11b中进行了拓展。802.11协议只对物理层和数据链路层进行了定义，数据链路层有分为逻辑链路控制（LLC）子层和介质访问控制（MAC）子层。

LLC层主要定义了MAC层的接入规则，在这一版的协议中定义了DCF和PCF两种接入模式。基于IEEE 802.2

### MAC层

如下是802.11中定义的MAC层的帧格式：

![image-20211028093036213](C:\Users\12865\AppData\Roaming\Typora\typora-user-images\image-20211028093036213.png)

其中Octets指包含8bit的字节。

#### Frame Control字段

Frame Control用于区分关联帧，RTS帧，CTS帧，ACK帧，数据帧到AP和总AP字段用于定义不同地址字段的含义。其中细节如下：

![image-20211028092432745](D:\EnderBlog\img\image-20211028092432745.png)

Protocol表明协议版本

Type用以区分帧的类型，802.11中定义了三种类型的帧，管理帧值为00负责监督，主要用来加入或退出无线网络，以及处理基站之间链接的转移事宜；控制帧值为01通常与数据帧搭配使用，负责区域的清空、信道的取得以及载波监听的维护；数据帧值为10负责在工作站之间传输数据、帧类型11保留尚未使用。

Subtype时发送帧的子类型，例如请求发送帧RTS的type为01，Subtype为1011。CTS的type为01，Subtype为1100

To DS与From DS分别表示无线链路向无线站点或AP发送的帧和无线站点向无线链路发送的帧。

More Fragments用于说明长帧被分段的情况，是否还有其它的帧。若较上层的封包经过MAC 分段处理，最后一个片段除外，其他片段均会将此bit 设定为1。

Retry有时候可能需要重传帧。任何重传的帧会将此bit 设定为1，以协助接收端剔除重复的帧。

Power Management此bit 用来指示、完成当前的帧交换过程后，发送端的电源管理状态。为1表示STA处于Power_save模式，为0表示STA处于active模式。

More Data只用于管理数据帧，在控制帧中此bit必然为0。

WEP用以表示Frame Body中是否包含由WEP加密的数据。

#### 其他字段

Duration/ID在数据帧和RTS、CTS帧中均存在，指明传输其数据帧的时间和传输确认的时间。

Sequence Control使用序号使接收方区分新传输的帧和以前帧的重传，类似于传输层的序号字段。

Frame Body则为有效载荷，由一个IP数据报或者ARP分组组成，最大长度为2312字节，但通常小于1500字节

FCS则是一个32位的CRC效验码

#### 地址字段

802.11中定义的地址包含如下四种：

1. DA-Destination Address
2. SA-Source Address
3. RA-Receiver Address
4. TA-Transmitter Address

Address字段的含义根据帧类型的不同而不同，具体如下表所示：

| 功能                | To Ds字段 | From Ds字段 | Address1 | Address2 | Address3 | Address4 |
| ------------------- | --------- | ----------- | -------- | -------- | -------- | -------- |
| IBSS                | 0         | 0           | DA/RA    | SA/TA    | BSSID    | N/A      |
| TP AP（基础结构）   | 1         | 0           | BSSID/RA | SA/TA    | DA       | N/A      |
| From AP（基础结构） | 0         | 1           | DA/RA    | BSSID/TA | SA       | N/A      |
| WDS（桥接器）       | 1         | 1           | BSSID/RA | BSSID/TA | DA       | SA       |

IBSS表示该数据帧从STA发往AP上行以太网；To AP表示该数据帧从STA发往AP；From AP表示该数据帧从AP发出，发往STA；WDS表示该数据帧用于无线网桥间发送数据。

### 物理层

物理层分为两个子层，分别是物理层收敛程序（PLCP）层和物理介质相关（PMD）层。PMD主要规定了调制技术和编码技术负责将PLCP传来的每个位单元利用天线传送至空中，而PLCP会为来自上层的数据帧加上自己的标头，负责无干扰信道评估（CCA）模式该技术在检测到周边有无线信号干扰时，可自动调整频宽模式，避开信道干扰，使无线信号更加稳定。当干扰消失时，又可自动捆绑空闲信道，充分利用信道捆绑优势，提升无线性能。，为不同的物理层技术构建分组。

802.11 -1997在物理层上最初定义了三种制式，分别是跳频技术（FHSS），DSSS和IR，FHSS和DSSS均工作在2.4G频段，IR则是采用标准的红外线。

FFHS和DSSS均属于扩频（Spread Spectrum）技术，其基本思想就是让信号所占有的频带宽度远大于所传信息必须的最小带宽。而DSSS就是直接在发送端用高码率的扩散码序列去扩散信号频谱信号的频谱，直观上来看就是载波信号的发射频率充满了整个带宽（频谱）。如果我们将信号传输比喻为在公路上行驶的货车，那么扩频技术就是为这辆火车提供了更多车道的公路，由单车道升级为了4车道甚至8车道，而如何利用这些车道则衍生出了FFHS和DSSS两种策略。而DSSS是将货物分包，让多辆货车在不同的车道上运输货物，在接收端重新组装这些货物。

而FHSS技术则是由载波快速在不同频率中切换实现。依然拿货车举例，现在我们的策略是，让这辆货车以一定规律（或者以伪随机）在不同的车道间进行切换，只要接收端和发送端同步切换，最终就能成功接收这批货物。值得一提的是不停更换无线电频率一躲避干扰及侦探的思路是二战时期由一位好莱坞女明星海蒂拉玛提供的，而如何使发送端和接收端同步的问题则是由前卫音乐家乔治·安塞尔根据自动演奏钢琴的原理提出的解决方案。

以上两个传输速率大概能达到1Mbps-2Mbps，FHSS会占用更大的频带宽度，需要79MHz，但每一个跳频只需要占用1MHz即可，子带宽更小意味着更低的采样率，即硬件成本将得到节约。DSSS的每个子频带则需要22MHz的带宽。此时的FHSS使用的调制方式为FSK，DSS使用的调制方式为PSK

FHSS对应的PLCP帧格式如下：

![image-20211027203508723](D:\EnderBlog\img\image-20211027203508723.png)

其中PLCP preamble中包含的Sync用于做时频同步，Start Frame Delimiter（SFD）用于表示帧的开头，由一个交替的01串构成，以0开头，以1结尾。SFD由16位二进制模式0000 1100 1011 1101（首先传输最左边的位）组成。第一个bit与Sync的最后一个比特相同。PLCP Header中包含的12bit长的PLW即PSDU Length Word代表从上层传来的MAC帧总长度，PSF即PLCP Signaling field用以表示传输速率，实际上最初的802.11已经存在了不同的速率，Header Error Check则是校验位，采用CRC-16对头部进行校验。

DSSS对应的PLCP帧格式如下：

![image-20211027205236976](D:\EnderBlog\img\image-20211027205236976.png)

可见其帧构造和FHSS类似，这一结构一直沿用到了802.11b，其中Signal表示的是数据帧的调制方式，并且数据率等于Signal值乘以100kbit/s。而Service字段被保留，供将来使用。

而对于红外而言，由于红外光的缺点在于容易受可见光的干扰，所以一般红外光的通信范围在1m左右，且穿墙能力较弱。灵活性和可移动性不如无线电波，而灵活性与移动性是一般采用802.11的最大驱动力。因此很快被从802.11中删除，在此不做讨论。

## 802.11a/802.11b

802.11a/b是802.11协议的第二个阶段的版本，都是在1999年发布的，用现在Wi-Fi的新的命名方式来说的话，802.11b对应的是Wi-Fi 1，802.11a对应的是Wi-Fi 2。

### 802.11b

802.11b通常被认为是Wi-Fi1，由之前对802.11的分析可知，在速度和传输距离上，802.11显然不能满足人们的需要，因此802.11b主要引入了CCK编码方式，使得经过CCK调制后的数据速率提升到了5.5Mbps和11Mbps，CCK为了对抗多径干扰，需要更复杂的均衡及调制，实现起来相对困难，这也推动了IEEE802.11引入新的调制技术。此外，协议还定义了一种可选的调制模式，PBCC。

另外，为了配合调制技术上的改动，PLCP帧的部分，802.11b引入了Short Preamble的结构，支持56bit的Sync字段。

并且802.11 -1997中被保留的Service字段中的3个bit也被用上了其中一位用来表示调制模式是CCK还是PBCC。由于支持了11Mbps后，原有的length字段的时间精度不够了，于是service中的一位就用来补位以提升精度

#### 802.11a

802.11a通常被认为是Wi-Fi2，802.11a则是采用的OFDM模式进行调制，将信道分成许多相互正交的子信道，每个信道包含多个子载波，每个载波上可以进行独立的调制，比如QPSK、QAM，在各个子信道中的这种正交调制和解调可以采用反向快速傅里叶变换（IFFT）和快速傅里叶变换（FFT）方法来实现，随着技术的发展，IFFT和FFT都是非常容易实现的。FFT的引入，大大降低了OFDM实现的复杂性，提升了系统的性能。OFDM可以很好的抵抗干扰以及减少多径效应（指电磁波经不同路径传播后，各分量场到达接收端时间不同，按各自相位相互叠加而造成干扰，使得原来的信号失真，或者产生错误。）的影响。并且，由于2.4GHz频带802.11a采用5GHz的频带，让802.11具有更少冲突的优点，然而高载波频率也带来了负面效果，802.11a几乎被限制在直线范围内使用，这导致必须使用更多的接入点，并且高频率也使得其更容易被吸收，无法像802.11b哪有传播的很远。802.11a的速率可以达到54Mbps。

由于制式、频带的不同，802.11a与802.11b的设备无法相互兼容。并且由于802.11a成本较高，相较于802.11b，它更多的被用于商业，而非家庭

## 802.11g

802.11g通常被认为是Wi-Fi3，802.11g世代中，MAC层部分仍然没有太大的改进，改变主要集中于物理层次技术的发展，在802.11a中得到更高速率的OFDM被加入到了802.11g中，使得数据传输速率提高到20Mbps以上。在802.11g中支持了4种物理层制式，分别是ERP-DSSS/CCK、ERP-OFDM、ERP-DSSS-OFDM、ERP-PBCC

其中ERP指Extended Rate PHY，即拓展物理层速率。

此外802.11g将OFDM引入到2.4G频段也是处于对802.11b设备的兼容考虑，降低了用户的投资，延长了802.11b产品的使用寿命。

802.11g的数据传输速率能达到54Mbps。802.11g设备具有如下有点：

1. 兼容性好，支持设备丰富
2. 相对便宜

缺点：

1. 由于需要兼容802.11b设备，因此为了匹配这些设备而使得网络速度减低

## 802.11n

802.11n通常被认为是Wi-Fi4，是802.11g的升级，它引入了MIMO技术来提高802.11g的速率，提供了高达600Mbps的带宽，其信号强度也得到了增强，使得其覆盖范围比以往的Wi-Fi协议更好。有了802.11g的基础，802.11n在设计时也考虑了对802.11a/b/g设备的兼容性。

MIMO技术的基本思想是在发送端和接收端都使用多跟天线，在收发之间构成多个信道的天线系统。之前提到的多径效应会影响信号质量，因此传统的天线系统都在如何消除多径效应上动脑筋，而MIMO系统正好相反，它利用多径效应来改善通信质量。在MIMO系统中，收发双方使用多副可以同时工作的天线进行通信。MIMO系统通常采用复杂的信号处理技术来显著增强可靠性、传输范围和吞吐量。发射机采用这些技术同时发送多路射频信号，接收机再从这些信号中将数据恢复出来。

## 802.11ac

802.11ac通常被认为是Wi-Fi5，802.11ac是在802.11a标准上建立起来的，与802.11a一样，仅运行在5GHz频段，能保证更少的冲突。但沿用了802.11n中的MIMO技术，最终理论速度由802.11n的600Mbps跃升至1Gbps。再此基础上，802.11ac也将完全兼容802.11 a/n。

## 802.11ax

802.11ax通常被认为是Wi-Fi6，也是正在兴起的一代产品，802.11ax的设计并没有在当前802.11ac的160M带宽上进行增加，而更关注的是如何更有效的使用当前频段资源，从而提供更高的实际网络速率。802.11ax具有如下特点：

1. 协议兼容性：能够兼容以往的802.11a/b/n/ac，等等标准，且该标准是即802.11n以后第二款能同时运行在2.4GHz和5GHz频段下的标准
2. 更好的节能新
3. 更高的传输速率以及覆盖范围
4. 引入上行MU-MIMO
5. 引入OFDMA



## 补充

**关于为什么最后FHSS会失败**：FHSS实际上是有一定优势的，其虽然占据了79MHz的带宽，但是其单个子带宽仅仅是1MHz，只不过是要在79MHz的连续带宽上变化。子带宽更小意味更低的采样率，**FHSS的硬件成本会更低**。但是**DSSS模式的稳定性会优于FHSS**，以及DSSS的覆盖面会更大，覆盖的面积会更广。所以最初的802.11协议中，最终是稳定性和覆盖性战胜了硬件成本。

The.Innovation.Journey.Of.WiFi.The.Road.To.Global.Success

## 总结

### 发展历程

可见Wi-Fi技术的发展更多的体现在物理层技术的更新换代，这告诉了我们层次结构设计的重要性，得益于IOS和TCP/IP的层级设计，802.11协议只需要专注于1-2层级的设计，并且后续优化只需要从物理层入手就能得到不错的效果。

### 展望Wi-Fi7

实际上Wi-Fi6E标准已经在802.11的考虑范围内了，该标准主要是将频带拓展到了6GHz，我们有理由相信，包含更大量更新的802.11be标准将把对6GHz的支持纳入考虑的范围内。

此外，就现阶段来讲，MIMO目前Wi-Fi发展的中点倾向，而随着物联网设备的发展，接入AP的设备将越来越多，引入更多天线组的同时，或许将支持更多STA的同时通信。

最后，Mesh组网在如今Wi-Fi6设备上的尝试较为成功，Wi-Fi7中如何实现多AP的协同工作以解决Wi-Fi覆盖范围的问题，可能也会被考虑。

### 思考问题的方向

此外，通过802.11的发展历程我们可以发现，一项技术的发展往往不是闭门造车，实际上，它在发展过程中引入了许多来自LTE通讯的技术，尽管LTE可以说是Wi-Fi的竞品。而802.11协议的发展也不是埋头朝着一个方向发展，很多时候出现了多条思路并行发展的情况，最后每条路上发展的解决方案，互相影响，最后再融合，从而使得产品越来越好，也是我们值得学习的思路。最后，802.11协议在向后兼容方面的考虑也值得我们去学习。
