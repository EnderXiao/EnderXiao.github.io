<!DOCTYPE html>
<html lang="en,zh-CN,zh-HK,zh-TW,default">
    <head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/#5.8.0'>
  <meta name="generator" content="Hexo 7.3.0">
  <meta name="Volantis" content="5.8.0">
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
  <link rel="canonical" href="http://enderxiao.github.io/2023/08/09/前端补缺vite/"/>
  <!-- 渲染优化 -->
    <meta http-equiv='x-dns-prefetch-control' content='on' />
      <link rel='dns-prefetch' href='https://unpkg.com'>
      <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Content-Security-Policy" content=" default-src 'self' https:; block-all-mixed-content; base-uri 'self' https:; form-action 'self' https:; worker-src 'self' https:; connect-src 'self' https: *; img-src 'self' data: https: *; media-src 'self' https: *; font-src 'self' data: https: *; frame-src 'self' https: *; manifest-src 'self' https: *; child-src https:; script-src 'self' https: 'unsafe-inline' *; style-src 'self' https: 'unsafe-inline' *; ">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <!-- import head_begin begin -->
  <!-- import head_begin end -->
  <!-- Custom Files headBegin begin-->
  <!-- 引入自定义黑暗模式动画 -->
<script defer src="../custom/drakmode/darkmode.js"></script>
<link rel="stylesheet" href="../custom/drakmode/darkmode.css">

<!-- 引入KaTex公式渲染 -->
<link rel="stylesheet" href="https://unpkg.com/katex@0.16.4/dist/katex.min.css">
<script defer src="https://unpkg.com/katex@0.16.4/dist/katex.min.js"></script>
<script defer src="https://unpkg.com/katex@0.16.4/dist/contrib/copy-tex.min.js"></script>
<!-- 引入公式滚动样式 -->
<link rel="stylesheet" href="../custom/MathScroll/style.css"
  <!-- Custom Files headBegin end-->
  <!-- front-matter head_begin begin -->
  <!-- front-matter head_begin end -->
    <link rel="shortcut icon" type='image/x-icon' href="/images/end_purple_favicon128.ico">
  <link rel="preload" href="/css/style.css" as="style">
  <link rel="preload" href="https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/VarelaRound/VarelaRound-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
<link rel="preload" href="https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/UbuntuMono/UbuntuMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <!-- feed -->
      <link rel="alternate" href="/atom.xml" title="Ender" type="application/atom+xml">
  <!-- 页面元数据 -->
  <title>前端补缺Vite - Ender</title>
  <meta name="keywords" content="life,Blog EnderXiao">
  <meta desc name="description" content="a blog of EnderXiao - John Doe - Ender">
  
<meta property="og:type" content="article">
<meta property="og:title" content="前端补缺Vite">
<meta property="og:url" content="http://enderxiao.github.io/2023/08/09/%E5%89%8D%E7%AB%AF%E8%A1%A5%E7%BC%BAVite/index.html">
<meta property="og:site_name" content="Ender">
<meta property="og:description" content="简介 Vite是由Vue公司开发的新型前端构建工具，由两部分组成：  一个开发服务器，基于原生ES模块提供了丰富的内建功能，例如模块热更新（HMR） 一套构建指，使用Rollup打包代码，  Vite可通过JS API和插件API进行拓展  搭建项目 1234npm init vite@latestnpm create vite@latestyarn create vitepnpm create">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png">
<meta property="article:published_time" content="2023-08-09T08:11:25.000Z">
<meta property="article:modified_time" content="2024-07-30T11:26:33.927Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="life">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png">
  <style>
    /* 首屏样式 */
    #safearea {
  display: none;
}
:root {
  --color-site-body: #f4f4f4;
  --color-site-bg: #f4f4f4;
  --color-site-inner: #fff;
  --color-site-footer: #666;
  --color-card: #fff;
  --color-text: #444;
  --color-block: #f6f6f6;
  --color-inlinecode: #c74f00;
  --color-codeblock: #fff7ea;
  --color-h1: #3a3a3a;
  --color-h2: #3a3a3a;
  --color-h3: #333;
  --color-h4: #444;
  --color-h5: #555;
  --color-h6: #666;
  --color-p: #444;
  --color-list: #666;
  --color-list-hl: #c4b23d;
  --color-meta: #888;
  --color-read-bkg: #e0d8c8;
  --color-read-post: #f8f1e2;
  --color-copyright-bkg: #f5f5f5;
}
* {
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  outline: none;
  margin: 0;
  padding: 0;
}
*::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
*::-webkit-scrollbar-track-piece {
  background: transparent;
}
*::-webkit-scrollbar-thumb {
  background: #f5df4d;
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
*::-webkit-scrollbar-thumb:hover {
  background: #ff5722;
}
html {
  color: var(--color-text);
  width: 100%;
  height: 100%;
  font-family: UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  font-size: 16px;
}
html >::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
html >::-webkit-scrollbar-track-piece {
  background: transparent;
}
html >::-webkit-scrollbar-thumb {
  background: #54b5a0 linear-gradient(45deg, rgba(255,255,255,0.4) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.4) 75%, transparent 75%, transparent);
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
html >::-webkit-scrollbar-thumb:hover {
  background: #54b5a0 linear-gradient(45deg, rgba(255,255,255,0.4) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.4) 75%, transparent 75%, transparent);
}
body {
  background-color: var(--color-site-body);
  text-rendering: optimizelegibility;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  line-height: 1.6;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
}
body.modal-active {
  overflow: hidden;
}
@media screen and (max-width: 680px) {
  body.modal-active {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
a {
  color: #f5df4d;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
a:hover {
  color: #ff5722;
}
a:active,
a:hover {
  outline: 0;
}
ul,
ol {
  padding-left: 0;
}
ul li,
ol li {
  list-style: none;
}
header {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
img {
  border: 0;
  background: none;
  max-width: 100%;
}
svg:not(:root) {
  overflow: hidden;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  -webkit-box-sizing: content-box;
  -moz-box-sizing: content-box;
  height: 0;
  border: 0;
  border-radius: 1px;
  -webkit-border-radius: 1px;
  border-bottom: 1px solid rgba(68,68,68,0.1);
}
button,
input {
  color: inherit;
  font: inherit;
  margin: 0;
}
button {
  overflow: visible;
  text-transform: none;
  -webkit-appearance: button;
  cursor: pointer;
}
@supports (backdrop-filter: blur(20px)) {
  .blur {
    background: rgba(255,255,255,0.9) !important;
    backdrop-filter: saturate(200%) blur(20px);
  }
}
.shadow {
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.shadow.floatable {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.shadow.floatable:hover {
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
}
#l_cover {
  min-height: 64px;
}
.cover-wrapper {
  top: 0;
  left: 0;
  max-width: 100%;
  height: 100vh;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  align-self: center;
  align-content: center;
  color: var(--color-site-inner);
  padding: 0 16px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  position: relative;
  overflow: hidden;
  margin-bottom: -100px;
}
.cover-wrapper .cover-body {
  z-index: 1;
  position: relative;
  width: 100%;
  height: 100%;
}
.cover-wrapper#full {
  height: calc(100vh + 100px);
  padding-bottom: 100px;
}
.cover-wrapper#half {
  max-height: 640px;
  min-height: 400px;
  height: calc(36vh - 64px + 200px);
}
.cover-wrapper #scroll-down {
  width: 100%;
  height: 64px;
  position: absolute;
  bottom: 100px;
  text-align: center;
  cursor: pointer;
}
.cover-wrapper #scroll-down .scroll-down-effects {
  color: #fff;
  font-size: 24px;
  line-height: 64px;
  position: absolute;
  width: 24px;
  left: calc(50% - 12px);
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  animation: scroll-down-effect 1.5s infinite;
  -webkit-animation: scroll-down-effect 1.5s infinite;
  -khtml-animation: scroll-down-effect 1.5s infinite;
  -moz-animation: scroll-down-effect 1.5s infinite;
  -o-animation: scroll-down-effect 1.5s infinite;
  -ms-animation: scroll-down-effect 1.5s infinite;
}
@-moz-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.cover-wrapper .cover-body {
  margin-top: 64px;
  margin-bottom: 100px;
}
.cover-wrapper .cover-body,
.cover-wrapper .cover-body .top,
.cover-wrapper .cover-body .bottom {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  max-width: 100%;
}
.cover-wrapper .cover-body .bottom {
  margin-top: 32px;
}
.cover-wrapper .cover-body .title {
  font-family: "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
  font-size: 3.125rem;
  line-height: 1.2;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.cover-wrapper .cover-body .subtitle {
  font-size: 20px;
}
.cover-wrapper .cover-body .logo {
  max-height: 120px;
  max-width: calc(100% - 4 * 16px);
}
@media screen and (min-height: 1024px) {
  .cover-wrapper .cover-body .title {
    font-size: 3rem;
  }
  .cover-wrapper .cover-body .subtitle {
    font-size: 1.05rem;
  }
  .cover-wrapper .cover-body .logo {
    max-height: 150px;
  }
}
.cover-wrapper .cover-body .m_search {
  position: relative;
  max-width: calc(100% - 16px);
  width: 320px;
  vertical-align: middle;
}
.cover-wrapper .cover-body .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  width: 100%;
}
.cover-wrapper .cover-body .m_search .icon,
.cover-wrapper .cover-body .m_search .input {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.cover-wrapper .cover-body .m_search .icon {
  position: absolute;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  line-height: 2.5rem;
  width: 32px;
  top: 0;
  left: 5px;
  color: rgba(68,68,68,0.75);
}
.cover-wrapper .cover-body .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  height: 2.5rem;
  width: 100%;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  font-size: 0.875rem;
  -webkit-appearance: none;
  padding-left: 36px;
  border-radius: 1.4rem;
  -webkit-border-radius: 1.4rem;
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(10px);
  border: none;
  color: var(--color-text);
}
@media screen and (max-width: 500px) {
  .cover-wrapper .cover-body .m_search .input {
    padding-left: 36px;
  }
}
.cover-wrapper .cover-body .m_search .input:hover {
  background: rgba(255,255,255,0.8);
}
.cover-wrapper .cover-body .m_search .input:focus {
  background: #fff;
}
.cover-wrapper .list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  flex-wrap: wrap;
  -webkit-flex-wrap: wrap;
  -khtml-flex-wrap: wrap;
  -moz-flex-wrap: wrap;
  -o-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  align-items: stretch;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.cover-wrapper .list-h a {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 0;
  -ms-flex: 1 0;
  flex: 1 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  font-weight: 600;
}
.cover-wrapper .list-h a img {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  border-radius: 2px;
  -webkit-border-radius: 2px;
  margin: 4px;
  min-width: 40px;
  max-width: 44px;
}
@media screen and (max-width: 768px) {
  .cover-wrapper .list-h a img {
    min-width: 36px;
    max-width: 40px;
  }
}
@media screen and (max-width: 500px) {
  .cover-wrapper .list-h a img {
    margin: 2px 4px;
    min-width: 32px;
    max-width: 36px;
  }
}
@media screen and (max-width: 375px) {
  .cover-wrapper .list-h a img {
    min-width: 28px;
    max-width: 32px;
  }
}
.cover-wrapper {
  max-width: 100%;
}
.cover-wrapper.search .bottom .menu {
  margin-top: 16px;
}
.cover-wrapper.search .bottom .menu .list-h a {
  white-space: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  align-items: baseline;
  padding: 2px;
  margin: 4px;
  color: var(--color-site-inner);
  opacity: 0.75;
  -webkit-opacity: 0.75;
  -moz-opacity: 0.75;
  text-shadow: 0 1px 2px rgba(0,0,0,0.05);
  border-bottom: 2px solid transparent;
}
.cover-wrapper.search .bottom .menu .list-h a i {
  margin-right: 4px;
}
.cover-wrapper.search .bottom .menu .list-h a p {
  font-size: 0.9375rem;
}
.cover-wrapper.search .bottom .menu .list-h a:hover,
.cover-wrapper.search .bottom .menu .list-h a.active,
.cover-wrapper.search .bottom .menu .list-h a:active {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
  border-bottom: 2px solid var(--color-site-inner);
}
.cover-wrapper.dock .menu,
.cover-wrapper.featured .menu,
.cover-wrapper.focus .menu {
  border-radius: 6px;
  -webkit-border-radius: 6px;
}
.cover-wrapper.dock .menu .list-h a,
.cover-wrapper.featured .menu .list-h a,
.cover-wrapper.focus .menu .list-h a {
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  padding: 12px;
  line-height: 24px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  border-bottom: none;
  text-align: center;
  align-content: flex-end;
  color: rgba(68,68,68,0.7);
  font-size: 1.5rem;
}
@media screen and (max-width: 500px) {
  .cover-wrapper.dock .menu .list-h a,
  .cover-wrapper.featured .menu .list-h a,
  .cover-wrapper.focus .menu .list-h a {
    padding: 12px 8px;
  }
}
.cover-wrapper.dock .menu .list-h a i,
.cover-wrapper.featured .menu .list-h a i,
.cover-wrapper.focus .menu .list-h a i {
  margin: 8px;
}
.cover-wrapper.dock .menu .list-h a p,
.cover-wrapper.featured .menu .list-h a p,
.cover-wrapper.focus .menu .list-h a p {
  font-size: 0.875rem;
}
.cover-wrapper.dock .menu .list-h a.active,
.cover-wrapper.featured .menu .list-h a.active,
.cover-wrapper.focus .menu .list-h a.active {
  background: var(--color-card);
  backdrop-filter: none;
}
.cover-wrapper.dock .menu .list-h a.active i,
.cover-wrapper.featured .menu .list-h a.active i,
.cover-wrapper.focus .menu .list-h a.active i,
.cover-wrapper.dock .menu .list-h a.active i+p,
.cover-wrapper.featured .menu .list-h a.active i+p,
.cover-wrapper.focus .menu .list-h a.active i+p {
  color: #f5df4d;
}
.cover-wrapper.dock .menu .list-h a.active img+p,
.cover-wrapper.featured .menu .list-h a.active img+p,
.cover-wrapper.focus .menu .list-h a.active img+p {
  color: var(--color-text);
}
.cover-wrapper.dock .menu .list-h a:hover,
.cover-wrapper.featured .menu .list-h a:hover,
.cover-wrapper.focus .menu .list-h a:hover {
  background: var(--color-card);
}
.cover-wrapper.dock .top {
  margin-bottom: 48px;
}
.cover-wrapper.dock .menu {
  background: rgba(255,255,255,0.5);
  position: absolute;
  bottom: 0;
  max-width: 100%;
}
.cover-wrapper.dock .menu .list-h {
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  margin: 4px;
}
.cover-wrapper.dock .menu .list-h a+a {
  margin-left: 4px;
}
@media screen and (max-width: 500px) {
  .cover-wrapper.dock .menu .list-h {
    overflow-x: scroll;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar {
    height: 0;
    width: 0;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-track-piece {
    background: transparent;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-thumb {
    background: #f5df4d;
    cursor: pointer;
    border-radius: 0;
    -webkit-border-radius: 0;
  }
  .cover-wrapper.dock .menu .list-h::-webkit-scrollbar-thumb:hover {
    background: #ff5722;
  }
}
@supports (backdrop-filter: blur(20px)) {
  .cover-wrapper.dock .menu {
    background: rgba(255,255,255,0.5);
    backdrop-filter: saturate(200%) blur(20px);
  }
}
.cover-wrapper #parallax-window {
  position: absolute;
  width: 100%;
  height: 100%;
  background: transparent;
}
.parallax-mirror {
  animation-delay: 0s;
  animation-duration: 0.5s;
  animation-fill-mode: forwards;
  animation-timing-function: ease-out;
  animation-name: fadeIn;
}
@-moz-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --color-mode: 'dark';
  }
  :root:not([color-scheme]) {
    --color-site-body: #121212;
    --color-read-bkg: #1f1f1f;
    --color-read-post: #262626;
    --color-site-bg: #1f1f1f;
    --color-site-inner: rgba(238,238,238,0.871);
    --color-site-footer: rgba(170,170,170,0.871);
    --color-card: #262626;
    --color-text: rgba(238,238,238,0.871);
    --color-block: #434343;
    --color-codeblock: #1f1f1f;
    --color-inlinecode: #d56d28;
    --color-h1: rgba(255,255,255,0.871);
    --color-h2: rgba(255,255,255,0.871);
    --color-h3: rgba(255,255,255,0.6);
    --color-h4: rgba(255,255,255,0.6);
    --color-h5: rgba(255,255,255,0.6);
    --color-h6: rgba(255,255,255,0.6);
    --color-p: rgba(217,217,217,0.871);
    --color-list: rgba(217,217,217,0.871);
    --color-list-hl: #f7e570;
    --color-meta: rgba(191,191,191,0.871);
    --color-link: rgba(191,191,191,0.871);
    --color-copyright-bkg: #21252b;
  }
  :root:not([color-scheme]) img {
    filter: brightness(70%) !important;
  }
  :root:not([color-scheme]) .blur {
    background: rgba(31,31,31,0.9) !important;
  }
  :root:not([color-scheme]) .white-box.blur {
    background: rgba(38,38,38,0.9) !important;
  }
  :root:not([color-scheme]) .nav-main .u-search-input {
    background: var(--color-card) !important;
  }
  :root:not([color-scheme]) #l_main .article .prev-next>a {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) #l_main .article .prev-next>a:hover {
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) .article blockquote {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .article-title a {
    color: var(--color-h1) !important;
  }
  :root:not([color-scheme]) details>summary {
    color: var(--color-p) !important;
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) details {
    border: 1px solid var(--color-site-bg) !important;
    background: var(--color-site-bg) !important;
  }
  :root:not([color-scheme]) #u-search .modal,
  :root:not([color-scheme]) #u-search .modal-header,
  :root:not([color-scheme]) #u-search .modal-body {
    background: var(--color-card) !important;
  }
  :root:not([color-scheme]) #u-search .modal-body .modal-results .result:hover {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .u-search-input:hover {
    background: var(--color-block) !important;
  }
  :root:not([color-scheme]) .u-search-input:focus {
    background: var(--color-site-body) !important;
  }
}
[color-scheme='dark'] {
  --color-site-body: #121212;
  --color-read-bkg: #1f1f1f;
  --color-read-post: #262626;
  --color-site-bg: #1f1f1f;
  --color-site-inner: rgba(238,238,238,0.871);
  --color-site-footer: rgba(170,170,170,0.871);
  --color-card: #262626;
  --color-text: rgba(238,238,238,0.871);
  --color-block: #434343;
  --color-codeblock: #1f1f1f;
  --color-inlinecode: #d56d28;
  --color-h1: rgba(255,255,255,0.871);
  --color-h2: rgba(255,255,255,0.871);
  --color-h3: rgba(255,255,255,0.6);
  --color-h4: rgba(255,255,255,0.6);
  --color-h5: rgba(255,255,255,0.6);
  --color-h6: rgba(255,255,255,0.6);
  --color-p: rgba(217,217,217,0.871);
  --color-list: rgba(217,217,217,0.871);
  --color-list-hl: #f7e570;
  --color-meta: rgba(191,191,191,0.871);
  --color-link: rgba(191,191,191,0.871);
  --color-copyright-bkg: #21252b;
}
[color-scheme='dark'] img {
  filter: brightness(70%) !important;
}
[color-scheme='dark'] .blur {
  background: rgba(31,31,31,0.9) !important;
}
[color-scheme='dark'] .white-box.blur {
  background: rgba(38,38,38,0.9) !important;
}
[color-scheme='dark'] .nav-main .u-search-input {
  background: var(--color-card) !important;
}
[color-scheme='dark'] #l_main .article .prev-next>a {
  background: var(--color-block) !important;
}
[color-scheme='dark'] #l_main .article .prev-next>a:hover {
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] .article blockquote {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .article-title a {
  color: var(--color-h1) !important;
}
[color-scheme='dark'] details>summary {
  color: var(--color-p) !important;
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] details {
  border: 1px solid var(--color-site-bg) !important;
  background: var(--color-site-bg) !important;
}
[color-scheme='dark'] #u-search .modal,
[color-scheme='dark'] #u-search .modal-header,
[color-scheme='dark'] #u-search .modal-body {
  background: var(--color-card) !important;
}
[color-scheme='dark'] #u-search .modal-body .modal-results .result:hover {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .u-search-input:hover {
  background: var(--color-block) !important;
}
[color-scheme='dark'] .u-search-input:focus {
  background: var(--color-site-body) !important;
}
@media screen and (max-width: 500px) {
  [color-scheme='dark'] .l_header .m_search {
    background: var(--color-site-bg) !important;
  }
}
@font-face {
  font-family: 'UbuntuMono';
  src: url("https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/UbuntuMono/UbuntuMono-Regular.ttf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
@font-face {
  font-family: 'Varela Round';
  src: url("https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/VarelaRound/VarelaRound-Regular.ttf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
.l_header {
  position: fixed;
  z-index: 1000;
  top: 0;
  width: 100%;
  height: 64px;
  background: var(--color-card);
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.l_header.auto {
  transition: opacity 0.4s ease;
  -webkit-transition: opacity 0.4s ease;
  -khtml-transition: opacity 0.4s ease;
  -moz-transition: opacity 0.4s ease;
  -o-transition: opacity 0.4s ease;
  -ms-transition: opacity 0.4s ease;
  visibility: hidden;
}
.l_header.auto.show {
  opacity: 1 !important;
  -webkit-opacity: 1 !important;
  -moz-opacity: 1 !important;
  visibility: visible;
}
.l_header .container {
  margin-left: 16px;
  margin-right: 16px;
}
.l_header #wrapper {
  height: 100%;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.l_header #wrapper .nav-main,
.l_header #wrapper .nav-sub {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  justify-content: space-between;
  -webkit-justify-content: space-between;
  -khtml-justify-content: space-between;
  -moz-justify-content: space-between;
  -o-justify-content: space-between;
  -ms-justify-content: space-between;
  align-items: center;
}
.l_header #wrapper .nav-main {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.l_header #wrapper.sub .nav-main {
  transform: translateY(-64px);
  -webkit-transform: translateY(-64px);
  -khtml-transform: translateY(-64px);
  -moz-transform: translateY(-64px);
  -o-transform: translateY(-64px);
  -ms-transform: translateY(-64px);
}
.l_header #wrapper .nav-sub {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  opacity: 0;
  -webkit-opacity: 0;
  -moz-opacity: 0;
  height: 64px;
  width: calc(100% - 2 * 16px);
  position: absolute;
}
.l_header #wrapper .nav-sub ::-webkit-scrollbar {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (min-width: 2048px) {
  .l_header #wrapper .nav-sub {
    max-width: 55vw;
    margin: auto;
  }
}
.l_header #wrapper.sub .nav-sub {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
}
.l_header #wrapper .title {
  position: relative;
  color: var(--color-text);
  padding-left: 24px;
  max-height: 64px;
}
.l_header #wrapper .nav-main .title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex-shrink: 0;
  line-height: 64px;
  padding: 0 24px;
  font-size: 1.25rem;
  font-family: "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
}
.l_header #wrapper .nav-main .title img {
  height: 64px;
}
.l_header .nav-sub {
  max-width: 1080px;
  margin: auto;
}
.l_header .nav-sub .title {
  font-weight: bold;
  font-family: UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  line-height: 1.2;
  max-height: 64px;
  white-space: normal;
  flex-shrink: 1;
}
.l_header .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  line-height: 64px;
  align-items: center;
}
.l_header .switcher .s-toc {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (max-width: 768px) {
  .l_header .switcher .s-toc {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
  }
}
.l_header .switcher >li {
  height: 48px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  margin: 2px;
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li {
    margin: 0 1px;
    height: 48px;
  }
}
.l_header .switcher >li >a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  align-items: center;
  width: 48px;
  height: 48px;
  padding: 0.85em 1.1em;
  border-radius: 100px;
  -webkit-border-radius: 100px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  color: #f5df4d;
}
.l_header .switcher >li >a:hover {
  border: none;
}
.l_header .switcher >li >a.active,
.l_header .switcher >li >a:active {
  border: none;
  background: var(--color-site-bg);
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li >a {
    width: 36px;
    height: 48px;
  }
}
.l_header .nav-sub .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
}
.l_header .m_search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  height: 64px;
  width: 240px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (max-width: 1024px) {
  .l_header .m_search {
    width: 44px;
    min-width: 44px;
  }
  .l_header .m_search input::placeholder {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
  }
  .l_header .m_search:hover {
    width: 240px;
  }
  .l_header .m_search:hover input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (min-width: 500px) {
  .l_header .m_search:hover .input {
    width: 100%;
  }
  .l_header .m_search:hover .input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search {
    min-width: 0;
  }
  .l_header .m_search input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.l_header .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  width: 100%;
  align-items: center;
}
.l_header .m_search .icon {
  position: absolute;
  width: 36px;
  left: 5px;
  color: var(--color-meta);
}
@media screen and (max-width: 500px) {
  .l_header .m_search .icon {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
.l_header .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding-top: 8px;
  padding-bottom: 8px;
  line-height: 1.3;
  width: 100%;
  color: var(--color-text);
  background: #fafafa;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  padding-left: 40px;
  font-size: 0.875rem;
  border-radius: 8px;
  -webkit-border-radius: 8px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (min-width: 500px) {
  .l_header .m_search .input:focus {
    box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
    -webkit-box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search .input {
    background: var(--color-block);
    padding-left: 8px;
    border: none;
  }
  .l_header .m_search .input:hover,
  .l_header .m_search .input:focus {
    border: none;
  }
}
@media (max-width: 500px) {
  .l_header .m_search {
    left: 0;
    width: 0;
    overflow: hidden;
    position: absolute;
    background: #fff;
    transition: all 0.28s ease;
    -webkit-transition: all 0.28s ease;
    -khtml-transition: all 0.28s ease;
    -moz-transition: all 0.28s ease;
    -o-transition: all 0.28s ease;
    -ms-transition: all 0.28s ease;
  }
  .l_header .m_search .input {
    border-radius: 32px;
    -webkit-border-radius: 32px;
    margin-left: 16px;
    padding-left: 16px;
  }
  .l_header.z_search-open .m_search {
    width: 100%;
  }
  .l_header.z_search-open .m_search .input {
    width: calc(100% - 120px);
  }
}
ul.m-pc >li>a {
  color: inherit;
  border-bottom: 2px solid transparent;
}
ul.m-pc >li>a:active,
ul.m-pc >li>a.active {
  border-bottom: 2px solid #f5df4d;
}
ul.m-pc li:hover >ul.list-v,
ul.list-v li:hover >ul.list-v {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.nav-list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  align-items: stretch;
}
ul.nav-list-h>li {
  position: relative;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  height: 100%;
  line-height: 2.4;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
ul.nav-list-h>li >a {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 600;
}
ul.list-v {
  z-index: 1;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: absolute;
  background: var(--color-card);
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  margin-top: -6px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  padding: 8px 0;
}
ul.list-v.show {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.list-v hr {
  margin-top: 8px;
  margin-bottom: 8px;
}
ul.list-v >li {
  white-space: nowrap;
  word-break: keep-all;
}
ul.list-v >li.header {
  font-size: 0.78125rem;
  font-weight: bold;
  line-height: 2em;
  color: var(--color-meta);
  margin: 8px 16px 4px;
}
ul.list-v >li.header i {
  margin-right: 8px;
}
ul.list-v >li ul {
  margin-left: 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: -40px;
}
ul.list-v .aplayer-container {
  min-height: 64px;
  padding: 6px 16px;
}
ul.list-v >li>a {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  color: var(--color-list);
  font-size: 0.875rem;
  font-weight: bold;
  line-height: 36px;
  padding: 0 20px 0 16px;
  text-overflow: ellipsis;
  margin: 0 4px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
@media screen and (max-width: 1024px) {
  ul.list-v >li>a {
    line-height: 40px;
  }
}
ul.list-v >li>a >i {
  margin-right: 8px;
}
ul.list-v >li>a:active,
ul.list-v >li>a.active {
  color: var(--color-list-hl);
}
ul.list-v >li>a:hover {
  color: var(--color-list-hl);
  background: var(--color-site-bg);
}
.l_header .menu >ul>li>a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding: 0 8px;
}
.l_header .menu >ul>li>a >i {
  margin-right: 4px;
}
.l_header ul.nav-list-h>li {
  color: var(--color-list);
  line-height: 64px;
}
.l_header ul.nav-list-h>li >a {
  max-height: 64px;
  overflow: hidden;
  color: inherit;
}
.l_header ul.nav-list-h>li >a:active,
.l_header ul.nav-list-h>li >a.active {
  color: #f5df4d;
}
.l_header ul.nav-list-h>li:hover>a {
  color: var(--color-list-hl);
}
.l_header ul.nav-list-h>li i.music {
  animation: rotate-effect 1.5s linear infinite;
  -webkit-animation: rotate-effect 1.5s linear infinite;
  -khtml-animation: rotate-effect 1.5s linear infinite;
  -moz-animation: rotate-effect 1.5s linear infinite;
  -o-animation: rotate-effect 1.5s linear infinite;
  -ms-animation: rotate-effect 1.5s linear infinite;
}
@-moz-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-webkit-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-o-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
.menu-phone li ul.list-v {
  right: calc(100% - 0.5 * 16px);
}
.menu-phone li ul.list-v ul {
  right: calc(100% - 0.5 * 16px);
}
#wrapper {
  max-width: 1080px;
  margin: auto;
}
@media screen and (min-width: 2048px) {
  #wrapper {
    max-width: 55vw;
  }
}
#wrapper .menu {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 1;
  -ms-flex: 1 1;
  flex: 1 1;
  margin: 0 16px 0 0;
}
#wrapper .menu .list-v ul {
  left: calc(100% - 0.5 * 16px);
}
.menu-phone {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: 16px;
  right: 8px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.menu-phone ul {
  right: calc(100% - 0.5 * 16px);
}
@media screen and (max-width: 500px) {
  .menu-phone {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: block;
  }
}
.l_header {
  max-width: 65vw;
  left: calc((100% - 65vw) * 0.5);
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
}
@media screen and (max-width: 2048px) {
  .l_header {
    max-width: 1112px;
    left: calc((100% - 1112px) * 0.5);
  }
}
@media screen and (max-width: 1112px) {
  .l_header {
    left: 0;
    border-radius: 0;
    -webkit-border-radius: 0;
    max-width: 100%;
  }
}
@media screen and (max-width: 500px) {
  .l_header .container {
    margin-left: 0;
    margin-right: 0;
  }
  .l_header #wrapper .nav-main .title {
    padding-left: 16px;
    padding-right: 16px;
  }
  .l_header #wrapper .nav-sub {
    width: 100%;
  }
  .l_header #wrapper .nav-sub .title {
    overflow-y: scroll;
    margin-top: 2px;
    padding: 8px 16px;
  }
  .l_header #wrapper .switcher {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
    margin-right: 8px;
  }
  .l_header .menu {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
@media screen and (max-width: 500px) {
  .list-v li {
    max-width: 270px;
  }
}
#u-search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  padding: 60px 20px;
  z-index: 1001;
}
@media screen and (max-width: 680px) {
  #u-search {
    padding: 0px;
  }
}
@media screen and (prefers-color-scheme: dark) and (max-width: 500px) {
  .l_header .m_search {
    background: var(--color-site-bg) !important;
  }
}

  </style>
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
    <script>
      let userColorScheme=localStorage.getItem("color-scheme")
      if(userColorScheme){
        document.documentElement.setAttribute("color-scheme", userColorScheme);
      }
    </script>
  
<script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
    '.kill-t{'+
      'font-size: 2rem;'+
    '}'+
    '.kill-c{'+
      'font-size: 1.2rem;'+
    '}'+
		'#l_header,#l_body{'+
			'display: none;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        `<span class="kill-t"><b>Sorry, your browser cannot access this site</b></span><br/>`+
        `<span class="kill-c">Microsoft has terminated support for Internet Explorer (IE) 10 and earlier versions in 2016. <br/>There are great security risks to continue using it. Please use contemporary mainstream browsers to access.</span><br/>`+
        `<a target="_blank" rel="noopener" href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/"><strong>Learn more ></strong></a>`+
    '</div>');
</script>


<noscript>
	<style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
    .kill-t{
      font-size: 2rem;
    }
    .kill-c{
      font-size: 1.2rem;
    }
		#l_header,#l_body{
			display: none;
		}
	</style>
    <div class="kill-noscript">
        <span class="kill-t"><b>Sorry, your browser cannot access this site</b></span><br/>
        <span class="kill-c">This page requires browser support (enable) JavaScript</span><br/>
        <a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=启用JavaScript"><strong>Learn more ></strong></a>
    </div>
</noscript>


  <script>
  /************这个文件存放不需要重载的全局变量和全局函数*********/
  window.volantis = {}; // volantis 全局变量
  volantis.debug = "env"; // 调试模式
  volantis.dom = {}; // 页面Dom see: /source/js/app.js etc.

  volantis.GLOBAL_CONFIG ={
    debug: "env",
    cdn: {"js":{"app":"/js/app.js","parallax":"/js/plugins/parallax.js","rightMenu":"/js/plugins/rightMenu.js","rightMenus":"/js/plugins/rightMenus.js","sites":"/js/plugins/tags/sites.js","friends":"/js/plugins/tags/friends.js","contributors":"/js/plugins/tags/contributors.js","search":"/js/search/hexo.js"},"css":{"style":"/css/style.css"}},
    default: {"avatar":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/avatar/round/3442075.svg","link":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/link/8f277b4ee0ecd.svg","cover":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/cover/76b86c0226ffd.svg","image":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/image/2659360.svg"},
    lastupdate: new Date(1722341071998),
    sidebar: {
      for_page: ["blogger","category","tagcloud","donate"],
      for_post: ["toc"],
      webinfo: {
        lastupd: {
          enable: true,
          friendlyShow: true
        },
        runtime: {
          data: "2020/01/01",
          unit: "天"
        }
      }
    },
    plugins: {
      message: {"enable":true,"css":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/izitoast/dist/css/iziToast.min.css","js":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/izitoast/dist/js/iziToast.min.js","icon":{"default":"fa-solid fa-info-circle light-blue","quection":"fa-solid fa-question-circle light-blue"},"time":{"default":5000,"quection":20000},"position":"topRight","transitionIn":"bounceInLeft","transitionOut":"fadeOutRight","titleColor":"var(--color-text)","messageColor":"var(--color-text)","backgroundColor":"var(--color-card)","zindex":2147483647,"copyright":{"enable":true,"title":"知识共享许可协议","message":"请遵守 CC BY-NC-SA 4.0 协议。","icon":"far fa-copyright light-blue"},"aplayer":{"enable":true,"play":"fa-solid fa-play","pause":"fa-solid fa-pause"},"rightmenu":{"enable":true,"notice":true}},
      fancybox: {"css":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fancyapps/ui/dist/fancybox.css","js":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fancyapps/ui/dist/fancybox.umd.js"},
      
      aplayer: {
        id: 2674113840,
        enable:true
      },
      
      
      
      rightmenus: {"enable":true,"order":["plugins.navigation","hr","plugins.inputBox","plugins.seletctText","plugins.elementCheck","plugins.elementImage","menus.link","hr","menus.darkMode","plugins.articlePage","music"],"options":{"iconPrefix":"fa-solid","articleShowLink":true,"musicAlwaysShow":true},"plugins":{"navigation":[{"id":"left","name":"转到上一页","icon":"fa-solid fa-arrow-left","event":"history.back()","group":"navigation"},{"id":"right","name":"转到下一页","icon":"fa-solid fa-arrow-right","event":"history.forward()","group":"navigation"},{"id":"redo","name":"刷新当前页面","icon":"fa-solid fa-redo","event":"window.location.reload()","group":"navigation"},{"id":"up","name":"回到顶部","icon":"fa-solid fa-arrow-up","event":"VolantisApp.scrolltoElement(volantis.dom.bodyAnchor)","group":"navigation"}],"inputBox":[{"id":"copyPaste","name":"粘贴文本","icon":"fa-solid fa-paste","event":"copyPaste","group":"inputBox"},{"id":"copyAll","name":"全选文本","icon":"fa-solid fa-object-ungroup","event":"copyAll","group":"inputBox"},{"id":"copyCut","name":"剪切文本","icon":"fa-solid fa-cut","event":"copyCut","group":"inputBox"}],"seletctText":[{"id":"copyText","name":"复制文本","icon":"fa-solid fa-copy","event":"copyText","group":"seletctText"},{"id":"searchWord","name":"站内搜索","icon":"fa-solid fa-search","event":"OpenSearch(__text__)","group":"seletctText"},{"id":"bingSearch","name":"必应搜索","icon":"fa-solid fa-search","event":"window.open(`https://cn.bing.com/search?q=${__text__}`)","group":"seletctText"}],"elementCheck":[{"id":"openTab","name":"新标签页打开","icon":"fa-solid fa-external-link-square-alt","event":"window.open(__link__)","group":"elementCheck"},{"id":"copyLink","name":"复制链接地址","icon":"fa-solid fa-link","event":"copyLink","group":"elementCheck"}],"elementImage":[{"id":"copyImg","name":"复制图片","icon":"fa-solid fa-image","event":"copyImg","group":"elementImage"},{"id":"googleImg","name":"谷歌识图","icon":"fa-solid fa-images","event":"window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)","group":"elementImage"}],"articlePage":[{"id":"printMode","name":"打印页面","icon":"fa-solid fa-print","event":"printMode","group":"articlePage"},{"id":"readMode","name":"阅读模式","icon":"fa-solid fa-book-open","event":"readMode","group":"articlePage"}]},"menus":{"link":[{"id":"help","name":"常见问题","icon":"fa-solid fa-question","link":"https://volantis.js.org/faqs/","group":"link"},"hr",{"id":"source_docs","name":"本站源码","icon":"fa-solid fa-code-branch","link":"https://github.com/enderxiao/enderxiao.github.io/","group":"link"},{"id":"source_theme","name":"主题源码","icon":"fa-solid fa-code-branch","link":"https://github.com/volantis-x/hexo-theme-volantis/","group":"link"}],"darkMode":[{"id":"darkMode","name":"暗黑模式","icon":"fa-solid fa-moon","event":"volantis.dark.toggle()","group":"darkMode"}]}}
      
    }
  }

  /******************** volantis.EventListener ********************************/
  // 事件监听器 see: /source/js/app.js
  volantis.EventListener = {}
  // 这里存放pjax切换页面时将被移除的事件监听器
  volantis.EventListener.list = []
  //构造方法
  function volantisEventListener(type, f, ele) {
    this.type = type
    this.f = f
    this.ele = ele
  }
  // 移除事件监听器
  volantis.EventListener.remove = () => {
    volantis.EventListener.list.forEach(function (i) {
      i.ele.removeEventListener(i.type, i.f, false)
    })
    volantis.EventListener.list = []
  }
  /******************** volantis.dom.$ ********************************/
  // 注：这里没有选择器，也没有forEach一次只处理一个dom，这里重新封装主题常用的dom方法，返回的是dom对象，对象包含了以下方法，同时保留dom的原生API
  function volantisDom(ele) {
    if (!ele) ele = document.createElement("div")
    this.ele = ele;
    // ==============================================================
    this.ele.find = (c) => {
      let q = this.ele.querySelector(c)
      if (q)
        return new volantisDom(q)
    }
    // ==============================================================
    this.ele.hasClass = (c) => {
      return this.ele.className.match(new RegExp('(\\s|^)' + c + '(\\s|$)'));
    }
    this.ele.addClass = (c) => {
      this.ele.classList.add(c);
      return this.ele
    }
    this.ele.removeClass = (c) => {
      this.ele.classList.remove(c);
      return this.ele
    }
    this.ele.toggleClass = (c) => {
      if (this.ele.hasClass(c)) {
        this.ele.removeClass(c)
      } else {
        this.ele.addClass(c)
      }
      return this.ele
    }
    // ==============================================================
    // 参数 r 为 true 表示pjax切换页面时事件监听器将被移除，false不移除
    this.ele.on = (c, f, r = 1) => {
      this.ele.addEventListener(c, f, false)
      if (r) {
        volantis.EventListener.list.push(new volantisEventListener(c, f, this.ele))
      }
      return this.ele
    }
    this.ele.click = (f, r) => {
      this.ele.on("click", f, r)
      return this.ele
    }
    this.ele.scroll = (f, r) => {
      this.ele.on("scroll", f, r)
      return this.ele
    }
    // ==============================================================
    this.ele.html = (c) => {
      // if(c=== undefined){
      //   return this.ele.innerHTML
      // }else{
      this.ele.innerHTML = c
      return this.ele
      // }
    }
    // ==============================================================
    this.ele.hide = (c) => {
      this.ele.style.display = "none"
      return this.ele
    }
    this.ele.show = (c) => {
      this.ele.style.display = "block"
      return this.ele
    }
    // ==============================================================
    return this.ele
  }
  volantis.dom.$ = (ele) => {
    return !!ele ? new volantisDom(ele) : null;
  }
  /******************** RunItem ********************************/
  function RunItem() {
    this.list = []; // 存放回调函数
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = ()=>{
          volantis.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) =>{
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index,1);
        }
      }
    }
    // 构造一个可以run的对象
    function Item(fn, name) {
      // 函数名称
      this.name = name || fn.name;
      // run方法
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }
  /******************** Pjax ********************************/
  // /layout/_plugins/pjax/index.ejs
  // volantis.pjax.send(callBack[,"callBackName"]) 传入pjax:send回调函数
  // volantis.pjax.push(callBack[,"callBackName"]) 传入pjax:complete回调函数
  // volantis.pjax.error(callBack[,"callBackName"]) 传入pjax:error回调函数
  volantis.pjax = {};
  volantis.pjax.method = {
    complete: new RunItem(),
    error: new RunItem(),
    send: new RunItem(),
  };
  volantis.pjax = Object.assign(volantis.pjax, {
    push: volantis.pjax.method.complete.push,
    error: volantis.pjax.method.error.push,
    send: volantis.pjax.method.send.push,
  });
  /******************** RightMenu ********************************/
  // volantis.rightmenu.handle(callBack[,"callBackName"]) 外部菜单项控制
  // 可在 volantis.mouseEvent 处获取右键事件
  volantis.rightmenu = {};
  volantis.rightmenu.method = {
    handle: new RunItem(),
  }
  volantis.rightmenu = Object.assign(volantis.rightmenu, {
    handle: volantis.rightmenu.method.handle.push,
  });
  /********************  Dark Mode  ********************************/
  // /layout/_partial/scripts/darkmode.ejs
  // volantis.dark.mode 当前模式 dark or light
  // volantis.dark.toggle() 暗黑模式触发器
  // volantis.dark.push(callBack[,"callBackName"]) 传入触发器回调函数
  volantis.dark = {};
  volantis.dark.method = {
    toggle: new RunItem(),
  };
  volantis.dark = Object.assign(volantis.dark, {
    push: volantis.dark.method.toggle.push,
  });
  /********************  Message  ********************************/
  // VolantisApp.message
  /********************  isMobile  ********************************/
  // /source/js/app.js
  // volantis.isMobile
  // volantis.isMobileOld
  /********************脚本动态加载函数********************************/
  // volantis.js(src, cb)  cb 可以传入onload回调函数 或者 JSON对象 例如: volantis.js("src", ()=>{}) 或 volantis.js("src", {defer:true,onload:()=>{}})
  // volantis.css(src)

  // 返回Promise对象，如下方法同步加载资源，这利于处理文件资源之间的依赖关系，例如：APlayer 需要在 MetingJS 之前加载
  // (async () => {
  //     await volantis.js("...theme.plugins.aplayer.js.aplayer...")
  //     await volantis.js("...theme.plugins.aplayer.js.meting...")
  // })();

  // 已经加入了setTimeout
  volantis.js = (src, cb) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }
  volantis.css = (src) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  }
  /********************按需加载的插件********************************/
  // volantis.import.jQuery().then(()=>{})
  volantis.import = {
    jQuery: () => {
      if (typeof jQuery == "undefined") {
        return volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/jquery/dist/jquery.min.js")
      } else {
        return new Promise(resolve => {
          resolve()
        });
      }
    }
  }
  /********************** requestAnimationFrame ********************************/
  // 1、requestAnimationFrame 会把每一帧中的所有 DOM 操作集中起来，在一次重绘或回流中就完成，并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率，一般来说，这个频率为每秒60帧。
  // 2、在隐藏或不可见的元素中，requestAnimationFrame 将不会进行重绘或回流，这当然就意味着更少的的 cpu，gpu 和内存使用量。
  volantis.requestAnimationFrame = (fn)=>{
    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
    }
    window.requestAnimationFrame(fn)
  }
  /************************ layoutHelper *****************************************/
  volantis.layoutHelper = (helper, html, opt)=>{
    opt = Object.assign({clean:false, pjax:true}, opt)
    function myhelper(helper, html, clean) {
      volantis.tempDiv = document.createElement("div");
      volantis.tempDiv.innerHTML = html;
      let layoutHelper = document.querySelector("#layoutHelper-"+helper)
      if (layoutHelper) {
        if (clean) {
          layoutHelper.innerHTML = ""
        }
        layoutHelper.append(volantis.tempDiv);
      }
    }
    myhelper(helper, html, opt.clean)
    if (opt.pjax) {
      volantis.pjax.push(()=>{
        myhelper(helper, html, opt.clean)
      },"layoutHelper-"+helper)
    }
  }
  /****************************** 滚动事件处理 ****************************************/
  volantis.scroll = {
    engine: new RunItem(),
    unengine: new RunItem(),
  };
  volantis.scroll = Object.assign(volantis.scroll, {
    push: volantis.scroll.engine.push,
  });
  // 滚动条距离顶部的距离
  volantis.scroll.getScrollTop = () =>{
    let scrollPos;
    if (window.pageYOffset) {
      scrollPos = window.pageYOffset;
    } else if (document.compatMode && document.compatMode != 'BackCompat') {
      scrollPos = document.documentElement.scrollTop;
    } else if (document.body) {
      scrollPos = document.body.scrollTop;
    }
    return scrollPos;
  }
  // 使用 requestAnimationFrame 处理滚动事件
  // `volantis.scroll.del` 中存储了一个数值, 该数值检测一定时间间隔内滚动条滚动的位移, 数值的检测频率是浏览器的刷新频率. 数值为正数时, 表示向下滚动. 数值为负数时, 表示向上滚动.
  volantis.scroll.handleScrollEvents = () => {
    volantis.scroll.lastScrollTop = volantis.scroll.getScrollTop()
    function loop() {
      const scrollTop = volantis.scroll.getScrollTop();
      if (volantis.scroll.lastScrollTop !== scrollTop) {
        volantis.scroll.del = scrollTop - volantis.scroll.lastScrollTop;
        volantis.scroll.lastScrollTop = scrollTop;
        // if (volantis.scroll.del > 0) {
        //   console.log("向下滚动");
        // } else {
        //   console.log("向上滚动");
        // }
        // 注销过期的unengine未滚动事件
        volantis.scroll.unengine.list=[]
        volantis.scroll.engine.start();
      }else{
        volantis.scroll.unengine.start();
      }
      volantis.requestAnimationFrame(loop)
    }
    volantis.requestAnimationFrame(loop)
  }
  volantis.scroll.handleScrollEvents()
  volantis.scroll.ele = null;
  // 触发页面滚动至目标元素位置
  volantis.scroll.to = (ele, option = {}) => {
    if (!ele) return;
    volantis.scroll.ele = ele;
    // 默认配置
    opt = {
      top: ele.getBoundingClientRect().top + document.documentElement.scrollTop,
      behavior: "smooth"
    }
    // 定义配置
    if ("top" in option) {
      opt.top = option.top
    }
    if ("behavior" in option) {
      opt.behavior = option.behavior
    }
    if ("addTop" in option) {
      opt.top += option.addTop
    }
    if (!("observerDic" in option)) {
      option.observerDic = 100
    }
    // 滚动
    window.scrollTo(opt);
    // 监视器
    // 监视并矫正元素滚动到指定位置
    // 用于处理 lazyload 引起的 cls 导致的定位失败问题
    // option.observer = false
    if (option.observer) {
      setTimeout(() => {
        if (volantis.scroll.ele != ele) {
          return
        }
        volantis.scroll.unengine.push(() => {
          let me = ele.getBoundingClientRect().top
          if(!(me >= -option.observerDic && me <= option.observerDic)){
            volantis.scroll.to(ele, option)
          }
          volantis.scroll.unengine.remove("unengineObserver")
        },"unengineObserver")
      },1000)
    }
  }
  /********************** Content Visibility ********************************/
  // 见 source/css/first.styl 如果遇到任何问题 删除 .post-story 即可
  // 一个元素被声明 content-visibility 属性后 如果元素不在 viewport 中 浏览器不会计算其后代元素样式和属性 从而节省 Style & Layout 耗时
  // content-visibility 的副作用: 锚点失效 等等(实验初期 暂不明确), 使用此方法清除样式
  volantis.cleanContentVisibility = ()=>{
    if (document.querySelector(".post-story")) {
      console.log("cleanContentVisibility");
      document.querySelectorAll(".post-story").forEach(e=>{
        e.classList.remove("post-story")
      })
    }
  }
  /******************************************************************************/
  /******************************************************************************/
  /******************************************************************************/
  //图像加载出错时的处理
  function errorImgAvatar(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/avatar/round/3442075.svg";
    img.onerror = null;
  }
  function errorImgCover(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/cover/76b86c0226ffd.svg";
    img.onerror = null;
  }
  /******************************************************************************/
</script>

  <!-- import head_end begin -->
  <!-- import head_end end -->
  <!-- Custom Files headEnd begin-->
  
  <!-- Custom Files headEnd end-->
  <!-- front-matter head_end begin -->
  <!-- front-matter head_end end -->
</head>
  <body itemscope itemtype="http://schema.org/WebPage">
    <!-- import body_begin begin-->
    <!-- import body_begin end-->
    <!-- Custom Files bodyBegin begin-->
    
    <!-- Custom Files bodyBegin end-->
    <!-- front-matter body_begin begin -->
    <!-- front-matter body_begin end -->
    <header itemscope itemtype="http://schema.org/WPHeader" id="l_header" class="l_header auto shadow floatable blur show" style='opacity: 0' >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a id="s-comment" class="fa-solid fa-comments fa-fw" target="_self"  href="/" onclick="return false;" title="comment"></a></li>
        
          <li><a id="s-toc" class="s-toc fa-solid fa-list fa-fw" target="_self"  href="/" onclick="return false;" title="toc"></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='https://z3.ax1x.com/2021/08/06/fmMNRO.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/" title="首页"
                  
                  
                  
                    active-action="action-home"
                  >
                  <i class='fas fa-home fa-fw'></i>首页
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/categories/" title="分类"
                  
                  
                  
                    active-action="action-categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/tags/" title="标签"
                  
                  
                  
                    active-action="action-tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/archives/" title="归档"
                  
                  
                  
                    active-action="action-archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/friends/" title="友链"
                  
                  
                  
                    active-action="action-friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/about/" title="关于"
                  
                  
                  
                    active-action="action-about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                 href="/" onclick="return false;" title="摸!"
                  
                  
                  >
                  <i class='fas fa-gamepad fa-fw'></i>摸!
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/EnderGame.github.2048.io/" title="2048!"
                  
                  
                  
                    active-action="action-EnderGamegithub2048io"
                  >
                  2048!
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/EnderGame.github.MoonSweeper.io/" title="MoonSweeper!"
                  
                  
                  
                    active-action="action-EnderGamegithubMoonSweeperio"
                  >
                  <i class='fas fa-moon fa-fw'></i>MoonSweeper!
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                 href="/" onclick="return false;" title="更多"
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>黑暗模式
                </a>
              <li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>
      
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fa-solid fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>
      

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fa-solid fa-search fa-fw" target="_self" href="/" onclick="return false;" title="search"></a></li>
				
				<li>
          <a class="s-menu fa-solid fa-bars fa-fw" target="_self" href="/" onclick="return false;" title="menu"></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/" title="首页"
                  
                  
                  
                    active-action="action-home"
                  >
                  <i class='fas fa-home fa-fw'></i>首页
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/categories/" title="分类"
                  
                  
                  
                    active-action="action-categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/tags/" title="标签"
                  
                  
                  
                    active-action="action-tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/archives/" title="归档"
                  
                  
                  
                    active-action="action-archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/friends/" title="友链"
                  
                  
                  
                    active-action="action-friends"
                  >
                  <i class='fas fa-link fa-fw'></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/about/" title="关于"
                  
                  
                  
                    active-action="action-about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                 href="/" onclick="return false;" title="摸!"
                  
                  
                  >
                  <i class='fas fa-gamepad fa-fw'></i>摸!
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/EnderGame.github.2048.io/" title="2048!"
                  
                  
                  
                    active-action="action-EnderGamegithub2048io"
                  >
                  2048!
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/EnderGame.github.MoonSweeper.io/" title="MoonSweeper!"
                  
                  
                  
                    active-action="action-EnderGamegithubMoonSweeperio"
                  >
                  <i class='fas fa-moon fa-fw'></i>MoonSweeper!
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                 href="/" onclick="return false;" title="更多"
                  
                  
                  >
                  <i class='fas fa-ellipsis-v fa-fw'></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box header toggle-mode-btn">
                  <i class='fas fa-moon fa-fw'></i>黑暗模式
                </a>
              <li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>

      <!-- Custom Files header begin -->
      
      <!-- Custom Files header end -->
		</div>
	</div>
  </div>
</header>

    <div id="l_body">
      <div id="l_cover">
  
    
      <!-- see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs -->
      <div id="none" class='cover-wrapper post dock' style="display: none;">
        
  <div id="parallax-window"></div>

<div class='cover-body'>
  <div class='top'>
    
      <img no-lazy class='logo' src='https://z3.ax1x.com/2021/08/06/fmncJU.png'/>
    
    
      <p class="title">Ender</p>
    
    
  </div>
  <div class='bottom'>
    <div class='menu navigation'>
      <div class='list-h'>
        
          
            <a href="/"
              
              
              active-action="action-home">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f4f0.svg'><p>Blogs</p>
            </a>
          
            <a href="/categories/"
              
              
              active-action="action-categories">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f516.svg'><p>Categories</p>
            </a>
          
            <a href="/tags/"
              
              
              active-action="action-tags">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f396.svg'><p>Tags</p>
            </a>
          
            <a href="/images/"
              
              
              active-action="action-images">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f389.svg'><p>Images</p>
            </a>
          
            <a href="/archives/"
              
              
              active-action="action-archives">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f5c3.svg'><p>Archives</p>
            </a>
          
            <a target="_blank" rel="noopener" href="https://github.com/enderxiao/enderxiao.github.io/"
              
              
              active-action="action-https:githubcomenderxiaoenderxiaogithubio">
              <img src='https://gcore.jsdelivr.net/gh/twitter/twemoji@13.0/assets/svg/1f9ec.svg'><p>Code</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

        <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
      </div>
    
  
</div>

      <div id="safearea">
        <div class="body-wrapper">
          
<div id="l_main" class=''>
  <article itemscope itemtype="http://schema.org/Article" class="article post white-box reveal md shadow floatable blur article-type-post" id="post" itemscope itemprop="blogPost">
  <link itemprop="mainEntityOfPage" href="http://enderxiao.github.io/2023/08/09/前端补缺Vite/">
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Ender">
  </span>
  <span hidden itemprop="post" itemscope itemtype="http://schema.org/Post">
    <meta itemprop="name" content="Ender">
    <meta itemprop="description" content="a blog of EnderXiao">
  </span>
  


  
    <div class='headimg-div'>
      <a class='headimg-a'>
        <img itemprop="image" class='headimg' src='https://z3.ax1x.com/2021/08/05/fego40.png'/>
      </a>
    </div>
  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title" itemprop="name headline">
        前端补缺Vite
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author' itemprop="author" itemscope itemtype="http://schema.org/Person">
  <a itemprop="url" class='author' href="/" rel="nofollow">
    <img itemprop="image" src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/apple-touch-icon.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/apple-touch-icon.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
    <p itemprop="name">Ender</p>
  </a>
</div>

          
        
          
            
  <div class='new-meta-item category'>
    <i class="fa-solid fa-folder-open fa-fw" aria-hidden="true"></i>
    <a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="sep"></span><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/Vite/">Vite</a>
    
      <span hidden itemprop="about" itemscope itemtype="http://schema.org/Thing">
        <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url"><span itemprop="name">前端</span></a>
      </span>
    
      <span hidden itemprop="about" itemscope itemtype="http://schema.org/Thing">
        <a href="/categories/%E5%89%8D%E7%AB%AF/Vite/" itemprop="url"><span itemprop="name">Vite</span></a>
      </span>
    
  </div>


          
        
          
            <div class="new-meta-item date" itemprop="dateCreated datePublished" datetime="2023-08-09T16:11:25+08:00">
  <a class='notlink'>
    <i class="fa-solid fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：Aug 9, 2023</p>
  </a>
</div>

          
        
          
            


<div class="new-meta-item browse">
  <a class='notlink'>
    <p>
      <i class="fa-solid fa-eye fa-fw" aria-hidden="true"></i>
      
      <span id="lc-pv" data-title="前端补缺Vite" data-path="/2023/08/09/%E5%89%8D%E7%AB%AF%E8%A1%A5%E7%BC%BAVite/">
        <span id='number'><i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i></span>
      </span>
      
      <span>次浏览</span>
    </p>
  </a>
</div>


          
        
        <!-- Custom Files topMeta begin-->
        
        <!-- Custom Files topMeta end-->
      </div>
    
  </div>


  <div id="layoutHelper-page-plugins"></div>
  <div id="post-body" itemprop="articleBody">
    <h2 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h2>
<p>Vite是由Vue公司开发的新型前端构建工具，由两部分组成：</p>
<ul>
<li>一个开发服务器，基于原生ES模块提供了丰富的内建功能，例如模块热更新（HMR）</li>
<li>一套构建指，使用Rollup打包代码，</li>
</ul>
<p>Vite可通过JS API和插件API进行拓展</p>
<h3 id="搭建项目"><a class="markdownIt-Anchor" href="#搭建项目"></a> 搭建项目</h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm init vite@latest</span><br><span class="line">npm create vite@latest</span><br><span class="line">yarn create vite</span><br><span class="line">pnpm create vite</span><br></pre></td></tr></table></figure>
<p>以上均可</p>
<p>这样创建会询问你项目名称和模板</p>
<p>同时也可以使用参数直接指定</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest my<span class="literal">-vue-app</span> <span class="literal">--</span> <span class="literal">--template</span> vue <span class="comment"># npm 7+</span></span><br><span class="line">npm create vite@latest my<span class="literal">-vue-app</span> <span class="literal">--template</span> vue <span class="comment"># npm 6.x</span></span><br><span class="line">yarn create vite my<span class="literal">-vue-app</span> <span class="literal">--template</span> vue</span><br><span class="line">pnpm create vite my<span class="literal">-vue-app</span> <span class="literal">--template</span> vue</span><br></pre></td></tr></table></figure>
<h2 id="执行过程"><a class="markdownIt-Anchor" href="#执行过程"></a> 执行过程</h2>
<p>在项目搭建完成后我们可以使用</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>
<p>命令来运行项目</p>
<p>该命令首先回去寻找项目目录下的<code>package.json</code>文件中的<code>scripts</code>标签中的<code>dev</code>标签</p>
<p>在Vite项目中<code>dev</code>标签会被映射为<code>vite</code></p>
<p>该命令首先会从本地的<code>node_module</code>中查找<code>bin</code>目录下的可执行<code>vite</code></p>
<p>如果没有则会去全局目录中查找</p>
<h2 id="vue3补充"><a class="markdownIt-Anchor" href="#vue3补充"></a> Vue3补充</h2>
<p>Vue3支持三种书写风格：</p>
<ul>
<li>
<p>option API</p>
</li>
<li>
<p>setup函数</p>
<ul>
<li>
<p>setup函数需要将数据返回：</p>
<ul>
<li>
<pre class="highlight"><code class="vue">&lt;template&gt;
	&lt;div&gt;
        &#123;&#123; a &#125;&#125;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
    export default &#123;
        setup() &#123;
            const a = 1
            return &#123;
                a
            &#125;
        &#125;
    &#125;
&lt;/script&gt;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    - 使用双花括号进行双向绑定</span><br><span class="line"></span><br><span class="line">- setup语法糖：</span><br><span class="line"></span><br><span class="line">  - ```vue</span><br><span class="line">      &lt;template&gt;</span><br><span class="line">      	&lt;div&gt;</span><br><span class="line">              &#123;&#123; a &#125;&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;script steup lan=&quot;ts&quot;&gt;</span><br><span class="line">          const a:number = 1</span><br><span class="line">      &lt;/script&gt;</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
</li>
<li>
<p>直接就能进行双向绑定，需要注意的是setup在单页组件（SFC）中只能有一个</p>
</li>
</ul>
</li>
</ul>
<p><code>v-once</code>，即之渲染依次</p>
<p><code>v-memo=&quot;[]&quot;</code>list中接收一个值，配合<code>v-for</code>进行性能优化</p>
<h3 id="ref全家桶"><a class="markdownIt-Anchor" href="#ref全家桶"></a> ref全家桶</h3>
<p>在Vue2的选项是API中我们定义响应式对象会这样创建：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                age:18</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>但在组合式API中，我们则需要使用<code>ref</code>或<code>reactive</code>来注册响应式对象：</p>
<p><code>isRef</code>可以判断一个对象是否为<code>ref</code>对象</p>
<p><code>shallowRef</code>创建浅层次的响应式对象，即引用对象中的数值变化不会引起它的视图变化，需要地址发生变化才会引起视图变化</p>
<ul>
<li>需要注意的是如果在同一作用域对<code>ref</code>和<code>shallowRef</code>对象同时进行修改，<code>shallowRef</code>会受到<code>ref</code>的影响导致视图改变</li>
</ul>
<p><code>triggerRef</code>用于强制更新收集的依赖</p>
<ul>
<li>上面提到的使用<code>ref</code>影响<code>shallowRef</code>的原因是在更新ref对象时调用了<code>triggerRef</code></li>
</ul>
<p><code>customRef</code>自定义Ref，接收一个回调函数作为参数，回调函数有两个参数track和trigger，分别用于收集和触发更新，该回调函数必须实现get和set方法</p>
<blockquote>
<p><strong>注意：</strong></p>
<p>可以在浏览器的控制台设置中 &gt; 首选项 &gt; 控制台 &gt; 启用自定义格式化程序</p>
<p>可以让Ref对象在输出时更简洁</p>
</blockquote>
<p>此外在Vue2中介绍过使用ref获取DOM元素的功能，Vue3中同样可以：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">        &lt;div ref=&quot;dom&quot;&gt;</span><br><span class="line">    		我是DOM        </span><br><span class="line">	    &lt;/div&gt;</span><br><span class="line">        &lt;button @click=&quot;change&quot;&gt;</span><br><span class="line">            获取DOM</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">    const dom = ref&lt;HTMLDivElement&gt;()</span><br><span class="line">    </span><br><span class="line">    const change = () =&gt; &#123;</span><br><span class="line">    // 此处使用?.断言来辅助TS推断</span><br><span class="line">    // 注意由于setUp标签渲染比DOM快，因此函数外读取将为undefined</span><br><span class="line">    // 因此可以放在点击事件中</span><br><span class="line">    console.log(dom.value?.innerText)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">        Ref: &#123;&#123; Man &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">        shallowRef: &#123;&#123; Man3 &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">	&lt;button @click=&quot;change&quot;&gt;</span><br><span class="line">        修改</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123; ref, isRef, shallowRef, triggerRef, customRef &#125; from &#x27;vue&#x27;</span><br><span class="line">    import type &#123; Ref &#125; from &#x27;vue&#x27; // Ref的泛型</span><br><span class="line">    </span><br><span class="line">    // 自定义Ref</span><br><span class="line">    function MyRef&lt;T&gt;(value:T) &#123;</span><br><span class="line">        return customRef((track, trigger) =&gt; &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                get() &#123;</span><br><span class="line">                    track()</span><br><span class="line">                    return value</span><br><span class="line">                &#125;,</span><br><span class="line">                set(newVal) &#123;</span><br><span class="line">                    value=newVal</span><br><span class="line">                    trigger()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    type M = &#123;</span><br><span class="line">        name:string</span><br><span class="line">    &#125;</span><br><span class="line">    // 直接使用ref</span><br><span class="line">    const Man = ref&lt;M&gt;(&#123; name: &#x27;Ender&#x27; &#125;)</span><br><span class="line">    // 使用Ref接口</span><br><span class="line">    const Man:Ref&lt;M&gt; = ref(&#123; name: &#x27;Ender&#x27; &#125;)</span><br><span class="line">    const Man2 = &#123; name: &#x27;Ender3&#x27; &#125;</span><br><span class="line">    const Man3 = shallowRef(&#123; name: &#x27;Ender4&#x27; &#125;)</span><br><span class="line">    const customRefMan = MyRef&lt;string&gt;(&#x27;customEnder&#x27;)</span><br><span class="line">    const change = () =&gt; &#123;</span><br><span class="line">        // 修改和取值时需要通过value访问其中的值</span><br><span class="line">        Man.value.name = &#x27;Ender2&#x27;</span><br><span class="line">        // shallowRef使用这样的方式修改视图将不会同步改变</span><br><span class="line">        Man2.value.name = &#x27;Ender2&#x27;  // 但此处仍然会发生改变，因为收到了ref的影响</span><br><span class="line">        // shallowRef需要使用这样的方式修改</span><br><span class="line">        Man2.value = &#123;</span><br><span class="line">            name: &quot;Ender2&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        // 但如果调用了triggerRef,即使是shallowRef也一样会被更新</span><br><span class="line">        triggerRef()</span><br><span class="line">        // 自定义Ref同样通过value的方式进行值修改</span><br><span class="line">        customRefMan.value = &#x27;customEnder修改了&#x27;</span><br><span class="line">        console.log(isRef(Man2))</span><br><span class="line">        console.log(Man)</span><br><span class="line">        console.log(Man)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="reactive全家桶"><a class="markdownIt-Anchor" href="#reactive全家桶"></a> reactive全家桶</h3>
<p>与ref一样，目的是将变量变为响应式对象，但和ref还是有区别的：</p>
<ul>
<li><code>ref</code>支持所有类型，但<code>reactive</code>只支持引用类型（Array， Object，Map，Set）（reactive同样支持传递泛型</li>
<li><code>reactive</code>取值和赋值不需要使用<code>.value</code>进行访问，直接使用赋值语句进行修改即可</li>
<li>但需要注意的是<code>reactive</code>对象不能直接赋值，原因是<code>reactive</code>对象是由<code>proxy</code>代理的，直接赋值将破坏响应式对象</li>
</ul>
<p><code>readonly</code>用来创建一个<code>reactive</code>对象的只读视图：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="title function_">reactive</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;Ender&#x27;</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> read = <span class="title function_">readonly</span>(obj)</span><br></pre></td></tr></table></figure>
<p>其中read对象的属性是无法进行赋值操作的，但<strong>read对象会随着obj对象的改变而改变</strong></p>
<p><code>shallowReactive</code>用于创建一个浅层响应式对象，与<code>reactive</code>的区别参考<code>shallowRef</code>和<code>ref</code>的区别:</p>
<ul>
<li><code>shallowReactive</code>的响应式只会添加到对象的第一层属性，即<code>shallowObj.attr</code>，之后层级的属性没有响应式，例如<code>shallowObj.attr.attr2</code></li>
<li>同样的当<code>shallowReactive</code>和<code>reactive</code>的域相同时，也会受到<code>reactive</code>的影响而发生改变</li>
</ul>
<h3 id="to全家桶"><a class="markdownIt-Anchor" href="#to全家桶"></a> to全家桶</h3>
<ul>
<li><code>toRef</code>
<ul>
<li>接收两个参数<code>(obj, key)</code></li>
<li>其中obj为一个响应式对象（传入非响应式对象将不会产生影响）
<ul>
<li>原因是使用<code>ref</code>或<code>reactive</code>创建的响应式对象中的get和set方法会调用<code>track</code>收集依赖和<code>trigar</code>更新依赖</li>
<li>因此在<code>toRef</code>返回的响应式对象中并没有做这两个操作，目的是防止传入响应式对象时收集和更新了两次</li>
<li>所以非响应式对象即使传入<code>toRef</code>函数，返回的对象中也并不会调用收集和更新函数</li>
</ul>
</li>
<li>key为一个属性key</li>
<li>作用是可以让响应式obj中的某个属性变为响应式</li>
<li>使用场景为：
<ul>
<li><strong>将对象中的某个属性包装为一个响应式对象提供给外部使用，而不暴露整个对象</strong></li>
<li><strong>有时需要将响应式对象中的某些属性解构出来传递给某个函数，由于解构操作使得属性失去响应式，此时需要使用它将这些属性变为响应式的</strong></li>
</ul>
</li>
</ul>
</li>
<li><code>toRefs</code>
<ul>
<li>指定了泛型为Object</li>
<li>接收一个Object类型的参数</li>
<li>即将这个对象中的所有属性均调用<code>toRef</code>变为响应式属性后，将整个新对象返回</li>
<li>使用场景：
<ul>
<li><strong>需要对整个对象进行解构取值时</strong></li>
<li><code>let &#123; name, age, like &#125; = toRefs(obj)</code>此时name、age、like均为响应式</li>
<li>如果此处不调用<code>toRefs</code>函数，得到的变量将不是响应式的，即修改将不会被更新</li>
</ul>
</li>
</ul>
</li>
<li><code>toRaw</code>
<ul>
<li>接收一个Object类型的参数</li>
<li>将传入的响应式Object转化为普通对象，即<strong>取消响应式</strong></li>
<li>源码中就是返回了响应式对象中的<code>__v_raw</code>属性的值</li>
</ul>
</li>
</ul>
<h3 id="vue3响应式原理"><a class="markdownIt-Anchor" href="#vue3响应式原理"></a> Vue3响应式原理</h3>
<p>Vue2中使用<code>Object.defineProperty</code>实现响应式</p>
<p>Vue3中则使用<code>Proxy</code>来实现</p>
<ul>
<li>vue2的不足
<ul>
<li>Vue2中的方法只能劫持设置好的数据，新增的数据需要使用<code>Vue.set()</code></li>
<li>数组只能操作种方式，修改某一项值无法劫持</li>
</ul>
</li>
</ul>
<p>下面是Vue3的响应式实现：</p>
<p><code>effect.ts</code>用于处理数据绑定</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> effect函数用于处理DOM渲染与数据的绑定</span></span><br><span class="line"><span class="comment">// TODO：effect函数接收一个用于DOM渲染的函数</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 定义一个全局变量来存储effect,便于函数外进行收集</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 定义一个脏数据标记方法</span></span><br><span class="line">interface <span class="title class_">Options</span> &#123;</span><br><span class="line">    schedule?: <span class="title class_">Function</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> activeEffect;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">effect</span> = (<span class="params">fn:<span class="built_in">Function</span>, option: Options</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> _effect = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 将fn的作用域提升使得外界可以访问</span></span><br><span class="line">        activeEffect = _effect</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 渲染DOM</span></span><br><span class="line">        <span class="keyword">let</span> res = <span class="title function_">fn</span>()</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 在effect中记录是否需要清除脏数据标记位的操作</span></span><br><span class="line">    _effect.<span class="property">options</span> = option</span><br><span class="line">    <span class="title function_">_effect</span>()</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 将函数返回用于在Computed对象中渲染</span></span><br><span class="line">    <span class="keyword">return</span> _effect</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实现track收集依赖</span></span><br><span class="line"><span class="comment">// TODO：接收一个对象以及对象中的一个属性值</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 一个全局的Map用于构建Object到Map的映射</span></span><br><span class="line"><span class="keyword">const</span> targetMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">track</span> = (<span class="params">target, key</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 取出target对象所对应的属性列表</span></span><br><span class="line">    <span class="keyword">let</span> depsMap = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">    <span class="keyword">if</span>(!depsMap) &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 第一次调用如果没有则添加</span></span><br><span class="line">        depsMap = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">        targetMap.<span class="title function_">set</span>(target, depsMap)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 如果有则将其中的key属性名对应的effect函数set取出</span></span><br><span class="line">    <span class="keyword">let</span> deps = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line">    <span class="keyword">if</span>(!deps) &#123;</span><br><span class="line">        <span class="comment">// 如果没有就添加</span></span><br><span class="line">        deps = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line">        depsMap.<span class="title function_">set</span>(key, deps)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 如果有则将effect函数加入到deps中,收集结束</span></span><br><span class="line">    deps.<span class="title function_">add</span>(activeEffect)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实现trigger触发更新函数</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 接收一个对象以及对象中的一个属性值</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">trigger</span> = (<span class="params">target, key</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 根据对象找到属性MAP</span></span><br><span class="line">    <span class="keyword">let</span> depsMap = targetMap.<span class="title function_">get</span>(target)</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 没有则报错</span></span><br><span class="line">    <span class="keyword">if</span>(!depsMap) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;target is not a effect object&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 存在则取出key对应的effect函数SET</span></span><br><span class="line">    <span class="keyword">let</span> deps = depsMap.<span class="title function_">get</span>(key)</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 如果没有则报错</span></span><br><span class="line">    <span class="keyword">if</span>(!deps) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;target.key is not a effect value&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 存在则重新调用其中的所有effect函数</span></span><br><span class="line">    deps.<span class="title function_">forEach</span>( <span class="function"><span class="params">effect</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 在触发更新时判断这一步更新是否有数据因此变为脏数据，有则重置其脏数据标记位</span></span><br><span class="line">        <span class="keyword">if</span>(effect?.<span class="property">options</span>?.<span class="property">schedule</span>) &#123;</span><br><span class="line">            effect?.<span class="property">options</span>?.<span class="property">schedule</span>?.()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">effect</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>reactive.ts</code>用于处理响应式对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 引入收集和触发机制</span></span><br><span class="line"><span class="keyword">import</span> &#123; track, trigger &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 一个用于判断属性是否为对象的函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = (<span class="params">target:any</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> target!=<span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> target == <span class="string">&#x27;object&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> reactive实现</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> reactive创建一个函数，接收一个对象，并使用泛型限制参数为对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reactive = &lt;T <span class="keyword">extends</span> object&gt;<span class="function">(<span class="params">target:T</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 创建一个proxy对象来代理原有对象</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(target, &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 拦截get</span></span><br><span class="line">        <span class="title function_">get</span>(<span class="params">target, propKey, receiver</span>) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 返回对象中的参数,此处使用Reflect中的参数来保证上下文的正确性</span></span><br><span class="line">            <span class="keyword">let</span> res = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, propKey, receiver) <span class="keyword">as</span> object</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 访问对象属性 后 需要进行资源回收</span></span><br><span class="line">            <span class="title function_">track</span>(target, propKey)</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 如果属性是对象，怎需要递归创建</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_">isObject</span>(res)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">reactive</span>(res)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">set</span>(<span class="params">target, propKey, value, receiver</span>) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 对对象属性进行设置,此处使用Reflect中的参数来保证上下文的正确性</span></span><br><span class="line">            <span class="keyword">let</span> <span class="attr">res</span>:boolean = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, propKey, value, receiver)</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 设置对象属性 后 需要进行依赖更新</span></span><br><span class="line">            <span class="title function_">trigger</span>(target, propKey)</span><br><span class="line">            <span class="keyword">return</span> res</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>computed.ts</code>用于实现计算属性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; effect &#125; <span class="keyword">from</span> <span class="string">&quot;./effect&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 实现计算属性，接收一个getter函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">computed</span> = (<span class="params"><span class="attr">getter</span>:<span class="title class_">Function</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 记录getter方法的响应式函数</span></span><br><span class="line">    <span class="keyword">let</span> _value = <span class="title function_">effect</span>(getter, &#123;</span><br><span class="line">        <span class="attr">schedule</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 回调函数中将数据标记为脏数据</span></span><br><span class="line">            _dirty = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 设置缓存机制</span></span><br><span class="line">    <span class="keyword">let</span> _dirty = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">let</span> cacheValue</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ComputedRefImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 拦截计算属性的访问属性请求</span></span><br><span class="line">        <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 如果为脏数据，则重新计算结果并更新缓存</span></span><br><span class="line">            <span class="keyword">if</span>(_dirty) &#123;</span><br><span class="line">                cacheValue = <span class="title function_">_value</span>()</span><br><span class="line">                _dirty = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 如果不为脏数据，则直接返回缓存结果</span></span><br><span class="line">            <span class="keyword">return</span> cacheValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 返回</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ComputedRefImpl</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;./reactive.ts&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">import</span> &#123; effect &#125; <span class="keyword">from</span> <span class="string">&quot;./effect.ts&quot;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&quot;./computed.ts&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> user = <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">name</span>: <span class="string">&quot;Ender&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">age</span>: <span class="string">&quot;23&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">foo</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">bar</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">sss</span>: <span class="number">123</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">effect</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>).<span class="property">innerText</span> = <span class="string">`<span class="subst">$&#123;user.name&#125;</span> -- <span class="subst">$&#123;user.age&#125;</span> -- <span class="subst">$&#123;user.foo.bar.sss&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">a</span> = <span class="title function_">reactive</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">name</span>: <span class="string">&#x27;a&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">age</span>: <span class="number">18</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 计算属性</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">b</span> = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;重新计算&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> a.<span class="property">age</span> + <span class="number">10</span></span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="computed计算属性"><a class="markdownIt-Anchor" href="#computed计算属性"></a> computed计算属性</h3>
<p>计算属性即当依赖发生改变时，就会触发他的更新，如果依赖值不变，则使用缓存中的属性值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">    	&lt;div&gt;</span><br><span class="line">    		姓：&lt;input v-model=&quot;firstName&quot; type=&quot;text&quot;&gt;</span><br><span class="line">	    &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">    	    名：&lt;input v-model=&quot;lastName&quot; type=&quot;text&quot;&gt;</span><br><span class="line">	    &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            全名: &#123;&#123; name &#125;&#125;</span><br><span class="line">	    &lt;/div&gt;</span><br><span class="line">        &lt;button @click=&quot;changeName&quot;&gt;</span><br><span class="line">            changeName</span><br><span class="line">	    &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&#x27;ts&#x27;&gt;</span><br><span class="line">    import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line">    let firstName = ref(&#x27;张&#x27;)</span><br><span class="line">    let lastName = ref(&#x27;三&#x27;)</span><br><span class="line">    // 1. 选项式写法 支持一个对象传入get、set方法</span><br><span class="line">    // name会随着firstName和lastName的变化而变化</span><br><span class="line">    let name = computed&lt;String&gt;(&#123;</span><br><span class="line">        get () &#123;</span><br><span class="line">            return firstName.value + &#x27;-&#x27; + lastName.value</span><br><span class="line">        &#125;,</span><br><span class="line">        set (newVal) &#123;</span><br><span class="line">            // 将得到的值解构赋值给firstName和lastName</span><br><span class="line">            [firstName.value, lastName.value] = newVal.split(&#x27;-&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    const changeName = () =&gt; &#123;</span><br><span class="line">        // name变量可以直接赋值，赋值时会被computed中的set拦截</span><br><span class="line">        name.value = &#x27;Ender-Xiao&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    // 函数写法 只能支持一个gat函数，不允许修改</span><br><span class="line">    // 使用computed创建的对象是readonly的</span><br><span class="line">    let name = computed(()=&gt; firstName.value + &#x27;-&#x27; + lastName.value)</span><br><span class="line">    </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意：</strong></p>
<p>需要注意的是使用<code>computed</code>函数创建的计算属性是<code>readonly</code>的，无法进行修改</p>
</blockquote>
<h3 id="watch监听器"><a class="markdownIt-Anchor" href="#watch监听器"></a> watch监听器</h3>
<ul>
<li><code>watch(obj, (newVal, oldVal) =&gt; &#123;&#125;, &#123;deep:true&#125;)</code>
<ul>
<li>obj为一个<strong>响应式</strong>对象</li>
<li>第二个参数接收一个回调函数，当obj发生变化时调用该函数
<ul>
<li>其中newVal为改变后的值，oldVal为改变前的值</li>
</ul>
</li>
<li>obj可以传入一个<strong>响应式对象数组</strong>，此时将会监听数组中的每一个对象的变化
<ul>
<li>并且此时的newVal和oldVal都将变为数组</li>
</ul>
</li>
<li>第三个参接收一个对象<code>options</code>，其中包含一些可选项
<ul>
<li><code>deep</code>
<ul>
<li>当obj为一个嵌套多层的对象且，为<code>ref</code>对象时，需要在options中将深度监听<code>deep</code>开启</li>
<li>如果obj是一个<code>reactive</code>对象，那么则不需要开启<code>deep</code></li>
<li>但处理引用对象时，newVal和oldVal中的值将会<strong>相同</strong></li>
</ul>
</li>
<li><code>immediate</code>
<ul>
<li>默认为false</li>
<li>为true时立即调用传入的第二个参数回调函数</li>
</ul>
</li>
<li><code>flash</code>
<ul>
<li>默认为<code>&quot;pre&quot;</code>，表示组件更新之前执行回调</li>
<li><code>&quot;sync&quot;</code>表示与组件更新同步执行回调</li>
<li><code>&quot;post&quot;</code>表示组件更新之后执行回调</li>
</ul>
</li>
</ul>
</li>
<li>当需要监听<strong>响应式对象中的某一个属性时</strong>则需要使用get函数的形式传递：
<ul>
<li><code>watch(()=&gt;obj.attr1.attr2.name, (newVal, oldVal)=&gt;&#123;&#125;)</code></li>
<li>此时newVal为新值，oldVal为旧值</li>
</ul>
</li>
</ul>
</li>
<li><code>watchEffect</code>高级监听器
<ul>
<li><code>const stop = watchEffect((oninvailidate)=&gt;&#123;oninvailidate(() =&gt; &#123;console.log(&quot;before&quot;)&#125;)console.log(message.value)&#125;, &#123;&#125;)</code></li>
<li>该函数接收一个回调函数
<ul>
<li>该回调函数中直接使用某一变量，那么该变量值的改变就将会被监听</li>
<li>回调函数接收一个<code>oninvailidate</code>函数
<ul>
<li>该回调函数接收另一个回调函数</li>
<li>在这个回调函数中的代码将<strong>始终在其监听的变量值发生变化之前运行</strong></li>
</ul>
</li>
<li>接收一个option对象
<ul>
<li><code>flash</code>
<ul>
<li>默认为<code>&quot;pre&quot;</code>，表示组件更新之前执行回调</li>
<li><code>&quot;sync&quot;</code>表示与组件更新同步执行回调</li>
<li><code>&quot;post&quot;</code>表示组件更新之后执行回调</li>
</ul>
</li>
<li><code>onTrigger</code>
<ul>
<li><code>onTrigger(e)&#123;debugger&#125;</code>可以提供调试时使用</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="组件与生命周期"><a class="markdownIt-Anchor" href="#组件与生命周期"></a> 组件与生命周期</h3>
<p>Vue3与2的区别在于，Vue3中在<code>setup</code>中引用组件后<strong>无需注册</strong></p>
<p>而Vue3组件的生命周期区别在于Vue3的<code>setup</code>中的组件没有<code>beforeCreate</code>和<code>created</code>两个生命周期，而使用<code>setup</code>代替</p>
<p><strong>Vue3组件生命周期</strong>：</p>
<ol>
<li><code>setup</code>代码块外面的部分</li>
<li><code>onBeforeMount</code>获取不到DOM</li>
<li><code>onMounted</code>能获取到DOM</li>
<li><code>onBeforeUpdate</code>获取更新前的DOM</li>
<li><code>onUpdated</code>获取更新后的DOM</li>
<li><code>onBeforeUnmount</code></li>
<li><code>onUnmounte</code></li>
<li><code>onRenderTracked((e)=&gt;&#123;&#125;)</code>在依赖收集完成后触发，即访问响应式对象的属性时<code>obj.attr</code></li>
<li><code>onRenderTriggered((e) =&gt; &#123;&#125;)</code>在触发更新时触发，即修改响应式对象的属性时<code>obj.attr=value</code></li>
</ol>
<p>开发时可以使用<code>const instance = getCurrentInstance()</code>来获取当前组件的window对象，而生命周期函数实际上就是挂载到window对象上的函数，因此可以通过这种方式来检测生命周期函数是否挂载上</p>
<h4 id="函数柯里化"><a class="markdownIt-Anchor" href="#函数柯里化"></a> 函数柯里化</h4>
<p>生命周期函数的实现使用了<strong>函数柯里化</strong>技术，因为生命函数创建时都由<code>createHook</code>方法创建，并由名称区别，而其他的参数在同一项目中始终保持不变，因此需要进行<strong>函数柯里化</strong>来保存部分参数，而这一技术实际上就是使用了<strong>函数闭包</strong>的特性将函数和其外部变量一起保存：</p>
<p>柯里化（Currying）又称<strong>部分求值</strong>，一个柯里化的函数首先会接收一些参数，接收了这些参数后，该函数并不会立即求值，而是继续返回另外一个函数，刚才传入的参数在函数形成的闭包中被保存起来。待到函数被真正需要求值的时候，之前传入的所有参数都会被一次性用于求值。</p>
<blockquote>
<p>简单来说就是：柯里化是一种函数的转换，它是指将一个函数从可调用的 f(a, b, c) 转换为可调用的 f(a)(b)©或者f(a, b)©或者f(a)(b, c)</p>
</blockquote>
<p>例如下面这个日志函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数：date, project, message</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">log</span> = (<span class="params">date, project, message</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;date&#125;</span> <span class="subst">$&#123;project&#125;</span> <span class="subst">$&#123;message&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logMsg = <span class="title function_">log</span>(<span class="string">&#x27;2022-07-29&#x27;</span>, <span class="string">&#x27;xxx后台管理系统&#x27;</span>, <span class="string">&#x27;mm接口异常&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(logMsg) <span class="comment">// 输出 2022-07-29 xxx后台管理系统 mm接口异常</span></span><br></pre></td></tr></table></figure>
<p>但通常当天日期是不变的，同一个项目的项目名也是不变的（不过不同的项目名是变化的），唯有信息是时刻变化</p>
<p>如果每次都把所有参数全部传入进去会有很多重复</p>
<p>因此可以对它进行柯里化：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">log</span> = (<span class="params">date</span>) =&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">projectName</span>) =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;date&#125;</span> <span class="subst">$&#123;projectName&#125;</span> <span class="subst">$&#123;message&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 如果日期、项目名、信息都不同的情况下输出日志 */</span></span><br><span class="line"><span class="comment">// 日期为“2022-07-29”，项目名为“A项目”，输出日志</span></span><br><span class="line"><span class="keyword">const</span> logMsg1 = <span class="title function_">log</span>(<span class="string">&#x27;2022-07-29&#x27;</span>)(<span class="string">&#x27;A项目&#x27;</span>)(<span class="string">&#x27;接口报错&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(logMsg1); <span class="comment">// 打印 2022-07-29 A项目 接口报错</span></span><br><span class="line"><span class="comment">// 日期为“2022-07-29”，项目名为“A项目”，输出日志</span></span><br><span class="line"><span class="keyword">const</span> logMsg2 = <span class="title function_">log</span>(<span class="string">&#x27;2022-08-01&#x27;</span>)(<span class="string">&#x27;B项目&#x27;</span>)(<span class="string">&#x27;接口成功&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(logMsg2); <span class="comment">// 打印 2022-08-01 B项目 接口成功</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 如果日期相同，项目名、信息不同的情况下输出日志 */</span></span><br><span class="line"><span class="keyword">const</span> sameDateLog = <span class="title function_">log</span>(<span class="string">&#x27;2022-07-29&#x27;</span>);</span><br><span class="line"><span class="comment">// 项目名为“A项目”，输出日志</span></span><br><span class="line"><span class="keyword">const</span> logMsg3 = <span class="title function_">sameDateLog</span>(<span class="string">&#x27;A项目&#x27;</span>)(<span class="string">&#x27;接口异常&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(logMsg3); <span class="comment">// 打印 2022-07-29 B项目 接口异常</span></span><br><span class="line"><span class="comment">// 项目名为“B项目”，输出日志</span></span><br><span class="line"><span class="keyword">const</span> logMsg4 = <span class="title function_">sameDateLog</span>(<span class="string">&#x27;B项目&#x27;</span>)(<span class="string">&#x27;接口超时&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(logMsg4); <span class="comment">// 打印 2022-07-29 B项目 接口超时</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 如果日期、项目名相同，信息不同的情况下输出日志 */</span></span><br><span class="line"><span class="keyword">const</span> sameDateProjectNameLog = <span class="title function_">log</span>(<span class="string">&#x27;2022-07-29&#x27;</span>)(<span class="string">&#x27;A项目&#x27;</span>);</span><br><span class="line"><span class="comment">// 输出日志</span></span><br><span class="line"><span class="keyword">const</span> logMsg5 = <span class="title function_">sameDateProjectNameLog</span>(<span class="string">&#x27;网络异常&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(logMsg5); <span class="comment">// 打印 2022-07-29 A项目 网络异常</span></span><br></pre></td></tr></table></figure>
<p>可以利用递归来封装一个把任意函数变为柯里化函数的函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数柯里化，利用递归和闭包实现</span></span><br><span class="line"><span class="keyword">const</span> curry = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> len = fn.<span class="property">length</span>; <span class="comment">// 获取初始函数fn的形参个数</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// curry返回改造后的函数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">t</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> innerLength = <span class="variable language_">arguments</span>.<span class="property">length</span>; <span class="comment">// 获取t的实参个数</span></span><br><span class="line">    <span class="keyword">const</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>); <span class="comment">// 将类数组arguments对象转为真正的数组（类数组arguments对象是函数传入的实际参数，类似数组，拥有数组属性，但不是数组）</span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">if</span> (innerLength &gt;= len) &#123; <span class="comment">// 递归出口，如果t实参个数已经大于fn形参个数,则终止递归</span></span><br><span class="line">      <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="literal">undefined</span>, args) <span class="comment">// 执行改造后的函数</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果t的实参个数少于fn的形参个数，说明柯里化并没有完成，则继续执行柯里化</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> innerArgs = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>); <span class="comment">// 将类数组arguments对象转为真正的数组（类数组arguments对象是函数传入的实际参数，类似数组，拥有数组属性，但不是数组）</span></span><br><span class="line">        <span class="keyword">const</span> allArgs = args.<span class="title function_">concat</span>(innerArgs);</span><br><span class="line">        <span class="keyword">return</span> t.<span class="title function_">apply</span>(<span class="literal">undefined</span>, allArgs)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span> (<span class="params">num1, num2, num3, num4, num5</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> num1 + num2 + num3 + num4 + num5;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> finalFun = <span class="title function_">curry</span>(add);</span><br><span class="line"><span class="keyword">const</span> result1 = <span class="title function_">finalFun</span>(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">const</span> result2 = <span class="title function_">finalFun</span>(<span class="number">1</span>, <span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">const</span> result3 = <span class="title function_">finalFun</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">const</span> result4 = <span class="title function_">finalFun</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)(<span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result1, result2, result3, result4); <span class="comment">// 15 15 15 15</span></span><br></pre></td></tr></table></figure>
<h5 id="柯里化经典面试题"><a class="markdownIt-Anchor" href="#柯里化经典面试题"></a> 柯里化经典面试题</h5>
<p>请实现一个add函数实现以下功能 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add(1) // 1</span><br><span class="line">add(1)(2) // 3</span><br><span class="line">add(1)(2)(3) // 6</span><br><span class="line">add(1)(2)(3)(4) // 10</span><br><span class="line">add(1)(2,3) // 6</span><br><span class="line">add(1,2)(3) // 6</span><br><span class="line">add(1,2,3) // 6</span><br></pre></td></tr></table></figure>
<h5 id="函数柯里化应用场景"><a class="markdownIt-Anchor" href="#函数柯里化应用场景"></a> 函数柯里化应用场景</h5>
<ol>
<li>参数复用：即如果函数有重复使用到的参数，可以利用柯里化，将复用的参数存储起来，不需要每次都传相同的参数</li>
<li>延迟执行：传入参数个数没有满足原函数入参个数，都不会立即返回结果，而是返回一个函数。（bind方法就是柯里化的一个示例）</li>
<li>函数式编程中，作为compose, functor, monad 等实现的基础</li>
</ol>
<p>优点：</p>
<ol>
<li>柯里化之后，我们没有丢失任何参数：log 依然可以被正常调用。</li>
<li>我们可以轻松地生成偏函数，例如用于生成今天的日志的偏函数。</li>
<li>入口单一。</li>
<li>易于测试和复用。</li>
</ol>
<p>缺点：</p>
<ol>
<li>函数嵌套多</li>
<li>占内存，有可能导致内存泄漏（因为本质是配合闭包实现的）</li>
<li>效率差（因为使用递归）</li>
<li>变量存取慢，访问性很差（因为使用了arguments）</li>
</ol>
<h3 id="组件间通信"><a class="markdownIt-Anchor" href="#组件间通信"></a> 组件间通信</h3>
<h4 id="父传子props"><a class="markdownIt-Anchor" href="#父传子props"></a> 父传子props</h4>
<p>vue3中使用<code>props</code>传值</p>
<p>父组件通过<code>v-bind(:)</code>将要传递的参数进行绑定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- template --&gt;</span><br><span class="line">&lt;waterFallVue :title=&quot;name&quot;&gt;&lt;/waterFallVue&gt;</span><br><span class="line">&lt;!-- script --&gt;</span><br><span class="line">let name=&quot;ender&quot;</span><br></pre></td></tr></table></figure>
<p>而子组件中如果处于setup模式下，则需要使用<code>defineProps()</code>宏来声明，其中声明的变量是可以直接在模板中使用的，但在宏外的js作用域内，需要通过其返回值<code>props</code>来访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">        &#123;&#123; title &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;!-- script setup --&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    const props = defineProps(&#123;</span><br><span class="line">        title: &#123;</span><br><span class="line">            type: String,</span><br><span class="line">            default: &quot;默认值&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    console.log(props.title)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>在非setup模式下，则需要在setup中接收<code>props</code>参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">      title: String</span><br><span class="line">  &#125;,</span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    // setup() 接收 props 作为第一个参数</span><br><span class="line">    console.log(props.title)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="ts泛型"><a class="markdownIt-Anchor" href="#ts泛型"></a> TS泛型</h5>
<p>值得一提的是，结合TS泛型机制，可以更方便，更整体化的去声明参数：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = defineProps&lt;&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span></span><br><span class="line">&#125;&gt;()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">title</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//TS 定义默认值需要使用withDefaults，该函数第二个参数接收一个对象来定义默认值</span></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">arr</span>: <span class="built_in">number</span>[]</span><br><span class="line">&#125;&gt;(), &#123;</span><br><span class="line">    <span class="comment">// 引用数据类型需要通过函数防止引用</span></span><br><span class="line">    <span class="attr">arr</span>:<span class="function">()=&gt;</span>[<span class="number">6</span>]</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;默认值&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="子传父"><a class="markdownIt-Anchor" href="#子传父"></a> 子传父</h4>
<h5 id="emit自定义事件方式"><a class="markdownIt-Anchor" href="#emit自定义事件方式"></a> emit自定义事件方式</h5>
<ol>
<li>子组件声明自定义事件</li>
<li>在自定义事件中访问子组件自己的变量</li>
<li>父组件将自己的函数<code>fun</code>以<strong>回调函数的方式</strong>传递给子组件的事件</li>
<li>子组件将需要传递的数据<code>data</code>作为回调函数的参数，调用回调函数<code>fun</code></li>
<li>父组件即可在函数<code>fun</code>中接收到子组件的值</li>
</ol>
<p>子组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;on-trans-data&#x27;</span>])</span><br><span class="line"><span class="keyword">const</span> transData = <span class="string">&quot;我是被传递的参数&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">send</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&#x27;on-trans-data&#x27;</span>, transData)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ts中的泛型写法如下</span></span><br><span class="line"><span class="keyword">const</span> emit = defineEmits&lt;&#123;</span><br><span class="line">    (<span class="attr">e</span>:<span class="string">&quot;on-trans-data&quot;</span>,<span class="attr">name</span>:<span class="built_in">string</span>):<span class="built_in">void</span></span><br><span class="line">&#125;&gt;()</span><br><span class="line"><span class="keyword">const</span> transData = <span class="string">&quot;我是被传递的参数&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">send</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&#x27;on-trans-data&#x27;</span>, transData)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>父组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;waterFallVue @on-trans-data=&quot;getData&quot;&gt;&lt;/waterFallVue&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    const getData = (data:String) =&gt; &#123;</span><br><span class="line">        // data为子组件中的数据</span><br><span class="line">        console.log(data)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="defiineexpose方法暴露方法or属性"><a class="markdownIt-Anchor" href="#defiineexpose方法暴露方法or属性"></a> defiineExpose方法暴露方法or属性</h5>
<p>子组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineExpose</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: <span class="string">&quot;Hello&quot;</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>而父组件则要使用ref来获取暴露的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;waterFallVue ref=&quot;waterFall&quot;&gt;&lt;/waterFallVue&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import waterFallVue from &#x27;./components/water-fall.vue&#x27;</span><br><span class="line">    import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">    onMounted(()=&gt;&#123;</span><br><span class="line">	    // 此处需要利用TS的InstanceType来推断类型</span><br><span class="line">        const waterFall = ref&lt;InstanceType&lt;typeof waterFallVue&gt;&gt;()</span><br><span class="line">    	console.log(waterFall.value.data)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="使用defineprops实现瀑布流组件"><a class="markdownIt-Anchor" href="#使用defineprops实现瀑布流组件"></a> 使用defineProps实现瀑布流组件</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;waterFall&quot; class=&quot;ender-waterfall&quot;&gt;</span><br><span class="line">        &lt;div :style=&quot;&#123;height: item.height + &#x27;px&#x27;, background: item.background, left: item.left + &#x27;px&#x27;,top: item.top + &#x27;px&#x27;&#125;&quot; v-for=&quot;(item, index) in waterFallList&quot; :key=&quot;index&quot; class=&quot;ender-waterfall__items&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">// TODO: 接收父组件传来的数据</span><br><span class="line">const props = withDefaults(defineProps&lt;&#123;</span><br><span class="line">    list: any[]</span><br><span class="line">&#125;&gt;(),&#123;</span><br><span class="line">    list: ()=&gt;[&#123;height: 300, background: &#x27;red&#x27;&#125;]</span><br><span class="line">&#125;)</span><br><span class="line">// TODO: 维护需要渲染的元素</span><br><span class="line">const waterFallList = reactive&lt;any[]&gt;([])</span><br><span class="line">// TODO: 维护高度</span><br><span class="line">const heightList:number[] = []</span><br><span class="line"></span><br><span class="line">//TODO: 初始化父组件传来的参数</span><br><span class="line">const init = () =&gt; &#123;</span><br><span class="line">    // TODO: 清空数据</span><br><span class="line">    waterFallList.length = 0</span><br><span class="line">    heightList.length = 0</span><br><span class="line">    const width = 130</span><br><span class="line">    // TODO: 获取可是区域的宽度</span><br><span class="line">    const x = document.getElementById(&quot;waterFall&quot;)?.clientWidth</span><br><span class="line">    const column =Math.floor(x===undefined? 0: x / width)</span><br><span class="line">    console.log(column)</span><br><span class="line">    // TODO: 根据列数从props中拿出第一行</span><br><span class="line">    for (let i = 0; i &lt; props.list.length; i++) &#123;</span><br><span class="line">        if(i&lt;column)&#123;</span><br><span class="line">            // TODO: 第一列元素按顺序放</span><br><span class="line">            props.list[i].left = i * width</span><br><span class="line">            props.list[i].top = 10</span><br><span class="line">            waterFallList.push(props.list[i])</span><br><span class="line">            heightList.push(props.list[i].height + 10)</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            // TODO: 之后的元素放在高度最小的列</span><br><span class="line">            let minHeightIndex = 0;</span><br><span class="line">            let minHeight = heightList[0];</span><br><span class="line">            heightList.forEach((h, index) =&gt; &#123;</span><br><span class="line">                if(h &lt; minHeight)&#123;</span><br><span class="line">                    minHeightIndex = index</span><br><span class="line">                    minHeight = h</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            // TODO: 计算top和left</span><br><span class="line">            props.list[i].left = minHeightIndex * width</span><br><span class="line">            props.list[i].top = minHeight + 10</span><br><span class="line">            // TODO: 更新需要渲染的元素</span><br><span class="line">            waterFallList.push(props.list[i])</span><br><span class="line">            // TODO: 更新高度</span><br><span class="line">            heightList[minHeightIndex] = minHeight + props.list[i].height + 10</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const resizeHandler = () =&gt; &#123;</span><br><span class="line">    init()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(()=&gt;&#123;</span><br><span class="line">    init()</span><br><span class="line">    // TODO: 监听窗口大小改变事件</span><br><span class="line">    // 防抖函数</span><br><span class="line">    const debounce = (fn:Function, delay:number) =&gt; &#123;</span><br><span class="line">        let timer:any = null</span><br><span class="line">        return function() &#123;</span><br><span class="line">            if(timer) &#123;</span><br><span class="line">                clearTimeout(timer)</span><br><span class="line">            &#125;</span><br><span class="line">            timer = setTimeout(()=&gt;&#123;</span><br><span class="line">                fn()</span><br><span class="line">            &#125;, delay)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 触发事件</span><br><span class="line">    const cancelDebounce = debounce(resizeHandler, 100)</span><br><span class="line">    window.addEventListener(&quot;resize&quot;, cancelDebounce)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">@include b(waterfall)&#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    width: 100%;</span><br><span class="line">    @include e(items)&#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        width: 120px;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="兄弟传参"><a class="markdownIt-Anchor" href="#兄弟传参"></a> 兄弟传参</h4>
<p>兄弟间传参有两种方式：</p>
<ol>
<li>父组件介入</li>
<li>事件总线BUS</li>
</ol>
<p>父组件介入传参理解起来相对容易，但写起来很复杂：</p>
<ol>
<li>父组件使用<code>emit</code>为子A派发事件</li>
<li>子A利用父组件派发的事件将数据data传递给父组件</li>
<li>父组件使用props为子B传递数据data</li>
</ol>
<p>这样组件A就能通过父组件派发的事件修改数据data，组件B也能监听到数据data的变化</p>
<h5 id="父组件介入"><a class="markdownIt-Anchor" href="#父组件介入"></a> 父组件介入</h5>
<p>父组件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;A @trans-data-to-b=&quot;getMessageFromA&quot;&gt;&lt;/A&gt;</span><br><span class="line">        &lt;B :message=&quot;message&quot;&gt;&lt;/B&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import A from &quot;./A.vue&quot;</span><br><span class="line">import B from &quot;./B.vue&quot;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;;</span><br><span class="line"></span><br><span class="line">let message = ref(&quot;&quot;)</span><br><span class="line">const getMessageFromA = (params: string) =&gt; &#123;</span><br><span class="line">    message.value = params</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>子组件A：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;button @click=&quot;emitToB&quot;&gt;给B传递一些信息&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">const emit = defineEmits([&#x27;trans-data-to-B&#x27;])</span><br><span class="line">let message = &quot;&quot;</span><br><span class="line">const emitToB = () =&gt; &#123;</span><br><span class="line">    message = &quot;来自A的信息&quot;</span><br><span class="line">    emit(&#x27;trans-data-to-B&#x27;, message)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>子组件B</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &#123;&#123; messageFromA &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">    messageFromA: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineProps&lt;Props&gt;()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h5 id="事件总线bus"><a class="markdownIt-Anchor" href="#事件总线bus"></a> 事件总线BUS</h5>
<p>利用<strong>发布订阅设计模式</strong>设计一个用于事件管理的类：</p>
<p>Bus.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 事件总线接口</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">BusClass</span> = &#123;</span><br><span class="line">    <span class="attr">emit</span>:<span class="function">(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">    <span class="attr">on</span>:<span class="function">(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">callback</span>: <span class="title class_">Function</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 事件名称类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ParamKey</span> = <span class="built_in">string</span> | <span class="built_in">number</span> | <span class="built_in">symbol</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 将事件名称与回调函数对应</span></span><br><span class="line"><span class="keyword">type</span> eventList = &#123;</span><br><span class="line">    [<span class="attr">key</span>: <span class="title class_">ParamKey</span>]: <span class="title class_">Array</span>&lt;<span class="title class_">Function</span>&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bus</span> <span class="keyword">implements</span> <span class="title class_">BusClass</span> &#123;</span><br><span class="line">    <span class="attr">list</span>: eventList</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 初始化事件列表</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">list</span> = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 事件调用时，找到事件名称对应的回调函数，分别执行事件名对应的所有回调函数</span></span><br><span class="line">    <span class="title function_">emit</span>(<span class="params"><span class="attr">name</span>:<span class="built_in">string</span>, ...<span class="attr">args</span>:<span class="title class_">Array</span>&lt;<span class="built_in">any</span>&gt;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">eventList</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Function</span>&gt; = <span class="variable language_">this</span>.<span class="property">list</span>[name]</span><br><span class="line">        eventList.<span class="title function_">forEach</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">            fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, ...args)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 将事件名与回调函数相对应，即事件的实际处理操作</span></span><br><span class="line">    <span class="title function_">on</span>(<span class="params"><span class="attr">name</span>:<span class="built_in">string</span>, <span class="attr">callback</span>:<span class="title class_">Function</span></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">eventList</span>:<span class="title class_">Array</span>&lt;<span class="title class_">Function</span>&gt; = <span class="variable language_">this</span>.<span class="property">list</span>[name] || []</span><br><span class="line">        eventList.<span class="title function_">push</span>(callback)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">list</span>[name] = eventList</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Bus</span>()</span><br></pre></td></tr></table></figure>
<p>子组件A（A.vue）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;button @click=&quot;emitToB&quot;&gt;给B传递一些信息&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import Bus from &quot;../../Bus&quot;</span><br><span class="line">let message = &quot;&quot;</span><br><span class="line">const emitToB = () =&gt; &#123;</span><br><span class="line">    message = &quot;来自A的信息&quot;</span><br><span class="line">    // 注册事件</span><br><span class="line">    Bus.emit(&#x27;trans-data-to-B&#x27;, message)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>子组件B（B.vue）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &#123;&#123; messageFromA &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import Bus from &#x27;../../Bus&#x27;;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">let messageFromA = ref(&quot;&quot;)</span><br><span class="line">Bus.on(&#x27;trans-data-to-B&#x27;, (message:string) =&gt; &#123;</span><br><span class="line">    messageFromA.value = message</span><br><span class="line">&#125;)</span><br><span class="line">type Props = &#123;</span><br><span class="line">    messageFromA: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineProps&lt;Props&gt;()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="全局组件与递归组件"><a class="markdownIt-Anchor" href="#全局组件与递归组件"></a> 全局组件与递归组件</h3>
<h4 id="全局组件"><a class="markdownIt-Anchor" href="#全局组件"></a> 全局组件</h4>
<p>定义全局组件需要在<code>main.ts</code>中对组件进行引入完成后即可在项目中的任何组件进行不引入的使用</p>
<p>此外还可以批量注册全局组件：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 借鉴ElementUI中的全局注册Icon组件</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">ElementPlusIconsVue</span> <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, component] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(<span class="title class_">ElementPlusIconsVue</span>)) &#123;</span><br><span class="line">  app.<span class="title function_">component</span>(key, component)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="递归组件"><a class="markdownIt-Anchor" href="#递归组件"></a> 递归组件</h4>
<p>对于树形结构的数据，我们可能需要使用递归的组件来对其进行渲染，例如如下形式的数据：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">TreeList</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  icon?: <span class="built_in">string</span>;</span><br><span class="line">  children?: <span class="title class_">TreeList</span>[] | [];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> data = reactive&lt;<span class="title class_">TreeList</span>[]&gt;([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;no.1&quot;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;no.1-1&quot;</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;no.1-1-1&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;no.2&quot;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;no.2-1&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;no.3&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>在VUE3中，可以直接使用文件名作为递归组件自己的名称：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Tree.vue --&gt;</span><br><span class="line">&lt;templat&gt;</span><br><span class="line">    &lt;div class=&quot;tree&quot; v-for=&quot;item in data&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;checkbox&quot;&gt; &lt;span&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;Tree v-if=&quot;item?.children?.length&quot; :data=&quot;item.children&quot;&gt;&lt;/Tree&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/templat&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setip lang=&#x27;ts&#x27;&gt;</span><br><span class="line">    type TreeList = &#123;</span><br><span class="line">        name: string;</span><br><span class="line">        icon?: string;</span><br><span class="line">        children?: TreeList[] | [];</span><br><span class="line">    &#125;;</span><br><span class="line">    type Props&lt;T&gt; = &#123;</span><br><span class="line">        data?: T[] | [];</span><br><span class="line">    &#125;;</span><br><span class="line">    defineProps&lt;Props&lt;TreeList&gt;&gt;();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>此外还可以使用一个额外的script来将组件变为具名组件，然后通过组件名来调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Tree.vue --&gt;</span><br><span class="line">&lt;templat&gt;</span><br><span class="line">    &lt;div class=&quot;tree&quot; v-for=&quot;item in data&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;checkbox&quot;&gt; &lt;span&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;!-- 使用name调用组件自身 --&gt;</span><br><span class="line">        &lt;tree v-if=&quot;item?.children?.length&quot; :data=&quot;item.children&quot;&gt;&lt;/tree&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/templat&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 定义组件name --&gt;</span><br><span class="line">&lt;script lang=&#x27;ts&#x27;&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        name: &quot;tree&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setip lang=&#x27;ts&#x27;&gt;</span><br><span class="line">    type TreeList = &#123;</span><br><span class="line">        name: string;</span><br><span class="line">        icon?: string;</span><br><span class="line">        children?: TreeList[] | [];</span><br><span class="line">    &#125;;</span><br><span class="line">    type Props&lt;T&gt; = &#123;</span><br><span class="line">        data?: T[] | [];</span><br><span class="line">    &#125;;</span><br><span class="line">    defineProps&lt;Props&lt;TreeList&gt;&gt;();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>第三种方式在Vue3.3之前需要使用插件<code>unplugin-vue-define-options</code>，之后的版本可以直接使用<code>defineOptions</code>编译宏来定义组件的<code>name</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Tree.vue --&gt;</span><br><span class="line">&lt;templat&gt;</span><br><span class="line">    &lt;div class=&quot;tree&quot; v-for=&quot;item in data&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;checkbox&quot;&gt; &lt;span&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;!-- 使用name调用组件自身 --&gt;</span><br><span class="line">        &lt;tree v-if=&quot;item?.children?.length&quot; :data=&quot;item.children&quot;&gt;&lt;/tree&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/templat&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setip lang=&#x27;ts&#x27;&gt;</span><br><span class="line">    &lt;!-- 使用defineOptions定义组件name --&gt;</span><br><span class="line">    defineOptions(&#123;</span><br><span class="line">        name: &quot;tree&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">    type TreeList = &#123;</span><br><span class="line">        name: string;</span><br><span class="line">        icon?: string;</span><br><span class="line">        children?: TreeList[] | [];</span><br><span class="line">    &#125;;</span><br><span class="line">    type Props&lt;T&gt; = &#123;</span><br><span class="line">        data?: T[] | [];</span><br><span class="line">    &#125;;</span><br><span class="line">    defineProps&lt;Props&lt;TreeList&gt;&gt;();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="递归组件事件"><a class="markdownIt-Anchor" href="#递归组件事件"></a> 递归组件事件</h5>
<p>可以对递归组件定义事件，此时需要注意事件冒泡的影响：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Tree.vue --&gt;</span><br><span class="line">&lt;templat&gt;</span><br><span class="line">    &lt;!-- 此处注意阻止组件事件冒泡，或者在父组件使用代理来处理组件点击事件 --&gt;</span><br><span class="line">    &lt;div @click.stop=&#x27;clickTap(item, $event)&#x27; class=&quot;tree&quot; v-for=&quot;item in data&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;checkbox&quot;&gt; &lt;span&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;!-- 使用name调用组件自身 --&gt;</span><br><span class="line">        &lt;tree v-if=&quot;item?.children?.length&quot; :data=&quot;item.children&quot;&gt;&lt;/tree&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/templat&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setip lang=&#x27;ts&#x27;&gt;</span><br><span class="line">    &lt;!-- 使用defineOptions定义组件name --&gt;</span><br><span class="line">    defineOptions(&#123;</span><br><span class="line">        name: &quot;tree&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">    type TreeList = &#123;</span><br><span class="line">        name: string;</span><br><span class="line">        icon?: string;</span><br><span class="line">        children?: TreeList[] | [];</span><br><span class="line">    &#125;;</span><br><span class="line">    type Props&lt;T&gt; = &#123;</span><br><span class="line">        data?: T[] | [];</span><br><span class="line">    &#125;;</span><br><span class="line">    defineProps&lt;Props&lt;TreeList&gt;&gt;();</span><br><span class="line">    const clickTap = (item: Tree, e) =&gt; &#123;</span><br><span class="line">        console.log(item)</span><br><span class="line">        console.log(e.target)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="传送组件teleport"><a class="markdownIt-Anchor" href="#传送组件teleport"></a> 传送组件Teleport</h3>
<p><code>Teleport</code>组件可以将其内部的组件通过一个css选择器，传送到所选择的元素内：</p>
<p>to属性接收一个css选择器字符串</p>
<p>disable接收一个boolean值控制传送的开启和关闭</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Teleport :disable=&quot;false&quot; :to=&quot;body&quot;&gt;</span><br><span class="line">    &lt;A&gt;&lt;/A&gt;</span><br><span class="line">&lt;/Teleport&gt;</span><br></pre></td></tr></table></figure>
<h3 id="动画组件transition"><a class="markdownIt-Anchor" href="#动画组件transition"></a> 动画组件Transition</h3>
<p>transition可以给以下情况添加过度动画：</p>
<ul>
<li>v-if</li>
<li>v-show</li>
<li>动态组件</li>
<li>组件根节点</li>
</ul>
<h4 id="基本用法"><a class="markdownIt-Anchor" href="#基本用法"></a> 基本用法</h4>
<p>transition提供一个name属性，该属性用于将组件与css样式相对应，该组件提供6个默认对应的样式命名：</p>
<ol>
<li><code>v-enter-from</code>：定义进入过渡的开始状态。在元素被插入之前生效，在元素被插入之后的下一帧移除。</li>
<li><code>v-enter-active</code>：定义进入过渡生效时的状态。在整个进入过渡的阶段中应用，在元素被插入之前生效，在过渡/动画完成之后移除。这个类可以被用来定义进入过渡的过程时间，延迟和曲线函数。</li>
<li><code>v-enter-to</code>：定义进入过渡的结束状态。在元素被插入之后下一帧生效 (与此同时 <code>v-enter-from</code> 被移除)，在过渡/动画完成之后移除。</li>
<li><code>v-leave-from</code>：定义离开过渡的开始状态。在离开过渡被触发时立刻生效，下一帧被移除。</li>
<li><code>v-leave-active</code>：定义离开过渡生效时的状态。在整个离开过渡的阶段中应用，在离开过渡被触发时立刻生效，在过渡/动画完成之后移除。这个类可以被用来定义离开过渡的过程时间，延迟和曲线函数。</li>
<li><code>v-leave-to</code>：离开过渡的结束状态。在离开过渡被触发之后下一帧生效 (与此同时 <code>v-leave-from</code> 被移除)，在过渡/动画完成之后移除。</li>
</ol>
<p>例如定义一个组件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @click=&#x27;flag = !flag&#x27;&gt;切换&lt;/button&gt;</span><br><span class="line">&lt;transition name=&#x27;fade&#x27;&gt;</span><br><span class="line">  &lt;div v-if=&#x27;flag&#x27; class=&quot;box&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure>
<p>则对应的css动画就可以这样设置：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//开始过度</span><br><span class="line"><span class="selector-class">.fade-enter-from</span>&#123;</span><br><span class="line">   <span class="attribute">background</span>:red;</span><br><span class="line">   <span class="attribute">width</span>:<span class="number">0px</span>;</span><br><span class="line">   <span class="attribute">height</span>:<span class="number">0px</span>;</span><br><span class="line">   <span class="attribute">transform</span>:<span class="built_in">rotate</span>(<span class="number">360deg</span>)</span><br><span class="line">&#125;</span><br><span class="line">//开始过度了</span><br><span class="line"><span class="selector-class">.fade-enter-active</span>&#123;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">2.5s</span> linear;</span><br><span class="line">&#125;</span><br><span class="line">//过度完成</span><br><span class="line"><span class="selector-class">.fade-enter-to</span>&#123;</span><br><span class="line">   <span class="attribute">background</span>:yellow;</span><br><span class="line">   <span class="attribute">width</span>:<span class="number">200px</span>;</span><br><span class="line">   <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line">//离开的过度</span><br><span class="line"><span class="selector-class">.fade-leave-from</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">transform</span>:<span class="built_in">rotate</span>(<span class="number">360deg</span>)</span><br><span class="line">&#125;</span><br><span class="line">//离开中过度</span><br><span class="line"><span class="selector-class">.fade-leave-active</span>&#123;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">1s</span> linear;</span><br><span class="line">&#125;</span><br><span class="line">//离开完成</span><br><span class="line"><span class="selector-class">.fade-leave-to</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">0px</span>;</span><br><span class="line">   <span class="attribute">height</span>:<span class="number">0px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="结合第三方动画库"><a class="markdownIt-Anchor" href="#结合第三方动画库"></a> 结合第三方动画库</h4>
<p>除了默认的样式匹配方式，还可以通过props来自定义动画和css样式的对应关系，这样可以方便我们使用第三方动画库：</p>
<ul>
<li><code>enter-from-class</code></li>
<li><code>enter-active-class</code></li>
<li><code>enter-to-class</code></li>
<li><code>leave-from-class</code></li>
<li><code>leave-active-class</code></li>
<li><code>leave-to-class</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;transition enter-active-class=&quot;animate__animated animate__bounceInLeft&quot; name=&#x27;fade&#x27;&gt;</span><br><span class="line">         &lt;div v-if=&#x27;flag&#x27; class=&quot;box&quot;&gt;&lt;/div&gt;</span><br><span class="line">       &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#x27;animate.css&#x27;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>也可以设置动画进入和离开的持续时间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;transition :duration=&quot;1000&quot;&gt;...&lt;/transition&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;transition :duration=&quot;&#123; enter: 500, leave: 800 &#125;&quot;&gt;...&lt;/transition&gt;</span><br></pre></td></tr></table></figure>
<p>transition包含8个生命周期</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@before-enter</span>=<span class="string">&quot;beforeEnter&quot;</span> <span class="comment">//对应enter-from</span></span><br><span class="line"><span class="variable">@enter</span>=<span class="string">&quot;enter&quot;</span><span class="comment">//对应enter-active</span></span><br><span class="line"><span class="variable">@after-enter</span>=<span class="string">&quot;afterEnter&quot;</span><span class="comment">//对应enter-to</span></span><br><span class="line"><span class="variable">@enter-cancelled</span>=<span class="string">&quot;enterCancelled&quot;</span><span class="comment">//显示过度打断</span></span><br><span class="line"><span class="variable">@before-leave</span>=<span class="string">&quot;beforeLeave&quot;</span><span class="comment">//对应leave-from</span></span><br><span class="line"><span class="variable">@leave</span>=<span class="string">&quot;leave&quot;</span><span class="comment">//对应enter-active</span></span><br><span class="line"><span class="variable">@after-leave</span>=<span class="string">&quot;afterLeave&quot;</span><span class="comment">//对应leave-to</span></span><br><span class="line"><span class="variable">@leave-cancelled</span>=<span class="string">&quot;leaveCancelled&quot;</span><span class="comment">//离开过度打断</span></span><br></pre></td></tr></table></figure>
<p>当只用 JavaScript 过渡的时候，在 <strong><code>enter</code> 和 <code>leave</code> 钩子中必须使用 <code>done</code> 进行回调</strong></p>
<p>回调函数将会在这一生命结束前被调用</p>
<p>结合gsap 动画库使用 <a target="_blank" rel="noopener" href="https://greensock.com/">GreenSock</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123;ref&#125; from &#x27;vue&#x27;</span><br><span class="line">import gsap from &#x27;gsap&#x27;</span><br><span class="line">const BeforeEnter = (el: Element) =&gt; &#123;</span><br><span class="line">    console.log(&#x27;进入之前from&#x27;, el);</span><br><span class="line">    gsap.set(el, &#123;</span><br><span class="line">        width: 0,</span><br><span class="line">        height: 0</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">const Enter = (el: Element,done: gsap.Callback) =&gt; &#123;</span><br><span class="line">    console.log(&#x27;过度曲线&#x27;);</span><br><span class="line">    gsap.to(el, &#123;</span><br><span class="line">        width: 200px,</span><br><span class="line">        height: 200px,</span><br><span class="line">        onComplete: done</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">const AfterEnter = (el: Element) =&gt; &#123;</span><br><span class="line">    console.log(&#x27;to&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">const EnterCanceller = (el: Element) =&gt; &#123;</span><br><span class="line">    console.log(&#x27;过度效果被打断&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;transition @before-enter=&quot;BeforeEnter&quot; @enter=&quot;Enter&quot; @after-enter=&quot;AfterEnter&quot;  @enter-cancelled=&quot;EnterCancelled&quot;&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>apper属性</p>
<p>通过这个属性可以设置初始节点过度 就是页面加载完成就开始动画 对应三个状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;transition appear appear-active-class=&quot;from&quot; appear-from-class=&quot;active&quot; appear-to-class=&quot;to&quot;&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure>
<h4 id="过度列表transition-group"><a class="markdownIt-Anchor" href="#过度列表transition-group"></a> 过度列表transition-group</h4>
<p>用法和transition几乎相同，用于渲染整个列表</p>
<ul>
<li>默认情况下，它不会渲染一个包裹元素，但是你可以通过 <code>tag</code> attribute 指定渲染一个元素。</li>
<li><a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/guide/transitions-enterleave.html#%E8%BF%87%E6%B8%A1%E6%A8%A1%E5%BC%8F">过渡模式</a>不可用，因为我们不再相互切换特有的元素。</li>
<li>内部元素<strong>总是需要</strong>提供唯一的 <code>key</code> attribute 值。</li>
<li>CSS 过渡的类将会应用在内部的元素中，而不是这个组/容器本身。</li>
</ul>
<p>使用<code>move-class</code>制作的洗牌动画：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;button @click=&quot;shuffleMatrix&quot;&gt;shuffle&lt;/button&gt;</span><br><span class="line">        &lt;transition-group move-class=&quot;ender-shuffleWraps--moveAnimate&quot; class=&quot;ender-shuffleWraps&quot; tag=&quot;div&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;ender-shuffleWraps__items&quot; v-for=&quot;item in list&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">                &#123;&#123;item.number&#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/transition-group&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive&#125; from &#x27;vue&#x27;</span><br><span class="line">import _ from &#x27;lodash&#x27;</span><br><span class="line"></span><br><span class="line">// 利用Array.apply生成一个长度为81,且值初始化为undefined的数组</span><br><span class="line">const list = ref(Array.apply(null, &#123;length: 81&#125; as number[]).map((_, index) =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        id: index,</span><br><span class="line">        number: (index % 9) + 1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">const shuffleMatrix = () =&gt; &#123;</span><br><span class="line">    list.value = _.shuffle(list.value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">@include b(shuffleWraps) &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-wrap: wrap;</span><br><span class="line">    width: calc(20px * 9 + 18px);</span><br><span class="line">    @include e(items) &#123;</span><br><span class="line">        width: 20px;</span><br><span class="line">        height: 20px;</span><br><span class="line">        background: #ccc;</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">        font-size: 20px;</span><br><span class="line">        margin: 1px;</span><br><span class="line">    &#125;</span><br><span class="line">    @include m(moveAnimate) &#123;</span><br><span class="line">        transition: all 0.3s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="自定义指令"><a class="markdownIt-Anchor" href="#自定义指令"></a> 自定义指令</h3>
<p>Vue中提供了<code>v-for</code>，<code>v-if</code>等等指令同时也支持自定义指令，自定义指令属于破坏性更新</p>
<p>Vue3的自定义指令也包含一些钩子函数</p>
<h4 id="vue3指令钩子函数"><a class="markdownIt-Anchor" href="#vue3指令钩子函数"></a> Vue3指令钩子函数</h4>
<p>Vue3的自定义指令钩子函数与Vue3组件生命周期相同</p>
<ul>
<li><strong>created</strong> 元素初始化的时候</li>
<li><strong>beforeMount</strong> 指令绑定到元素后调用 只调用一次</li>
<li><strong>mounted</strong> 元素插入父级dom调用</li>
<li><strong>beforeUpdate</strong> 元素（虚拟DOM）被更新之前调用</li>
<li><strong>update</strong> 这个周期方法被移除 改用<strong>updated</strong></li>
<li><strong>beforeUnmount</strong> 在元素被移除前调用</li>
<li><strong>unmounted</strong> 指令被移除后调用 只调用一次</li>
</ul>
<p>而Vue2中指令生命周期为：bind，inserted，update，componentUpdate，unbind</p>
<h4 id="自定义指令钩子函数"><a class="markdownIt-Anchor" href="#自定义指令钩子函数"></a> 自定义指令钩子函数</h4>
<p>首先可以在setup语法糖中声明局部自定义指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;tmplate&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;button @click=&quot;flg = !flg&quot;&gt;</span><br><span class="line">            切换状态</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">        &lt;!-- 使用自定义钩子 --&gt;</span><br><span class="line">        &lt;!-- 自定义钩子同样允许自定义参数，以及自定义修饰符 --&gt;</span><br><span class="line">        &lt;A v-if=&quot;flg&quot; v-move:aaa.ender=&quot;&#123;background: &#x27;red&#x27;&#125;&quot;&gt;&lt;/A&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/tmplate&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import A from &quot;./components/A.vue&quot;</span><br><span class="line">    import &#123;ref, Directive, DirectiveBinding&#125; from &quot;vue&quot;</span><br><span class="line">    let flg = ref&lt;boolean&gt;(true)</span><br><span class="line">    type Dir =&#123;</span><br><span class="line">        background: string</span><br><span class="line">    &#125;</span><br><span class="line">    // 自定义指令的命名必须以v开头</span><br><span class="line">    // 类型为Directive</span><br><span class="line">    const vMove:Directive = &#123;</span><br><span class="line">        // 传入自定义钩子的参数在所有生命周期函数中都能作为参数接收到</span><br><span class="line">        created() &#123;</span><br><span class="line">            console.log(&quot;========&gt;created&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        beforeMount() &#123;</span><br><span class="line">            console.log(&quot;========&gt;beforeMount&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        // 接收到的参数以及修饰符都包含在DirectiveBinding类型中，该类型接收一个泛型辅助推导</span><br><span class="line">        mounted(el:HTMLElement, dir:DirectiveBinding&lt;Dir&gt;) &#123;</span><br><span class="line">            console.log(&quot;========&gt;mounted&quot;)</span><br><span class="line">            el.style.background = dir.value.background</span><br><span class="line">        &#125;,</span><br><span class="line">        beforeUpdate() &#123;</span><br><span class="line">            console.log(&quot;========&gt;beforeUpdate&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        updated() &#123;</span><br><span class="line">            console.log(&quot;========&gt;updated&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        beforeUnmount() &#123;</span><br><span class="line">            console.log(&quot;========&gt;beforeUnmount&quot;)</span><br><span class="line">        &#125;,</span><br><span class="line">        unmount() &#123;</span><br><span class="line">            console.log(&quot;========&gt;unmount&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .A &#123;</span><br><span class="line">        width: 200px;</span><br><span class="line">        height: 200px;</span><br><span class="line">        border: 1px solid #ccc;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="函数简写"><a class="markdownIt-Anchor" href="#函数简写"></a> 函数简写</h4>
<p>当并不需要自定义指令的全部钩子函数时，可以使用函数简写使用部分钩子函数</p>
<p>例如下面这个使用自定义指令实现按钮级的鉴权功能的案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;tmplate&gt;</span><br><span class="line">    &lt;div class=&quot;btns&quot;&gt;</span><br><span class="line">        &lt;button v-has-show=&quot;shope:edit&quot;&gt;创建&lt;/button&gt;</span><br><span class="line">        &lt;button v-has-show=&quot;shope:create&quot;&gt;编辑&lt;/button&gt;</span><br><span class="line">        &lt;button v-has-show=&quot;shope:delete&quot;&gt;删除&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/tmplate&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setip lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123;ref, reactive&#125; from &quot;vue&quot;</span><br><span class="line">    import type &#123;Directive&#125; from &quot;vue&quot;</span><br><span class="line">    </span><br><span class="line">    // 模拟用户ID存储</span><br><span class="line">    localStorage.setItem(&#x27;userId&#x27;, &#x27;ender&#x27;)</span><br><span class="line">    // mock后台返回的数据</span><br><span class="line">    // 此处使用京东标准，ID:页面:权限</span><br><span class="line">    const permission = [</span><br><span class="line">        &#x27;ender:shope:edit&#x27;,</span><br><span class="line">        &#x27;ender:shope:create&#x27;,</span><br><span class="line">        &#x27;ender:shope:delete&#x27;</span><br><span class="line">    ]</span><br><span class="line">    // 取出用户ID</span><br><span class="line">    const userId = localStorage.getItem(&#x27;userId&#x27;) as string</span><br><span class="line">	// 创建自定义指令</span><br><span class="line">    // 函数式自定义指令，接收两个参数el和binding，分别代表被指令绑定的DOM元素，以及指令绑定的值</span><br><span class="line">    // 可以通过Directive接收的两个泛型指定类型</span><br><span class="line">    const vHasShow:Directive&lt;HTMLElement, string&gt;(el, binding) &#123;</span><br><span class="line">        // 拼接得到用户权限信息字符串</span><br><span class="line">        if(!permission.includes(userId + &quot;:&quot; + binding.value)) &#123;</span><br><span class="line">            el.style.display = &#x27;none&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scope lang=&#x27;less&#x27;&gt;</span><br><span class="line">    .btns&#123;</span><br><span class="line">        button &#123;</span><br><span class="line">            margin: 10px</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="自定义指令实现图片懒加载"><a class="markdownIt-Anchor" href="#自定义指令实现图片懒加载"></a> 自定义指令实现图片懒加载</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;tmplate&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;img v-lazy=&quot;item&quot; v-for=&quot;item in arr&quot; width=&quot;360&quot; height=&quot;500&quot; alt=&quot;&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/tmplate&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123;ref, reactive&#125; from &quot;vue&quot;</span><br><span class="line">    import type &#123; Directive &#125; from &quot;vue&quot;</span><br><span class="line">    // 使用vue提供的函数批量引入图片</span><br><span class="line">    // meta找有两个方法:glob和globEager</span><br><span class="line">    // glob是懒加载的，返回的是一个函数，import语句用于函数会触发代码分包</span><br><span class="line">    // let modules = &#123;&quot;xxx&quot;: ()=&gt; import(&quot;xxx&quot;)&#125;</span><br><span class="line">    // globEager为静态加载</span><br><span class="line">    // import xxx from &#x27;xxx&#x27;</span><br><span class="line">    // 使用TS中的Record工具定义一个对象类型，接收两个泛型，分别表示key和value的类型</span><br><span class="line">    let imgList:Record&lt;string, &#123; default: string &#125;&gt; = import.meta.glob(&#x27;./assets/images/*.*&#x27;)</span><br><span class="line">    let arr = Object.values(imageList).map((v) =&gt; v.default)</span><br><span class="line">    </span><br><span class="line">    // 自定义指令</span><br><span class="line">    const vLazy:Directive&lt;HTMLImgElement, string&gt; = async (el, binding) =&gt; &#123;</span><br><span class="line">        // 加载默认显示的图片</span><br><span class="line">        const def = await import(&#x27;./assets/vue.svg&#x27;)</span><br><span class="line">        el.src = def.default</span><br><span class="line">        // 借助js新增的IntersectionObserver方法监听元素是否出现在可视窗内</span><br><span class="line">        const observer = new IntersectionObserver((enr) =&gt; &#123;</span><br><span class="line">            // 回调函数返回一个entrece数组，取其第一个元素</span><br><span class="line">            // inersectionRatio为一个number变量，用于记录元素在可视窗口中的比例</span><br><span class="line">            if(enr[0].inersectionRatio &gt; 0) &#123;</span><br><span class="line">                // 出现在视窗中则需要加载真正的图片</span><br><span class="line">                el.src = binding.value</span><br><span class="line">                // 赋值完成后停止监听避免反复加载</span><br><span class="line">                observer.unobserver(el)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        // 开启事件监听</span><br><span class="line">        observer.observer(el)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;less&quot;&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="自定义hooks"><a class="markdownIt-Anchor" href="#自定义hooks"></a> 自定义hooks</h3>
<p>hook即将文件的一些单独功能的js代码抽离出来进行封装的方式，是函数的一种写法。</p>
<p>vue2中使用mixin来实现类似的功能但不同的是hook是函数，mixin返回的是一个对象</p>
<p>hook的经典应用案例是Vue3 hook 库<a target="_blank" rel="noopener" href="https://vueuse.org/guide/">Get Started | VueUse</a></p>
<p>下面以一个实现图片转base64的功能演示hook的使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onMounted &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Options</span> = &#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="built_in">string</span>  <span class="comment">// 用与检索图片标签的字符串</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Return</span> = &#123;</span><br><span class="line">    <span class="attr">baseURL</span>: <span class="built_in">string</span> | <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params"><span class="attr">options</span>: <span class="title class_">Options</span></span>): <span class="title class_">Promise</span>&lt;<span class="title class_">Return</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> toBase64 = (<span class="attr">el</span>: <span class="title class_">HTMLImageElement</span>):<span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 创建canvas对象将图像画进去后利用toDataURL方法转base64编码</span></span><br><span class="line">        <span class="keyword">const</span> <span class="attr">canvas</span>: <span class="title class_">HTMLCanvasElement</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line">        <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>) <span class="keyword">as</span> <span class="title class_">CanvasRenderingContext2D</span></span><br><span class="line">        canvas.<span class="property">width</span> = el.<span class="property">width</span></span><br><span class="line">        canvas.<span class="property">height</span> = el.<span class="property">height</span></span><br><span class="line">        ctx.<span class="title function_">drawImage</span>(el, <span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> canvas.<span class="title function_">toDataURL</span>(<span class="string">&#x27;image/png&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="attr">file</span>: <span class="title class_">HTMLImageElement</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(options.<span class="property">el</span>) <span class="keyword">as</span> <span class="title class_">HTMLImageElement</span></span><br><span class="line">            file.<span class="property">onload</span> = (): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(&#123;</span><br><span class="line">                    <span class="attr">baseURL</span>: <span class="title function_">toBase64</span>(file)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接下来只需要在组件中引入并使用即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;img id=&quot;img&quot; width=&quot;300&quot; height=&quot;300&quot; src=&quot;./img/test.png&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import useImageToBase64 from &quot;./hooks&quot;</span><br><span class="line">    useImageToBase64(&#123;el: &quot;#img&quot;&#125;).then((res) =&gt; &#123;</span><br><span class="line">        console.loh(res.baseURL)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="自定义hook与自定义指令组合"><a class="markdownIt-Anchor" href="#自定义hook与自定义指令组合"></a> 自定义hook与自定义指令组合</h4>
<p>下面通过一个案例来熟悉vite打包，自定义hook自定义指令以及如何发布到npm</p>
<h5 id="项目构建"><a class="markdownIt-Anchor" href="#项目构建"></a> 项目构建</h5>
<p>首先构建项目，创建src文件，在其下方创建index.ts入口，随后创建README</p>
<p>然后使用如下命令生成package.json</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm init</span><br></pre></td></tr></table></figure>
<p>接着使用如下命令生成ts配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --init</span><br></pre></td></tr></table></figure>
<p>然后创建一个vite.config.ts文件作为vite的配置文件</p>
<p>创建一个index.d.ts文件用来编写声明文件</p>
<h5 id="编写库功能"><a class="markdownIt-Anchor" href="#编写库功能"></a> 编写库功能</h5>
<p>随后就可以开始在index.ts中编写内容了：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;<span class="title class_">App</span>&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// mutationObserver 主要侦听子集变化，包括属性变化以及增删改查</span></span><br><span class="line"><span class="comment">// interSectionObserver 主要侦听元素是否在视口内</span></span><br><span class="line"><span class="comment">// ResizeObserver 主要侦听元素宽高变化</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useResize</span>(<span class="params"><span class="attr">el</span>: <span class="title class_">HTMLElement</span>, <span class="attr">callBack</span>: <span class="title class_">Function</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> resize = <span class="keyword">new</span> <span class="title class_">ResizeObserver</span>(<span class="function">(<span class="params">entries</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 由于可以监听多个元素，所以entries是一个数组，此处我们只监听一个元素</span></span><br><span class="line">        <span class="comment">// contentRect包含变化前后的宽高</span></span><br><span class="line">        <span class="title function_">callBack</span>(entries[<span class="number">0</span>].<span class="property">contentRect</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 添加侦听元素</span></span><br><span class="line">    resize.<span class="title function_">observe</span>(el)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> vue插件规范，需要实现install方法</span></span><br><span class="line"><span class="comment">// 改方法接收app作为参数</span></span><br><span class="line"><span class="comment">// 这样app实例就可以通过app.use(router)这样的形式使用</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">install</span> = (<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 通过directive添加自定义指令</span></span><br><span class="line">    app.<span class="title function_">directive</span>(<span class="string">&quot;resize&quot;</span>, &#123;</span><br><span class="line">        <span class="title function_">mounted</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">            <span class="title function_">useResize</span>(el, binding.<span class="property">value</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">useResize.<span class="property">install</span> = install</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将函数导出，就实现了自定义hook的效果</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useResize</span><br></pre></td></tr></table></figure>
<h5 id="使用vite打包"><a class="markdownIt-Anchor" href="#使用vite打包"></a> 使用vite打包</h5>
<p>接着在vite中配置该库打包时要用到的一些信息：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认打包一个UMD和一个es module</span></span><br><span class="line"><span class="comment">// umd支持amd cmd cjs 全局变量模式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">        <span class="attr">lib</span>: &#123;</span><br><span class="line">            <span class="comment">// 库入口文件地址</span></span><br><span class="line">            <span class="attr">entry</span>: <span class="string">&quot;src/index.ts&quot;</span>,</span><br><span class="line">            <span class="comment">// 库名称</span></span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;useResize&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 属性透传</span></span><br><span class="line">        <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">            <span class="comment">// 确保外部化处理不想打包进库的依赖</span></span><br><span class="line">            <span class="attr">external</span>: [<span class="string">&#x27;vue&#x27;</span>],</span><br><span class="line">            <span class="attr">output</span>: &#123;</span><br><span class="line">                <span class="comment">// 在UMD模式下为这些外部化的依赖提供一个全局变量</span></span><br><span class="line">                <span class="attr">globals</span>: &#123;</span><br><span class="line">                    <span class="attr">useResize</span>: <span class="string">&quot;useResize&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>接下来在package.json中添加一个打包的命令：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite build&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后呢使用如下命令进行打包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
<p>就会看到多了一个dist文件夹，其中ts代码被编译为了mjs以及umd形式的两个js文件</p>
<h5 id="发布到npm"><a class="markdownIt-Anchor" href="#发布到npm"></a> 发布到npm</h5>
<p>在将库发布到npm之前我们需要对我们的库做一些声明，在index.d.ts中编写声明：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明文件</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">const</span> <span class="attr">useResize</span>: &#123;</span><br><span class="line">    (<span class="attr">el</span>: <span class="title class_">HTMLElement</span>, <span class="attr">callBack</span>: <span class="title class_">Function</span>): <span class="built_in">void</span>;</span><br><span class="line">    <span class="attr">install</span>: <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useResize</span><br></pre></td></tr></table></figure>
<p>最后，在发布之前还需要再package.json中配置一些发布时需要设计到的信息：</p>
<ol>
<li>配置库作为全局变量被引入的js文件入口“main”</li>
<li>配置库作为es module被引入时的js文件入口“module”</li>
<li>配置上传到npm时要上传的文件“file”</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dist/ender-vue-resize.umd.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dist/ender-vue-resize.mjs&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;dist&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;index.d.ts&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>之后使用如下命令进行发布：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm adduser # 注册一个npm账号</span><br><span class="line">npm login # 登录npm账号</span><br><span class="line">npm publish # 发布</span><br></pre></td></tr></table></figure>
<h3 id="全局函数以及全局变量"><a class="markdownIt-Anchor" href="#全局函数以及全局变量"></a> 全局函数以及全局变量</h3>
<p>在vue2中使用Prototype来增加全局函数或全局变量，但vue3中已经不再使用这一方法了</p>
<p>vue3中通过createApp生成vueApp实例对象，则可以通过以下方式添加全局函数以及全局变量</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue2.x</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">Prototype</span>.<span class="property">$http</span> = <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vue3.x</span></span><br><span class="line">app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$env</span> = <span class="string">&quot;dev&quot;</span></span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$filter</span> = &#123;</span><br><span class="line">    format&lt;T&gt; (<span class="attr">str</span>: T) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`Ender-<span class="subst">$&#123;str&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义好之后需要扩充vue的声明，防止编辑器报错</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Filter</span> = &#123;</span><br><span class="line">    format&lt;T&gt; (<span class="attr">str</span>: T):<span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&quot;vue&quot;</span> &#123;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ComponentCustomProperties</span> &#123;</span><br><span class="line">        <span class="attr">$filter</span>: <span class="title class_">Filter</span>,</span><br><span class="line">        <span class="attr">$env</span>: <span class="built_in">string</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用时直接在html中或在script中调用即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &#123;&#123;$env&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &#123;&#123;$filter.format(&quot;World&quot;)&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123;getCurrentInstance&#125; from &quot;vue&quot;</span><br><span class="line">    // js中需要先获取当前app实例，再从当前实例的proxy中得到全局变量/方法</span><br><span class="line">    const app = getCurrentInstance()</span><br><span class="line">    console.log(app?.proxy?.$env)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="vue编写插件"><a class="markdownIt-Anchor" href="#vue编写插件"></a> Vue编写插件</h3>
<p>使用vue编写插件时需要经过以下步骤：</p>
<ol>
<li>编写用作插件的vue组件，并将方法通过defineExpose暴露</li>
<li>编写ts以对象或函数的形式将vue组件导出
<ol>
<li>以对象形式导出时要求在对象中实现install函数</li>
<li>install函数主要完成以下几个步骤：
<ol>
<li>使用createVNode方法，根据vue组件创建虚拟DOM节点VNode</li>
<li>使用render方法将虚拟DOM挂在到指定DOM节点</li>
<li>如果组件有暴露方法则将方法注册为Vue全局函数或全局变量</li>
</ol>
</li>
</ol>
</li>
<li>在main.ts中引入组件，并使用app.use安装编写的插件</li>
<li>为了使用方便，需要在main.ts中拓展vue的声明</li>
</ol>
<p>index.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div v-if=&quot;isShow&quot; class=&quot;ender-loading&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;ender-loading__content&quot;&gt;Loading...&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">    const isShow = ref(false) // 控制显示</span><br><span class="line">    console.log(isShow)</span><br><span class="line"></span><br><span class="line">    const show = () =&gt; &#123;</span><br><span class="line">        isShow.value = true</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const hide = () =&gt; &#123;</span><br><span class="line">        isShow.value = false</span><br><span class="line">    &#125;</span><br><span class="line">    // 暴露组件方法</span><br><span class="line">    defineExpose(&#123;</span><br><span class="line">        isShow,</span><br><span class="line">        show,</span><br><span class="line">        hide</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">    @include b(loading) &#123;</span><br><span class="line">        position: fixed;</span><br><span class="line">        inset: 0;</span><br><span class="line">        background-color: rgba(0, 0, 0, 0.8);</span><br><span class="line">        display: flex;</span><br><span class="line">        justify-content: center;</span><br><span class="line">        align-items: center;</span><br><span class="line">        @include e(content) &#123;</span><br><span class="line">            font-size: 30px;</span><br><span class="line">            color: #fff;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createVNode, <span class="title class_">App</span>, <span class="title class_">VNode</span>, render &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Loading</span> <span class="keyword">from</span> <span class="string">&quot;./index.vue&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以对象形式导出作为插件时需要实现install方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// install方法接收app实例对象</span></span><br><span class="line">    <span class="title function_">install</span>(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span></span>) &#123;</span><br><span class="line">        <span class="comment">// 将组件创建为虚拟DOM节点</span></span><br><span class="line">        <span class="keyword">const</span> <span class="attr">vNode</span>: <span class="title class_">VNode</span> = <span class="title function_">createVNode</span>(<span class="title class_">Loading</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(vNode)</span><br><span class="line">        <span class="comment">// 使用render方法将虚拟DOM挂在到指定元素中</span></span><br><span class="line">        <span class="comment">// 此处由于是全局loading则挂在到body上</span></span><br><span class="line">        <span class="title function_">render</span>(vNode, <span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">        <span class="comment">// 将组件方法配置为全局方法</span></span><br><span class="line">        app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$loading</span> = &#123;</span><br><span class="line">            <span class="attr">show</span>: <span class="function">() =&gt;</span> vNode.<span class="property">component</span>?.<span class="property">exposed</span>?.<span class="title function_">show</span>(),</span><br><span class="line">            <span class="attr">hide</span>: <span class="function">() =&gt;</span> vNode.<span class="property">component</span>?.<span class="property">exposed</span>?.<span class="title function_">hide</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Loading</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Loading&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用use方法安装插件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">Loading</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义插件需要进行拓展声明才能有代码提示</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Lod</span> = &#123;</span><br><span class="line">    <span class="attr">show</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>,</span><br><span class="line">    <span class="attr">hide</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;@vue/runtime-core&#x27;</span> &#123;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ComponentCustomProperties</span> &#123;</span><br><span class="line">        <span class="attr">$loading</span>: <span class="title class_">Lod</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Layout&gt;&lt;/Layout&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, reactive, getCurrentInstance &#125; from &#x27;vue&#x27;</span><br><span class="line">import Layout from &quot;./Layout/index.vue&quot;</span><br><span class="line"></span><br><span class="line">const instance = getCurrentInstance()</span><br><span class="line">instance?.proxy?.$loading.show()</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  instance?.proxy?.$loading.hide()</span><br><span class="line">&#125;, 2000)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">* &#123;</span><br><span class="line">  margin: 0;</span><br><span class="line">  padding: 0;</span><br><span class="line">&#125;</span><br><span class="line">html, body &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line">#app &#123;</span><br><span class="line">  @include bfc;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="appuse手撕"><a class="markdownIt-Anchor" href="#appuse手撕"></a> app.use手撕</h3>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> app <span class="keyword">from</span> <span class="string">&quot;../main&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isFunction &#125; <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Use</span> &#123;</span><br><span class="line">    <span class="attr">install</span>: <span class="function">(<span class="params"><span class="attr">app</span>: <span class="title class_">App</span>, ...<span class="attr">options</span>: <span class="built_in">any</span>[]</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set防止重复注册</span></span><br><span class="line"><span class="keyword">const</span> installList = <span class="keyword">new</span> <span class="title class_">Set</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title class_">MyUseM</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Use</span>&gt;(<span class="attr">plugin</span>: T, ...<span class="attr">options</span>: <span class="built_in">any</span>[]) &#123;</span><br><span class="line">    <span class="keyword">if</span>(installList.<span class="title function_">has</span>(plugin)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;插件已注册过&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(plugin &amp;&amp; <span class="title function_">isFunction</span>(plugin.<span class="property">install</span>)) &#123;</span><br><span class="line">        installList.<span class="title function_">add</span>(plugin)</span><br><span class="line">        plugin.<span class="title function_">install</span>(app, ...options)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_">isFunction</span>(plugin)) &#123;</span><br><span class="line">        installList.<span class="title function_">add</span>(plugin)</span><br><span class="line">        <span class="title function_">plugin</span>(app, ...options)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 链式调用</span></span><br><span class="line">    <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ui组件库"><a class="markdownIt-Anchor" href="#ui组件库"></a> UI组件库</h3>
<ol>
<li>ElementUI
<ol>
<li>样例使用ts，setup语法糖编写</li>
<li>表单需要自己写分页</li>
</ol>
</li>
<li>Ant Design
<ol>
<li>样例使用ts，setup函数编写</li>
<li>表单包含分页</li>
</ol>
</li>
<li>View Design
<ol>
<li>样例使用js，选项式API</li>
</ol>
</li>
<li>Vant
<ol>
<li>移动端UI，支持小程序、vue2、vue3、react</li>
<li>样例使用setup函数模式</li>
<li>包含很多业务组件（地址，联系人编辑等等</li>
<li>提供了很多自定义hook</li>
</ol>
</li>
</ol>
<h3 id="属性透传"><a class="markdownIt-Anchor" href="#属性透传"></a> 属性透传</h3>
<p>在使用ElementUI时，由于Vue中Scoped的存在，阻止了css样式的向外传播。</p>
<p>由于单页应用会将所有Vue组件合并为一个HTML，因此为了保证css之间互相不影响。vue可以为vue组件中的style标签加scope</p>
<p>scope通过为DOM结构以及css样式上添加唯一不重复的标识：data-v-hash（通过PostCSS转译实现），以保证唯一性</p>
<p>总结scoped的三条渲染规则：</p>
<ol>
<li>给HTML中的DOM节点加一个不重复的data属性：（data-v-123)来进行区分</li>
<li>给每个css选择器的末尾加上当前组件的属性选择器[data-v-123]</li>
<li>如果组件内部包含其他组件，则只会给其他组件的最外层标签加上当前组件的data属性</li>
</ol>
<p>但使用ElementUI时，通常会希望自定义一些样式，因此vue提供了<code>:deep</code>，他的作用就是用来改变属性选择器的位置</p>
<p>以下代码会将[data-v-123]属性选择器加在最外层属性ender-content__input上，如果不使用deep则会加在 ender-content__input input上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;ender-content&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;ender-content__item&quot;&gt;</span><br><span class="line">            &lt;el-input class=&quot;ender-content__input&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</span><br><span class="line">@include b(content) &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">    background-color: #fff;</span><br><span class="line">    overflow: auto;</span><br><span class="line">    overflow-y: hidden;</span><br><span class="line">    padding: 0 10px;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    @include e(item) &#123;</span><br><span class="line">        flex: 1;</span><br><span class="line">        overflow: auto;</span><br><span class="line">        border-bottom: 1px solid #ccc;</span><br><span class="line">        padding: 10px;</span><br><span class="line">    &#125;</span><br><span class="line">    @include e(input) &#123;</span><br><span class="line">        // vue2 中使用 /deep/</span><br><span class="line">        // vue3 中也可以使用，但是会报错</span><br><span class="line">        :deep(input)&#123;</span><br><span class="line">            background: red;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="vue3-style新特性"><a class="markdownIt-Anchor" href="#vue3-style新特性"></a> Vue3 Style新特性</h3>
<h4 id="插槽选择器"><a class="markdownIt-Anchor" href="#插槽选择器"></a> 插槽选择器</h4>
<p>当我们使用插槽时，想要为插入的内容添加样式：</p>
<p>A组件接收一个插槽</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        我是插槽</span><br><span class="line">        &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>在App.vue中引入，并向插槽中插入div</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;A&gt;</span><br><span class="line">            &lt;div class=&quot;a&quot;&gt;私人定制div&lt;/div&gt;</span><br><span class="line">        &lt;/A&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import A from &quot;@/components/A.vue&quot;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>接着使用<code>:slotted</code>来修饰类选择器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"> :slotted(.a) &#123;</span><br><span class="line">    color:red</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="全局选择器"><a class="markdownIt-Anchor" href="#全局选择器"></a> 全局选择器</h4>
<p>如果想要添加全局样式，在vue2中则需要去掉style标签中的scoped</p>
<p>vue3中只需要使用global修饰即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">:global(div)&#123;</span><br><span class="line">    color:red</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="动态css"><a class="markdownIt-Anchor" href="#动态css"></a> 动态css</h4>
<p>单文件组件的style标签可以通过v-bind将响应式对象绑定为css属性值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;div&quot;&gt;</span><br><span class="line">       小满是个弟弟</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const red = ref&lt;string&gt;(&#x27;red&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.div&#123;</span><br><span class="line">   color:v-bind(red)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>如果绑定响应式对象中的值为引用类型，则需要使用引号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> &lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;div&quot;&gt;</span><br><span class="line">        小满是个弟弟</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123; ref &#125; from &quot;vue&quot;</span><br><span class="line">const red = ref(&#123;</span><br><span class="line">    color:&#x27;pink&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.div &#123;</span><br><span class="line">    color: v-bind(&#x27;red.color&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="css-module"><a class="markdownIt-Anchor" href="#css-module"></a> css module</h4>
<p><code>&lt;style module&gt;</code>标签会被编译为 CSS Modules 并且将生成的 CSS 类作为 $style 对象的键暴露给组件</p>
<p>并且支持自定义注入名称<code>&lt;style module=&quot;ender&quot;&gt;</code></p>
<p>之后可以直接通过<code>:class</code>指令使用（多值可以使用数组接收：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div :class=&quot;[ender.red,ender.border]&quot;&gt;</span><br><span class="line">        Hello World</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;style module=&quot;ender&quot;&gt;</span><br><span class="line">.red &#123;</span><br><span class="line">    color: red;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line">.border&#123;</span><br><span class="line">    border: 1px solid #ccc;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>不具名module则通过style使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div :class=&quot;$style.red&quot;&gt;</span><br><span class="line">        Hello World</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line">&lt;style module&gt;</span><br><span class="line">.red &#123;</span><br><span class="line">    color: red;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>注入的类可以通过 <a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/api/global-api.html#usecssmodule">useCssModule</a> API 在 <code>setup()</code> 和 <code>&lt;script setup&gt;</code> 中使用。对于使用了自定义注入名称的 <code>&lt;style module&gt;</code> 模块，<code>useCssModule</code> 接收一个对应的 <code>module</code> attribute 值作为第一个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div :class=&quot;[ender.red,ender.border]&quot;&gt;</span><br><span class="line">        Hello World</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; useCssModule &#125; from &#x27;vue&#x27;</span><br><span class="line">const css = useCssModule(&#x27;ender&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"> </span><br><span class="line">&lt;style module=&quot;ender&quot;&gt;</span><br><span class="line">.red &#123;</span><br><span class="line">    color: red;</span><br><span class="line">    font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line">.border&#123;</span><br><span class="line">    border: 1px solid #ccc;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>使用场景一般用于<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=TSX&amp;spm=1001.2101.3001.7020">TSX</a> 和 render 函数 居多</p>
<h3 id="nexttick"><a class="markdownIt-Anchor" href="#nexttick"></a> NextTick</h3>
<p>在Vue中数据的更新是同步的，但是DOM的更新是异步的</p>
<p>因此当我们实现一个自动滚动到最低部的聊天框这种需要在send按钮点击后操作DOM的场景时，由于send处理函数是同步的，而更新DOM是异步的，因此并不会滚动到我们希望的位置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">let</span> chatList = <span class="title function_">reactive</span>([</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;A&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;xxxxx&quot;</span>&#125;</span><br><span class="line">])</span><br><span class="line"><span class="keyword">let</span> ipt = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> box = ref&lt;<span class="title class_">HTMLDivElement</span>&gt;() <span class="comment">// 使用ref绑定的DOM元素</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">send</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    chatList.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: ipt.<span class="property">value</span></span><br><span class="line">    &#125;)</span><br><span class="line">    box.<span class="property">value</span>.<span class="property">scrollup</span> = <span class="number">9999999</span> <span class="comment">// 当这一步执行时同步的，因此会先滑动到底部，在将新增加的DOM更新到页面上</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此Vue提供了NextTick API用来解决这样的问题，第一种方式就是回调函数：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">let</span> chatList = <span class="title function_">reactive</span>([</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;A&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;xxxxx&quot;</span>&#125;</span><br><span class="line">])</span><br><span class="line"><span class="keyword">let</span> ipt = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> box = ref&lt;<span class="title class_">HTMLDivElement</span>&gt;() <span class="comment">// 使用ref绑定的DOM元素</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">send</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    chatList.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: ipt.<span class="property">value</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    	box.<span class="property">value</span>.<span class="property">scrollup</span> = <span class="number">9999999</span> <span class="comment">// 将语句放在nextTick的回调函数中就能解决问题</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以使用async/await来实现上述功能</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span></span><br><span class="line"><span class="keyword">let</span> chatList = <span class="title function_">reactive</span>([</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;A&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;xxxxx&quot;</span>&#125;</span><br><span class="line">])</span><br><span class="line"><span class="keyword">let</span> ipt = <span class="title function_">ref</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> box = ref&lt;<span class="title class_">HTMLDivElement</span>&gt;() <span class="comment">// 使用ref绑定的DOM元素</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">send</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    chatList.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: ipt.<span class="property">value</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 这样在await之后的语句都变为异步执行了</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">nextTick</span>()</span><br><span class="line">   	box.<span class="property">value</span>.<span class="property">scrollup</span> = <span class="number">9999999</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际上nextTick函数就是将其中的代码变为了异步任务，其源码是通过Promise将代码变为<strong>微任务</strong>实现的：</p>
<p>源码地址：core\packages\runtime-core\src\scheduler.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">resolvedPromise</span>: <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt; = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line"><span class="keyword">let</span> <span class="attr">currentFlushPromise</span>: <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> nextTick&lt;T = <span class="built_in">void</span>&gt;(</span><br><span class="line">	<span class="attr">this</span>: T, <span class="comment">// ts语法用于指定this类型</span></span><br><span class="line">    fn?: <span class="function">(<span class="params"><span class="attr">this</span>:T</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">): <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> p = currrentFlushPromise || resolvedPromise</span><br><span class="line">    <span class="keyword">return</span> fn ? p.<span class="title function_">then</span>(<span class="variable language_">this</span> ? fn.<span class="title function_">bind</span>(<span class="variable language_">this</span>), fn) : p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事实上nextTick中的tick指的就是浏览器渲染过程中的一帧，那浏览器这一帧率做了什么</p>
<p>1.处理用户的事件，就是event 例如 click，input change 等。</p>
<p>2.执行定时器任务</p>
<p>3.执行 requestAnimationFrame</p>
<p>4.执行dom 的回流与重绘</p>
<p>5.计算更新图层的绘制指令</p>
<p>6.绘制指令合并主线程 如果有空余时间会执行 <code>requestidlecallback</code></p>
<p>所以 一个Tick 就是去做了这些事</p>
<h3 id="h函数"><a class="markdownIt-Anchor" href="#h函数"></a> h函数</h3>
<p>Vue事实上包含三种编写风格：</p>
<ol>
<li>template风格</li>
<li>JSX风格</li>
<li>h函数风格</li>
</ol>
<p>Vue3中已经很少使用了，偶尔会出现在，需要定义一个小组件单又不需要复用，不想为其创建文件夹的场景下</p>
<p>出现的原因是Vue单文件组件编译是需要过程，他会经过</p>
<p>parser编译为AST树 -&gt; transform转化为JS API -&gt; generate生成render函数</p>
<p>render函数则会返回一个h函数包裹的VNode虚拟DOM节点</p>
<p>而h函数直接跳过这三个阶段，所以性能上有很大的帮助。其底层实际上就是调用的<code>createVNode()</code>方法直接创建虚拟DOM节点，因此实际上使用h函数编写组件就像直接编写虚拟DOM节点。</p>
<p>h函数接收三个参数：</p>
<ol>
<li>type节点类型</li>
<li>propsOrChildren对象，主要用来表示props, attrs, dom props, class, style</li>
<li>children子节点</li>
</ol>
<p>h函数有多种重载形式：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 除类型之外的所有参数都是可选的</span></span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span> &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//属性和属性都可以在道具中使用</span></span><br><span class="line"><span class="comment">//Vue会自动选择正确的分配方式</span></span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">class</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="attr">innerHTML</span>: <span class="string">&#x27;hello&#x27;</span> &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// props modifiers such as .prop and .attr can be added</span></span><br><span class="line"><span class="comment">// with &#x27;.&#x27; and `^&#x27; prefixes respectively</span></span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="string">&#x27;.name&#x27;</span>: <span class="string">&#x27;some-name&#x27;</span>, <span class="string">&#x27;^width&#x27;</span>: <span class="string">&#x27;100&#x27;</span> &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// class 和 style 可以是对象或者数组</span></span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">class</span>: [foo, &#123; bar &#125;], <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span> &#125; &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义事件需要加on 如 onXxx</span></span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;&#125; &#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 子集可以字符串</span></span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span> &#125;, <span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//如果没有props是可以省略props 的</span></span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [<span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>)])</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 子数组可以包含混合的VNode和字符串</span></span><br><span class="line"><span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [<span class="string">&#x27;hello&#x27;</span>, <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>)])</span><br></pre></td></tr></table></figure>
<p>props传递参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;Btn text=&quot;按钮&quot;&gt;&lt;/Btn&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script setup lang=&#x27;ts&#x27;&gt;</span><br><span class="line">import &#123; h, &#125; from &#x27;vue&#x27;;</span><br><span class="line">type Props = &#123;</span><br><span class="line">    text: string</span><br><span class="line">&#125;</span><br><span class="line">const Btn = (props: Props, ctx: any) =&gt; &#123;</span><br><span class="line">    return h(&#x27;div&#x27;, &#123;</span><br><span class="line">        class: &#x27;p-2.5 text-white bg-green-500 rounded shadow-lg w-20 text-center inline m-1&#x27;,</span><br><span class="line"> </span><br><span class="line">    &#125;, props.text)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>派发事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;Btn @on-click=&quot;getNum&quot; text=&quot;按钮&quot;&gt;&lt;/Btn&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script setup lang=&#x27;ts&#x27;&gt;</span><br><span class="line">import &#123; h, &#125; from &#x27;vue&#x27;;</span><br><span class="line">type Props = &#123;</span><br><span class="line">    text: string</span><br><span class="line">&#125;</span><br><span class="line">const Btn = (props: Props, ctx: any) =&gt; &#123;</span><br><span class="line">    return h(&#x27;div&#x27;, &#123;</span><br><span class="line">        class: &#x27;p-2.5 text-white bg-green-500 rounded shadow-lg w-20 text-center inline m-1&#x27;,</span><br><span class="line">        onClick: () =&gt; &#123;</span><br><span class="line">            ctx.emit(&#x27;on-click&#x27;, 123)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, props.text)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">const getNum = (num: number) =&gt; &#123;</span><br><span class="line">    console.log(num);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>定义插槽：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;Btn @on-click=&quot;getNum&quot;&gt;</span><br><span class="line">        &lt;template #default&gt;</span><br><span class="line">            按钮slots</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">    &lt;/Btn&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script setup lang=&#x27;ts&#x27;&gt;</span><br><span class="line">import &#123; h, &#125; from &#x27;vue&#x27;;</span><br><span class="line">type Props = &#123;</span><br><span class="line">    text?: string</span><br><span class="line">&#125;</span><br><span class="line">const Btn = (props: Props, ctx: any) =&gt; &#123;</span><br><span class="line">    return h(&#x27;div&#x27;, &#123;</span><br><span class="line">        class: &#x27;p-2.5 text-white bg-green-500 rounded shadow-lg w-20 text-center inline m-1&#x27;,</span><br><span class="line">        onClick: () =&gt; &#123;</span><br><span class="line">            ctx.emit(&#x27;on-click&#x27;, 123)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, ctx.slots.default())</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">const getNum = (num: number) =&gt; &#123;</span><br><span class="line">    console.log(num);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到实际上和编写setUphan’shu的形式是一样的。</p>
<h3 id="vue33编译宏"><a class="markdownIt-Anchor" href="#vue33编译宏"></a> Vue3.3编译宏</h3>
<p>需要使用Vue3.3及以上版本</p>
<h4 id="defineprops"><a class="markdownIt-Anchor" href="#defineprops"></a> defineProps</h4>
<p>使用普通方式<code>defineProps</code>接收组件参数时，无法设置赞数类型，因此使得使用prop访问参数时没有代码提示</p>
<p>为了解决这个问题Vue提供了<code>PropType</code>，可以使用这个API将参数断言为指定的数据类型</p>
<p>同时<code>defineProps</code>函数也可接收一个泛型来定义接收参数的类型：<code>defineProps&lt;&#123;name:string[]&#125;&gt;()</code></p>
<p>Vue3.3对<code>defineProps</code>进行了改进，新增了泛型的支持，需要在script标签上增加<code>generic=&quot;T&quot;</code>熟悉来定义泛型</p>
<p>父向子组件传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div&gt;</span><br><span class="line">    &lt;Child :name=&quot;[&#x27;ender&#x27;]&quot;&gt;&lt;/Child&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> &lt;script lang=&#x27;ts&#x27; setup&gt;</span><br><span class="line"> import Child from &#x27;./views/child.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>子组件接收</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &lt;template&gt;</span><br><span class="line"> &lt;div&gt;</span><br><span class="line">     &#123;&#123; name &#125;&#125;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> &lt;script generic=&quot;T&quot;  lang=&#x27;ts&#x27; setup&gt;</span><br><span class="line">     // 通过generic属性定义泛型</span><br><span class="line"> defineProps&lt;&#123;</span><br><span class="line">    name:T[] // name属性就可以使用泛型构造任意类型数组的类型</span><br><span class="line"> &#125;&gt;()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这也如果有的父组件要向子组件传递string[]，但有的又需要传递number[]时，就可以使用泛型来定义类型</p>
<h4 id="defineemits"><a class="markdownIt-Anchor" href="#defineemits"></a> defineEmits</h4>
<p><code>defineEmits</code>编译宏用来进行事件派发，在TS中为了获得更友好的类型提示，通常我们需要利用该函数接收一个泛型来定义事件接收函数的类型：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emit = defineEmits&lt;&#123;</span><br><span class="line">    (<span class="attr">event</span>: <span class="built_in">string</span>, <span class="attr">name</span>: <span class="built_in">string</span>): <span class="built_in">void</span></span><br><span class="line">&#125;&gt;()</span><br></pre></td></tr></table></figure>
<p>3.3中对这一方式进行了优化，可以直接通过数组的形式为事件指定参数类型：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emit = defineEmits&lt;&#123;</span><br><span class="line">    <span class="string">&#x27;send&#x27;</span>: [<span class="attr">name</span>: <span class="built_in">string</span>]</span><br><span class="line">&#125;&gt;()</span><br></pre></td></tr></table></figure>
<h4 id="defineoptions"><a class="markdownIt-Anchor" href="#defineoptions"></a> defineOptions</h4>
<p>vue3.3内置了<code>defineOptions()</code>用于操作OptionsAPI中的内容，需要注意的是已经有编译宏的Options，比如emit，props, expose, slots无法在其中使用</p>
<p>通常用来定义name：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineOptions</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;Child&quot;</span>,</span><br><span class="line">    <span class="attr">inheritAttrs</span>:<span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="defineslots"><a class="markdownIt-Anchor" href="#defineslots"></a> defineSlots</h4>
<p>defineSlots是3.3新增的编译宏，只做声明不做实现</p>
<p>作用是约束slot类型</p>
<p>父组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Child :data=&quot;list&quot;&gt;</span><br><span class="line">            &lt;template #default=&quot;&#123;item&#125;&quot;&gt;</span><br><span class="line">                   &lt;div&gt;&#123;&#123; item.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">        &lt;/Child&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&#x27;ts&#x27; setup&gt;</span><br><span class="line">import Child from &#x27;./views/child.vue&#x27;</span><br><span class="line">const list = [</span><br><span class="line">    &#123;</span><br><span class="line">        name: &quot;张三&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: &quot;李四&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: &quot;王五&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>子组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;div&gt;</span><br><span class="line">     &lt;ul&gt;</span><br><span class="line">        &lt;li v-for=&quot;(item,index) in data&quot;&gt;</span><br><span class="line">            &lt;slot :index=&quot;index&quot; :item=&quot;item&quot;&gt;&lt;/slot&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">     &lt;/ul&gt;</span><br><span class="line"> &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"> &lt;script generic=&quot;T&quot;  lang=&#x27;ts&#x27; setup&gt;</span><br><span class="line">defineProps&lt;&#123;</span><br><span class="line">    data: T[]</span><br><span class="line">&#125;&gt;()</span><br><span class="line">defineSlots&lt;&#123;</span><br><span class="line">   default(props:&#123;item:T,index:number&#125;):void</span><br><span class="line">&#125;&gt;()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="环境变量"><a class="markdownIt-Anchor" href="#环境变量"></a> 环境变量</h3>
<p>Vue提供的用于区分开发环境，测试环境，生产环境的方法</p>
<p>默认的环境变量保存在<code>import.meta.env</code>，需要注意的是尽量不要对环境变量做动态的修改，因为在生成环境中环境变量采用硬编码的方式，因此在生产环境下动态修改环境变量会报错</p>
<p>如果需要自定义环境变量，则需要在根目录下创建文件名为：</p>
<p><code>.env.development</code>-开发环境</p>
<p><code>.env.production</code>-生产环境</p>
<p>的文件</p>
<p>如果希望上述两个环节变量生效，需要子package.json中是script中指定启动命令的模式（目前可以默认读取无需配置了：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// &quot;dev&quot;: &quot;vite&quot;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vite --mode development&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>但如果想在Vue组件以外的ts文件中获取环境变量，比如在vist.config.ts中获取环境变量则需要使用nodejs的API以及Vite的APi：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig, loadEnv &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="title function_">default</span>(&#123;mode&#125;:<span class="built_in">any</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// loadEnv接收两个参数，第一个参数代表当前允许的模式，此处通过export default的回调函数获得</span></span><br><span class="line">    <span class="comment">// 第二个参数接收一个目录代表环境变量文件所在的路径，此处使用nodeJS中的process.cwd()获取根目录路径</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">loadEnv</span>(mode, process.<span class="title function_">cwd</span>()))</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">        <span class="comment">// Vite配置</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="vue3性能优化"><a class="markdownIt-Anchor" href="#vue3性能优化"></a> Vue3性能优化</h3>
<p>在开发环境中通常页面性能会使用Chrome浏览器中的LightningHouse进行性能测试</p>
<p>其中包含几个常用指标：</p>
<ol>
<li>FCP
<ul>
<li>First Contentful Paint</li>
<li>首屏加载时间</li>
</ul>
</li>
<li>Speed Index
<ul>
<li>页面各个可见部分的显示平均时间</li>
<li>当有数据需要从后台获取时将影响这一数值</li>
</ul>
</li>
<li>LCP
<ul>
<li>Largest Contentful Paint</li>
<li>最大内容绘制时间</li>
<li>页面最大的DOM元素绘制所需的时间</li>
</ul>
</li>
<li>TTL
<ul>
<li>Time To Interactive</li>
<li>从页面开始渲染到用户可以操作的时间间隔</li>
<li>即内容必需渲染完成，且交互元素绑定的事件已经注册完成</li>
</ul>
</li>
<li>TBT
<ul>
<li>Total Blocking Time</li>
<li>主进程被阻塞的时间</li>
</ul>
</li>
<li>CLS
<ul>
<li>Cumulative Layout Shift</li>
<li>计算布局偏移值</li>
<li>偏移值不为0可能导致用户想点A但下一帧A按钮被挤到旁边导致实际点了B</li>
</ul>
</li>
</ol>
<p>而在生产环境中Vite可以使用<code>rollup-plugin-visualizer</code>对打包后的项目进行性能分析</p>
<p>需要在vite.config.ts中进行注册：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; visualizer &#125; <span class="keyword">from</span> <span class="string">&quot;rollup-plugin-visualizer&quot;</span></span><br><span class="line"><span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="comment">// 主要要将open属性设为true</span></span><br><span class="line">    <span class="attr">plugins</span>: [<span class="title class_">Vue</span>(),<span class="title function_">vueJSX</span>(), <span class="title function_">visualizer</span>(&#123;<span class="attr">open</span>:<span class="literal">true</span>&#125;)]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后使用npm run build命令进行打包后，打包完成时会生成一个html显示打包过程中每个模块占用的时间，模块面积越大代表打包耗时越多</p>
<p>对于打包的优化，Vite提供了一些配置项对打包的过程进行优化，可以在build属性中设置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">        <span class="attr">chunkSizeWarningLimit</span>: <span class="number">2000</span>, <span class="comment">// 包大小警告阈值</span></span><br><span class="line">        <span class="attr">cssCodeSplit</span>: <span class="literal">true</span>, <span class="comment">// css 拆分</span></span><br><span class="line">        <span class="attr">sourcemap</span>: <span class="literal">false</span>, <span class="comment">// 是否生成sourcemap</span></span><br><span class="line">        <span class="attr">minify</span>: <span class="string">&quot;terser&quot;</span>, <span class="comment">// 是否使用最小化混淆，支持esbuild和terser，前者打包更快，后者打包后体积更小</span></span><br><span class="line">        <span class="attr">assetsInlineLimit</span>: <span class="number">4000</span> <span class="comment">// 小于该值的图片将大包为base64</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此外vite还有许多优化插件，比如：</p>
<ul>
<li><code>vite-plugin-pwa</code>：让项目支持离线缓存技术，使web应用无线接近于原生应用
<ul>
<li>可以添加到桌面，使用manifest实现</li>
<li>可以实现离线缓存，使用service worker实现（新技术</li>
<li>可以发送通知，使用service worker实现</li>
</ul>
</li>
</ul>
<p>另外还可以通过一些vue的插件进行性能优化比如图像懒加载可以使用<code>vue3-lazy</code>实现懒加载</p>
<p>对于数据量很多的列表可以使用虚拟列表中技术（Element-UI已经集成），即只有可视区域的DOM，其余部分没有DOM</p>
<p>对于主进程频繁被阻塞的问题可以使用多线程来解决，通过new Worker创建子线程，然后通过postMessage和onMessage分别进行发送信息和接收信息，使用terminate方法关闭，该方法遵守同源限制，且<strong>不允许在子线程中操作DOM</strong></p>
<p>此外还可以使用<strong>防抖</strong>和<strong>节流</strong>来优化用户体验，这些在VueUse中都已经实现</p>
<h2 id="web-components"><a class="markdownIt-Anchor" href="#web-components"></a> Web Components</h2>
<p>原生JS也提供了封装组件的能力，由三部分组成：</p>
<ol>
<li>Custom Element：自定义元素</li>
<li>Shadow DOM：（微前端也是基于该技术，隔离JS和CSS）用于将组件的css与js和外部缓解隔离</li>
<li>HTML template：允许我们使用模板字符串定义组件中的HTML内容</li>
</ol>
<p>Web Components包含四个生命周期：</p>
<ol>
<li>connectedCallback：挂载</li>
<li>disconnectedCallback：断开</li>
<li>adoptedCallback：移动</li>
<li>attributeChangeCallback：改变</li>
</ol>
<p>原生Web Component也可以配合Vue一起使用</p>
<p>注意：vue中使用原生组件需要在vite配置中指定某某前缀的组件跳过组件检测</p>
<p>然后就可以在js中使用<code>defineCustomElement(customVueCeVue)</code>创建自定义组件，其中函数可以从vue中导入，customVueCeVue为我们定义好的组件</p>
<p>然后使用<code>window.customElements.define('prefix-component')</code>将组件和他的标签挂载道window对象上</p>
<p>这种模式下传参时只能支持字符串参数，因此如果要传递引用类型则需要使用<code>JSON.stringify()</code>转化为JSON字符串</p>
<h2 id="proxy跨域"><a class="markdownIt-Anchor" href="#proxy跨域"></a> proxy跨域</h2>
<p>跨域是存在于浏览器端的问题，主要是由于浏览器最核心最基础的安全功能——<strong>同源策略</strong>限制</p>
<p>当一个请求url的<strong>协议，域名，端口</strong>三者中任意一个与当前页面的URL不同则为<strong>跨域</strong></p>
<p>解决跨域问题通常有以下几个方法</p>
<h3 id="jsonp方法"><a class="markdownIt-Anchor" href="#jsonp方法"></a> JsonP方法</h3>
<blockquote>
<p>百度使用的方法</p>
</blockquote>
<p>原理：由于HTML中的script标签不受同源策略的限制，因此我们可以通过<strong>动态创建script标签</strong>，将src作为服务器地址，然后服务器返回一个callback接受返回的参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">clickBtn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> s, obj</span><br><span class="line">    obj = &#123;<span class="string">&quot;table&quot;</span>: <span class="string">&quot;products&quot;</span>, <span class="string">&quot;limit&quot;</span>: <span class="number">10</span>&#125;; <span class="comment">// 构建参数</span></span><br><span class="line">    s = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>); <span class="comment">// 创建script元素</span></span><br><span class="line">    s.<span class="property">src</span> = <span class="string">&quot;接口地址xxxxx&quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj) <span class="comment">// 传递参数</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(s) <span class="comment">// 将script挂载</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与服务端返回函数同名</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myFunc</span>(<span class="params">myObj</span>) &#123;</span><br><span class="line">    <span class="comment">// 接收后端返回数据</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;demo&quot;</span>).<span class="property">innerHTML</span> = myObj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但该方法无法发送post请求</p>
<h3 id="cors设置"><a class="markdownIt-Anchor" href="#cors设置"></a> CORS设置</h3>
<p>后端可以通过设置CORS来允许跨域资源共享</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="string">&quot;http://web.xxx.com&quot;</span> <span class="comment">// 可指定地址</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以设为*允许任意站点</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="string">&quot;*&quot;</span> <span class="comment">// 使用通配符允许任意站点访问，不推荐，安全性不高，且在使用session时无法在前端种植cookie</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="proxy代理"><a class="markdownIt-Anchor" href="#proxy代理"></a> Proxy代理</h3>
<p>实际上是用node代替前端对后端进行请求（因为服务端没有跨域限制）</p>
<p>假设有后端接口：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建get请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">     res.<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>:<span class="number">200</span>,</span><br><span class="line">        <span class="attr">message</span>:<span class="string">&quot;请求成功&quot;</span></span><br><span class="line">     &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//端口号9001</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">9001</span>)</span><br></pre></td></tr></table></figure>
<p>我们直接在前端使用fetch会报跨域错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123;ref,reactive &#125; from &#x27;vue&#x27;</span><br><span class="line">fetch(&#x27;http://localhost:9001/user&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>此时可以开启vite的代理</p>
<p>vite中在配置文件中设置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">  <span class="attr">server</span>:&#123;</span><br><span class="line">     <span class="attr">proxy</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;/api&#x27;</span>:&#123;</span><br><span class="line">            <span class="attr">target</span>:<span class="string">&quot;http://localhost:9001/&quot;</span>, <span class="comment">//跨域地址</span></span><br><span class="line">            <span class="attr">changeOrigin</span>:<span class="literal">true</span>, <span class="comment">//支持跨域</span></span><br><span class="line">            <span class="attr">rewrite</span>:<span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/api/</span>, <span class="string">&quot;&quot;</span>)<span class="comment">//重写路径,替换/api</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后将前端请求url修改为<code>/api/user</code>即可</p>
<p>webpack proxy 和 node proxy 用法都类似</p>
<p>需要注意的是proxy只在开发环境中生效，生产环境由于网页会上服务器，前后端分离可以使用nginx，apache等等服务器的代理实现</p>
<p>vite的proxy底层实现实际上就是监听前端页面端口的请求后，向服务器端口发送请求：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// proxyMiddleware 中的代码</span></span><br><span class="line"><span class="keyword">import</span> httpProxy <span class="keyword">from</span> <span class="string">&#x27;http-proxy&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">proxyMiddleware</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">httpServer</span>: http.<span class="title class_">Server</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">options</span>: <span class="title class_">NonNullable</span>&lt;<span class="title class_">CommonServerOptions</span>[<span class="string">&#x27;proxy&#x27;</span>]&gt;,</span></span><br><span class="line"><span class="params">    <span class="attr">config</span>: <span class="title class_">ResolvedConfig</span></span></span><br><span class="line"><span class="params">  </span>): <span class="title class_">Connect</span>.<span class="property">NextHandleFunction</span> &#123;</span><br><span class="line">    <span class="comment">// lazy require only when proxy is used</span></span><br><span class="line"><span class="keyword">const</span> proxy = httpProxy.<span class="title function_">createProxyServer</span>(opts) <span class="keyword">as</span> <span class="title class_">HttpProxy</span>.<span class="property">Server</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// http-proxy 模块用于转发 http 请求</span></span><br><span class="line"><span class="comment">// 其实现的大致原理为使用 http 或 https 模块搭建 node 代理服务器，将客户端发送的请求数据转发到目标服务器，再将响应输送到客户端</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> httpProxy = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy = httpProxy.<span class="title function_">createProxyServer</span>(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个代理服务 代理到9001</span></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    proxy.<span class="title function_">web</span>(req,res,&#123;</span><br><span class="line">        <span class="attr">target</span>:<span class="string">&quot;http://localhost:9001/xm&quot;</span>, <span class="comment">//代理的地址</span></span><br><span class="line">        <span class="attr">changeOrigin</span>:<span class="literal">true</span>, <span class="comment">//是否有跨域</span></span><br><span class="line">        <span class="attr">ws</span>:<span class="literal">true</span> <span class="comment">//webSocetk</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>
<h2 id="虚拟dom与diff算法"><a class="markdownIt-Anchor" href="#虚拟dom与diff算法"></a> 虚拟DOM与diff算法</h2>
<p>虚拟DOM即通过JS生成的AST节点树</p>
<p>虚拟DOM的产生是因为：</p>
<ul>
<li>直接操作DOM性能低下</li>
<li>但操作JS速度更快</li>
</ul>
<p>而Diff算法则是为了让对虚拟DOM的操作变得更快而产生的。</p>
<p>例如<code>v-for</code>中不使用key属性时，更新DOM需要经过以下几个阶段：</p>
<ul>
<li>按从左到右的顺序，新元素替换旧元素</li>
<li>最后如果元素少了，则卸载最后几个</li>
<li>如果元素多了，则新增最后几个</li>
</ul>
<p>如果使用了key，更新DOM就变为了如下几个步骤：</p>
<ul>
<li>前序对比算法（从左到右对比新旧元素的key和type，直到第一个不匹配</li>
<li>后序对比算法（从右到左对比新旧元素的key和type，直到第一个不匹配</li>
<li>如果多出新节点，则挂载</li>
<li>如果多出旧节点，则卸载</li>
<li>乱序情况特殊处理
<ul>
<li>乱序时，先计算得到key与index的映射</li>
<li>然后应用了贪心+二分查找的思想计算最长上升子序列</li>
<li>那么之后只需要将不在最长上升子序列中的元素进行移动即可</li>
<li>如果在其中就不需要移动，这样能够保证移动的次数最少</li>
</ul>
</li>
</ul>
<h2 id="tailwind-css"><a class="markdownIt-Anchor" href="#tailwind-css"></a> Tailwind CSS</h2>
<p>Tailwind CSS是一个由JS编写的CSS框架，基于PostCSS解析。</p>
<p>PostCSS插件在使用时需要进行一些配置：</p>
<ol>
<li>PostCSS配置文件postcss.config.js，新增tailwind插件</li>
<li>TailwindCSS配置文件tailwind.config.js</li>
</ol>
<p>PostCSS处理CSS的大致流程如下：</p>
<ol>
<li>将CSS解析为抽象语法树（AST树）</li>
<li>读取配置文件，根据该文件生成新的抽象语法树</li>
<li>将AST树“传递”给一系列数据转换操作处理（变量数据循环生成，嵌套类名循环等）</li>
<li>清除一系列操作留下的数据</li>
<li>将处理完毕的AST树重新转化为字符串</li>
</ol>
<h3 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D tailwindcss@latest postcss@latest autoprefixer@latest</span><br></pre></td></tr></table></figure>
<p>其中autoprefixer可以 自动为样式添加–web-kit-等等前缀以增强页面的兼容性</p>
<h3 id="生成配置文件"><a class="markdownIt-Anchor" href="#生成配置文件"></a> 生成配置文件</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx tailwindcss init -p</span><br></pre></td></tr></table></figure>
<h3 id="修改配置文件"><a class="markdownIt-Anchor" href="#修改配置文件"></a> 修改配置文件</h3>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.0</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">purge</span>: [<span class="string">&#x27;./index.html&#x27;</span>, <span class="string">&#x27;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&#x27;</span>],</span><br><span class="line">  <span class="attr">theme</span>: &#123;</span><br><span class="line">    <span class="attr">extend</span>: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3.0</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">content</span>: [<span class="string">&#x27;./index.html&#x27;</span>, <span class="string">&#x27;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&#x27;</span>],</span><br><span class="line">  <span class="attr">theme</span>: &#123;</span><br><span class="line">    <span class="attr">extend</span>: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打包时会根据tailwind的配置，将没有使用到的类排除，只将使用到的类打包</p>
<p>创建一个index.css</p>
<p>引入</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure>
<p>在main.ts中引入样式文件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="mitt"><a class="markdownIt-Anchor" href="#mitt"></a> Mitt</h2>
<p>Mitt是一个利用<strong>发布订阅</strong>设计模式解决组件间通讯操作发杂问题的JS库，它提供了emit，on，off，all四种方法</p>
<h3 id="配置"><a class="markdownIt-Anchor" href="#配置"></a> 配置</h3>
<p>全局使用Mitt首先需要将其挂载到根组件上，如果使用ts并且想要类型推断功能，则需要获取Mitt中的所有类型：</p>
<p>在项目的main.ts中进行如下配置</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mitt <span class="keyword">from</span> <span class="string">&#x27;mitt&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Mitt</span> = <span class="title function_">mitt</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span> 支持TS的类型推断代码提示</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;vue&#x27;</span> &#123;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ComponentCustomProperties</span> &#123;</span><br><span class="line">        <span class="attr">$Bus</span>: <span class="keyword">typeof</span> <span class="title class_">Mitt</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> 全局挂载Mitt</span></span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$Bus</span> = <span class="title class_">Mitt</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="emit"><a class="markdownIt-Anchor" href="#emit"></a> emit</h3>
<p>接着在组件A中就可以直接注册事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; getCurrentInstance &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">// TODO: 获取组件实例</span><br><span class="line">const instance = getCurrentInstance()</span><br><span class="line"></span><br><span class="line">const emitEvent = () =&gt; &#123;</span><br><span class="line">    // TODO: 从实例的代理处获得Bus</span><br><span class="line">    instance?.proxy?.$Bus.emit(&#x27;trans-data-to-b&#x27;, &#x27;来自A的数据&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;组件A&lt;/h1&gt;</span><br><span class="line">        &lt;button @click=&quot;emitEvent&quot;&gt;emit&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="on"><a class="markdownIt-Anchor" href="#on"></a> on</h3>
<p>在组件B中可以通过on来订阅事件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; getCurrentInstance, ref &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">const instance = getCurrentInstance()</span><br><span class="line"></span><br><span class="line">const messageFromA = ref(&quot;&quot;)</span><br><span class="line"></span><br><span class="line">instance?.proxy?.$Bus.on(&#x27;trans-data-to-b&#x27;, (message: string) =&gt; &#123;</span><br><span class="line">    console.log(message)</span><br><span class="line">    messageFromA.value = message</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;组件B&lt;/h1&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; messageFromA &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>on函数还可以监听所有事件：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">instance?.<span class="property">proxy</span>?.<span class="property">$Bus</span>.<span class="title function_">on</span>(<span class="string">&#x27;*&#x27;</span>, <span class="function">(<span class="params"><span class="attr">eventName</span>:<span class="built_in">string</span>,<span class="attr">message</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 事件名与参数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(eventName)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(message)</span><br><span class="line">    messageFromA.<span class="property">value</span> = message</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="off"><a class="markdownIt-Anchor" href="#off"></a> Off</h3>
<p>使用off函数可以将之前为事件名称绑定的函数删除：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; getCurrentInstance, ref &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">const instance = getCurrentInstance()</span><br><span class="line"></span><br><span class="line">const messageFromA = ref(&quot;&quot;)</span><br><span class="line"></span><br><span class="line">const Bus = (message: any) =&gt; &#123;</span><br><span class="line">    console.log(message)</span><br><span class="line">    messageFromA.value = message</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// TODO: 为事件名绑定事件函数</span><br><span class="line">instance?.proxy?.$Bus.on(&#x27;trans-data-to-b&#x27;, Bus)</span><br><span class="line"></span><br><span class="line">// TODO: 删除事件函数</span><br><span class="line">instance?.proxy?.$Bus.off(&#x27;trans-data-to-b&#x27;, Bus)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;组件B&lt;/h1&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; messageFromA &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="all"><a class="markdownIt-Anchor" href="#all"></a> all</h3>
<p>all用来获取一个所有事件名称到事件处理函数的Map</p>
<p>可以使用all.clear来清除所有事件的绑定：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">instance?.<span class="property">proxy</span>?.<span class="property">$Bus</span>.<span class="property">all</span>.<span class="title function_">clear</span>()</span><br></pre></td></tr></table></figure>
<h2 id="ionic"><a class="markdownIt-Anchor" href="#ionic"></a> Ionic</h2>
<p>ionic是一个支持Angular，react，vue的移动端开发框架，其转化的方式时基于webview的，属于Hybrid App开发，底层时基于cordva和capacitor（二选一）</p>
<h3 id="安装-2"><a class="markdownIt-Anchor" href="#安装-2"></a> 安装</h3>
<p>Java环境以及Android Studio（包含安卓SDK）</p>
<h3 id="项目创建"><a class="markdownIt-Anchor" href="#项目创建"></a> 项目创建</h3>
<p>可以使用以下命令使用ionic命令构建项目：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ionic start projectName templateName --type vue</span><br></pre></td></tr></table></figure>
<p>接下来可以直接使用npm run dev命令在web端预览项目</p>
<h3 id="安卓预览"><a class="markdownIt-Anchor" href="#安卓预览"></a> 安卓预览</h3>
<p>如果想在安卓端预览项目，那么首先要对项目打包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>
<p>接下来使用ionic命令将包编译为安卓项目</p>
<p>如果是ios项目则只需要把android替换为ios</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ionic capacitor copy android</span><br></pre></td></tr></table></figure>
<p>编译完成后会生成一个android文件夹，其中应该包含一个capacitor.setting.gradle文件</p>
<p>接下来可以使用ionic相关命令开启预览</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ionic capacitor open android</span><br></pre></td></tr></table></figure>
<p>ionic会帮忙在android studio中打开项目，创建虚拟机后运行即可预览</p>
<p>但这样的预览<strong>无法实现热更新</strong></p>
<h3 id="热更新"><a class="markdownIt-Anchor" href="#热更新"></a> 热更新</h3>
<p>ionic热更新只能在使用USB调试的时候可以实现，在安卓SDK中安装USB Driver后，连接安卓手机，使用如下命令开启热更新：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ionic capacitor run android -l --external</span><br></pre></td></tr></table></figure>
<h2 id="h5适配"><a class="markdownIt-Anchor" href="#h5适配"></a> H5适配</h2>
<h3 id="分辨率适配"><a class="markdownIt-Anchor" href="#分辨率适配"></a> 分辨率适配</h3>
<p>在开发移动端页面时常因为设备宽高比不同导致页面显示不全，才是可以通过<code>meta</code>标签来告诉浏览器使用什么大小渲染页面（默认为标准视口大小）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width&quot;</span>, <span class="attr">initial-scale</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>将标签添加在index.html既可</p>
<h3 id="清除默认样式"><a class="markdownIt-Anchor" href="#清除默认样式"></a> 清除默认样式</h3>
<p>web页面偶尔会带有默认的margin或padding，会影响开发次数需要清除默认样式，并将根容器进行BFC设置</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,<span class="selector-tag">body</span>,<span class="selector-id">#app</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="postcss"><a class="markdownIt-Anchor" href="#postcss"></a> postCSS</h3>
<p>postCSS相当于CSS的babel，可以对CSS代码进行一些预编译。</p>
<p>比如如果想要实现px自动转vw的小工具，只需要编写一个postCSS的小插件即可</p>
<ol>
<li>
<p>在根目录下创建plugins目录</p>
</li>
<li>
<p>为tsconfig.node.json中的include配置扫包目录，以及开启允许隐式Any的设置</p>
</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;noImplicitAny&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;plugins/**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>在plugin目录下创建插件文件：<code>postcss-px-to-viewport.ts</code></li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&quot;postcss&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认参数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Options</span> = &#123;</span><br><span class="line">    <span class="attr">viewportWidth</span>: <span class="number">375</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Options</span> &#123;</span><br><span class="line">    viewportWidth?: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">PostCsspxToViewport</span> = (<span class="attr">options</span>: <span class="title class_">Options</span> = <span class="title class_">Options</span>): <span class="function"><span class="params">Plugin</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 接收到参数后将参数与默认值合并</span></span><br><span class="line">    <span class="keyword">const</span> opt = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, <span class="title class_">Options</span>, options)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 定义插件名称</span></span><br><span class="line">        <span class="attr">postcssPlugin</span>: <span class="string">&quot;postcss-px-to-viewport&quot;</span>,</span><br><span class="line">        <span class="comment">// 钩子函数</span></span><br><span class="line">        <span class="comment">// 该钩子函数用于获取css节点</span></span><br><span class="line">        <span class="title class_">Declaration</span>(node) &#123;</span><br><span class="line">            <span class="comment">// 删选带px单位的属性值，node.key和node.value分别表示所有属性与其值</span></span><br><span class="line">            <span class="comment">// 这里还可以使用自定义单位，例如ED</span></span><br><span class="line">            <span class="keyword">if</span>(node.<span class="property">value</span>.<span class="title function_">includes</span>(<span class="string">&quot;px&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">const</span> num = <span class="built_in">parseFloat</span>(node.<span class="property">value</span>) <span class="comment">// 获取属性值的数值部分</span></span><br><span class="line">                node.<span class="property">value</span> = <span class="string">`<span class="subst">$&#123;((num / opt.viewportWidth) * <span class="number">100</span>).toFixed(<span class="number">2</span>)&#125;</span>vw`</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>然后再vite.config.ts中引入并注册</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">PostCsspxToViewport</span>&#125; <span class="keyword">from</span> <span class="string">&quot;./plugins/postcss-px-to-viewport&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 配置postcss</span></span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">postcss</span>: &#123;</span><br><span class="line">        <span class="attr">plugins</span>: [<span class="title class_">PostCsspxToViewport</span>()]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="切换主题切换字体大小"><a class="markdownIt-Anchor" href="#切换主题切换字体大小"></a> 切换主题/切换字体大小</h3>
<p>可以使用VueUse插件封装好的API<code>useCssVar</code>改变css中定义的变量来实现：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> font = <span class="title function_">useCssVar</span>(<span class="string">&#x27;--size&#x27;</span>)</span><br><span class="line">font.<span class="property">value</span> = num + <span class="string">&#x27;px&#x27;</span></span><br></pre></td></tr></table></figure>
<p>其底层原理是通过以下两个API获取和设置css变量：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">style</span>.<span class="title function_">getPropertyValue</span>(<span class="string">&#x27;--size&#x27;</span>)</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&#x27;--size&#x27;</span>, num + <span class="string">&#x27;px&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="css原子化"><a class="markdownIt-Anchor" href="#css原子化"></a> CSS原子化</h2>
<p>定义：</p>
<blockquote>
<p>原子化<code>CSS</code>是一种<code>CSS</code>架构方式，其支持小型、单一用途的类，其名称基于视觉功能。</p>
</blockquote>
<p>更加通俗的来讲，原子化<code>CSS</code>是一种新的<code>CSS</code>编程思路，它倾向于创建小巧且单一用途的<code>class</code>，并且以视觉效果进行命名。举个简单的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 原子化类定义 --&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .text-white &#123; color: white; &#125;</span><br><span class="line">  .bg-black &#123; background-color: black; &#125;</span><br><span class="line">  .text-center &#123; text-align: center; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 原子化类使用 --&gt;</span><br><span class="line">&lt;div class=&quot;text-white bg-black text-center&quot;&gt;hello Atomic CSS&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>css原子化的优缺点：</p>
<ul>
<li>优点：
<ul>
<li>减少了css体积，提高css可复用性</li>
<li>减少起名复杂度</li>
</ul>
</li>
<li>缺点
<ul>
<li>增加了记忆成本，比如background需要记住其缩写bg</li>
</ul>
</li>
</ul>
<h3 id="原子化插件unocss"><a class="markdownIt-Anchor" href="#原子化插件unocss"></a> 原子化插件unocss</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D unocss</span><br></pre></td></tr></table></figure>
<p>unocss最好使用在vite中，因为webpack的版本功能被阉割</p>
<p><a target="_blank" rel="noopener" href="https://xiaoman.blog.csdn.net/article/details/125650172">小满Vue3第三十七章（unocss原子化）_unocss解决了什么问题-CSDN博客</a></p>
<h2 id="tsxjsx"><a class="markdownIt-Anchor" href="#tsxjsx"></a> TSX/JSX</h2>
<p>Vue中同样支持使用JSX的方式来编写组件，需要安装和使用官方插件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @vitejs/plugin-vue-jsx -D</span><br></pre></td></tr></table></figure>
<p>安装完成后需要在vite中进行一些配置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vueJsx <span class="keyword">from</span> <span class="string">&#x27;@vite/plugin-vue-jsx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>(), <span class="title function_">vueJsx</span>()],</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">      <span class="attr">alias</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;@&#x27;</span>: <span class="title function_">fileURLToPath</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&quot;./src&quot;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>))</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="tsx的使用"><a class="markdownIt-Anchor" href="#tsx的使用"></a> TSX的使用</h3>
<p>使用TSX创建组件时，先新建一个<code>.tsx</code>文件后，使用如下方式即可：</p>
<ol>
<li>
<pre class="highlight"><code class="tsx"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;
    <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Ender<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)
&#125;
&lt;!--code￼<span class="number">130</span>--&gt;

- 利用<span class="string">`defineComponent`</span>方法创建<span class="title class_">OptionAPI</span>式组件，需要实现render方法

</code></pre>
</li>
<li>
<pre class="highlight"><code class="tsx"><span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;
<span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;

<span class="keyword">interface</span> <span class="title class_">Props</span> &#123;
    name?: <span class="built_in">string</span>
&#125;
<span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;
    <span class="attr">props</span>: &#123;
        <span class="attr">name</span>:<span class="title class_">String</span>
    &#125;,
    <span class="attr">emits</span>: [<span class="string">&#x27;my-click&#x27;</span>],
    <span class="title function_">setup</span>(<span class="params"><span class="attr">props</span>:<span class="title class_">Props</span>, &#123;emit&#125; </span>) &#123;
        <span class="keyword">const</span> age = <span class="title function_">ref</span>(<span class="number">25</span>)
        <span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"><span class="attr">str</span>:<span class="built_in">string</span></span>) =&gt; &#123;
            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;点击了: &quot;</span>, str)
            <span class="title function_">emit</span>(<span class="string">&quot;my-click&quot;</span>, str)
        &#125;
        <span class="variable language_">console</span>.<span class="title function_">log</span>(props)
        <span class="keyword">return</span> <span class="function">() =&gt;</span> (
            <span class="language-xml"><span class="tag">&lt;&gt;</span>
                <span class="tag">&lt;<span class="name">div</span>&gt;</span>props: &#123;props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> fn(&quot;Hello&quot;)&#125;&gt;
                    &#123; age.value &#125;
                <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
            <span class="tag">&lt;/&gt;</span></span>
        )
    &#125;
&#125;)
&lt;!--code￼<span class="number">131</span>--&gt;

</code></pre>
</li>
</ol>
<h2 id="unplugin-auto-import"><a class="markdownIt-Anchor" href="#unplugin-auto-import"></a> unplugin-auto-import</h2>
<p>一个能够使项目全局引入vue函数的组件，可以引入ref、reactive等vue包中的函数，也支持axios等其他包</p>
<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install unplugin-auto-import</span><br></pre></td></tr></table></figure>
<p>在<code>vite.config.ts</code>中配置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, <span class="variable constant_">URL</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vueJsx <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue-jsx&#x27;</span></span><br><span class="line"><span class="comment">// 自动引入ref, reactive等插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">AutoImport</span> <span class="keyword">from</span> <span class="string">&#x27;unplugin-auto-import/vite&#x27;</span></span><br><span class="line"><span class="comment">// import tsx from &#x27;./plugin/index&#x27;</span></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>(), <span class="title function_">vueJsx</span>(), <span class="title class_">AutoImport</span>(&#123;</span><br><span class="line">    <span class="comment">// 全局引入vue包中的函数</span></span><br><span class="line">    <span class="attr">imports</span>:[<span class="string">&#x27;vue&#x27;</span>],</span><br><span class="line">    <span class="comment">// 定义挂载位置</span></span><br><span class="line">    <span class="attr">dts</span>: <span class="string">&quot;src/auto-import.d.ts&quot;</span></span><br><span class="line">  &#125;)],</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: <span class="title function_">fileURLToPath</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&quot;./src&quot;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="babel与vite插件编写"><a class="markdownIt-Anchor" href="#babel与vite插件编写"></a> Babel与Vite插件编写</h2>
<p>一个将ES6+语法编译为ES5从而实现低版本浏览器适配的插件，其原理是：</p>
<p>源代码  <code>-&gt;</code>（编译器（parse））抽象语法树 AST<code>-&gt;</code>（转换过程（transform））修改后的AST <code>-&gt;</code>（生成器（generator））转换后的代码</p>
<p>可以利用Babel实现Vite项目中的TSX解析，可以利用以下插件实现：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install @vue/babel-plugin-jsx # vue的babel支持</span><br><span class="line">npm install @babel/core # babel核心组件</span><br><span class="line">npm install @babel/plugin-transform-typescript # babel TS编译器</span><br><span class="line">npm install @babel/plugin-syntax-import-meta # import 语法编译</span><br><span class="line">npm install @types/babel__core # babel core声明文件</span><br></pre></td></tr></table></figure>
<p>首先我们在根目录下创建一个插件目录<code>plugin</code>并在目录下创建文件<code>index.tx</code>:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plugin/index.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Plugin</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> babel <span class="keyword">from</span> <span class="string">&#x27;@babel/core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> jsx <span class="keyword">from</span> <span class="string">&#x27;@vue/babel-plugin-jsx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>(<span class="params"></span>):<span class="title class_">Plugin</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">// 插件命名需要以vite-plugin开头，vue用来区分是vue使用还是react</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;vite-plugin-vue-tsx&quot;</span>,</span><br><span class="line">        <span class="comment">// id为文件路径</span></span><br><span class="line">        <span class="title function_">transform</span>(<span class="params">code, id</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果是以.tex结尾的路径</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="regexp">/.tsx$/</span>.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(code, id)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其次将该目录添加进<code>tsconfig.node.json</code>文件中进行引入</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;composite&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Node&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;allowSyntheticDefaultImports&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 添加plugin目录</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;vite.config.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;plugin&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后就可以和其他插件一样在vite的配置文件中使用了：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, <span class="variable constant_">URL</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="comment">// import vueJsx from &#x27;@vitejs/plugin-vue-jsx&#x27;</span></span><br><span class="line"><span class="comment">// 自定义插件</span></span><br><span class="line"><span class="keyword">import</span> tsx <span class="keyword">from</span> <span class="string">&#x27;./plugin/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="comment">// 插件使用</span></span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>(), <span class="title function_">tsx</span>()],</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: <span class="title function_">fileURLToPath</span>(<span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&quot;./src&quot;</span>, <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="vite"><a class="markdownIt-Anchor" href="#vite"></a> Vite</h2>
<p>Vite提现了Vue团队的一贯作风：减少开发者的心智负担。</p>
<p>相比于webpack，他内置了更多功能从而减少了开发者对插件等外部依赖的管理，降低了心智负担</p>
<p>例如在Vite中不需要配置css-loader、less-loader、ts-loader等等插件就能直接使用。</p>
<h3 id="构建工具"><a class="markdownIt-Anchor" href="#构建工具"></a> 构建工具</h3>
<p>构架工具具备的功能：</p>
<ol>
<li>遇到ts文件使用tsc将ts文件转化为js文件</li>
<li>遇到.vue或.tsx/jsx使用<code>react-compiler</code>和<code>vue-compiler</code>将其转化为<code>render</code>函数</li>
<li>遇到less/sass/postcss/windtail使用<code>less-loader</code>，<code>sass-loader</code>等将其编译为原生css</li>
<li>遇到老版本浏览器使用babel将es6以上的语法转化为旧版语法</li>
<li>利用uglify/terser等对代码进行压缩优化体积</li>
<li>…</li>
</ol>
<p>构建工具就是将以上功能集成到一起并自动执行的工具</p>
<p>一个构建工具实际上还会复杂其他多种工作，那我们将他的功能进行归类：</p>
<ol>
<li>模块化支持：支持<code>es module</code>或<code>commonJS</code>等多种模块化的模块引入语法<code>from ... import ..</code>或<code>const ... = require(...)</code></li>
<li>处理代码兼容性：babel、less、ts语法转换（构建工具利用其他处理工具自动化的完成）</li>
<li>提高项目性能：压缩文件，代码分割</li>
<li>优化开发体验：
<ol>
<li>构建工具自动监听文件变化，重新打包并在浏览器重新运行（<strong>热更新HMR</strong>）</li>
<li>开发服务器：解决跨域问题</li>
</ol>
</li>
</ol>
<p>目前市面上的构建工具：</p>
<ul>
<li>webpack</li>
<li>vite</li>
<li>parcel</li>
<li>esbuild</li>
<li>rollup</li>
<li>grunt</li>
<li>gulp</li>
</ul>
<h3 id="vite相对于webpack的优势"><a class="markdownIt-Anchor" href="#vite相对于webpack的优势"></a> Vite相对于Webpack的优势</h3>
<p><strong>Vite为什么笔Webpack快那么都？</strong></p>
<blockquote>
<p>Webpack考虑到网页可以跑在服务端，也能跑在客户端，于是支持多种模块化方法混用，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span> <span class="comment">// es6 module</span></span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&quot;lodash&quot;</span>) <span class="comment">// commonJs</span></span><br></pre></td></tr></table></figure>
<p>那么为了避免这种情况导致的编译错误，Webpack在启动服务之前，需要对每一个moduel都进行一边编译，以确保把所有模块化方法都转化为了一般形式，因此当项目使用的module越来越多时，启动和热更新（HMR）的速度就会变慢</p>
<p>而Vite要求模块化必需使用es6 module的方式，则可直接启动服务，当module被需要时，在编译module，实现按需导入，减少编译和热更新等待的时间</p>
</blockquote>
<h3 id="vite脚手架和vite"><a class="markdownIt-Anchor" href="#vite脚手架和vite"></a> Vite脚手架和Vite</h3>
<p>在Vite官网使用给出的构建项目时使用的命令：</p>
<p><code>yarn create vite</code></p>
<p>实际上是使用了<code>create-vite</code>这个脚手架的功能，脚手架包含<code>Vite</code>但脚手架的主要更能还是根据模板创建项目文件以及目录</p>
<h3 id="vite-2"><a class="markdownIt-Anchor" href="#vite-2"></a> Vite</h3>
<p>Vite以<code>index.html</code>文件作为入口</p>
<p>它解析<code>&lt;script type=&quot;module&quot; src=&quot;...&quot;&gt;</code> ，这个标签指向你的 JavaScript 源码。内联引入 JavaScript 的 <code>&lt;script type=&quot;module&quot;&gt;</code> 和引用 CSS 的 <code>&lt;link href&gt;</code> 也能利用 Vite 特有的功能被解析。</p>
<p><code>index.html</code> 中的 URL 将被自动转换，因此不再需要 <code>%PUBLIC_URL%</code> 占位符了。</p>
<h3 id="根目录"><a class="markdownIt-Anchor" href="#根目录"></a> 根目录</h3>
<p><code>vite</code> 以当前工作目录作为根目录启动开发服务器。你也可以通过 <code>vite serve some/sub/dir</code> 来指定一个替代的根目录。注意 Vite 同时会解析项目根目录下的 <a target="_blank" rel="noopener" href="https://cn.vitejs.dev/config/#configuring-vite">配置文件（即 <code>vite.config.js</code>）</a>，因此如果根目录被改变了，你需要将配置文件移动到新的根目录下。</p>
<p>Vite运行在node环境中，在后续的代码中经常会使用到<code>path.resolve()</code>函数来构造路径，原因是当我们在使用相对路径访问某个包时，node环境下会将相对路径与<code>process.pwd()</code>拼接，但这一函数返回值始终是当前node的运行目录，也就是说如果我们不再vite的项目根目录下使用，相对路径的拼接就会出错，因此我们需要使用<code>__dirname</code>这一变量来得到当前文件所在的目录，再与相对路径拼接得到正确的绝对路径。</p>
<p>实际上这与node的编译有关，node在对js文件进行编译时，会将每个js文件封装为一个立即执行函数来隔绝作用于，在这个函数中第五个参数就是<code>__dirname</code>，用来保存当前js文件的绝对路径。因此在node环境下的js文件可以访问这一变量。</p>
<p>此外该立即执行函数打字包含以下几个参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"><span class="built_in">exports</span>, <span class="built_in">require</span>, <span class="variable language_">module</span>, __filename, __dirname</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;())</span><br></pre></td></tr></table></figure>
<p>其中</p>
<ul>
<li><code>exports === module.exports</code>是commonjs的导出对象</li>
<li><code>require</code>为commonjs的导入方法</li>
<li><code>module</code>为module对象</li>
<li><code>__filename</code>为文件绝对路径+文件名</li>
<li><code>__dirname</code>为文件绝对路径</li>
</ul>
<h3 id="vite依赖构建"><a class="markdownIt-Anchor" href="#vite依赖构建"></a> Vite依赖构建</h3>
<p>Vite遇到非绝对路径会对其进行补全，依赖预构建<strong>只发生在开发环境，生产环境全权交给rollup</strong>，对于commonJS的导出方式进行依赖预构建。</p>
<p>Vite的依赖构建特别之处在于会对以来进行<strong>依赖预构建</strong>：</p>
<p>Vite会找到对应的依赖，然后使用esbuild（go语言编写）对JS语法进行一些处理，将其他模块化规范都转化为es6 module的规范，然后放到当前目录下的<code>node_module/.vite/deps</code>中，同时对esmodule规范的各个模块进行统一集成。</p>
<p>预构建解决了下面三个问题：</p>
<ol>
<li>不同的第三方包有不同的导出格式</li>
<li>在路径的处理上可以直接使用<code>.vite/deps</code>，方便路径重写</li>
<li>解决网络多包传输的性能问题（是导致原生esmodule规范不敢支持node_module的原因之一），无论多少额外的export和import，最终都会尽可能进行集成最后生成一个或者几个模块</li>
</ol>
<p>在<code>vite.config.js</code>中可以通过<code>optimizeDeps</code>设置针对某些包是否进行依赖预构建</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">optimizeDeps</span>: &#123;</span><br><span class="line">    <span class="attr">exclude</span>: [<span class="string">&#x27;lodash-es&#x27;</span>], <span class="comment">//不对lodash-es进行依赖预构建，此时会根据加载所有lodash依赖的包</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="vite运行在node端为什么可以是用esmodule的包管理"><a class="markdownIt-Anchor" href="#vite运行在node端为什么可以是用esmodule的包管理"></a> Vite运行在node端为什么可以是用esmodule的包管理</h4>
<p>node端只支持commonJS规范，但是vite的配置文件<code>vite.config.js</code>可以使用esmodule进行包的导入导出</p>
<p>这是因为vite在读取配置文件的时候会率先解析文件语法，遇到esmodule规范的语法时直接将其替换为commonJS</p>
<h3 id="vite配置文件处理细节"><a class="markdownIt-Anchor" href="#vite配置文件处理细节"></a> Vite配置文件处理细节</h3>
<ol>
<li>
<p>Vite配置文件语法提示</p>
<ol>
<li>
<p>是用webStorm会有良好的语法提示</p>
</li>
<li>
<p>为了获得良好的语法提示，建议从vite中导入defineConfig，然后是用defineConfig对配置对象进行导出，defineConfig是一个函数，该函数的参数是用ts定义了interface，因此会有良好的代码提示：</p>
</li>
<li>
<pre class="highlight"><code class="ts"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span>
<span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;
&#125;
&lt;!--code￼<span class="number">141</span>--&gt;

</code></pre>
</li>
</ol>
</li>
<li>
<p>关于环境的处理</p>
<ol>
<li>
<p>使用webpack的时候想要区分环境，需要针对不同环境编写config，比如开发环境要在<code>webpack.dev.config</code>中配置，生产环境要在<code>webpack.prod.config</code>中配置</p>
</li>
<li>
<p>而vite中则可以是用defineConfig函数进行区分，然后根据不同的环境返回不同的config对象：</p>
</li>
<li>
<pre class="highlight"><code class="ts"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span>

<span class="comment">// 导入不同环境的配置</span>
<span class="keyword">import</span> viteBaseConfig <span class="keyword">from</span> <span class="string">&#x27;./vite.base.config.ts&#x27;</span>
<span class="keyword">import</span> viteDevConfig <span class="keyword">from</span> <span class="string">&#x27;./vite.base.config.ts&#x27;</span>
<span class="keyword">import</span> viteProbConfig <span class="keyword">from</span> <span class="string">&#x27;./vite.base.config.ts&#x27;</span>

<span class="comment">// 文件压缩</span>
<span class="comment">// import viteCompression from &#x27;vite-plugin-compression&#x27;</span>


<span class="comment">// 策略模式，减少if else的使用</span>
<span class="keyword">const</span> envResolver = &#123;
  <span class="string">&quot;build&quot;</span>: <span class="function">() =&gt;</span> &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生产环境&quot;</span>);
    <span class="keyword">return</span> &#123;...viteBaseConfig, ...viteProbConfig&#125;
  &#125;,
  <span class="string">&quot;serve&quot;</span>: <span class="function">() =&gt;</span> &#123;
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;开发环境&quot;</span>);
    <span class="keyword">return</span> &#123;...viteBaseConfig, ...viteDevConfig&#125;
  &#125;
&#125;

<span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(<span class="function">(<span class="params">&#123;command&#125;</span>) =&gt;</span> &#123;
    <span class="comment">// command根据是用的命令vite build/vite区分环境</span>
    <span class="keyword">return</span> envResolver[command]()
&#125;)
&lt;!--code￼<span class="number">142</span>--&gt;



</code></pre>
</li>
</ol>
</li>
</ol>
<blockquote>
<p>process是node端关于进程的对象</p>
</blockquote>
<h4 id="客户端是用环境变量"><a class="markdownIt-Anchor" href="#客户端是用环境变量"></a> 客户端是用环境变量</h4>
<p>vite会将环境变量同时注入<code>import.meta.env</code>中，以便在客户端是用环境变量（即组件，axios，等文件内）</p>
<p>由上文对<code>loadEnv</code>的源码分析可知，vite对环境变量进行了拦截，避免将不必要的隐私数据注入到<code>import.meta.env</code>中，只有以<code>prefixes</code>开头的环境变量才会被注入</p>
<p>也可以直接在配置文件中通过<code>envPrefix</code>进行配置</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">envPrefix</span>: <span class="string">&quot;ENDER_&quot;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="vite如何让浏览器识别vue"><a class="markdownIt-Anchor" href="#vite如何让浏览器识别vue"></a> Vite如何让浏览器识别.vue</h3>
<p>Vite实际上在开发环境中运行整个项目签会使用node开启一个服务，并监听特定端口的请求（默认未<code>5173</code>）</p>
<p>当我们在浏览器中输入url时，Vite服务会根据URL找到对应的文件，以response的形式应答浏览器，并以<code>Content-Type</code>字段告诉浏览器应该以什么方式解析返回的结果</p>
<p>当请求的文件时<code>.vue</code>文件时，Vite服务读到文件后会进行AST语法分析（这一过程就是vue-loader的功能），最终生成JS语法文件，然后以<code>text/javascript</code>格式相应浏览器，浏览器就会以JS格式解析<code>.vue</code>文件</p>
<h3 id="vite如何处理css"><a class="markdownIt-Anchor" href="#vite如何处理css"></a> Vite如何处理css</h3>
<p>Vite原生支持css文件的处理</p>
<ol>
<li>vite读到main.js中引用了index.css文件</li>
<li>是用fs模块读取index.css中的文件内容</li>
<li>直接创建一个style标签，将index.css中文件内容粘贴到<code>&lt;style&gt;</code>标签中</li>
<li>将<code>&lt;style&gt;</code>标签插入<code>index.html</code>的head中</li>
<li>将css文件内容直接替换为js脚本（便于热更新，或模块化css），让浏览器以js的方式解析css文件</li>
</ol>
<p>但如果我们进行协同开发，不同的组件是用了不同的css文件，且这两个文件中都有名字为<code>.footer</code>的样式，此时后导入的组件的样式将覆盖先导入的组件的样式</p>
<p>此时可以是用cssmodule来解决这一问题</p>
<p>cssmodule即css模块化，是一个基于node的css处理模块：</p>
<ol>
<li>他读取<code>$&#123;style&#125;.moduel.css</code>的文件<code>module</code>是一种约定，表示开启模块化</li>
<li>将其中的所有类目进行替换，即在原有类名的末尾添加一串hash字符串</li>
<li>同时创建一个对象让旧类名作为key，新类名作为value</li>
<li>将替换完成的内容放入head标签中</li>
<li>将<code>module.css</code>文件中的内容替换为js</li>
<li>将3中创建的对象进行默认导出</li>
</ol>
<p>同时less、sass等都可以使用同样的方法进行模块化</p>
<h3 id="vite中配置css的处理"><a class="markdownIt-Anchor" href="#vite中配置css的处理"></a> Vite中配置css的处理</h3>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">css</span>: &#123; <span class="comment">// <span class="doctag">TODO:</span> 对css的行为进行配置, modules的配置会传给postcss处理</span></span><br><span class="line">    <span class="attr">modules</span>: &#123; <span class="comment">// <span class="doctag">TODO:</span> 对css模块化的默认行为进行覆盖</span></span><br><span class="line">        <span class="attr">localsConvention</span>: <span class="string">&quot;camelCase&quot;</span>, <span class="comment">// 配置类名展示形式，camelCase表示驼峰命名支持驼峰式和连接符式</span></span><br><span class="line">        <span class="attr">scopeBehaviour</span>: <span class="string">&quot;global&quot;</span>, <span class="comment">// 配置当前的模块化行为是模块化还是全局化global表示全局，local表示模块化</span></span><br><span class="line">        <span class="comment">// generateScopedName: (name, filename, css) =&gt;&#123;return `$&#123;name&#125;_$&#123;Math.random().toString(36).substr(3, 8)&#125;`&#125;</span></span><br><span class="line">        <span class="comment">// name代表css文件中原本的类名</span></span><br><span class="line">        <span class="comment">// filename代表css的绝对路径</span></span><br><span class="line">        <span class="comment">// css代表当前样式</span></span><br><span class="line">        <span class="attr">generateScopedName</span>: <span class="string">&quot;[name]_[local]_[hash:5]&quot;</span>, <span class="comment">// 生成的类名规则，其中格式通配符定义在postcss文档中给出，可以配置为函数</span></span><br><span class="line">        <span class="attr">hashPrefix</span>: <span class="string">&quot;ender&quot;</span>, <span class="comment">// 生成hash时，hashPrefix会被加到类名中来生成hash以降低hash冲突</span></span><br><span class="line">        <span class="attr">globalModulePaths</span>: [], <span class="comment">// 代表不想参与css模块化的路径，建议使用Path.resolve生成绝对路径，通常如果自己的css中使用&#x27;@import&#x27;引入了第三方css时，需要为第三方css配置</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="vite配置css预处理器"><a class="markdownIt-Anchor" href="#vite配置css预处理器"></a> Vite配置css预处理器</h3>
<p>在没有构建工具的情况下可以直接安装less或sass，然后使用对应的编译程序编译less或sass代码：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn add less // 安装less</span><br><span class="line"></span><br><span class="line">npx lessc style.module.less // 编译less文件</span><br><span class="line"></span><br><span class="line">npx lessc <span class="literal">--math</span>=<span class="string">&quot;always&quot;</span> style.module.less // 编译less文件</span><br></pre></td></tr></table></figure>
<p>这些lessc命令使用到的参数都可以在vite中进行配置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">preprocessorOptions</span>: &#123;  <span class="comment">// <span class="doctag">TODO:</span> css预处理器配置采用key + config的形式处理</span></span><br><span class="line">    <span class="attr">less</span>: &#123;</span><br><span class="line">        <span class="comment">// 在webpack中是通过配置less-loader实现的</span></span><br><span class="line">        <span class="attr">math</span>: <span class="string">&quot;always&quot;</span>,  <span class="comment">// 配置对数学表达式的编译,</span></span><br><span class="line">        <span class="attr">global</span>: &#123;</span><br><span class="line">            <span class="comment">// 配置全局变量</span></span><br><span class="line">            <span class="attr">mainColor</span>: <span class="string">&quot;red&quot;</span>  <span class="comment">// 此时在less文件中即可读取该变量</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">scss</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sourcemap"><a class="markdownIt-Anchor" href="#sourcemap"></a> SourceMap</h3>
<p>我们的项目上线时被压缩或者被编译过，那么当程序出错后，报错的位置信息将不再正确</p>
<p>此时我们可以开启vite的<code>devSourcemap</code>配置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devSourcemap</span>: <span class="literal">true</span>  <span class="comment">// 开启css的sourceMap，即文件索引，开启后，项目启动时在浏览器中可以直接索引到样式所在的文件</span></span><br></pre></td></tr></table></figure>
<p>这样在启动项目之后，即使less或者sass被编译成了其他文件，我们依然可以在浏览器的开发者中直接看到样式所在的源文件</p>
<h3 id="postcss-2"><a class="markdownIt-Anchor" href="#postcss-2"></a> PostCSS</h3>
<blockquote>
<p>与babel相对于js一样，postCSS是对css进行兼容性处理的软件</p>
</blockquote>
<p>我们思考预处理器无法完成的事情：</p>
<ul>
<li>对未来css属性的一些使用降级问题</li>
<li>前缀补全: --webkit（为了兼容低版本浏览器）</li>
</ul>
<h4 id="使用"><a class="markdownIt-Anchor" href="#使用"></a> 使用</h4>
<p>首先需要安装postcss</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add postcss<span class="literal">-cli</span> postcss <span class="literal">-D</span></span><br></pre></td></tr></table></figure>
<p>随后我们可以通过描述文件控制postcss<br />
postcss支持多种格式的配置文件，但是最常用的还是js</p>
<p>在配置文件中我们可以对postcss用到的插件进行统一的整理</p>
<p>例如经常使用的<code>postcss-preset-env</code>预设环境，其中包含了一些默认的插件，例如语法降级，编译等插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//postcss.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postcssPresetEnv = <span class="built_in">require</span>(<span class="string">&quot;post-preset-env&quot;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">export</span> = &#123;</span><br><span class="line">    <span class="comment">// 使用预设环境添加语法降级和编译功能</span></span><br><span class="line">    <span class="comment">// 使用less，sass进行语法编译，但目前postcss的less和sass插件已经停止维护了</span></span><br><span class="line">    <span class="comment">// 因此less和sass目前是独立于postcss进行编译的，编译完成后在交由postcss，但实际上postcss在功能上是可以包含less和sass的</span></span><br><span class="line">    <span class="comment">// 此后postcss也被称为后处理器，即less和sass处理后交由postcss处理</span></span><br><span class="line">    <span class="attr">plugins</span>: [<span class="title function_">postPresetEnv</span>(<span class="comment">/* pluginsOptions */</span>)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用postcss可以对指定文件进行编译：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx postcss style.css <span class="literal">-o</span> result.css</span><br></pre></td></tr></table></figure>
<h3 id="vite中配置postcss"><a class="markdownIt-Anchor" href="#vite中配置postcss"></a> Vite中配置postCSS</h3>
<p>vite支持postCSS因此只需要在<code>vite.config.js</code>中进行配置即可：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="attr">postcss</span>: &#123;</span><br><span class="line">        <span class="attr">plugins</span>: [<span class="title function_">postcssPresetEnv</span>()]  <span class="comment">// 配置postcss中使用plugins</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<ul>
<li><code>postcss-preset-env</code>: 支持css变量、未来语法，甚至自动补全（auto-prefixer插件的功能）</li>
</ul>
<p>vite同样支持直接读取<code>postcss.config.js</code>中的配置，但在<code>vite.config.js</code>中进行的配置优先级更高。</p>
<h3 id="vite加载静态资源"><a class="markdownIt-Anchor" href="#vite加载静态资源"></a> Vite加载静态资源</h3>
<blockquote>
<p>除了动态API以外，绝大多数资源都会被视为静态资源</p>
</blockquote>
<p>vite对于静态资源基本上是开箱即用的</p>
<p>对于assets中的图片、Json文件，使用<code>import</code>引入即可，并且json通过<code>import</code>引入之后直接就为对象，但在其他的构建工具中导入的json文件将作为json字符串</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// people.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    name<span class="punctuation">:</span> <span class="string">&quot;小王&quot;</span><span class="punctuation">,</span></span><br><span class="line">    age<span class="punctuation">:</span> <span class="number">18</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jsonFile <span class="keyword">from</span> <span class="string">&quot;./src/assets/json/people.json&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;jsonFile: &quot;</span>, jsonFile)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以使用展开运算符部分导入</span></span><br><span class="line"><span class="keyword">import</span> &#123; name &#125; <span class="keyword">from</span> <span class="string">&quot;./src/assets/json/people.json&quot;</span></span><br><span class="line"><span class="comment">// 这样构建生产环境时可以触发Tree Shacking机制避免不必要的导入，提升性能</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name: &quot;</span>, name)</span><br></pre></td></tr></table></figure>
<p>在导入资源时，我们还可以定义其导入的方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以url的形式导入(默认形式)</span></span><br><span class="line"><span class="keyword">import</span> imgUrl <span class="keyword">from</span> <span class="string">&quot;./src/assets/images/a.png?url&quot;</span></span><br><span class="line"><span class="comment">// 输出为图像绝对路径</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;imgUrl: &quot;</span>, imgUrl)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以raw的形式导入</span></span><br><span class="line"><span class="keyword">import</span> imgRaw <span class="keyword">from</span> <span class="string">&quot;./src/assets/images/a.png?raw&quot;</span></span><br><span class="line"><span class="comment">// 输出为图像Buffer，即二进制字符串</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;imgRaw: &quot;</span>, imgRaw)<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<p>但有时候我们需要在组件中引入assets中的某张图片，但是由于组件目录过深导致使用相对路径导入时需要使用很多次<code>../</code>来退回到<code>src</code>目录下，此时就可以利用Vite的<code>resolve.alias</code>别名配置来定义绝对路径的别名：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">            <span class="comment">// 使用path.resolve和__dirname拼接绝对路径</span></span><br><span class="line">            <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./src&quot;</span>)</span><br><span class="line">            <span class="string">&#x27;@assets&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./src/assets&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样引入时只需要使用别名引入静态资源</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> imgUrl <span class="keyword">from</span> <span class="string">&quot;@assets/images/a.png&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="关于svg"><a class="markdownIt-Anchor" href="#关于svg"></a> 关于SVG</h4>
<p>SVG的优缺点：</p>
<ul>
<li>优点：
<ul>
<li>体积小</li>
<li>不会失真</li>
</ul>
</li>
<li>缺点：
<ul>
<li>无法表示层次复杂的图片</li>
</ul>
</li>
</ul>
<p>在导入图像时我们讨论过使用不同的格式加载图片得到的结果，加载SVG文件时同理，但使用RAW格式加载SVG得到的结果这不再是buffer，而是文件内容的字符串，因此，我们可以直接将RAW格式的SVG添加到页面中，还能进行修改颜色、绑定事件等等操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> svgRaw <span class="keyword">from</span> <span class="string">&quot;./assets/svgs/svgFile.svg?raw&quot;</span>;</span><br><span class="line"><span class="comment">// 结果为字符串</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(svgRaw)</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span> = svgRaw</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定事件与修改颜色</span></span><br><span class="line"><span class="keyword">const</span> svgElement = <span class="variable language_">document</span>.<span class="title function_">getElementByTagName</span>(<span class="string">&quot;svg&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">svgElement.<span class="property">onmouseenter</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">fill</span> = <span class="string">&quot;red&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="vite生产环境对静态资源的处理"><a class="markdownIt-Anchor" href="#vite生产环境对静态资源的处理"></a> Vite生产环境对静态资源的处理</h3>
<p>Vite使用rollup打包后，会在<code>/dist</code>文件夹下生成最终的文件，但其中静态资源的路径使用的是以<code>/dist</code>为根目录的相对路径，因此如果我们在项目文件夹下启动Live Server等工具进行预览时，会出现找不到资源的问题，此时只需要切换到<code>/dist</code>目录下启动服务即可。(Webpack中可以通过配置<code>baseURL</code>来解决)</p>
<p>打包后的静态资源会在文件名后添加hash字符串，这是由于浏览器自身具有缓存机制，对于同名资源浏览器不会重新加载，而是直接读取缓存。因此需要hash字符串来避免文件名一致，保证浏览器会重新请求静态资源。</p>
<p>Vite中使用的hash算法是基于文件名和文件内容的，因此当我们对文件内容进行修改时产生的hash值就会改变，从而引起重新加载。</p>
<p>在构建生产包时的配置可以在<code>build</code>中配置</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="comment">// 取消文件压缩</span></span><br><span class="line">    <span class="attr">minify</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;  <span class="comment">// <span class="doctag">TODO:</span> 配置rollup的构建策略</span></span><br><span class="line">        <span class="attr">output</span>: &#123;  <span class="comment">// 控制输出</span></span><br><span class="line">             <span class="comment">// 占位符控制生成静态资源文件的名称</span></span><br><span class="line">             <span class="comment">// hash为文件名和文件内容组合生产的字符串</span></span><br><span class="line">            <span class="attr">assetFileNames</span>: <span class="string">&quot;[hash].[name].[ext]&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 静态资源阈值。4000KB，小于该阈值的图片将被打包为base64图片</span></span><br><span class="line">    <span class="attr">assetsInlineLimit</span>: <span class="number">4096000</span>,</span><br><span class="line">    <span class="comment">// 导出文件夹名称</span></span><br><span class="line">    <span class="attr">outDir</span>: <span class="string">&quot;outDist&quot;</span>,</span><br><span class="line">    <span class="comment">// 导出静态资源文件夹名称</span></span><br><span class="line">    <span class="attr">assetsDir</span>: <span class="string">&quot;static&quot;</span>,</span><br><span class="line">    <span class="comment">// 清楚输出目录中的所有文件</span></span><br><span class="line">    <span class="attr">emptyOutDir</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="resolvealias原理"><a class="markdownIt-Anchor" href="#resolvealias原理"></a> resolve.alias原理</h3>
<p>在我们对alias进行配置时，实际上Vite在开启服务后，会读取<code>vite.config.hs</code>中的内容，当我们输入URL请求文件时，Vite服务会拿到我们请求的文件名，然后使用<code>Object.entries()</code>得到<code>resolve.alias</code>中的键值对，然后将文件中<code>import...from</code>中的<code>@</code>替换为<code>配置的path</code>.</p>
<h3 id="vite插件"><a class="markdownIt-Anchor" href="#vite插件"></a> Vite插件</h3>
<blockquote>
<p>Vite会在生命周期的不同阶段调用不同的插件已达成某些目的</p>
</blockquote>
<p>事实上中间件、插件，都具有类似的功能，例如Redux中间件就是在Redux dispatch一个action之后，到达reducer之前进行的一些操作</p>
<p>实际上如果想自己开发一个Vite插件，Vite为我们提供了许多生命周期钩子函数，我们可以利用这些钩子函数，在不同的钩子函数中实现我们希望的功能，那么一个属于我们的插件就完成了。</p>
<p>Vite在构建生产环境时使用的是rollup，那么Vite会提供一些与rollup生命周期相同的生命周期<a target="_blank" rel="noopener" href="https://vitejs.cn/vite3-cn/guide/api-plugin.html#virtual-modules-convention">通用钩子</a>，使用这些钩子，Vite会在开发环境以及生产环境中都调用这些钩子。另外Vite还提供了一些<a target="_blank" rel="noopener" href="https://vitejs.cn/vite3-cn/guide/api-plugin.html#vite-specific-hooks">Vite特有的钩子</a>。</p>
<p>下面列举一些Vite常用的特有钩子函数:</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">        <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">            <span class="attr">output</span>: &#123;</span><br><span class="line">                <span class="attr">manualChunks</span>: <span class="function">(<span class="params">filePath</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(filePath.<span class="title function_">includes</span>(<span class="string">&quot;node_modules&quot;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&quot;vendor&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="title function_">config</span>(<span class="params">options</span>) &#123;</span><br><span class="line">                <span class="comment">// 处理配置文件</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">configureServer</span>(<span class="params">server</span>) &#123;</span><br><span class="line">                <span class="comment">// 处理vite服务器事业</span></span><br><span class="line">                server.<span class="property">middlewares</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span>&#123;&#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">transformIndexHtml</span>(<span class="params">html</span>)&#123;</span><br><span class="line">                <span class="comment">// 处理index.html文件</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">configResolved</span>(<span class="params">options</span>) &#123;</span><br><span class="line">                <span class="comment">// 整个配置文件的解析流程完成后调用该钩子函数,用于读和存储解析完成的配置文件</span></span><br><span class="line">                <span class="comment">// vite内部有一个默认的配置文件</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;options: &quot;</span>, options)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">configurePreviewServer</span>(<span class="params">server</span>)&#123;</span><br><span class="line">                <span class="comment">// vite打包完成后，可以使用vite preview命令预览生产环境下的项目</span></span><br><span class="line">                <span class="comment">// 功能与configureServer基本相同只不过是配置preview阶段开启的服务</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">handleHotUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 热更新相关钩子，用于自定义热更新行为</span></span><br><span class="line">            &#125;,</span><br><span class="line">                <span class="comment">// vite和rollup通用钩子</span></span><br><span class="line">            <span class="title function_">options</span>(<span class="params">rollupOptions</span>) &#123;</span><br><span class="line">                <span class="comment">// 处理rollup配置，即build.rollupOptions对象</span></span><br><span class="line">                <span class="comment">// vite会调用该钩子，rollup也会</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">buildStart</span>(<span class="params">fullRollupOptions</span>) &#123;</span><br><span class="line">                <span class="comment">// 与configResolved功能相同，拿到编译完后的rollup配置</span></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>下面介绍一些常用插件</p>
<h4 id="vite-aliases"><a class="markdownIt-Anchor" href="#vite-aliases"></a> Vite-aliases</h4>
<blockquote>
<p>该插件可以帮助项目自动生成别名</p>
</blockquote>
<p>他会检查目录下包括src在内的所有目录，并帮助框架自动生成别名</p>
<p>该插件能自动生成配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/**/src&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@assets&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/**/src/assets&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@components&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/**/src/components&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>该插件有许多配置，例如<code>prefix</code>用来修改别名的前缀，默认为<code>@</code></p>
<p>具体参考：<a target="_blank" rel="noopener" href="https://github.com/Subwaytime/vite-aliases">Vite-Aliases Github</a></p>
<p>下面尝试手写实现一个<code>vite-aliases</code>插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vite的插件需要返回一个配置对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const fs = require(&#x27;fs&#x27;)</span></span><br><span class="line"><span class="comment">// const path = require(&#x27;path&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Array</span>&#125; dirFilesArray 包含所有文件名的数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; basePath 跟目录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">object</span>&#125; 包含两个数组属性的对象：dirs表示目录下所有目录名，files表示目录下所有文件名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">diffDirAndFile</span> = (<span class="params">dirFilesArray = [], basePath = <span class="string">&#x27;&#x27;</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> result = &#123;</span><br><span class="line">        <span class="attr">dirs</span>: [],</span><br><span class="line">        <span class="attr">files</span>: [],</span><br><span class="line">    &#125;</span><br><span class="line">    dirFilesArray.<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 读取每个文件的文件状态</span></span><br><span class="line">        <span class="keyword">const</span> currentFileStates = fs.<span class="title function_">statSync</span>(</span><br><span class="line">            path.<span class="title function_">resolve</span>(__dirname, <span class="string">`<span class="subst">$&#123;basePath&#125;</span>/<span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 判断是否为目录</span></span><br><span class="line">        <span class="keyword">const</span> isDir = currentFileStates.<span class="title function_">isDirectory</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isDir) result.<span class="property">dirs</span>.<span class="title function_">push</span>(name)</span><br><span class="line">        <span class="keyword">else</span> result.<span class="property">files</span>.<span class="title function_">push</span>(name)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; prefix 自定义前缀，默认为@</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">object</span>&#125; key代表别名，value代表绝对路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getAllFills</span> = (<span class="params">prefix = <span class="string">&#x27;@&#x27;</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 读取src目录下的所有文件文件名</span></span><br><span class="line">    <span class="keyword">const</span> result = fs.<span class="title function_">readdirSync</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src&#x27;</span>))</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 区分目录名和文件名</span></span><br><span class="line">    <span class="keyword">const</span> diffResult = <span class="title function_">diffDirAndFile</span>(result, <span class="string">&#x27;../src&#x27;</span>)</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 对于每个目录名，产生一组别名到绝对路径的键值对</span></span><br><span class="line">    <span class="keyword">const</span> resolveAliasesObj = &#123;&#125;</span><br><span class="line">    diffResult.<span class="property">dirs</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> key = <span class="string">`<span class="subst">$&#123;prefix&#125;</span><span class="subst">$&#123;name&#125;</span>`</span></span><br><span class="line">        <span class="keyword">const</span> absPath = path.<span class="title function_">resolve</span>(__dirname, <span class="string">`../src/<span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">        resolveAliasesObj[key] = absPath</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resolveAliasesObj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="title function_">default</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> config UserConfig 当前Vite配置文件</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> env &#123; mode: string, command: string&#125; mode为当前所处环境，command为serve或build</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="title function_">config</span>(<span class="params">config, env</span>) &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 对src目录下的所有文件进行处理</span></span><br><span class="line">            <span class="keyword">const</span> resolveAliasesObj = <span class="title function_">getAllFills</span>()</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(resolveAliasesObj)</span><br><span class="line">            <span class="comment">// 该函数返回的对象是部分的ViteConfig，返回的对象将于与iteConfig进行Deep Merge</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">resolve</span>: &#123;</span><br><span class="line">                    <span class="attr">alias</span>: resolveAliasesObj,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="vite-plugin-html"><a class="markdownIt-Anchor" href="#vite-plugin-html"></a> Vite-plugin-html</h4>
<blockquote>
<p>赋予开发者动态控制整个html文件中内容的能力</p>
</blockquote>
<p>可以通过<code>ejs</code>语法向html中注入内容，它在服务端用的比较多，因为服务端经常会动态地修改index.html</p>
<p>而Vite实际上运行在服务端，因此选用该语法进行注入</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">createHtmlPlugin</span>(&#123;</span><br><span class="line">    <span class="attr">inject</span>: &#123;</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&quot;主页&quot;</span> <span class="comment">// 修改index.html中的title标签</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>其原理是通过Vite的<code>transformIndexHtml</code>钩子实现的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span>  &#123;</span><br><span class="line">        <span class="comment">// 用于转换html</span></span><br><span class="line">        <span class="attr">transformIndexHtml</span>: &#123;</span><br><span class="line">            <span class="comment">// 将插件执行时机提前</span></span><br><span class="line">            <span class="attr">enforce</span>: <span class="string">&quot;pre&quot;</span></span><br><span class="line">            <span class="attr">transform</span>: <span class="function">(<span class="params">html, ctx</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// ctx表示执行上下文，包含api, /index.html, get, post, headers</span></span><br><span class="line">                <span class="keyword">return</span> html.<span class="title function_">replace</span>(<span class="regexp">/&lt;%= title %&gt;/g</span>, options.<span class="property">inject</span>.<span class="property">data</span>.<span class="property">title</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在该插件实现的过程中我们使用了<code>enforce:&quot;pre&quot;</code>配置，让插件的运行周期提前，实际上vite在运行各种插件时是按照一定顺序进行的：</p>
<ul>
<li>Alias</li>
<li>带有<code>enforce: &quot;pre&quot;</code>的用户插件</li>
<li>Vite核心插件</li>
<li>没有<code>enforce</code>属性的插件</li>
<li>Vite构建用的插件</li>
<li>带有<code>enforce: &quot;post&quot;</code>的用户插件</li>
<li>Vite后置构建插件（最小化、manifest，报告）</li>
</ul>
<p>因此当我们不设置<code>enforce</code>属性时，会先运行Vite核心插件，导致核心插件先读取了<code>index.html</code>的内容，然后直接报错，因此需要在其他组件执行之前，将ejs替换为真实的内容。</p>
<h4 id="vite-plugin-mock"><a class="markdownIt-Anchor" href="#vite-plugin-mock"></a> Vite-plugin-mock</h4>
<blockquote>
<p>mock数据指模拟数据，该插件依赖于mockJS</p>
</blockquote>
<p>在前后端并行开发时，我们通常需要先完成接口文档的编写，后端同学根据接口文档编写接口以保证返回的数据结构相同。</p>
<p>有了接口文档后，就可以利用mock数据来模拟从后端请求到的数据进行开发。一般有两种方法：</p>
<ol>
<li>简单方式: 直接写死
<ul>
<li>优点
<ul>
<li>书写简单方便调试</li>
</ul>
</li>
<li>缺点
<ul>
<li>无法进行海量数据的测试</li>
<li>无法获得标准数据</li>
<li>无法感知http的异常</li>
</ul>
</li>
</ul>
</li>
<li>mockJS：模拟海量数据</li>
</ol>
<p>首先我们在根目录下创建一个mock目录，并添加index.js来编写mock脚本</p>
<p>相关语法可以在<a target="_blank" rel="noopener" href="https://github.com/nuysoft/Mock/wiki/Syntax-Specification">mockJS</a>中查看</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /mock/index.js</span></span><br><span class="line"><span class="keyword">import</span> mockJS <span class="keyword">from</span> <span class="string">&quot;mockjs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userList = mockJS.<span class="title function_">mock</span>(&#123;</span><br><span class="line">    <span class="string">&quot;data|100&quot;</span>: [&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;@cname&quot;</span>, <span class="comment">// 生成不同中文名</span></span><br><span class="line">        <span class="attr">ename</span>: <span class="string">&quot;@first @last&quot;</span>, <span class="comment">// 生成不同英文名</span></span><br><span class="line">        <span class="string">&quot;id|+1&quot;</span>: <span class="number">1</span>, <span class="comment">// 从1开始每次自增1的id</span></span><br><span class="line">        <span class="attr">avatar</span>: mockJS.<span class="property">Random</span>.<span class="title function_">image</span>(), <span class="comment">// 生成不同图片地址</span></span><br><span class="line">        <span class="attr">time</span>: <span class="string">&quot;@time&quot;</span> <span class="comment">// 生成不同的时间</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/api/users&quot;</span>,</span><br><span class="line">        <span class="attr">response</span>: <span class="function">(<span class="params">&#123;body&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// body -&gt; 请求体</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">                <span class="attr">msg</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">                <span class="attr">data</span>: userList</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>随后在Vite中进行配置后，我们就可以在项目中像使用真正的API一样，用Axios请求得到结果了：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ViteMockServe</span> &#125; <span class="keyword">from</span> <span class="string">&quot;vite-plugin-mock&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title class_">ViteMockServe</span>(&#123;</span><br><span class="line">            <span class="comment">// mock脚本目录</span></span><br><span class="line">            <span class="attr">mockPath</span>: <span class="string">&quot;mock&quot;</span>,</span><br><span class="line">            <span class="comment">// 配置只有开发环境才会拦截请求</span></span><br><span class="line">            <span class="attr">localEnabled</span>: command === <span class="string">&#x27;serve&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>其余配置可以在<a target="_blank" rel="noopener" href="https://github.com/vbenjs/vite-plugin-mock">vite-plugins-mock</a>插件中查看。</p>
<p>通过实际使用我们可以感受到该插件是通过拦截了我们的请求实现的，随后我们也知道Vite在开发环境中会为前端开启一个服务，以此来实现热更新、跨域等等功能，该插件就是利用了Vite启动的服务器为我们拦截了请求，实际上该插件是通过Vite的<code>configureServer</code>钩子来得到Vite服务器相关配置的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="title function_">default</span>(config) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">config</span>(<span class="params">config, env</span>) &#123;</span><br><span class="line">            <span class="comment">// 处理配置</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">configureServer</span>(<span class="params">server</span>) &#123;</span><br><span class="line">            <span class="comment">// 服务器相关配置</span></span><br><span class="line">            <span class="comment">// 真实情况下使用异步</span></span><br><span class="line">            <span class="keyword">const</span> mockState = fs.<span class="title function_">stateSync</span>(<span class="string">&quot;mock&quot;</span>)</span><br><span class="line">            <span class="keyword">const</span> isDir = mockState.<span class="title function_">isDirectory</span>()</span><br><span class="line">            <span class="keyword">let</span> mockResult = []</span><br><span class="line">            <span class="keyword">if</span>(isDir) &#123;</span><br><span class="line">                <span class="comment">// 使用process.cwd()获取当前执行根目录</span></span><br><span class="line">                mockResult = <span class="built_in">require</span>(path.<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), <span class="string">&quot;mock/index.js&quot;</span>))</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// server.middlewares获得服务器的中间件</span></span><br><span class="line">            <span class="comment">// node服务器对请求的处理是按照顺序交给一个又一个中间件进行处理的</span></span><br><span class="line">            <span class="comment">// req: 请求对象, 用户发送的请求，包括请求头、请求体</span></span><br><span class="line">            <span class="comment">// res: 响应对象, 包括响应头res.header</span></span><br><span class="line">            <span class="comment">// next: 是否交给下一个中间件进行处理，调用next方法则会交给下一个中间件</span></span><br><span class="line">            server.<span class="property">middlewares</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 查找mock脚本文件中是否包含请求的url</span></span><br><span class="line">                <span class="keyword">const</span> mockMatch = mockResult.<span class="title function_">find</span>(<span class="function"><span class="params">mockDescriptor</span> =&gt;</span> mockDescriptor.<span class="property">url</span> === req.<span class="property">url</span>)</span><br><span class="line">                <span class="keyword">if</span>(req.<span class="property">url</span> === <span class="string">&quot;/api/users&quot;</span>) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(mockMatch) &#123;</span><br><span class="line">                    <span class="comment">// 调用mock脚本的响应函数得到响应内容</span></span><br><span class="line">                    <span class="keyword">const</span> responseData = mockDescriptor.<span class="title function_">response</span>(req)</span><br><span class="line">                    <span class="comment">// 设置响应头中的响应类型为json避免中文乱码</span></span><br><span class="line">                    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">                    <span class="comment">// 返回请求</span></span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(responseData))</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_">next</span>()</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="vite-plugin-federation"><a class="markdownIt-Anchor" href="#vite-plugin-federation"></a> Vite-plugin-federation</h4>
<blockquote>
<p>模块联邦插件</p>
</blockquote>
<p>Webpack5提出联邦（federation）的概念，允许两个不同项目访问彼此的方法与组件。<br />
Vite也具备实现类似功能的插件</p>
<h3 id="vite-ts"><a class="markdownIt-Anchor" href="#vite-ts"></a> Vite + Ts</h3>
<p>Vite原生支持TS</p>
<p>但Vite只对ts进行编译，不会执行ts中的类型检查，Vite假设ts类型检查已经被编辑器执行了。但可以通过<code>tsc --noEmit</code>在打包阶段进行ts类型检查，如果检查不通过则不会生成打包文件，可以通过修改<code>package.json -&gt; scripts.build</code>脚本，先运行<code>tsc --noEmit</code>进行检测再进行build:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tsc --noEmit &amp;&amp; vite build&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>但是在Vite中，我们如果想让ts的报错直接输出在控制台，该如何做呢？</p>
<p>可以使用<code>vite-plugin-checker</code>插件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> checker <span class="keyword">from</span> <span class="string">&quot;vite-plugin-checker&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// 开启ts语法检测</span></span><br><span class="line">        <span class="title function_">checker</span>(&#123;<span class="attr">typescript</span>: <span class="literal">true</span>&#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ts包含一些配置，可以在<code>tsconfig.json</code>中编写：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;useDefineForClassFields&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Node&quot;</span><span class="punctuation">,</span> <span class="comment">// 配置模块解析方法为Node, 规定ts找包是从node_modules中找</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preserve&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;ESNext&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOM&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 声明当前环境，让ts在该环境下进行语法检测</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>  <span class="comment">// 是否跳过node_modules目录的检查</span></span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/**/*.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*.d.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*.tsx&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*.vue&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;references&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./tsconfig.node.json&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>此外，如果我们希望向环境变量中引入一些提示，这可以在<code>vite-dev.d.ts</code>中进行配置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ts三斜线指令，读到该配置时Vite自动引入&quot;vite/client&quot;</span></span><br><span class="line"><span class="comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处编写的借口将与ts默认类型进行合并，此后调用import.meta.env就能获得关于VITE_PROXY_TARGET的语法提示</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ImportMetaEnv</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">VITE_PROXY_TARGET</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="vite性能优化"><a class="markdownIt-Anchor" href="#vite性能优化"></a> Vite性能优化</h3>
<p>性能优化说的是在哪些方面进行优化？</p>
<ul>
<li>开发时态的构建速度优化：npx run dev呈现结果要占用很长时间、以及热更新需要很长时间才能反应到页面上
<ul>
<li>webpack4可以通过cache-loader，webpack5可以通过cache来缓存上一次loader的结果，如果两次构建源代码产生的结果没有变化这不调用loader，另外thread-loader还能开启多线程构建</li>
<li>然而Vite是按需加载的形式，不太需要关注这些</li>
</ul>
</li>
<li>页面性能指标：与写代码的方式有关
<ul>
<li>fcp(first content paint)：首个元素染时间
<ul>
<li>懒加载优化</li>
<li>http优化：
<ul>
<li>强缓存：服务端给响应头追加一些字段（expires），客户端会记住这些字段，在expires（截止失效时间）没有到达之前，无论如何刷新页面，客户端都不会重新请求，而是从缓存中取</li>
<li>协商缓存：是否使用缓存需要和后端协商，当服务端将客户端标记为协商缓存后，客户端下次刷新页面需要重新请求资源时会先向服务端发送一个协商请求，服务端如果认为资源发生了变化则响应具体的内容，如果服务端认为没有变化则响应304</li>
</ul>
</li>
</ul>
</li>
<li>lcp(largest content paint)：页面中最大元素的渲染时长</li>
</ul>
</li>
<li>js逻辑
<ul>
<li>要注意副作用的清除:
<ul>
<li>例如一个组件中包含一个计时器，由于项目运行过程中组件会发生频繁的挂载与卸载，如果不清楚计时器，每次挂载时又会创建新的计时器。所以在React的函数组件中，我们如果要在声明周期中使用计时器，通常会在<code>useEffect</code>的返回函数中清除定时器</li>
</ul>
</li>
<li>写法上的注意事项: <code>requestAnimationFrame</code>, <code>requestIdleCallback</code>
<ul>
<li>浏览器的帧率为：16.6ms一帧（包括执行js逻辑以及回流、重绘），当js逻辑、回流、重绘这些任务的处理时长超过16.6ms，则会出现明显卡顿。</li>
<li><code>requestIdleCallback</code>接收一个回调函数当浏览器一帧的任务进行到尾声时如果执行时间不足16.6ms则会执行传入的回调</li>
<li>react也提供了<code>concurrency(concurrent mode)</code>可中断渲染来处理卡顿的问题</li>
</ul>
</li>
<li>防抖 节流建议使用lodash提供的，避免自己书写时造成的性能问题</li>
<li>另外对于保存了海量数据的Array，使用lodash中提供的forEach方法代替Array原型上的forEach，lodash的forEach引入了额外的算法平衡性能</li>
</ul>
</li>
<li>对作用域的控制
<ul>
<li>在写for循环的时候，为了避免作用域嵌套层级过深，需要将for块级作用域中用到的变量保存在该作用域中，避免多次通过作用域链向外部作用域查找数据。</li>
</ul>
</li>
<li>css
<ul>
<li>关注继承属性，能继承的不要重复写</li>
<li>尽量避免过深的css嵌套</li>
</ul>
</li>
<li>构建优化(rollup)🌟
<ul>
<li>优化体积
<ul>
<li>压缩</li>
<li>treeShacking</li>
<li>图片资源压缩</li>
<li>CDN加载</li>
<li>分包策略</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// react中处理计时器</span></span><br><span class="line"><span class="keyword">const</span> [timer, setTimer] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setTimer</span>(<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;&#125;))</span><br><span class="line">    <span class="comment">// 组件卸载时会调用useEffect的返回值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="comment">// 在for块级作用域中创建变量len，避免比较大小时每次向外询问arr.length</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>, len = arr.<span class="property">length</span>; i &lt; len; i++) &#123;&#125;</span><br><span class="line"><span class="comment">// 较低性能写法：for(let i = 0; i &lt; arr.length; i++)&#123;&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="分包策略"><a class="markdownIt-Anchor" href="#分包策略"></a> 分包策略</h4>
<p>浏览器对于静态资源的缓存策略是，文件名未发生变化，则不会重新请求</p>
<p>当我们在业务代码中引用了<code>lodash</code>等包时，打包的过程中会将这些第三方包也和业务代码打包到同一个js文件中，此时会为业务代码引入大量代码，而第三方包却是长期不会发生变化的。</p>
<p>当我们对业务代码进行修改时，打包生成的文件会加入hash字符串，从而改变文件名，让浏览器重新请求，但这个过程中第三方包也被加入了进去，因此第三方包也会和业务代码一起被重新请求，导致需要请求大量没有变化的代码。</p>
<p>分包就是把一些不会更新的代码进行单独打包</p>
<p>例如我们可以通过<code>build.rollupConfig.output.manualChunks</code>配置分包策略：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> checker <span class="keyword">from</span> <span class="string">&quot;vite-plugin-checker&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// 开启ts语法检测</span></span><br><span class="line">        <span class="title function_">checker</span>(&#123;<span class="attr">typescript</span>: <span class="literal">true</span>&#125;),</span><br><span class="line">    ]</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">        <span class="attr">rollupConfig</span>: &#123;</span><br><span class="line">            <span class="attr">output</span>: &#123;</span><br><span class="line">                <span class="attr">manualChunks</span>: <span class="function">(<span class="params"><span class="attr">id</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// id为包路径名</span></span><br><span class="line">                    <span class="comment">// 对于所有路径名中包含node_module的包，都打包到vender.js中</span></span><br><span class="line">                    <span class="keyword">if</span>(id.<span class="title function_">includes</span>(<span class="string">&quot;node_module&quot;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&quot;vender&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此外对于多出口的项目，首先我们可以通过配置<code>build.rollupConfig.input</code>来处理不同出口文件的位置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> checker <span class="keyword">from</span> <span class="string">&quot;vite-plugin-checker&quot;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// 开启ts语法检测</span></span><br><span class="line">        <span class="title function_">checker</span>(&#123;<span class="attr">typescript</span>: <span class="literal">true</span>&#125;),</span><br><span class="line">    ]</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">        <span class="attr">rollupConfig</span>: &#123;</span><br><span class="line">            <span class="attr">input</span>: &#123;</span><br><span class="line">                <span class="attr">main</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./index.html&quot;</span>),</span><br><span class="line">                <span class="attr">product</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./product.html&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">output</span>: &#123;</span><br><span class="line">                <span class="attr">manualChunks</span>: <span class="function">(<span class="params"><span class="attr">id</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// id为包路径名</span></span><br><span class="line">                    <span class="comment">// 对于所有路径名中包含node_module的包，都打包到vender.js中</span></span><br><span class="line">                    <span class="keyword">if</span>(id.<span class="title function_">includes</span>(<span class="string">&quot;node_module&quot;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&quot;vender&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>vite为我们进行了优化，当index.html依赖的main.ts文件引用了product.html依赖的product.ts文件，而两个ts文件均引用了lodash等第三方包时，vite会将main.ts中的对lodash的引用去除，并直接通过product.ts引用lodash以缩小包体积，当然当我们设置了lodash分包后，两个文件都会直接充lodash包中引用</p>
<h4 id="gzip压缩"><a class="markdownIt-Anchor" href="#gzip压缩"></a> gzip压缩</h4>
<blockquote>
<p>将静态文件进行压缩，已达到减少体积的目的</p>
</blockquote>
<p>Vite服务将会对静态文件进行压缩，客户端收到压缩包后进行解压</p>
<p>在工程化领域内存在chunk的概念，也可以叫块</p>
<p>块最后会被映射为js文件，但是块并不是js文件，在vite中这一概念不如webpack中明显</p>
<p>当我们单个chunk的大小超过500Kb后Vite会给出警告⚠️，建议我们采用分包策略，动态导入，或者调整警告阈值。</p>
<p>另外我们还可以用gzip来压缩chunk的体积</p>
<p>我们可以通过<code>vite-plugin-compression</code>插件实现</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> checker <span class="keyword">from</span> <span class="string">&quot;vite-plugin-checker&quot;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span></span><br><span class="line"><span class="keyword">import</span> viteCompression <span class="keyword">from</span> <span class="string">&quot;vite-plugin-compression&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// 开启ts语法检测</span></span><br><span class="line">        <span class="title function_">checker</span>(&#123;<span class="attr">typescript</span>: <span class="literal">true</span>&#125;),</span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="title function_">viteCompression</span>()</span><br><span class="line">    ]</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">        <span class="attr">rollupConfig</span>: &#123;</span><br><span class="line">            <span class="attr">input</span>: &#123;</span><br><span class="line">                <span class="attr">main</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./index.html&quot;</span>),</span><br><span class="line">                <span class="attr">product</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;./product.html&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">output</span>: &#123;</span><br><span class="line">                <span class="attr">manualChunks</span>: <span class="function">(<span class="params"><span class="attr">id</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// id为包路径名</span></span><br><span class="line">                    <span class="comment">// 对于所有路径名中包含node_module的包，都打包到vender.js中</span></span><br><span class="line">                    <span class="keyword">if</span>(id.<span class="title function_">includes</span>(<span class="string">&quot;node_module&quot;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&quot;vender&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时再进行打包，dist目录下除了会生成index.js以外，还会生成index.js.gz文件</p>
<p>此时服务端拿到打包后的代码后，如果收到请求index.js则服务端会读取index.js.gz，然后设置响应头为<code>content-encoding: gzip</code>此时浏览器检查收到的响应中是否包含gzip，如果有这进行解压操作，得到原本的js文件</p>
<p>由上面的流程可以发现解压操作需要浏览器来做，因此需要浏览器承担一部分解压的消耗。对于较小的文件进行压缩，就可能会适得其反，降低性能。</p>
<h4 id="动态导入"><a class="markdownIt-Anchor" href="#动态导入"></a> 动态导入</h4>
<p>动态导入的思想与vite的按需加载是异曲同工的</p>
<p>动态导入是es6的一个新特性</p>
<p>对于一个需要导入的包，我们只需要以函数的方式使用import就可以实现动态导入：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">&quot;./src/imgLoader&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>这种方式的主要应用场景是在进行路由时，实现动态加载组件：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以react中的路由为例</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="keyword">import</span>(<span class="string">&quot;./src/components/Home&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/login&quot;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="keyword">import</span>(<span class="string">&quot;./src/components/Login&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>import函数返回一个<code>promise</code>对象，他的原理实际上是拿到组件文件后先对组件进行编译为js，随后并不会使用<code>&lt;script src=&quot;./src/components/login.js&quot;&gt;</code>来引入js文件，而是在没有进入某个页面时将promise的状态设为<code>pending</code>，当进入该页面后，将promise的状态设为<code>fulfilled</code>，将<code>&lt;script src=&quot;./src/components/login.js&quot;&gt;</code>插入body中实现引入。</p>
<h4 id="cdn加速"><a class="markdownIt-Anchor" href="#cdn加速"></a> CDN加速</h4>
<blockquote>
<p>CDN: content delivery network内容分发网络</p>
</blockquote>
<p>利用这一技术我们可以充CDN服务器上请求资源或第三方包，而不需要将第三方包打包进我们的项目中去。</p>
<p>使用CDN请求包的好处是，CDN服务器会根据地理位置的远近选择距离最近的可用服务器进行响应，从而加速请求。</p>
<p>以前在原生项目中我们使用JQuery时经常会用到cdn技术，例如充百度CDN中引入JQuery：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当Vite在开发环境并不能那么轻松的修改html，因此Vite可以通过<code>vite-plugin-cdn-import</code>插件配置cdn：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> viteCDNPlugin <span class="keyword">from</span> <span class="string">&quot;vite-plugin-cdn-import&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="title function_">viteCDNPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">modules</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 需要使用CDN引入的包名称</span></span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;lodash&quot;</span>,</span><br><span class="line">                    <span class="comment">// 引入后的变量名</span></span><br><span class="line">                    <span class="attr">var</span>: <span class="string">&quot;_&quot;</span>,</span><br><span class="line">                    <span class="comment">// 引入的CDN地址</span></span><br><span class="line">                    <span class="attr">path</span>: <span class="string">&quot;https://unpkg.com/lodash@4.17.21/lodash.min.js&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>随后在组件中直接正常引入lodash即可在开发环境中使用，打包的时候rollup和vite将不会把通过cdn引入的包打包进我们的工程</p>
<blockquote>
<p>需要注意⚠️的是，使用CDN引入包后，我们需要项目时刻保持联网状态才能想CDN服务器请求我们需要的包。</p>
</blockquote>
<h3 id="vite跨域"><a class="markdownIt-Anchor" href="#vite跨域"></a> Vite跨域</h3>
<blockquote>
<p>跨域是存在于浏览器端的问题，主要是由于浏览器最核心最基础的安全功能——<strong>同源策略</strong>限制</p>
</blockquote>
<p>当一个请求url的<strong>协议，域名，端口</strong>三者中任意一个与当前页面的URL不同则为<strong>跨域</strong></p>
<p>发生跨域时候，服务器实际上<strong>已经响应了请求</strong>，只是浏览器对响应的请求进行了拦截，因为发送请求时浏览器是无法进行拦截的，浏览器并不知道请求的服务器是否运行跨域</p>
<p>Vite支持采用Proxy的方式解决跨域问题</p>
<p>实际上是用node代替前端对后端进行请求（因为服务端没有跨域限制）</p>
<p>假设有后端接口：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建get请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/user&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">     res.<span class="title function_">json</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>:<span class="number">200</span>,</span><br><span class="line">        <span class="attr">message</span>:<span class="string">&quot;请求成功&quot;</span></span><br><span class="line">     &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//端口号9001</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">9001</span>)</span><br></pre></td></tr></table></figure>
<p>我们直接在前端使用fetch会报跨域错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">import &#123;ref,reactive &#125; from &#x27;vue&#x27;</span><br><span class="line">fetch(&#x27;http://localhost:9001/user&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>此时可以开启vite的代理</p>
<p>vite中在配置文件中设置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">vue</span>()],</span><br><span class="line">  <span class="attr">server</span>:&#123;</span><br><span class="line">     <span class="attr">proxy</span>:&#123;</span><br><span class="line">        <span class="comment">// key + 描述对象的形式</span></span><br><span class="line">        <span class="string">&#x27;/api&#x27;</span>:&#123;</span><br><span class="line">            <span class="comment">// 遇到/api开头的请求，将其代理到targe表示的地址</span></span><br><span class="line">            <span class="attr">target</span>:<span class="string">&quot;http://localhost:9001/&quot;</span>, <span class="comment">//跨域地址</span></span><br><span class="line">            <span class="attr">changeOrigin</span>:<span class="literal">true</span>, <span class="comment">//支持跨域</span></span><br><span class="line">            <span class="attr">rewrite</span>:<span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/api/</span>, <span class="string">&quot;&quot;</span>)<span class="comment">//重写路径,替换/api</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后将前端请求url修改为<code>/api/user</code>即可</p>
<p>webpack proxy 和 node proxy 用法都类似</p>
<p>需要注意的是proxy只在开发环境中生效，生产环境由于网页会上服务器，前后端分离可以使用nginx，apache等等服务器的代理实现</p>
<p>vite的proxy底层实现实际上就是监听前端页面端口的请求后，向服务器端口发送请求：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// proxyMiddleware 中的代码</span></span><br><span class="line"><span class="keyword">import</span> httpProxy <span class="keyword">from</span> <span class="string">&#x27;http-proxy&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">proxyMiddleware</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="attr">httpServer</span>: http.<span class="title class_">Server</span> | <span class="literal">null</span>,</span></span><br><span class="line"><span class="params">    <span class="attr">options</span>: <span class="title class_">NonNullable</span>&lt;<span class="title class_">CommonServerOptions</span>[<span class="string">&#x27;proxy&#x27;</span>]&gt;,</span></span><br><span class="line"><span class="params">    <span class="attr">config</span>: <span class="title class_">ResolvedConfig</span></span></span><br><span class="line"><span class="params">  </span>): <span class="title class_">Connect</span>.<span class="property">NextHandleFunction</span> &#123;</span><br><span class="line">    <span class="comment">// lazy require only when proxy is used</span></span><br><span class="line"><span class="keyword">const</span> proxy = httpProxy.<span class="title function_">createProxyServer</span>(opts) <span class="keyword">as</span> <span class="title class_">HttpProxy</span>.<span class="property">Server</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// http-proxy 模块用于转发 http 请求</span></span><br><span class="line"><span class="comment">// 其实现的大致原理为使用 http 或 https 模块搭建 node 代理服务器，将客户端发送的请求数据转发到目标服务器，再将响应输送到客户端</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> httpProxy = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy = httpProxy.<span class="title function_">createProxyServer</span>(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个代理服务 代理到9001</span></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    proxy.<span class="title function_">web</span>(req,res,&#123;</span><br><span class="line">        <span class="attr">target</span>:<span class="string">&quot;http://localhost:9001/xm&quot;</span>, <span class="comment">//代理的地址</span></span><br><span class="line">        <span class="attr">changeOrigin</span>:<span class="literal">true</span>, <span class="comment">//是否有跨域</span></span><br><span class="line">        <span class="attr">ws</span>:<span class="literal">true</span> <span class="comment">//webSocetk</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>
<h3 id="vite总结"><a class="markdownIt-Anchor" href="#vite总结"></a> Vite总结</h3>
<p><a target="_blank" rel="noopener" href="https://vitejs.cn/vite3-cn/config/shared-options.html">Vite相关配置</a></p>
<h2 id="pinia"><a class="markdownIt-Anchor" href="#pinia"></a> Pinia</h2>
<p>Pinia是一款状态管理工具，是Vuex的替代品，相较于Vuex，Pinia.js具有以下特性：</p>
<ul>
<li>完整的ts支持</li>
<li>轻量化，压缩后体积只有1kb</li>
<li>去除mutations，只有state、getters、actions</li>
<li>actions支持同步和异步</li>
<li>代码扁平化没有模块嵌套，只有store的概念，store之间可以自由使用，每一个store都是独立的</li>
<li>无需手动添加store，store一旦创建便会自动添加</li>
<li>支持Vue3和Vue2</li>
</ul>
<h3 id="安装-3"><a class="markdownIt-Anchor" href="#安装-3"></a> 安装</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure>
<h3 id="引入"><a class="markdownIt-Anchor" href="#引入"></a> 引入</h3>
<h4 id="vue3"><a class="markdownIt-Anchor" href="#vue3"></a> Vue3</h4>
<p>在main.ts中进行如下引入</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;createPinia&#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createPinia</span>()</span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">use</span>(store)</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="vue2"><a class="markdownIt-Anchor" href="#vue2"></a> Vue2</h4>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia, <span class="title class_">PiniaVuePlugin</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">PiniaVuePlugin</span>)</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="comment">// other options...</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// note the same `pinia` instance can be used across multiple Vue apps on</span></span><br><span class="line">  <span class="comment">// the same page</span></span><br><span class="line">  pinia,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="修改state的方法"><a class="markdownIt-Anchor" href="#修改state的方法"></a> 修改state的方法</h3>
<ol>
<li>直接修改
<ul>
<li>在使用<code>const store = useMyStore()</code>方法得到store可以直接访问store中的state并对其中的数据进行修改：</li>
<li><code>store.val = 2</code></li>
</ul>
</li>
<li>使用patch批量修改
<ul>
<li><code>store.$patch(&#123; val: 2 &#125;)</code></li>
</ul>
</li>
<li>使用patch函数参数形式
<ul>
<li><code>store.$patch((state) =&gt; &#123; val: 2 &#125;)</code></li>
<li>这种方法可以在函数中加一些业务逻辑</li>
</ul>
</li>
<li>直接重新构造state
<ul>
<li><code>store.$state = &#123;val:2&#125;</code></li>
<li>这种方法必需修改state中的所有值</li>
</ul>
</li>
<li>使用actions中定义的方法修改值
<ul>
<li><code>store.updateVal(num)</code></li>
</ul>
</li>
</ol>
<h3 id="store"><a class="markdownIt-Anchor" href="#store"></a> Store</h3>
<h4 id="解构store"><a class="markdownIt-Anchor" href="#解构store"></a> 解构store</h4>
<p>store中的state属性可以通过解构的方式得到，但是结构出来的数据并不具有响应式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = <span class="title function_">useMyStore</span>()</span><br><span class="line"><span class="keyword">const</span> &#123;val&#125; = store</span><br></pre></td></tr></table></figure>
<p>因此对store中的值进行修改不会反应到结构出来的<code>val</code>上</p>
<p>为了解决这个问题pinia提供了一个hook可以将普通变量变为响应式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useMyStore</span>()</span><br><span class="line"><span class="keyword">const</span> &#123;val&#125; = <span class="title function_">storeToRefs</span>(store)</span><br></pre></td></tr></table></figure>
<p>这也无论是对<code>val</code>进行修改或是对<code>store.val</code>进行修改，或是使用actions进行修改都会同时反应到<code>val</code>和<code>store.val</code></p>
<h4 id="getter和actions"><a class="markdownIt-Anchor" href="#getter和actions"></a> getter和actions</h4>
<p>getter中定义一些函数，类似于计算属性，可以修饰一些值：</p>
<p>actions中定义一些函数用于对state中的值进行操作，同时支持异步和同步，并且可以相互调用。</p>
<h3 id="pinia-api"><a class="markdownIt-Anchor" href="#pinia-api"></a> Pinia API</h3>
<ol>
<li><code>$reset()</code>
<ul>
<li>不接受任何参数，没有返回值</li>
<li>调用后将state设置为初始值<code>store.$reset()</code></li>
</ul>
</li>
<li><code>$subscribe(Function, object | null)</code>
<ul>
<li>接收一个工厂函数，函数有两个参数<code>arg,state</code>，分别表示影响（包含新值、旧值等等）和新的state</li>
<li>当state中的值发生变化就会自动调用传入的工厂函数</li>
</ul>
</li>
<li><code>$onAction(Function, boolean | null)</code>
<ul>
<li>调用actions中的方法时出发<code>Function</code></li>
<li>接收一个工厂函数，接收一个对象<code>arg</code>，包含一个after回调，store实例等等</li>
<li>第二个参数为true时，则即使调用onAction的组件被销毁，该函数依然会继续监听</li>
</ul>
</li>
</ol>
<h3 id="pinia插件"><a class="markdownIt-Anchor" href="#pinia插件"></a> Pinia插件</h3>
<h4 id="持久化"><a class="markdownIt-Anchor" href="#持久化"></a> 持久化</h4>
<p>pinia和vuex都不具备持久化的功能，页面刷新后其中的数据就会变为初始状态</p>
<p>pinia支持自定义插件，可以使用插件来实现pinia中数据的持久化：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义兜底变量</span></span><br><span class="line"><span class="keyword">const</span> __piniaKey = <span class="string">&#x27;__PINIAKEY__&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义入参类型</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Options</span> = &#123;</span><br><span class="line">   key?:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将数据存在本地</span></span><br><span class="line"><span class="keyword">const</span> setStorage = (<span class="attr">key</span>: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">any</span>): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line"> </span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value))</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//存缓存中读取</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getStorage</span> = (<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>) =&gt; &#123; </span><br><span class="line">	<span class="keyword">return</span> (<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key) ? <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key) <span class="keyword">as</span> <span class="built_in">string</span>) : &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//利用函数柯丽华接受用户入参</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">piniaPlugin</span> = (<span class="params"><span class="attr">options</span>: <span class="title class_">Options</span></span>) =&gt; &#123;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//将函数返回给pinia  让pinia  调用 注入 context</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function">(<span class="params"><span class="attr">context</span>: <span class="title class_">PiniaPluginContext</span></span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">const</span> &#123; store &#125; = context;</span><br><span class="line">		<span class="keyword">const</span> data = <span class="title function_">getStorage</span>(<span class="string">`<span class="subst">$&#123;options?.key ?? __piniaKey&#125;</span>-<span class="subst">$&#123;store.$id&#125;</span>`</span>)</span><br><span class="line">		store.$subscribe(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">			<span class="title function_">setStorage</span>(<span class="string">`<span class="subst">$&#123;options?.key ?? __piniaKey&#125;</span>-<span class="subst">$&#123;store.$id&#125;</span>`</span>, <span class="title function_">toRaw</span>(store.<span class="property">$state</span>));</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="comment">//返回值覆盖pinia 原始值</span></span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			...data</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化pinia</span></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//注册pinia 插件</span></span><br><span class="line">pinia.<span class="title function_">use</span>(<span class="title function_">piniaPlugin</span>(&#123;</span><br><span class="line">	<span class="attr">key</span>: <span class="string">&quot;pinia&quot;</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

  </div>
  
  
    
    <div class='footer'>
       <!-- 参考资料、相关资料等 -->
      
       <!-- 相关文章 -->
      
      <!-- 版权声明组件 -->
      
        
          <div class='copyright'>
            <blockquote>
              
                
                  <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

                
              
                
                  <p>本文永久链接是：<a href="http://enderxiao.github.io/2023/08/09/前端补缺Vite/">http://enderxiao.github.io/2023/08/09/前端补缺Vite/</a></p>
                
              
            </blockquote>
          </div>
        
      
      <!-- 打赏组件 -->
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateModified" datetime="2024-07-30T19:26:33+08:00">
  <a class='notlink'>
    <i class="fa-solid fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：Jul 30, 2024</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/life/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>life</p></a></div>
  <span hidden itemprop="keywords">life</span>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://enderxiao.github.io/2023/08/09/%E5%89%8D%E7%AB%AF%E8%A1%A5%E7%BC%BAVite/&title=前端补缺Vite - Ender&summary="
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qq.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qq.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://enderxiao.github.io/2023/08/09/%E5%89%8D%E7%AB%AF%E8%A1%A5%E7%BC%BAVite/&title=前端补缺Vite - Ender&summary="
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qzone.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qzone.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://service.weibo.com/share/share.php?url=http://enderxiao.github.io/2023/08/09/%E5%89%8D%E7%AB%AF%E8%A1%A5%E7%BC%BAVite/&title=前端补缺Vite - Ender&summary="
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/weibo.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/weibo.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
          
        </a>
      
    
      
    
      
        <a class="-mob-share-telegram" title="" rel="external nofollow noopener noreferrer noopener"
          
            target="_blank" href="https://t.me/share/url?url=http://enderxiao.github.io/2023/08/09/%E5%89%8D%E7%AB%AF%E8%A1%A5%E7%BC%BAVite/&text=前端补缺Vite - Ender"
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/telegram.png" class="lazyload placeholder" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/telegram.png" srcset="https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@3/img/placeholder/c617bfd2497fcea598e621413e315c368f8d8e.svg">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
    <!-- Custom Files bottomMeta begin -->
    
    <!-- Custom Files bottomMeta end -->
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/2023/09/07/%E7%AE%80%E5%8E%86/'>
          <p class='title'><i class="fa-solid fa-chevron-left" aria-hidden="true"></i>简历</p>
          <p class='content'> 项目经历
 在线教育平台开发
 项目经历

项目名称: 在线教育平台开发
项目描述: 开发一个在线教育平台，提供学生登录、签到、课程浏览、互动课堂、在线学习等功能。
技术架构:

前端界面使用...</p>
        </a>
      
      
        <a class='next' href='/2023/08/08/%E5%89%8D%E7%AB%AFH5%E8%A1%A5%E7%BC%BA/'>
          <p class='title'>前端H5补缺<i class="fa-solid fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>根据前端技能树补缺H5知识

 语义化标签

&lt;header&gt;
&lt;nav&gt;
&lt;article&gt;
&lt;section&gt;
&lt;aside&gt;
&...</p>
        </a>
      
    </div>
  
  <!-- Custom Files postEnd begin-->
  
  <!-- Custom Files postEnd end-->
</article>


  


  <article class="post white-box shadow floatable blur" id="comments">
    <span hidden>
      <meta itemprop="discussionUrl" content="/2023/08/09/%E5%89%8D%E7%AB%AF%E8%A1%A5%E7%BC%BAVite/index.html#comments">
    </span>
    <p ct><i class='fa-solid fa-comments'></i> 评论</p>
    

    <div id="layoutHelper-comments"></div>

  </article>






</div>
<aside id='l_side' itemscope itemtype="http://schema.org/WPSideBar">
  

  
    
    
      
    
  


<div class="widget-sticky pjax">

  
  


  <section class="widget toc-wrapper desktop mobile " id="toc-div" >
    
  <header>
    
      <i class="fa-solid fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text"> 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text"> 搭建项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-text"> 执行过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vue3%E8%A1%A5%E5%85%85"><span class="toc-text"> Vue3补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ref%E5%85%A8%E5%AE%B6%E6%A1%B6"><span class="toc-text"> ref全家桶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reactive%E5%85%A8%E5%AE%B6%E6%A1%B6"><span class="toc-text"> reactive全家桶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#to%E5%85%A8%E5%AE%B6%E6%A1%B6"><span class="toc-text"> to全家桶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue3%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86"><span class="toc-text"> Vue3响应式原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#computed%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7"><span class="toc-text"> computed计算属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#watch%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-text"> watch监听器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E4%B8%8E%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text"> 组件与生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96"><span class="toc-text"> 函数柯里化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%AF%E9%87%8C%E5%8C%96%E7%BB%8F%E5%85%B8%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-text"> 柯里化经典面试题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text"> 函数柯里化应用场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-text"> 组件间通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%88%B6%E4%BC%A0%E5%AD%90props"><span class="toc-text"> 父传子props</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ts%E6%B3%9B%E5%9E%8B"><span class="toc-text"> TS泛型</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E4%BC%A0%E7%88%B6"><span class="toc-text"> 子传父</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#emit%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6%E6%96%B9%E5%BC%8F"><span class="toc-text"> emit自定义事件方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#defiineexpose%E6%96%B9%E6%B3%95%E6%9A%B4%E9%9C%B2%E6%96%B9%E6%B3%95or%E5%B1%9E%E6%80%A7"><span class="toc-text"> defiineExpose方法暴露方法or属性</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8defineprops%E5%AE%9E%E7%8E%B0%E7%80%91%E5%B8%83%E6%B5%81%E7%BB%84%E4%BB%B6"><span class="toc-text"> 使用defineProps实现瀑布流组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%84%E5%BC%9F%E4%BC%A0%E5%8F%82"><span class="toc-text"> 兄弟传参</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%88%B6%E7%BB%84%E4%BB%B6%E4%BB%8B%E5%85%A5"><span class="toc-text"> 父组件介入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BFbus"><span class="toc-text"> 事件总线BUS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E7%BB%84%E4%BB%B6%E4%B8%8E%E9%80%92%E5%BD%92%E7%BB%84%E4%BB%B6"><span class="toc-text"> 全局组件与递归组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E7%BB%84%E4%BB%B6"><span class="toc-text"> 全局组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E7%BB%84%E4%BB%B6"><span class="toc-text"> 递归组件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E7%BB%84%E4%BB%B6%E4%BA%8B%E4%BB%B6"><span class="toc-text"> 递归组件事件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E9%80%81%E7%BB%84%E4%BB%B6teleport"><span class="toc-text"> 传送组件Teleport</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB%E7%BB%84%E4%BB%B6transition"><span class="toc-text"> 动画组件Transition</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-text"> 基本用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8A%A8%E7%94%BB%E5%BA%93"><span class="toc-text"> 结合第三方动画库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E5%BA%A6%E5%88%97%E8%A1%A8transition-group"><span class="toc-text"> 过度列表transition-group</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4"><span class="toc-text"> 自定义指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vue3%E6%8C%87%E4%BB%A4%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0"><span class="toc-text"> Vue3指令钩子函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0"><span class="toc-text"> 自定义指令钩子函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%AE%80%E5%86%99"><span class="toc-text"> 函数简写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-text"> 自定义指令实现图片懒加载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89hooks"><span class="toc-text"> 自定义hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89hook%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E7%BB%84%E5%90%88"><span class="toc-text"> 自定义hook与自定义指令组合</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA"><span class="toc-text"> 项目构建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E5%BA%93%E5%8A%9F%E8%83%BD"><span class="toc-text"> 编写库功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8vite%E6%89%93%E5%8C%85"><span class="toc-text"> 使用vite打包</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E5%88%B0npm"><span class="toc-text"> 发布到npm</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%87%BD%E6%95%B0%E4%BB%A5%E5%8F%8A%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-text"> 全局函数以及全局变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6"><span class="toc-text"> Vue编写插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#appuse%E6%89%8B%E6%92%95"><span class="toc-text"> app.use手撕</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ui%E7%BB%84%E4%BB%B6%E5%BA%93"><span class="toc-text"> UI组件库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E9%80%8F%E4%BC%A0"><span class="toc-text"> 属性透传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue3-style%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-text"> Vue3 Style新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E6%A7%BD%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-text"> 插槽选择器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-text"> 全局选择器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81css"><span class="toc-text"> 动态css</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#css-module"><span class="toc-text"> css module</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nexttick"><span class="toc-text"> NextTick</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#h%E5%87%BD%E6%95%B0"><span class="toc-text"> h函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue33%E7%BC%96%E8%AF%91%E5%AE%8F"><span class="toc-text"> Vue3.3编译宏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#defineprops"><span class="toc-text"> defineProps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#defineemits"><span class="toc-text"> defineEmits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#defineoptions"><span class="toc-text"> defineOptions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#defineslots"><span class="toc-text"> defineSlots</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text"> 环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue3%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text"> Vue3性能优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-components"><span class="toc-text"> Web Components</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#proxy%E8%B7%A8%E5%9F%9F"><span class="toc-text"> proxy跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jsonp%E6%96%B9%E6%B3%95"><span class="toc-text"> JsonP方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cors%E8%AE%BE%E7%BD%AE"><span class="toc-text"> CORS设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#proxy%E4%BB%A3%E7%90%86"><span class="toc-text"> Proxy代理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9Fdom%E4%B8%8Ediff%E7%AE%97%E6%B3%95"><span class="toc-text"> 虚拟DOM与diff算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tailwind-css"><span class="toc-text"> Tailwind CSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text"> 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text"> 生成配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text"> 修改配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mitt"><span class="toc-text"> Mitt</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-text"> 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#emit"><span class="toc-text"> emit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#on"><span class="toc-text"> on</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#off"><span class="toc-text"> Off</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#all"><span class="toc-text"> all</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ionic"><span class="toc-text"> Ionic</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-2"><span class="toc-text"> 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA"><span class="toc-text"> 项目创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%8D%93%E9%A2%84%E8%A7%88"><span class="toc-text"> 安卓预览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%AD%E6%9B%B4%E6%96%B0"><span class="toc-text"> 热更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#h5%E9%80%82%E9%85%8D"><span class="toc-text"> H5适配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%BE%A8%E7%8E%87%E9%80%82%E9%85%8D"><span class="toc-text"> 分辨率适配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E9%BB%98%E8%AE%A4%E6%A0%B7%E5%BC%8F"><span class="toc-text"> 清除默认样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#postcss"><span class="toc-text"> postCSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2%E5%AD%97%E4%BD%93%E5%A4%A7%E5%B0%8F"><span class="toc-text"> 切换主题&#x2F;切换字体大小</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#css%E5%8E%9F%E5%AD%90%E5%8C%96"><span class="toc-text"> CSS原子化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%AD%90%E5%8C%96%E6%8F%92%E4%BB%B6unocss"><span class="toc-text"> 原子化插件unocss</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tsxjsx"><span class="toc-text"> TSX&#x2F;JSX</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tsx%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text"> TSX的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unplugin-auto-import"><span class="toc-text"> unplugin-auto-import</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babel%E4%B8%8Evite%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-text"> Babel与Vite插件编写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vite"><span class="toc-text"> Vite</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7"><span class="toc-text"> 构建工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E7%9B%B8%E5%AF%B9%E4%BA%8Ewebpack%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-text"> Vite相对于Webpack的优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E8%84%9A%E6%89%8B%E6%9E%B6%E5%92%8Cvite"><span class="toc-text"> Vite脚手架和Vite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite-2"><span class="toc-text"> Vite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B9%E7%9B%AE%E5%BD%95"><span class="toc-text"> 根目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E4%BE%9D%E8%B5%96%E6%9E%84%E5%BB%BA"><span class="toc-text"> Vite依赖构建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vite%E8%BF%90%E8%A1%8C%E5%9C%A8node%E7%AB%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E6%98%AF%E7%94%A8esmodule%E7%9A%84%E5%8C%85%E7%AE%A1%E7%90%86"><span class="toc-text"> Vite运行在node端为什么可以是用esmodule的包管理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E7%BB%86%E8%8A%82"><span class="toc-text"> Vite配置文件处理细节</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%98%AF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text"> 客户端是用环境变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E5%A6%82%E4%BD%95%E8%AE%A9%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%86%E5%88%ABvue"><span class="toc-text"> Vite如何让浏览器识别.vue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86css"><span class="toc-text"> Vite如何处理css</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E4%B8%AD%E9%85%8D%E7%BD%AEcss%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-text"> Vite中配置css的处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E9%85%8D%E7%BD%AEcss%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-text"> Vite配置css预处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sourcemap"><span class="toc-text"> SourceMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#postcss-2"><span class="toc-text"> PostCSS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-text"> 使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E4%B8%AD%E9%85%8D%E7%BD%AEpostcss"><span class="toc-text"> Vite中配置postCSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E5%8A%A0%E8%BD%BD%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-text"> Vite加载静态资源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Esvg"><span class="toc-text"> 关于SVG</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%AF%B9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-text"> Vite生产环境对静态资源的处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#resolvealias%E5%8E%9F%E7%90%86"><span class="toc-text"> resolve.alias原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E6%8F%92%E4%BB%B6"><span class="toc-text"> Vite插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vite-aliases"><span class="toc-text"> Vite-aliases</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vite-plugin-html"><span class="toc-text"> Vite-plugin-html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vite-plugin-mock"><span class="toc-text"> Vite-plugin-mock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vite-plugin-federation"><span class="toc-text"> Vite-plugin-federation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite-ts"><span class="toc-text"> Vite + Ts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text"> Vite性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%85%E7%AD%96%E7%95%A5"><span class="toc-text"> 分包策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip%E5%8E%8B%E7%BC%A9"><span class="toc-text"> gzip压缩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5"><span class="toc-text"> 动态导入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cdn%E5%8A%A0%E9%80%9F"><span class="toc-text"> CDN加速</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E8%B7%A8%E5%9F%9F"><span class="toc-text"> Vite跨域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E6%80%BB%E7%BB%93"><span class="toc-text"> Vite总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pinia"><span class="toc-text"> Pinia</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-3"><span class="toc-text"> 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5"><span class="toc-text"> 引入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vue3"><span class="toc-text"> Vue3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vue2"><span class="toc-text"> Vue2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9state%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text"> 修改state的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#store"><span class="toc-text"> Store</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%84store"><span class="toc-text"> 解构store</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#getter%E5%92%8Cactions"><span class="toc-text"> getter和actions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pinia-api"><span class="toc-text"> Pinia API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pinia%E6%8F%92%E4%BB%B6"><span class="toc-text"> Pinia插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text"> 持久化</span></a></li></ol></li></ol></li></ol>
    </div>
  </section>

  

</div>


<!-- 没有 pjax 占位会报错 万恶的 pjax -->

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <!-- Custom Files side begin -->
  
  <!-- Custom Files side end -->
</aside>



          <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<pjax>
<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  pdata.commentConfig={};
  //  see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs
  
    // header
    var l_header=document.getElementById("l_header");
    
    l_header.classList.add("show");
    
    
      // cover
      var cover_wrapper=document.querySelector('#l_cover .cover-wrapper');
      var scroll_down=document.getElementById('scroll-down');
      cover_wrapper.id="none";
      cover_wrapper.style.display="none";
      scroll_down.style.display="none";
    
  
</script>
</pjax>
        </div>
        
  
  <footer class="footer clearfix"  itemscope itemtype="http://schema.org/WPFooter">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.3'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='320px'
      server='netease'
      type='playlist'
      id='2674113840'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper" itemprop="about" itemscope itemtype="http://schema.org/Thing">
          
            
          
            
          
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        
          <div><p><span id="lc-sv">本站总访问量为 <span id='number'><i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i></span> 次</span> <span id="lc-uv">访客数为 <span id='number'><i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i></span> 人</span></p>
</div>
        
      
    
      
        Use
        <a href="https://github.com/volantis-x/hexo-theme-volantis/#5.8.0" target="_blank" class="codename">Volantis</a>
        as theme
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright © since 2017 XXX</a></p>

        </div>
      
    
    <!-- Custom Files footer begin-->
    
    <!-- Custom Files footer end-->
  </footer>


        <a id="s-top" class="fa-solid fa-arrow-up fa-fw" href="/" onclick="return false;" title="top"></a>
      </div>
    </div>
    <div>
      <script>
  /******************** volantis.dom ********************************/
  // 页面选择器 将dom对象缓存起来 see: /source/js/app.js etc.
  volantis.dom.bodyAnchor = volantis.dom.$(document.getElementById("safearea")); // 页面主体
  volantis.dom.topBtn = volantis.dom.$(document.getElementById('s-top')); // 向上
  volantis.dom.wrapper = volantis.dom.$(document.getElementById('wrapper')); // 整个导航栏
  volantis.dom.coverAnchor = volantis.dom.$(document.querySelector('#l_cover .cover-wrapper')); // 1个
  volantis.dom.switcher = volantis.dom.$(document.querySelector('#l_header .switcher .s-search')); // 搜索按钮   移动端 1个
  volantis.dom.header = volantis.dom.$(document.getElementById('l_header')); // 移动端导航栏
  volantis.dom.search = volantis.dom.$(document.querySelector('#l_header .m_search')); // 搜索框 桌面端 移动端 1个
  volantis.dom.mPhoneList = volantis.dom.$(document.querySelectorAll('#l_header .m-phone .list-v')); //  手机端 子菜单 多个
</script>

<script>
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fortawesome/fontawesome-free/css/all.min.css");
  
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/font-awesome-animation/font-awesome-animation.min.css");
  
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/node-waves/dist/waves.min.css");
  
</script>

<!-- required -->

  
<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/jquery/dist/jquery.min.js"></script>



<!-- internal -->

<script src="/js/app.js"></script>





  













<div id="rightmenu-wrapper">
  <ul class="list-v rightmenu" id="rightmenu-content">
    
  <li class='navigation menuNavigation-Content'>


    <a class="nav icon-only fix-cursor-default" onclick="history.back()"><i class="fa-solid fa-arrow-left fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="history.forward()"><i class="fa-solid fa-arrow-right fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="window.location.reload()"><i class="fa-solid fa-redo fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="VolantisApp.scrolltoElement(volantis.dom.bodyAnchor)"><i class="fa-solid fa-arrow-up fa-fw"></i></a>


  </li>


    <hr class="menuLoad-Content" >



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyPaste" data-event="copyPaste" data-group="inputBox">
      <i class="fa-solid fa-paste fa-fw"></i>
      粘贴文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyAll" data-event="copyAll" data-group="inputBox">
      <i class="fa-solid fa-object-ungroup fa-fw"></i>
      全选文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyCut" data-event="copyCut" data-group="inputBox">
      <i class="fa-solid fa-cut fa-fw"></i>
      剪切文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyText" data-event="copyText" data-group="seletctText">
      <i class="fa-solid fa-copy fa-fw"></i>
      复制文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="searchWord" data-event="OpenSearch(__text__)" data-group="seletctText">
      <i class="fa-solid fa-search fa-fw"></i>
      站内搜索
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="bingSearch" data-event="window.open(`https://cn.bing.com/search?q=${__text__}`)" data-group="seletctText">
      <i class="fa-solid fa-search fa-fw"></i>
      必应搜索
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="openTab" data-event="window.open(__link__)" data-group="elementCheck">
      <i class="fa-solid fa-external-link-square-alt fa-fw"></i>
      新标签页打开
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyLink" data-event="copyLink" data-group="elementCheck">
      <i class="fa-solid fa-link fa-fw"></i>
      复制链接地址
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyImg" data-event="copyImg" data-group="elementImage">
      <i class="fa-solid fa-image fa-fw"></i>
      复制图片
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="googleImg" data-event="window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)" data-group="elementImage">
      <i class="fa-solid fa-images fa-fw"></i>
      谷歌识图
    </span>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="help" target="_blank" rel="noopener" href="https://volantis.js.org/faqs/" data-group="link">
      <i class="fa-solid fa-question fa-fw"></i>
      常见问题
    </a>
  </li>



    <hr class="menuLoad-Content" >



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="source_docs" target="_blank" rel="noopener" href="https://github.com/enderxiao/enderxiao.github.io/" data-group="link">
      <i class="fa-solid fa-code-branch fa-fw"></i>
      本站源码
    </a>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="source_theme" target="_blank" rel="noopener" href="https://github.com/volantis-x/hexo-theme-volantis/" data-group="link">
      <i class="fa-solid fa-code-branch fa-fw"></i>
      主题源码
    </a>
  </li>



    <hr class="menuLoad-Content" >



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="darkMode" data-event="volantis.dark.toggle()" data-group="darkMode">
      <i class="fa-solid fa-moon fa-fw"></i>
      暗黑模式
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="printMode" data-event="printMode" data-group="articlePage">
      <i class="fa-solid fa-print fa-fw"></i>
      打印页面
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="readMode" data-event="readMode" data-group="articlePage">
      <i class="fa-solid fa-book-open fa-fw"></i>
      阅读模式
    </span>
  </li>


<div id="menuMusic">
  <li class='music name menuOption-Content'>
    <p class='nav music-title fix-cursor-default'></p>
  </li>
  <li class='music ctrl'>
    <a class='nav icon-only backward fix-cursor-default' href="/" onclick="return false;" title="backward">
      <i class='fa-solid fa-step-backward fa-fw'></i>
    </a>
    <a class='nav icon-only toggle fix-cursor-default' href="/" onclick="return false;" title="toggle">
      <i class='fa-solid fa-play fa-fw'></i>
    </a>
    <a class='nav icon-only forward fix-cursor-default' href="/" onclick="return false;" title="forward">
      <i class='fa-solid fa-step-forward fa-fw'></i>
    </a>
  </li>
  <li class='music volume'>
    <div class='nav volume'>
      <div class="aplayer-volume-bar-wrap">
        <div class="aplayer-volume-bar fix-cursor-pointer">
          <div class="aplayer-volume"></div>
          <i class='left fa-solid fa-volume-off fa-fw'></i>
          <i class='right fa-solid fa-volume-up fa-fw'></i>
        </div>
      </div>
    </div>
  </li>
</div>

  </ul>
</div>
<script src="/js/plugins/rightMenus.js"></script>
<script>
  const RightMenusFunction = {};
  












  //RightMenusFunction['copyPaste'] = (fun) => {fun()}





  //RightMenusFunction['copyAll'] = (fun) => {fun()}





  //RightMenusFunction['copyCut'] = (fun) => {fun()}





  //RightMenusFunction['copyText'] = (fun) => {fun()}





  RightMenusFunction['searchWord'] = (__text__) => {OpenSearch(__text__)}





  RightMenusFunction['bingSearch'] = (__text__) => {window.open(`https://cn.bing.com/search?q=${__text__}`)}





  RightMenusFunction['openTab'] = (__link__) => {window.open(__link__)}





  //RightMenusFunction['copyLink'] = (fun) => {fun()}





  //RightMenusFunction['copyImg'] = (fun) => {fun()}





  RightMenusFunction['googleImg'] = (__link__) => {window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)}















  RightMenusFunction['darkMode'] = () => {volantis.dark.toggle()}





  //RightMenusFunction['printMode'] = (fun) => {fun()}





  //RightMenusFunction['readMode'] = (fun) => {fun()}





</script>



<!-- rightmenu要在darkmode之前（ToggleButton） darkmode要在comments之前（volantis.dark.push）-->

  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "color-scheme";
const rootElementDarkModeAttributeName = "color-scheme";
const setLS = (k, v) => {
    localStorage.setItem(k, v);
};
const removeLS = (k) => {
    localStorage.removeItem(k);
};
const getLS = (k) => {
    return localStorage.getItem(k);
};
const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};
const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};
const validColorModeKeys = {
  dark: true,
  light: true,
};
const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);
  getCustomDarkMode();
  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};
const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};
/**
 * get target mode
 */
 const getCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  if(currentSetting=="dark"){
    volantis.dark.mode="light";
  }else{
    volantis.dark.mode="dark";
  }
  // console.log(volantis.dark.mode)
};
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};
/**
 * 暗黑模式触发器
 */
volantis.dark.toggle=()=>{
  const mode = toggleCustomDarkMode();
  applyCustomDarkModeSettings(mode);
  // 使用 volantis.dark.push 方法传入volantis.dark.toggle回调函数 参见layout/_partial/scripts/global.ejs
  volantis.dark.method.toggle.start();
}
/**
 * bind event for toggle button
 */

function bindToggleButton() {
  var btn= document.querySelectorAll("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn")
  btn.forEach(function (e) {
    volantis.dom.$(e).on('click',volantis.dark.toggle);
  })
}
applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", ()=>{
  volantis.requestAnimationFrame(bindToggleButton)
});
volantis.pjax.push(bindToggleButton);

const darkModelListeners={
  dark:(mediaQueryList )=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "dark";
    }
    volantis.dark.method.toggle.start();
  },
  light:(mediaQueryList)=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "light";
    }
    volantis.dark.method.toggle.start();
  }
}
window.matchMedia('(prefers-color-scheme: dark)').addListener(darkModelListeners.dark)
window.matchMedia('(prefers-color-scheme: light)').addListener(darkModelListeners.light)
</script>




<script>
  function loadIssuesJS() {
    
      const sites_api = document.getElementById('sites-api');
      if (sites_api != undefined && typeof SitesJS === 'undefined') {
        volantis.js("/js/plugins/tags/sites.js")
      }
    
    
      const friends_api = document.getElementById('friends-api');
      if (friends_api != undefined && typeof FriendsJS === 'undefined') {
        volantis.js("/js/plugins/tags/friends.js")
      }
    
    
      const contributors_api = document.getElementById('contributors-api');
      if (contributors_api != undefined && typeof ContributorsJS === 'undefined') {
        volantis.js("/js/plugins/tags/contributors.js")
      }
    
  };
  loadIssuesJS()
  volantis.pjax.push(()=>{
    loadIssuesJS();
  })

</script>




  <script defer src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/vanilla-lazyload/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  

<script>
  window.FPConfig = {
	delay: 0,
	ignoreKeywords: ["#"],
	maxRPS: 6,
	hoverDelay: 0
  };
</script>
<script defer src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/flying-pages/flying-pages.min.js"></script>





   <script type="text/javascript">
  function pjax_scrollrebeal() {
    ScrollReveal().reveal("#l_main .reveal", {
      distance: "32px",
      duration: "800",
      interval: "20",
      scale: "0.9",
      easing: "ease-out",
    });
  }
  function init_scrollrebeal() {
    if (typeof ScrollReveal == "undefined") {
      volantis.requestAnimationFrame(init_scrollrebeal);
    } else {
      pjax_scrollrebeal();
    }
  }
  volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/scrollreveal/dist/scrollreveal.min.js");
  document.addEventListener("DOMContentLoaded", init_scrollrebeal);
  volantis.pjax.push(
    pjax_scrollrebeal,
    "pjax_scrollrebeal",
    (setRequestAnimationFrame = false)
  );
</script>




  <script>
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/aplayer/dist/APlayer.min.css");
  (async () => {
    // APlayer 需要在  MetingJS 之前加载
    await volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/aplayer/dist/APlayer.min.js")
    await volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/meting/dist/Meting.min.js")
  
    // 右键 music 需要在 APlayer  MetingJS 之后加载
    await volantis.js('/js/plugins/aplayer.js')
  
  })();

  function SetAPlayerPlugin(){
    let Metings = document.querySelectorAll('meting-js');
    if (Metings.length === 0) {return;};
    if (Metings[0].aplayer && Metings[0].aplayer.on) {
      // improve the accessibility https://web.dev/button-name/
      document.querySelectorAll(".aplayer-icon-menu").forEach(e=>{
        e.setAttribute("aria-label","Aplayer Menu")
      })
      // message see: /layout/_plugins/message/script.ejs
      
        try {
          setTimeout(() => {
            Metings.forEach((item, index) => {
              const aplayerItem = item.aplayer; if(!aplayerItem) return;
              const rightAplayerCheck = 'true' === 'true'
                && item.meta.id === '2674113840';
              if(rightAplayerCheck && typeof RightMenuAplayer !="undefined") RightMenuAplayer.checkAPlayer();
              if(aplayerItem.events.events.play.every(item => {return item.name !== 'messagePlay'})) {
                aplayerItem.on('play', function messagePlay() {
                  let index = aplayerItem.list.index;
                  let title = aplayerItem.list.audios[index].title;
                  let artist = aplayerItem.list.audios[index].artist;
                  setTimeout(() => {
                    VolantisApp.message('音乐通知', title + ' - ' + artist, {
                      icon: 'fa-solid fa-play',
                      transitionIn: 'flipInX',
                      transitionOut: 'flipOutX'
                    });
                  }, 100)
                });
              }
              if(aplayerItem.events.events.pause.every(item => {return item.name !== 'messagePause'})) {
                aplayerItem.on('pause', function messagePause() {
                  let index = aplayerItem.list.index;
                  let title = aplayerItem.list.audios[index].title;
                  let artist = aplayerItem.list.audios[index].artist;
                  setTimeout(() => {
                    // 歌曲播放结束也会触发 pause 事件，为了避免错误提示，等待一会儿
                    if(aplayerItem.paused) {
                      VolantisApp.message('音乐通知', title + ' - ' + artist, {
                        icon: 'fa-solid fa-pause',
                        transitionIn: 'flipInX',
                        transitionOut: 'flipOutX'
                      });
                    }
                  }, 100)
                });
              }
            });
          }, 500)
        } catch (error) { console.error(error); }
      
    }else{
      volantis.requestAnimationFrame(SetAPlayerPlugin)
    }
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    SetAPlayerPlugin();
  });
  volantis.pjax.push(SetAPlayerPlugin);
</script>




      <script>
  volantis.layoutHelper("comments",`<div id="giscus_container"></div>`)

  volantis.giscus = {};

  function check_giscus() {
    if (volantis.dark.mode === "dark") {
      volantis.giscus.Theme = 'dark';
    } else {
      volantis.giscus.Theme = 'light';
    }

    return document.getElementById("giscus_container");
  }

  function pjax_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;
    let cfg = Object.assign({"theme":{"light":"light","dark":"dark"},"repo":"EnderXiao/myrepo","repo-id":"R_kgDOH8NryQ","category":"General","category-id":"DIC_kwDOH8Nryc4CRPWQ","mapping":"pathname","reactions-enabled":"1","emit-metadata":"0","lang":"zh-CN"},pdata.commentConfig)
    const script = document.createElement('script');
    script.setAttribute('src', 'https://giscus.app/client.js');
    Object.keys(cfg).forEach(k=>{
      if (k != "theme") {
        script.setAttribute('data-'+k, cfg[k]);
      }
    })
    script.setAttribute('data-theme', volantis.giscus.Theme);
    script.setAttribute('crossorigin', "anonymous");
    HEAD.appendChild(script);
  }

  function dark_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;

    const message = {
      setConfig: {
        theme: volantis.giscus.Theme
      }
    };
    const giscusIframe = document.querySelector('iframe.giscus-frame');
    giscusIframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
  }
  pjax_giscus();
  volantis.pjax.push(pjax_giscus);
  volantis.dark.push(dark_giscus);
</script>

    





<!-- optional -->

  <script>
  const SearchServiceDataPathRoot = ("/" || "/").endsWith("/") ?
    "/" || "/" :
    "//" || "/";
  const SearchServiceDataPath = SearchServiceDataPathRoot + "content.json";

  function loadSearchScript() {
    // see: layout/_partial/scripts/_ctrl/cdnCtrl.ejs
    return volantis.js("/js/search/hexo.js");
  }

  function loadSearchService() {
    loadSearchScript();
    document.querySelectorAll(".input.u-search-input").forEach((e) => {
      e.removeEventListener("focus", loadSearchService, false);
    });

    document.querySelectorAll(".u-search-form").forEach((e) => {
      e.addEventListener("submit", (event) => {
        event.preventDefault();
      }, false);
    });
  }

  // 打开并搜索 字符串 s
  function OpenSearch(s) {
    if (typeof SearchService === 'undefined')
      loadSearchScript().then(() => {
        SearchService.setQueryText(s);
        SearchService.search();
      });
    else {
      SearchService.setQueryText(s);
      SearchService.search();
    }
  }

  // 访问含有 ?s=xxx  的链接时打开搜索 // 与搜索引擎 structured data 相关: /scripts/helpers/structured-data/lib/config.js
  if (window.location.search && /^\?s=/g.test(window.location.search)) {
    let queryText = decodeURI(window.location.search)
      .replace(/\ /g, "-")
      .replace(/^\?s=/g, "");
    OpenSearch(queryText);
  }

  // 搜索输入框获取焦点时加载搜索
  document.querySelectorAll(".input.u-search-input").forEach((e) => {
    e.addEventListener("focus", loadSearchService, false);
  });
</script>



  
<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/node-waves/dist/waves.min.js"></script>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function () {
  Waves.attach('.flat-btn', ['waves-button']);
  Waves.attach('.float-btn', ['waves-button', 'waves-float']);
  Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
  Waves.attach('.flat-box', ['waves-block']);
  Waves.attach('.float-box', ['waves-block', 'waves-float']);
  Waves.attach('.waves-image');
  Waves.init();
});
</script>



  
<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/comment_typing/comment_typing.js"></script>




  <script>



  function pjax_highlightjs_copyCode(){
    if (!(document.querySelector(".highlight .code pre") ||
      document.querySelector(".article pre code"))) {
      return;
    }
    VolantisApp.utilCopyCode(".highlight .code pre, .article pre code")
  }
  volantis.requestAnimationFrame(pjax_highlightjs_copyCode)
  volantis.pjax.push(pjax_highlightjs_copyCode)

</script>




  <script defer>

  const LCCounter = {
    app_id: 'u9j57bwJod4EDmXWdxrwuqQT-MdYXbMMI',
    app_key: 'jfHtEKVE24j0IVCGHbvuFClp',
    custom_api_server: '',

    // 查询存储的记录
    getRecord(Counter, url, title) {
      return new Promise(function (resolve, reject) {
        Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({url})))
          .then(resp => resp.json())
          .then(({results, code, error}) => {
            if (code === 401) {
              throw error;
            }
            if (results && results.length > 0) {
              var record = results[0];
              resolve(record);
            } else {
              Counter('post', '/classes/Counter', {url, title: title, times: 0})
                .then(resp => resp.json())
                .then((record, error) => {
                  if (error) {
                    throw error;
                  }
                  resolve(record);
                }).catch(error => {
                console.error('Failed to create', error);
                reject(error);
              });
            }
          }).catch((error) => {
          console.error('LeanCloud Counter Error:', error);
          reject(error);
        });
      })
    },

    // 发起自增请求
    increment(Counter, incrArr) {
      return new Promise(function (resolve, reject) {
        Counter('post', '/batch', {
          "requests": incrArr
        }).then((res) => {
          res = res.json();
          if (res.error) {
            throw res.error;
          }
          resolve(res);
        }).catch((error) => {
          console.error('Failed to save visitor count', error);
          reject(error);
        });
      });
    },

    // 构建自增请求体
    buildIncrement(objectId) {
      return {
        "method": "PUT",
        "path": `/1.1/classes/Counter/${ objectId }`,
        "body": {
          "times": {
            '__op': 'Increment',
            'amount': 1
          }
        }
      }
    },

    // 校验是否为有效的 UV
    validUV() {
      var key = 'LeanCloudUVTimestamp';
      var flag = localStorage.getItem(key);
      if (flag) {
        // 距离标记小于 24 小时则不计为 UV
        if (new Date().getTime() - parseInt(flag) <= 86400000) {
          return false;
        }
      }
      localStorage.setItem(key, new Date().getTime().toString());
      return true;
    },

    addCount(Counter) {
      var enableIncr = '' === 'true' && window.location.hostname !== 'localhost';
      enableIncr = true;
      var getterArr = [];
      var incrArr = [];
      // 请求 PV 并自增
      var pvCtn = document.querySelector('#lc-sv');
      if (pvCtn || enableIncr) {
        var pvGetter = this.getRecord(Counter, 'http://enderxiao.github.io' + '/#lc-sv', 'Visits').then((record) => {
          incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-sv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + 1;
              if (pvCtn) {
                pvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(pvGetter);
      }

      // 请求 UV 并自增
      var uvCtn = document.querySelector('#lc-uv');
      if (uvCtn || enableIncr) {
        var uvGetter = this.getRecord(Counter, 'http://enderxiao.github.io' + '/#lc-uv', 'Visitors').then((record) => {
          var vuv = this.validUV();
          vuv && incrArr.push(this.buildIncrement(record.objectId))
          var eles = document.querySelectorAll('#lc-uv #number');
          if (eles.length > 0) {
            eles.forEach((el,index,array)=>{
              el.innerText = record.times + (vuv ? 1 : 0);
              if (uvCtn) {
                uvCtn.style.display = 'inline';
              }
            })
          }
        });
        getterArr.push(uvGetter);
      }

      // 请求文章的浏览数，如果是当前页面就自增
      var allPV = document.querySelectorAll('#lc-pv');
      if (allPV.length > 0 || enableIncr) {
        for (i = 0; i < allPV.length; i++) {
          let pv = allPV[i];
          let title = pv.getAttribute('data-title');
          var url = 'http://enderxiao.github.io' + pv.getAttribute('data-path');
          if (url) {
            var viewGetter = this.getRecord(Counter, url, title).then((record) => {
              // 是当前页面就自增
              let curPath = window.location.pathname;
              if (curPath.includes('index.html')) {
                curPath = curPath.substring(0, curPath.lastIndexOf('index.html'));
              }
              if (pv.getAttribute('data-path') == curPath) {
                incrArr.push(this.buildIncrement(record.objectId));
              }
              if (pv) {
                var ele = pv.querySelector('#lc-pv #number');
                if (ele) {
                  if (pv.getAttribute('data-path') == curPath) {
                    ele.innerText = (record.times || 0) + 1;
                  } else {
                    ele.innerText = record.times || 0;
                  }
                  pv.style.display = 'inline';
                }
              }
            });
            getterArr.push(viewGetter);
          }
        }
      }

      // 如果启动计数自增，批量发起自增请求
      if (enableIncr) {
        Promise.all(getterArr).then(() => {
          incrArr.length > 0 && this.increment(Counter, incrArr);
        })
      }

    },


    fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${ api_server }/1.1${ url }`, {
          method,
          headers: {
            'X-LC-Id': this.app_id,
            'X-LC-Key': this.app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      this.addCount(Counter);
    },

    refreshCounter() {
      var api_server = this.custom_api_server || `https://${ this.app_id.slice(0, 8).toLowerCase() }.api.lncldglobal.com`;
      if (api_server) {
        this.fetchData(api_server);
      } else {
        fetch('https://app-router.leancloud.cn/2/route?appId=' + this.app_id)
          .then(resp => resp.json())
          .then(({api_server}) => {
            this.fetchData('https://' + api_server);
          });
      }
    }

  };

  LCCounter.refreshCounter();

  document.addEventListener('pjax:complete', function () {
    LCCounter.refreshCounter();
  });
</script>








  <script>
  let imgs = ["https://z3.ax1x.com/2021/08/05/fegggS.jpg"];
  let index = 0;
  let IntervalParallax = null;

  function parallax(){
    let ParallaxWindow = document.querySelector("#parallax-window");
    
    Parallax.window = ParallaxWindow;
    Parallax.options.fade = 1500;
    Parallax.cache = 1;
    next_parallax();
    Parallax.init();
    if (imgs.length>1) {
      IntervalParallax = setInterval(function () {
        next_parallax();
      }, '10000');
    }
  }

  function next_parallax() {
    if (typeof Parallax == "undefined") {
      return
    }
    
      if (!document.querySelector("#full")&&!document.querySelector("#half")) {
        return
      }
    
    if (imgs.length>=1) {
      Parallax.options.src = imgs[index % imgs.length];
      Parallax.start();
      index++;
      if (Parallax.cache) {
        fetch(imgs[index % imgs.length] +"?t=" + new Date().getTime());
        if (index == imgs.length) {
          Parallax.cache = 0;
        }
      }
    }
  }
  var runningOnBrowser = typeof window !== "undefined";
  var isBot = runningOnBrowser && !("onscroll" in window) || typeof navigator !== "undefined" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);
  if (!isBot) {
    volantis.js('/js/plugins/parallax.js').then(()=>{
      parallax()
    })
    volantis.pjax.send(()=>{
      clearInterval(IntervalParallax)
    },"clearIntervalParallax");
    volantis.pjax.push(parallax);
  }
</script>




  <script>
  function load_swiper() {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/swiper/swiper-bundle.min.css");
    volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/swiper/swiper-bundle.min.js").then(() => {
      pjax_swiper();
    });
  }

  load_swiper();

  function pjax_swiper() {
    volantis.swiper = new Swiper('.swiper-container', {
      slidesPerView: 'auto',
      spaceBetween: 8,
      centeredSlides: true,
      loop: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    });
  }

  volantis.pjax.push(() => {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    if (typeof volantis.swiper === "undefined") {
      load_swiper();
    } else {
      pjax_swiper();
    }
  });
</script>


<!-- pjax 标签必须存在于所有页面 否则 pjax error -->
<pjax>

        <script>
  // https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/math/mathjax.swig
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = "https://unpkg.com/volantis-static@0.0.1654736714924/libs/mathjax/es5/tex-mml-chtml.js";
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    // 文章章节标题不能为 “MathJax” ，否则会报错。
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typesetPromise();
  }
</script>



</pjax>

<script>
  function listennSidebarTOC() {
    const navItems = document.querySelectorAll(".toc li");
    if (!navItems.length) return;
    let targets = []
    const sections = [...navItems].map((element) => {
      const link = element.querySelector(".toc-link");
      const target = document.getElementById(
        decodeURI(link.getAttribute("href")).replace("#", "")
      );
      targets.push(target)
      // 解除 a 标签 href 的 锚点定位, a 标签 href 的 锚点定位 会随机启用?? 产生错位???
      link.setAttribute("onclick","return false;")
      link.setAttribute("toc-action","toc-"+decodeURI(link.getAttribute("href")).replace("#", ""))
      link.setAttribute("href","/")
      // 配置 点击 触发新的锚点定位
      link.addEventListener("click", (event) => {
        event.preventDefault();
        // 这里的 addTop 是通过错位使得 toc 自动展开.
        volantis.scroll.to(target,{addTop: 5, observer:true})
        // Anchor id
        history.pushState(null, document.title, "#" + target.id);
      });
      return target;
    });

    function activateNavByIndex(target) {
      if (target.classList.contains("active-current")) return;

      document.querySelectorAll(".toc .active").forEach((element) => {
        element.classList.remove("active", "active-current");
      });
      target.classList.add("active", "active-current");
      let parent = target.parentNode;
      while (!parent.matches(".toc")) {
        if (parent.matches("li")) parent.classList.add("active");
        parent = parent.parentNode;
      }
    }

    // 方案一：
    volantis.activateNavIndex=0
    activateNavByIndex(navItems[volantis.activateNavIndex])
    volantis.scroll.push(()=>{
      if (targets[0].getBoundingClientRect().top >= 0) {
        volantis.activateNavIndex = 0
      }else if (targets[targets.length-1].getBoundingClientRect().top < 0) {
        volantis.activateNavIndex = targets.length-1
      } else {
        for (let index = 0; index < targets.length; index++) {
          const target0 = targets[index];
          const target1 = targets[(index+1)%targets.length];
          if (target0.getBoundingClientRect().top < 0&&target1.getBoundingClientRect().top >= 0) {
            volantis.activateNavIndex=index
            break;
          }
        }
      }
      activateNavByIndex(navItems[volantis.activateNavIndex])
    })

    // 方案二：
    // IntersectionObserver 不是完美精确到像素级别 也不是低延时性的
    // function findIndex(entries) {
    //   let index = 0;
    //   let entry = entries[index];
    //   if (entry.boundingClientRect.top > 0) {
    //     index = sections.indexOf(entry.target);
    //     return index === 0 ? 0 : index - 1;
    //   }
    //   for (; index < entries.length; index++) {
    //     if (entries[index].boundingClientRect.top <= 0) {
    //       entry = entries[index];
    //     } else {
    //       return sections.indexOf(entry.target);
    //     }
    //   }
    //   return sections.indexOf(entry.target);
    // }
    // function createIntersectionObserver(marginTop) {
    //   marginTop = Math.floor(marginTop + 10000);
    //   let intersectionObserver = new IntersectionObserver(
    //     (entries, observe) => {
    //       let scrollHeight = document.documentElement.scrollHeight;
    //       if (scrollHeight > marginTop) {
    //         observe.disconnect();
    //         createIntersectionObserver(scrollHeight);
    //         return;
    //       }
    //       let index = findIndex(entries);
    //       activateNavByIndex(navItems[index]);
    //     }, {
    //       rootMargin: marginTop + "px 0px -100% 0px",
    //       threshold: 0,
    //     }
    //   );
    //   sections.forEach((element) => {
    //     element && intersectionObserver.observe(element);
    //   });
    // }
    // createIntersectionObserver(document.documentElement.scrollHeight);
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    volantis.requestAnimationFrame(listennSidebarTOC)
  });
  document.addEventListener("pjax:success", ()=>{
    volantis.requestAnimationFrame(listennSidebarTOC)
  });
</script>



<script>
  document.onreadystatechange = function () {
    if (document.readyState == 'complete') {
      // 页面加载完毕 样式加载失败，或是当前网速慢，或是开启了省流模式
      const { saveData, effectiveType } = navigator.connection || navigator.mozConnection || navigator.webkitConnection || {}
      if (getComputedStyle(document.querySelector("#safearea"), null)["display"] == "none" || saveData || /2g/.test(effectiveType)) {
        document.querySelectorAll(".reveal").forEach(function (e) {
          e.style["opacity"] = "1";
        });
        document.querySelector("#safearea").style["display"] = "block";
      }
    }
  }
</script>


  <script type="application/ld+json">[{"@context":"http://schema.org","@type":"Organization","name":"Ender","url":"http://enderxiao.github.io/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},{"@context":"http://schema.org","@type":"Person","name":"John Doe","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://enderxiao.github.io/","sameAs":["https://github.com/volantis-x"],"description":"a blog of EnderXiao"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"http://enderxiao.github.io/","name":"Ender"}},{"@type":"ListItem","position":2,"item":{"@id":"http://enderxiao.github.io/categories/前端/","name":"前端"}},{"@type":"ListItem","position":2,"item":{"@id":"http://enderxiao.github.io/categories/前端/Vite/","name":"Vite"}},{"@type":"ListItem","position":3,"item":{"@id":"http://enderxiao.github.io/2023/08/09/前端补缺Vite/","name":"前端补缺Vite"}}]},{"@context":"http://schema.org","@type":"WebSite","name":"Ender","url":"http://enderxiao.github.io/","keywords":"Blog EnderXiao","description":"a blog of EnderXiao","author":{"@type":"Person","name":"John Doe","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://enderxiao.github.io/","description":"a blog of EnderXiao"},"publisher":{"@type":"Organization","name":"Ender","url":"http://enderxiao.github.io/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"potentialAction":{"@type":"SearchAction","name":"Site Search","target":{"@type":"EntryPoint","urlTemplate":"http://enderxiao.github.io?s={search_term_string}"},"query-input":"required name=search_term_string"}},{"@context":"http://schema.org","@type":"BlogPosting","headline":"前端补缺Vite","description":"a blog of EnderXiao","inLanguage":["en","zh-CN","zh-HK","zh-TW","default"],"mainEntityOfPage":{"@type":"WebPage","@id":"http://enderxiao.github.io/2023/08/09/%E5%89%8D%E7%AB%AF%E8%A1%A5%E7%BC%BAVite/"},"author":{"@type":"Person","name":"John Doe","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://enderxiao.github.io/"},"publisher":{"@type":"Organization","name":"Ender","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"url":"http://enderxiao.github.io/2023/08/09/%E5%89%8D%E7%AB%AF%E8%A1%A5%E7%BC%BAVite/","wordCount":0,"datePublished":"2023-08-09T08:11:25.000Z","dateModified":"2024-07-30T11:26:33.927Z","articleSection":"前端","keywords":"life","image":{"@type":"ImageObject","url":"https://z3.ax1x.com/2021/08/05/fego40.png","width":1024,"height":768}}]</script>



      
        <!--
  pjax重载区域接口：
  1.  <pjax></pjax> 标签 pjax 标签必须存在于所有页面 否则 pjax error
  2.  script[data-pjax]
  3.  .pjax-reload script
  4.  .pjax
-->



<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/pjax/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox]):not([onclick="return false;"]):not([onclick="return!1"]):not([target="_blank"]):not([target="view_window"]):not([href$=".xml"])',
        selectors: [
          "head title",
          "head meta[name=keywords]",
          "head meta[name=description]",
          
          "#l_main",
          "#pjax-header-nav-list",
          ".pjax",
          "pjax", // <pjax></pjax> 标签
          "script[data-pjax], .pjax-reload script" // script标签添加data-pjax 或 script标签外层添加.pjax-reload 的script代码段重载
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000,
        
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      // 使用 volantis.pjax.send 方法传入pjax:send回调函数 参见layout/_partial/scripts/global.ejs
      volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      // 使用 volantis.pjax.push 方法传入重载函数 参见layout/_partial/scripts/global.ejs
      volantis.pjax.method.complete.start();
    });

    document.addEventListener('pjax:error', function (e) {
      if(volantis.debug) {
        console.error(e);
        console.log('pjax error: \n' + JSON.stringify(e));
      }else{
        // 使用 volantis.pjax.error 方法传入pjax:error回调函数 参见layout/_partial/scripts/global.ejs
        volantis.pjax.method.error.start();
        window.location.href = e.triggerElement.href;
      }
    });
</script>

      
    </div>
    <!-- import body_end begin-->
    <!-- import body_end end-->
    <!-- Custom Files bodyEnd begin-->
    
    <!-- Custom Files bodyEnd end-->
    <!-- front-matter body_end begin -->
    <!-- front-matter body_end end -->
  </body>
</html>
